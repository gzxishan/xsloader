{"version":3,"file":"xsloader.js","sources":["../src/polyfill/json.js","../src/util/global.js","../src/core/loader.js","../src/util/urls.js","../src/util/base.js","../src/util/index.js","../src/public/global-deprecated.js","../src/public/global-base.js","../src/public/is.js","../src/public/funs.js","../src/public/browser.js","../src/public/index.js","../src/core/module-def.js","../src/core/module.js","../src/core/script.js","../src/core/index.js","../src/define.js","../src/core/plugins/inner-dep.js","../src/core/plugins/ready.js","../src/core/plugins/try.js","../src/core/plugins/nodeps.js","../src/core/plugins/exists.js","../src/core/plugins/name.js","../src/core/plugins/css.js","../src/core/plugins/text.js","../src/core/plugins/window.js","../src/core/plugins/withdeps.js","../src/core/plugins/json.js","../src/core/plugins/xshttp.js","../src/core/plugins/xsrequest.js","../src/core/plugins/xsmsg.js","../src/service.js","../src/main.js"],"sourcesContent":["//https://github.com/douglascrockford/JSON-js\n//  json2.js\n//  2017-06-12\n//  Public Domain.\n//  NO WARRANTY EXPRESSED OR IMPLIED. USE AT YOUR OWN RISK.\n\n//  USE YOUR OWN COPY. IT IS EXTREMELY UNWISE TO LOAD CODE FROM SERVERS YOU DO\n//  NOT CONTROL.\nconst JSON = {};\n\nexport default JSON;\n\nlet rx_one = /^[\\],:{}\\s]*$/;\nlet rx_two = /\\\\(?:[\"\\\\\\/bfnrt]|u[0-9a-fA-F]{4})/g;\nlet rx_three = /\"[^\"\\\\\\n\\r]*\"|true|false|null|-?\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d+)?/g;\nlet rx_four = /(?:^|:|,)(?:\\s*\\[)+/g;\nlet rx_escapable = /[\\\\\"\\u0000-\\u001f\\u007f-\\u009f\\u00ad\\u0600-\\u0604\\u070f\\u17b4\\u17b5\\u200c-\\u200f\\u2028-\\u202f\\u2060-\\u206f\\ufeff\\ufff0-\\uffff]/g;\nlet rx_dangerous = /[\\u0000\\u00ad\\u0600-\\u0604\\u070f\\u17b4\\u17b5\\u200c-\\u200f\\u2028-\\u202f\\u2060-\\u206f\\ufeff\\ufff0-\\uffff]/g;\n\nfunction f(n) {\n\t// Format integers to have at least two digits.\n\treturn(n < 10) ?\n\t\t\"0\" + n :\n\t\tn;\n}\n\nfunction this_value() {\n\treturn this.valueOf();\n}\n\nif(typeof Date.prototype.toJSON !== \"function\") {\n\n\tDate.prototype.toJSON = function() {\n\t\treturn isFinite(this.valueOf()) ?\n\t\t\t(\n\t\t\t\tthis.getUTCFullYear() +\n\t\t\t\t\"-\" +\n\t\t\t\tf(this.getUTCMonth() + 1) +\n\t\t\t\t\"-\" +\n\t\t\t\tf(this.getUTCDate()) +\n\t\t\t\t\"T\" +\n\t\t\t\tf(this.getUTCHours()) +\n\t\t\t\t\":\" +\n\t\t\t\tf(this.getUTCMinutes()) +\n\t\t\t\t\":\" +\n\t\t\t\tf(this.getUTCSeconds()) +\n\t\t\t\t\"Z\"\n\t\t\t) :\n\t\t\tnull;\n\t};\n\n\tBoolean.prototype.toJSON = this_value;\n\tNumber.prototype.toJSON = this_value;\n\tString.prototype.toJSON = this_value;\n}\n\nlet gap;\nlet indent;\nlet meta;\nlet rep;\n\nfunction quote(string) {\n\n\t// If the string contains no control characters, no quote characters, and no\n\t// backslash characters, then we can safely slap some quotes around it.\n\t// Otherwise we must also replace the offending characters with safe escape\n\t// sequences.\n\n\trx_escapable.lastIndex = 0;\n\treturn rx_escapable.test(string) ?\n\t\t\"\\\"\" + string.replace(rx_escapable, function(a) {\n\t\t\tlet c = meta[a];\n\t\t\treturn typeof c === \"string\" ?\n\t\t\t\tc :\n\t\t\t\t\"\\\\u\" + (\"0000\" + a.charCodeAt(0).toString(16)).slice(-4);\n\t\t}) + \"\\\"\" :\n\t\t\"\\\"\" + string + \"\\\"\";\n}\n\nfunction str(key, holder) {\n\t// Produce a string from holder[key].\n\tlet i; // The loop counter.\n\tlet k; // The member key.\n\tlet v; // The member value.\n\tlet length;\n\tlet mind = gap;\n\tlet partial;\n\tlet value = holder[key];\n\n\t// If the value has a toJSON method, call it to obtain a replacement value.\n\tif(\n\t\tvalue &&\n\t\ttypeof value === \"object\" &&\n\t\ttypeof value.toJSON === \"function\"\n\t) {\n\t\tvalue = value.toJSON(key);\n\t}\n\n\t// If we were called with a replacer function, then call the replacer to\n\t// obtain a replacement value.\n\n\tif(typeof rep === \"function\") {\n\t\tvalue = rep.call(holder, key, value);\n\t}\n\n\t// What happens next depends on the value's type.\n\n\tswitch(typeof value) {\n\t\tcase \"string\":\n\t\t\treturn quote(value);\n\t\tcase \"number\":\n\t\t\t// JSON numbers must be finite. Encode non-finite numbers as null.\n\t\t\treturn(isFinite(value)) ?\n\t\t\t\tString(value) :\n\t\t\t\t\"null\";\n\n\t\tcase \"boolean\":\n\t\tcase \"null\":\n\t\t\t// If the value is a boolean or null, convert it to a string. Note:\n\t\t\t// typeof null does not produce \"null\". The case is included here in\n\t\t\t// the remote chance that this gets fixed someday.\n\t\t\treturn String(value);\n\n\t\t\t// If the type is \"object\", we might be dealing with an object or an array or\n\t\t\t// null.\n\t\tcase \"object\":\n\t\t\t// Due to a specification blunder in ECMAScript, typeof null is \"object\",\n\t\t\t// so watch out for that case.\n\t\t\tif(!value) {\n\t\t\t\treturn \"null\";\n\t\t\t}\n\n\t\t\t// Make an array to hold the partial results of stringifying this object value.\n\n\t\t\tgap += indent;\n\t\t\tpartial = [];\n\t\t\t// Is the value an array?\n\t\t\tif(Object.prototype.toString.apply(value) === \"[object Array]\") {\n\n\t\t\t\t// The value is an array. Stringify every element. Use null as a placeholder\n\t\t\t\t// for non-JSON values.\n\t\t\t\tlength = value.length;\n\t\t\t\tfor(i = 0; i < length; i += 1) {\n\t\t\t\t\tpartial[i] = str(i, value) || \"null\";\n\t\t\t\t}\n\t\t\t\t// Join all of the elements together, separated with commas, and wrap them in\n\t\t\t\t// brackets.\n\n\t\t\t\tv = partial.length === 0 ?\n\t\t\t\t\t\"[]\" :\n\t\t\t\t\tgap ?\n\t\t\t\t\t(\n\t\t\t\t\t\t\"[\\n\" +\n\t\t\t\t\t\tgap +\n\t\t\t\t\t\tpartial.join(\",\\n\" + gap) +\n\t\t\t\t\t\t\"\\n\" +\n\t\t\t\t\t\tmind +\n\t\t\t\t\t\t\"]\"\n\t\t\t\t\t) :\n\t\t\t\t\t\"[\" + partial.join(\",\") + \"]\";\n\t\t\t\tgap = mind;\n\t\t\t\treturn v;\n\t\t\t}\n\n\t\t\t// If the replacer is an array, use it to select the members to be stringified.\n\t\t\tif(rep && typeof rep === \"object\") {\n\t\t\t\tlength = rep.length;\n\t\t\t\tfor(i = 0; i < length; i += 1) {\n\t\t\t\t\tif(typeof rep[i] === \"string\") {\n\t\t\t\t\t\tk = rep[i];\n\t\t\t\t\t\tv = str(k, value);\n\t\t\t\t\t\tif(v) {\n\t\t\t\t\t\t\tpartial.push(quote(k) + (\n\t\t\t\t\t\t\t\t(gap) ?\n\t\t\t\t\t\t\t\t\": \" : \":\"\n\t\t\t\t\t\t\t) + v);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// Otherwise, iterate through all of the keys in the object.\n\t\t\t\tfor(k in value) {\n\t\t\t\t\tif(Object.prototype.hasOwnProperty.call(value, k)) {\n\t\t\t\t\t\tv = str(k, value);\n\t\t\t\t\t\tif(v) {\n\t\t\t\t\t\t\tpartial.push(quote(k) + (\n\t\t\t\t\t\t\t\t(gap) ?\n\t\t\t\t\t\t\t\t\": \" :\n\t\t\t\t\t\t\t\t\":\"\n\t\t\t\t\t\t\t) + v);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Join all of the member texts together, separated with commas,\n\t\t\t// and wrap them in braces.\n\n\t\t\tv = partial.length === 0 ?\n\t\t\t\t\"{}\" : gap ?\n\t\t\t\t\"{\\n\" + gap + partial.join(\",\\n\" + gap) + \"\\n\" + mind + \"}\" :\n\t\t\t\t\"{\" + partial.join(\",\") + \"}\";\n\t\t\tgap = mind;\n\t\t\treturn v;\n\t}\n}\n\n// If the JSON object does not yet have a stringify method, give it one.\nif(typeof JSON.stringify !== \"function\") {\n\tmeta = { // table of character substitutions\n\t\t\"\\b\": \"\\\\b\",\n\t\t\"\\t\": \"\\\\t\",\n\t\t\"\\n\": \"\\\\n\",\n\t\t\"\\f\": \"\\\\f\",\n\t\t\"\\r\": \"\\\\r\",\n\t\t\"\\\"\": \"\\\\\\\"\",\n\t\t\"\\\\\": \"\\\\\\\\\"\n\t};\n\tJSON.stringify = function(value, replacer, space) {\n\n\t\t// The stringify method takes a value and an optional replacer, and an optional\n\t\t// space parameter, and returns a JSON text. The replacer can be a function\n\t\t// that can replace values, or an array of strings that will select the keys.\n\t\t// A default replacer method can be provided. Use of the space parameter can\n\t\t// produce text that is more easily readable.\n\n\t\tlet i;\n\t\tgap = \"\";\n\t\tindent = \"\";\n\t\t// If the space parameter is a number, make an indent string containing that\n\t\t// many spaces.\n\t\tif(typeof space === \"number\") {\n\t\t\tfor(i = 0; i < space; i += 1) {\n\t\t\t\tindent += \" \";\n\t\t\t}\n\n\t\t\t// If the space parameter is a string, it will be used as the indent string.\n\n\t\t} else if(typeof space === \"string\") {\n\t\t\tindent = space;\n\t\t}\n\n\t\t// If there is a replacer, it must be a function or an array.\n\t\t// Otherwise, throw an error.\n\n\t\trep = replacer;\n\t\tif(replacer && typeof replacer !== \"function\" && (\n\t\t\t\ttypeof replacer !== \"object\" ||\n\t\t\t\ttypeof replacer.length !== \"number\"\n\t\t\t)) {\n\t\t\tthrow new Error(\"JSON.stringify\");\n\t\t}\n\n\t\t// Make a fake root object containing our value under the key of \"\".\n\t\t// Return the result of stringifying the value.\n\n\t\treturn str(\"\", {\n\t\t\t\"\": value\n\t\t});\n\t};\n}\n\n// If the JSON object does not yet have a parse method, give it one.\n\nif(typeof JSON.parse !== \"function\") {\n\tJSON.parse = function(text, reviver) {\n\t\t// The parse method takes a text and an optional reviver function, and returns\n\t\t// a JavaScript value if the text is a valid JSON text.\n\t\tlet j;\n\n\t\tfunction walk(holder, key) {\n\t\t\t// The walk method is used to recursively walk the resulting structure so\n\t\t\t// that modifications can be made.\n\t\t\tlet k;\n\t\t\tlet v;\n\t\t\tlet value = holder[key];\n\t\t\tif(value && typeof value === \"object\") {\n\t\t\t\tfor(k in value) {\n\t\t\t\t\tif(Object.prototype.hasOwnProperty.call(value, k)) {\n\t\t\t\t\t\tv = walk(value, k);\n\t\t\t\t\t\tif(v !== undefined) {\n\t\t\t\t\t\t\tvalue[k] = v;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tdelete value[k];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn reviver.call(holder, key, value);\n\t\t}\n\n\t\t// Parsing happens in four stages. In the first stage, we replace certain\n\t\t// Unicode characters with escape sequences. JavaScript handles many characters\n\t\t// incorrectly, either silently deleting them, or treating them as line endings.\n\t\ttext = String(text);\n\t\trx_dangerous.lastIndex = 0;\n\t\tif(rx_dangerous.test(text)) {\n\t\t\ttext = text.replace(rx_dangerous, function(a) {\n\t\t\t\treturn(\n\t\t\t\t\t\"\\\\u\" +\n\t\t\t\t\t(\"0000\" + a.charCodeAt(0).toString(16)).slice(-4)\n\t\t\t\t);\n\t\t\t});\n\t\t}\n\n\t\t// In the second stage, we run the text against regular expressions that look\n\t\t// for non-JSON patterns. We are especially concerned with \"()\" and \"new\"\n\t\t// because they can cause invocation, and \"=\" because it can cause mutation.\n\t\t// But just to be safe, we want to reject all unexpected forms.\n\n\t\t// We split the second stage into 4 regexp operations in order to work around\n\t\t// crippling inefficiencies in IE's and Safari's regexp engines. First we\n\t\t// replace the JSON backslash pairs with \"@\" (a non-JSON character). Second, we\n\t\t// replace all simple value tokens with \"]\" characters. Third, we delete all\n\t\t// open brackets that follow a colon or comma or that begin the text. Finally,\n\t\t// we look to see that the remaining characters are only whitespace or \"]\" or\n\t\t// \",\" or \":\" or \"{\" or \"}\". If that is so, then the text is safe for eval.\n\n\t\tif(\n\t\t\trx_one.test(\n\t\t\t\ttext\n\t\t\t\t.replace(rx_two, \"@\")\n\t\t\t\t.replace(rx_three, \"]\")\n\t\t\t\t.replace(rx_four, \"\")\n\t\t\t)\n\t\t) {\n\n\t\t\t// In the third stage we use the eval function to compile the text into a\n\t\t\t// JavaScript structure. The \"{\" operator is subject to a syntactic ambiguity\n\t\t\t// in JavaScript: it can begin a block or an object literal. We wrap the text\n\t\t\t// in parens to eliminate the ambiguity.\n\t\t\tj = eval(\"(\" + text + \")\");\n\t\t\t// In the optional fourth stage, we recursively walk the new structure, passing\n\t\t\t// each name/value pair to a reviver function for possible transformation.\n\n\t\t\treturn(typeof reviver === \"function\") ?\n\t\t\t\twalk({\n\t\t\t\t\t\"\": j\n\t\t\t\t}, \"\") : j;\n\t\t}\n\t\t// If the text is not JSON parseable, then a SyntaxError is thrown.\n\t\tthrow new SyntaxError(\"JSON.parse\");\n\t};\n}","let g;\nif(typeof window !== undefined) {\n\tg = window;\n} else if(typeof self !== undefined) {\n\tg = self;\n} else if(typeof global !== undefined) {\n\tg = global;\n} else {\n\tthrow new Error(\"not found global var!\");\n}\n\n/**\n * 用于包装变量，防止JSON.stringify等时输出指定变量。\n * @param {Object} val\n */\nfunction InVar(val) {\n\tthis.get = function() {\n\t\treturn val;\n\t};\n\n\tthis.set = function(newVal) {\n\t\tlet old = val;\n\t\tval = newVal;\n\t\treturn old;\n\t};\n}\ng.InVar = InVar;\n\nexport default g;","import global from '../util/global.js';\nlet loaderFun;\nlet xsloader = global.xsloader = function() {\n\treturn loaderFun.apply(this, arguments);\n};\n\nexport default {\n\tloaderFun: (fun) => {\n\t\tloaderFun = fun;\n\t}\n};","const ABSOLUTE_PROTOCOL_REG = /^(([a-zA-Z0-9_]*:\\/\\/)|(\\/)|(\\/\\/))/;\r\nconst ABSOLUTE_PROTOCOL_REG2 = /^([a-zA-Z0-9_]+:)\\/\\/([^/\\s]+)/;\r\nconst defaultJsExts = [\".js\", \".js+\", \".js++\", \".es\", \"es6\", \".jsx\", \".vue\"];\r\n\r\nimport global from './global.js';\r\nconst xsloader = global.xsloader;\r\n\r\nfunction isJsFile(path) {\r\n\tif(!xsloader.isString(path) || path.indexOf(\".\") == -1) {\r\n\t\treturn false;\r\n\t}\r\n\tvar pluginIndex = path.indexOf(\"!\");\r\n\tif(pluginIndex > 0) {\r\n\t\tpath = path.substring(0, pluginIndex);\r\n\t}\r\n\tvar index = path.indexOf(\"?\");\r\n\tif(index > 0) {\r\n\t\tpath = path.substring(0, index);\r\n\t}\r\n\tindex = path.indexOf(\"#\");\r\n\tif(index > 0) {\r\n\t\tpath = path.substring(0, index);\r\n\t}\r\n\tlet theConfig = xsloader.config();\r\n\r\n\tvar jsExts = theConfig && theConfig.jsExts || defaultJsExts;\r\n\tfor(var i = 0; i < jsExts.length; i++) {\r\n\t\tif(xsloader.endsWith(path, jsExts[i])) {\r\n\t\t\treturn {\r\n\t\t\t\text: jsExts[i],\r\n\t\t\t\tpath: path\r\n\t\t\t};\r\n\t\t}\r\n\t}\r\n\treturn false;\r\n}\r\n\r\nfunction dealPathMayAbsolute(path, currentUrl) {\r\n\tcurrentUrl = currentUrl || location.href;\r\n\tlet rs = ABSOLUTE_PROTOCOL_REG.exec(path);\r\n\r\n\tlet finalPath;\r\n\tlet absolute;\r\n\tif(rs) {\r\n\t\tlet protocol = rs[1];\r\n\t\tabsolute = true;\r\n\r\n\t\trs = ABSOLUTE_PROTOCOL_REG2.exec(currentUrl);\r\n\t\tlet _protocol = rs && rs[1] || location.protocol;\r\n\t\tlet _host = rs && rs[2] || location.host;\r\n\r\n\t\tif(protocol == \"//\") {\r\n\t\t\tfinalPath = _protocol + \"//\" + path;\r\n\t\t} else if(protocol == \"/\") {\r\n\t\t\tfinalPath = _protocol + \"//\" + _host + path;\r\n\t\t} else {\r\n\t\t\tfinalPath = path;\r\n\t\t}\r\n\r\n\t} else {\r\n\t\tabsolute = false;\r\n\t\tfinalPath = path;\r\n\t}\r\n\treturn {\r\n\t\tabsolute: absolute,\r\n\t\tpath: finalPath\r\n\t};\r\n}\r\n\r\nfunction getPathWithRelative(path, relative, isPathDir) {\r\n\r\n\tlet relativeQuery = \"\";\r\n\tlet qIndex = path.lastIndexOf(\"?\");\r\n\tif(qIndex >= 0) {\r\n\t\tpath = path.substring(0, qIndex);\r\n\t} else {\r\n\t\tqIndex = path.lastIndexOf(\"#\");\r\n\t\tif(qIndex >= 0) {\r\n\t\t\tpath = path.substring(0, qIndex);\r\n\t\t}\r\n\t}\r\n\r\n\tqIndex = relative.lastIndexOf(\"?\");\r\n\tif(qIndex >= 0) {\r\n\t\trelativeQuery = relative.substring(qIndex);\r\n\t\trelative = relative.substring(0, qIndex);\r\n\t} else {\r\n\t\tqIndex = relative.lastIndexOf(\"#\");\r\n\t\tif(qIndex >= 0) {\r\n\t\t\trelativeQuery = relative.substring(qIndex);\r\n\t\t\trelative = relative.substring(0, qIndex);\r\n\t\t}\r\n\t}\r\n\r\n\tlet absolute = dealPathMayAbsolute(relative);\r\n\tif(absolute.absolute) {\r\n\t\treturn absolute.path + relativeQuery;\r\n\t}\r\n\r\n\tif(isPathDir === undefined) {\r\n\t\tlet index = path.lastIndexOf(\"/\");\r\n\t\tif(index == path.length - 1) {\r\n\t\t\tisPathDir = true;\r\n\t\t} else {\r\n\t\t\tif(index == -1) {\r\n\t\t\t\tindex = 0;\r\n\t\t\t} else {\r\n\t\t\t\tindex++;\r\n\t\t\t}\r\n\t\t\tisPathDir = path.indexOf(\".\", index) == -1;\r\n\t\t}\r\n\t}\r\n\r\n\tif(xsloader.endsWith(path, \"/\")) {\r\n\t\tpath = path.substring(0, path.length - 1);\r\n\t}\r\n\r\n\tlet isRelativeDir = false;\r\n\tif(relative == \".\" || xsloader.endsWith(relative, \"/\")) {\r\n\t\trelative = relative.substring(0, relative.length - 1);\r\n\t\tisRelativeDir = true;\r\n\t} else if(relative == \".\" || relative == \"..\" || xsloader.endsWith(\"/.\") || xsloader.endsWith(\"/..\")) {\r\n\t\tisRelativeDir = true;\r\n\t}\r\n\r\n\tlet prefix = \"\";\r\n\tlet index = -1;\r\n\tlet absolute2 = dealPathMayAbsolute(path);\r\n\tif(absolute2.absolute) {\r\n\t\tpath = absolute2.path;\r\n\t\tlet index2 = path.indexOf(\"//\");\r\n\t\tindex = path.indexOf(\"/\", index2 + 2);\r\n\t\tif(index == -1) {\r\n\t\t\tindex = path.length;\r\n\t\t}\r\n\t}\r\n\r\n\tprefix = path.substring(0, index + 1);\r\n\tpath = path.substring(index + 1);\r\n\r\n\tlet stack = path.split(\"/\");\r\n\tif(!isPathDir && stack.length > 0) {\r\n\t\tstack.pop();\r\n\t}\r\n\tlet relatives = relative.split(\"/\");\r\n\tfor(let i = 0; i < relatives.length; i++) {\r\n\t\tlet str = relatives[i];\r\n\t\tif(\"..\" == str) {\r\n\t\t\tif(stack.length == 0) {\r\n\t\t\t\t\r\n\t\t\t\tthrow new Error(\"no more upper path:path=\"+arguments[0]+\",relative=\"+arguments[1]);\r\n\t\t\t}\r\n\t\t\tstack.pop();\r\n\t\t} else if(\".\" != str) {\r\n\t\t\tstack.push(str);\r\n\t\t}\r\n\t}\r\n\tif(stack.length == 0) {\r\n\t\treturn \"\";\r\n\t}\r\n\tlet result = prefix + stack.join(\"/\");\r\n\tif(isRelativeDir && !xsloader.endsWith(result, \"/\")) {\r\n\t\tresult += \"/\";\r\n\t}\r\n\tresult = xsloader.appendArgs2Url(result, relativeQuery);\r\n\treturn result;\r\n}\r\n\r\nfunction getNodeAbsolutePath(node) {\r\n\tlet src = node.src || node.getAttribute(\"src\");\r\n\treturn getPathWithRelative(location.href, src);\r\n}\r\n\r\n//去掉url的query参数和#参数\r\nfunction removeQueryHash(url) {\r\n\tif(url) {\r\n\t\tlet index = url.indexOf(\"?\");\r\n\t\tif(index >= 0) {\r\n\t\t\turl = url.substring(0, index);\r\n\t\t}\r\n\r\n\t\tindex = url.indexOf(\"#\");\r\n\t\tif(index >= 0) {\r\n\t\t\turl = url.substring(0, index);\r\n\t\t}\r\n\t}\r\n\treturn url;\r\n}\r\n\r\nconst REPLACE_STRING_PROPERTIES_EXP = new RegExp(\"\\\\$\\\\{([^\\\\{]+)\\\\}\");\r\nconst ALL_TYPE_PROPERTIES_EXP = new RegExp(\"^\\\\$\\\\[([^\\\\[\\\\]]+)\\\\]$\");\r\n\r\nfunction propertiesDeal(configObject, properties) {\r\n\tif(!properties) {\r\n\t\treturn configObject;\r\n\t}\r\n\r\n\tfunction replaceStringProperties(string, properties, property) {\r\n\t\tlet rs;\r\n\t\tlet str = string;\r\n\t\trs = ALL_TYPE_PROPERTIES_EXP.exec(str);\r\n\t\tif(rs) {\r\n\t\t\tlet propKey = rs[1];\r\n\t\t\tlet propValue = xsloader.getObjectAttr(properties, propKey);\r\n\t\t\tif(propValue === undefined) {\r\n\t\t\t\treturn str;\r\n\t\t\t} else {\r\n\t\t\t\treturn propValue;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlet result = \"\";\r\n\t\twhile(true) {\r\n\t\t\trs = REPLACE_STRING_PROPERTIES_EXP.exec(str);\r\n\t\t\tif(!rs) {\r\n\t\t\t\tresult += str;\r\n\t\t\t\tbreak;\r\n\t\t\t} else {\r\n\t\t\t\tlet propKey = rs[1];\r\n\t\t\t\tif(property !== undefined && property.propertyKey == propKey) {\r\n\t\t\t\t\tthrow new Error(\"replace property error:propertyKey=\" + propKey);\r\n\t\t\t\t} else if(property) {\r\n\t\t\t\t\tproperty.has = true;\r\n\t\t\t\t}\r\n\t\t\t\tresult += str.substring(0, rs.index);\r\n\t\t\t\tresult += xsloader.getObjectAttr(properties, propKey);\r\n\t\t\t\tstr = str.substring(rs.index + rs[0].length);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n\r\n\t//处理属性引用\r\n\tfunction replaceProperties(obj, property, enableKeyAttr) {\r\n\t\tif(!obj) {\r\n\t\t\treturn obj;\r\n\t\t}\r\n\t\tif(xsloader.isFunction(obj)) {\r\n\t\t\treturn obj;\r\n\t\t} else if(xsloader.isArray(obj)) {\r\n\t\t\tfor(let i = 0; i < obj.length; i++) {\r\n\t\t\t\tobj[i] = replaceProperties(obj[i], property, enableKeyAttr);\r\n\t\t\t}\r\n\t\t} else if(xsloader.isString(obj)) {\r\n\t\t\tobj = replaceStringProperties(obj, properties, property);\r\n\t\t} else if(xsloader.isObject(obj)) {\r\n\t\t\tif(property) {\r\n\t\t\t\tproperty.has = false;\r\n\t\t\t}\r\n\t\t\tlet replaceKeyMap = {};\r\n\t\t\tfor(let x in obj) {\r\n\t\t\t\tif(property) {\r\n\t\t\t\t\tproperty.propertyKey = x;\r\n\t\t\t\t}\r\n\t\t\t\tobj[x] = replaceProperties(obj[x], property, enableKeyAttr);\r\n\t\t\t\tif(enableKeyAttr) {\r\n\t\t\t\t\tlet _x = replaceStringProperties(x, properties, property);\r\n\t\t\t\t\tif(_x !== x) {\r\n\t\t\t\t\t\treplaceKeyMap[x] = _x;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tfor(let x in replaceKeyMap) {\r\n\t\t\t\tlet objx = obj[x];\r\n\t\t\t\tdelete obj[x];\r\n\t\t\t\tobj[replaceKeyMap[x]] = objx;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn obj;\r\n\r\n\t}\r\n\r\n\tif(!properties.__dealt__) {\r\n\t\tlet property = {\r\n\t\t\thas: false\r\n\t\t};\r\n\r\n\t\tfor(let x in properties) {\r\n\t\t\tlet fun = properties[x];\r\n\t\t\tif(xsloader.isFunction(fun)) {\r\n\t\t\t\tproperties[x] = fun.call(properties);\r\n\t\t\t}\r\n\t\t}\r\n\t\tdo {\r\n\t\t\treplaceProperties(properties, property);\r\n\t\t} while (property.has);\r\n\t\tproperties.__dealt__ = true;\r\n\t}\r\n\r\n\treturn replaceProperties(configObject, undefined, true);\r\n}\r\n\r\nfunction replaceModulePrefix(config, deps) {\r\n\r\n\tif(!deps||deps.length==0) {\r\n\t\treturn;\r\n\t}\r\n\r\n\tfor(let i = 0; i < deps.length; i++) {\r\n\t\tlet m = deps[i];\r\n\t\tif(typeof m == \"string\") {\r\n\t\t\tlet index = m.indexOf(\"!\");\r\n\t\t\tlet pluginParam = index > 0 ? m.substring(index) : \"\";\r\n\t\t\tm = index > 0 ? m.substring(0, index) : m;\r\n\r\n\t\t\tindex = m.indexOf(\"?\");\r\n\t\t\tlet query = index > 0 ? m.substring(index) : \"\";\r\n\t\t\tm = index > 0 ? m.substring(0, index) : m;\r\n\r\n\t\t\tlet is = isJsFile(m);\r\n\t\t\tif(!is && !/\\.[^\\/\\s]*$/.test(m) && (xsloader.startsWith(m, \".\") || dealPathMayAbsolute(m).absolute)) {\r\n\t\t\t\tdeps[i] = m + \".js\" + query + pluginParam;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tif(config.modulePrefixCount) {\r\n\t\t//模块地址的前缀替换\r\n\t\tfor(let prefix in config.modulePrefix) {\r\n\t\t\tlet replaceStr = config.modulePrefix[prefix].replace;\r\n\t\t\tlet len = prefix.length;\r\n\t\t\tfor(let i = 0; i < deps.length; i++) {\r\n\t\t\t\tlet m = deps[i];\r\n\t\t\t\tif(typeof m == \"string\") {\r\n\t\t\t\t\tlet pluginIndex = m.indexOf(\"!\");\r\n\t\t\t\t\tlet pluginName = null;\r\n\t\t\t\t\tif(pluginIndex >= 0) {\r\n\t\t\t\t\t\tpluginName = m.substring(0, pluginIndex + 1);\r\n\t\t\t\t\t\tm = m.substring(pluginIndex + 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(xsloader.startsWith(m, prefix)) {\r\n\t\t\t\t\t\tlet dep = replaceStr + m.substring(len);\r\n\t\t\t\t\t\tdeps[i] = pluginName ? pluginName + dep : dep;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction getScriptBySubname(subname) {\r\n\tlet ss = document.getElementsByTagName('script');\r\n\tif(subname) {\r\n\t\tfor(let i = 0; i < ss.length; i++) {\r\n\t\t\tlet script = ss[i];\r\n\t\t\tlet src = script.src;\r\n\t\t\tsrc = src.substring(src.lastIndexOf(\"/\"));\r\n\t\t\tif(src.indexOf(subname) >= 0) {\r\n\t\t\t\treturn script;\r\n\t\t\t}\r\n\t\t}\r\n\t} else {\r\n\t\treturn ss;\r\n\t}\r\n}\r\n\r\nexport default {\r\n\tgetPathWithRelative,\r\n\tgetNodeAbsolutePath,\r\n\tdealPathMayAbsolute,\r\n\tremoveQueryHash,\r\n\tpropertiesDeal,\r\n\treplaceModulePrefix,\r\n\tisJsFile,\r\n\tgetScriptBySubname,\r\n};","import global from './global.js';\r\nconst xsloader = global.xsloader;\r\nconst commentRegExp = /\\/\\*[\\s\\S]*?\\*\\/|([^:\"'=]|^)\\/\\/.*$/mg;\r\nconst cjsRequireRegExp = /[^.]require\\s*\\(\\s*[\"']([^'\"\\r\\n]+)[\"']\\s*\\)/g;\r\n\r\n//基于有向图进行循环依赖检测\r\nfunction GraphPath() {\r\n\tlet pathEdges = {};\r\n\tlet vertexMap = {};\r\n\tlet depMap = {};\r\n\tthis.addEdge = function(begin, end) {\r\n\t\tdepMap[begin + \"|\" + end] = true;\r\n\t\tif(!pathEdges[begin]) {\r\n\t\t\tpathEdges[begin] = [];\r\n\t\t}\r\n\t\tif(!vertexMap[begin]) {\r\n\t\t\tvertexMap[begin] = true;\r\n\t\t}\r\n\t\tif(!vertexMap[end]) {\r\n\t\t\tvertexMap[end] = true;\r\n\t\t}\r\n\t\tpathEdges[begin].push({\r\n\t\t\tbegin: begin,\r\n\t\t\tend: end\r\n\t\t});\r\n\t};\r\n\r\n\tthis.hasDep = function(name, dep) {\r\n\t\treturn depMap[name + \"|\" + dep];\r\n\t};\r\n\r\n\tthis.tryAddEdge = function(begin, end) {\r\n\t\tthis.addEdge(begin, end);\r\n\t\tlet paths = this.hasLoop();\r\n\t\tif(paths.length > 0) {\r\n\t\t\tpathEdges[begin].pop();\r\n\t\t}\r\n\t\treturn paths;\r\n\t};\r\n\r\n\tthis.hasLoop = function() {\r\n\t\tlet visited = {};\r\n\t\tlet recursionStack = {};\r\n\r\n\t\tfor(let x in vertexMap) {\r\n\t\t\tvisited[x] = false;\r\n\t\t\trecursionStack[x] = false;\r\n\t\t}\r\n\r\n\t\tlet has = false;\r\n\t\tlet paths = [];\r\n\t\tfor(let name in vertexMap) {\r\n\t\t\tpaths = [];\r\n\t\t\tif(checkLoop(name, visited, recursionStack, paths)) {\r\n\t\t\t\thas = true;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn has ? paths : [];\r\n\t};\r\n\r\n\tfunction checkLoop(v, visited, recursionStack, paths) {\r\n\t\tif(!visited[v]) {\r\n\t\t\tvisited[v] = true;\r\n\t\t\trecursionStack[v] = true;\r\n\t\t\tpaths.push(v);\r\n\r\n\t\t\tif(pathEdges[v]) {\r\n\t\t\t\tlet edges = pathEdges[v];\r\n\t\t\t\tfor(let i = 0; i < edges.length; i++) {\r\n\t\t\t\t\tlet edge = edges[i];\r\n\t\t\t\t\tif(!visited[edge.end] && checkLoop(edge.end, visited, recursionStack, paths)) {\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t} else if(recursionStack[edge.end]) {\r\n\t\t\t\t\t\tpaths.push(edge.end);\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\trecursionStack[v] = false;\r\n\t\treturn false;\r\n\t}\r\n}\r\n\r\n//使得内部的字符串变成数组\r\nfunction strValue2Arr(obj) {\r\n\tif(!obj || xsloader.isArray(obj)) {\r\n\t\treturn;\r\n\t}\r\n\tfor(let x in obj) {\r\n\t\tif(xsloader.isString(obj[x])) {\r\n\t\t\tobj[x] = [obj[x]];\r\n\t\t}\r\n\t}\r\n}\r\n\r\n/**\r\n * 同步模式下，返回false表示终止循环。\r\n * @param {Object} ary\r\n * @param {Object} func\r\n * @param {Object} isSync\r\n * @param {Object} fromEnd\r\n */\r\nfunction each(ary, func, isSync, fromEnd) {\r\n\tif(ary) {\r\n\t\tif(isSync) {\r\n\t\t\tfunction fun(index) {\r\n\t\t\t\tif(fromEnd ? index < 0 : index >= ary.length) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tlet handle = function(rs) {\r\n\t\t\t\t\tif(rs) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfun(fromEnd ? index - 1 : index + 1);\r\n\t\t\t\t};\r\n\t\t\t\tfunc(ary[index], index, ary, handle);\r\n\t\t\t}\r\n\t\t\tfun(fromEnd ? ary.length - 1 : 0);\r\n\t\t} else {\r\n\t\t\tif(fromEnd) {\r\n\t\t\t\tfor(let i = ary.length - 1; i >= 0; i--) {\r\n\t\t\t\t\tif(func(ary[i], i, ary) === false) {\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tfor(let i = 0; i < ary.length; i++) {\r\n\t\t\t\t\tif(func(ary[i], i, ary) === false) {\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t}\r\n}\r\n\r\nfunction __commentReplace(match, singlePrefix) {\r\n\treturn singlePrefix || '';\r\n}\r\n//添加内部直接require('...')的模块\r\nfunction appendInnerDeps(deps, callback) {\r\n\tif(xsloader.isFunction(callback)) {\r\n\t\tcallback\r\n\t\t\t.toString()\r\n\t\t\t.replace(commentRegExp, __commentReplace)\r\n\t\t\t.replace(cjsRequireRegExp, function(match, dep) {\r\n\t\t\t\tif(xsloader.indexInArray(deps, dep) == -1) {\r\n\t\t\t\t\tdeps.push(dep);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t}\r\n}\r\n\r\nlet idCount = 2019;\r\n\r\nfunction getAndIncIdCount() {\r\n\treturn idCount++;\r\n}\r\n\r\nclass PluginError {\r\n\tconstructor(err, invoker) {\r\n\t\tif(err instanceof PluginError) {\r\n\t\t\tthis.err = err.err;\r\n\t\t\tthis.invoker = err.invoker;\r\n\t\t} else {\r\n\t\t\tthis.err = err;\r\n\t\t\tthis.invoker = invoker;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nlet isXsLoaderEnd = false;\r\nconst IE_VERSION = (function getIEVersion() {\r\n\tlet userAgent = navigator.userAgent; //取得浏览器的userAgent字符串  \r\n\tlet isIE = userAgent.indexOf(\"compatible\") > -1 && userAgent.indexOf(\"MSIE\") > -1; //判断是否IE<11浏览器  \r\n\tlet isEdge = userAgent.indexOf(\"Edge\") > -1 && !isIE; //判断是否IE的Edge浏览器  \r\n\tlet isIE11 = userAgent.indexOf('Trident') > -1 && userAgent.indexOf(\"rv:11.0\") > -1;\r\n\tif(isIE) {\r\n\t\tlet reIE = new RegExp(\"MSIE[\\\\s]+([0-9.]+);\").exec(userAgent);\r\n\t\tlet fIEVersion = parseInt(reIE && reIE[1] || -1);\r\n\t\treturn fIEVersion == -1 ? -1 : fIEVersion;\r\n\t} else if(isEdge) {\r\n\t\treturn 'edge'; //edge\r\n\t} else if(isIE11) {\r\n\t\treturn 11; //IE11  \r\n\t} else {\r\n\t\treturn -1; //不是ie浏览器\r\n\t}\r\n})();\r\n\r\nexport default {\r\n\tgraphPath: new GraphPath(),\r\n\tstrValue2Arr,\r\n\teach,\r\n\tappendInnerDeps,\r\n\tgetAndIncIdCount,\r\n\tPluginError,\r\n\tloaderEnd() {\r\n\t\tisXsLoaderEnd = true;\r\n\t},\r\n\tisLoaderEnd() {\r\n\t\treturn isXsLoaderEnd;\r\n\t},\r\n\tIE_VERSION,\r\n};","import urls from './urls.js';\nimport global from './global.js';\nimport base from './base.js';\n\nexport default {\n\t...urls,\n\tglobal,\n\t...base\n};","import utils from \"../util/index.js\";\n\nconst global = utils.global;\nconst xsloader = global.xsloader;\n\n//ie9\ntry {\n\tif(Function.prototype.bind && console && (typeof console['log'] == \"object\")) {\n\t\tutils.each([\"log\", \"info\", \"warn\", \"error\", \"assert\", \"dir\", \"clear\", \"profile\", \"profileEnd\"], (method) => {\n\t\t\tlet thiz = Function.prototype.bind;\n\t\t\tconsole[method] = thiz.call(console[method], console);\n\t\t});\n\t}\n} catch(e) {\n\tglobal.console = {\n\t\tlog: function() {},\n\t\terror: function() {},\n\t\twarn: function() {}\n\t};\n}\n\ntry {\n\n\tif(!Array.prototype.indexOf) {\n\t\tArray.prototype.indexOf = function(elem, offset) {\n\t\t\tfor(let i = offset === undefined ? 0 : offset; i < this.length; i++) {\n\t\t\t\tif(this[i] == elem) {\n\t\t\t\t\treturn i;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn -1;\n\t\t};\n\t}\n\n\tif(!Array.pushAll) {\n\t\tArray.pushAll = function(thiz, arr) {\n\t\t\tif(!xsloader.isArray(arr)) {\n\t\t\t\tthrow new Error(\"not array:\" + arr);\n\t\t\t}\n\t\t\tfor(let i = 0; i < arr.length; i++) {\n\t\t\t\tthiz.push(arr[i]);\n\t\t\t}\n\t\t\treturn thiz;\n\t\t};\n\t}\n} catch(e) {\n\tconsole.error(e);\n}\n\nfunction startsWith(str, starts) {\n\tif(!(typeof str == \"string\")) {\n\t\treturn false;\n\t}\n\treturn str.indexOf(starts) == 0;\n}\n\nfunction endsWith(str, ends) {\n\tif(!(typeof str == \"string\")) {\n\t\treturn false;\n\t}\n\tlet index = str.lastIndexOf(ends);\n\tif(index >= 0 && (str.length - ends.length == index)) {\n\t\treturn true;\n\t} else {\n\t\treturn false;\n\t}\n}\n\nfunction _indexInArray(array, ele, offset = 0, compare) {\n\tlet index = -1;\n\tif(array) {\n\t\tfor(let i = offset || 0; i < array.length; i++) {\n\t\t\tif(compare) {\n\t\t\t\tif(compare(array[i], ele, i, array)) {\n\t\t\t\t\tindex = i;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif(array[i] == ele) {\n\t\t\t\t\tindex = i;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t}\n\t}\n\treturn index;\n}\n\nfunction indexInArray(array, ele, compare) {\n\treturn _indexInArray(array, ele, 0, compare);\n}\n\nfunction indexInArrayFrom(array, ele, offset, compare) {\n\treturn _indexInArray(array, ele, offset, compare);\n}\n\nexport default {\n\tstartsWith,\n\tendsWith,\n\tindexInArray,\n\tindexInArrayFrom\n};","import {\n\tJSON as xsJSON\n} from \"../polyfill/index.js\";\nimport utils from \"../util/index.js\";\n\nconst global = utils.global;\nconst xsloader = global.xsloader;\nconst IE_VERSION = utils.IE_VERSION;\n\nif(!String.prototype.trim) {\n\tString.prototype.trim = function() {\n\t\treturn this.replace(/^\\s\\s*/, '').replace(/\\s\\s*$/, '');\n\t};\n}\n\n//生成一个随机的id，只保证在本页面是唯一的\nfunction randId(suffix) {\n\tlet id = \"r\" + parseInt(new Date().getTime() / 1000) + \"_\" + parseInt(Math.random() * 1000) + \"_\" + utils.getAndIncIdCount();\n\tif(suffix !== undefined) {\n\t\tid += suffix;\n\t}\n\treturn id;\n}\n\nfunction xsEval(scriptString) {\n\ttry {\n\t\tlet rs = IE_VERSION > 0 && IE_VERSION < 9 ? eval(\"[\" + scriptString + \"][0]\") : eval(\"(\" + scriptString + \")\");\n\t\treturn rs;\n\t} catch(e) {\n\t\tthrow e;\n\t}\n}\n\n/**\n * 注意key需要用引号包裹\n * @param {Object} str\n * @param {Object} option\n */\nfunction xsParseJson(str, option) {\n\tif(str === \"\" || str === null || str === undefined || !xsloader.isString(str)) {\n\t\treturn str;\n\t}\n\n\toption = xsloader.extend({\n\t\tfnStart: \"\", //\"/*{f}*/\",\n\t\tfnEnd: \"\", //\"/*{f}*/\",\n\t\trcomment: \"\\\\/\\\\/#\\\\/\\\\/\"\n\t}, option);\n\n\tlet fnMap = {};\n\tlet fnOffset = 0;\n\tlet replacer = undefined;\n\tif(option.fnStart && option.fnEnd) {\n\t\twhile(true) {\n\t\t\tlet indexStart = str.indexOf(option.fnStart, fnOffset);\n\t\t\tlet indexEnd = str.indexOf(option.fnEnd, indexStart == -1 ? fnOffset : indexStart + option.fnStart.length);\n\t\t\tif(indexStart == -1 && indexEnd == -1) {\n\t\t\t\tbreak;\n\t\t\t} else if(indexStart == -1) {\n\t\t\t\tconsole.warn(\"found end:\" + option.fnEnd + \",may lack start:\" + option.fnStart);\n\t\t\t\tbreak;\n\t\t\t} else if(indexEnd == -1) {\n\t\t\t\tconsole.warn(\"found start:\" + option.fnStart + \",may lack end:\" + option.fnEnd);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tlet fnId = \"_[_\" + randId() + \"_]_\";\n\t\t\tlet fnStr = str.substring(indexStart + option.fnStart.length, indexEnd).trim();\n\t\t\tif(!xsloader.startsWith(fnStr, \"function(\")) {\n\t\t\t\tthrow \"not a function:\" + fnStr;\n\t\t\t}\n\t\t\ttry {\n\t\t\t\tstr = str.substring(0, indexStart) + '\"' + fnId + '\"' + str.substring(indexEnd + option.fnEnd.length);\n\t\t\t\tlet fn = xsloader.xsEval(fnStr);\n\t\t\t\tfnMap[fnId] = fn;\n\t\t\t} catch(e) {\n\t\t\t\tconsole.error(fnStr);\n\t\t\t\tthrow e;\n\t\t\t}\n\t\t\tfnOffset = indexStart + fnId.length;\n\t\t}\n\t\treplacer = function(key, val) {\n\t\t\tif(xsloader.isString(val) && fnMap[val]) {\n\t\t\t\treturn fnMap[val];\n\t\t\t} else {\n\t\t\t\treturn val;\n\t\t\t}\n\t\t};\n\t}\n\n\tif(option.rcomment) {\n\t\tstr = str.replace(/(\\r\\n)|\\r/g, \"\\n\"); //统一换行符号\n\t\tstr = str.replace(new RegExp(option.rcomment + \"[^\\\\n]*(\\\\n|$)\", \"g\"), \"\"); //去除行注释\n\t}\n\n\ttry {\n\t\tlet jsonObj = xsJSON;\n\t\treturn jsonObj.parse(str, replacer);\n\t} catch(e) {\n\t\ttry {\n\t\t\tlet reg = new RegExp('position[\\\\s]*([0-9]+)[\\\\s]*$');\n\t\t\tif(e.message && reg.test(e.message)) {\n\t\t\t\tlet posStr = e.message.substring(e.message.lastIndexOf(\"position\") + 8);\n\t\t\t\tlet pos = parseInt(posStr.trim());\n\t\t\t\tlet _str = str.substring(pos);\n\t\t\t\tconsole.error(e.message + \":\" + _str.substring(0, _str.length > 100 ? 100 : _str.length));\n\t\t\t}\n\t\t} catch(e2) {\n\t\t\tconsole.warn(e2);\n\t\t}\n\t\tthrow e;\n\t}\n}\n\nfunction xsJson2String(obj) {\n\tlet jsonObj = xsJSON;\n\treturn jsonObj.stringify(obj);\n}\n\nconst getPathWithRelative = utils.getPathWithRelative;\n\nfunction _toParamsMap(argsStr, decode = true) {\n\tif(xsloader.isObject(argsStr)) {\n\t\treturn argsStr;\n\t}\n\tif(!argsStr) {\n\t\targsStr = location.search;\n\t}\n\n\tlet index = argsStr.indexOf(\"?\");\n\tif(index >= 0) {\n\t\targsStr = argsStr.substring(index + 1);\n\t} else {\n\t\tif(utils.dealPathMayAbsolute(argsStr).absolute) {\n\t\t\treturn {};\n\t\t}\n\t}\n\tindex = argsStr.lastIndexOf(\"#\");\n\tif(index >= 0) {\n\t\targsStr = argsStr.substring(0, index);\n\t}\n\n\tlet ret = {},\n\t\tseg = argsStr.split('&'),\n\t\ts;\n\tfor(let i = 0; i < seg.length; i++) {\n\t\tif(!seg[i]) {\n\t\t\tcontinue;\n\t\t}\n\t\ts = seg[i].split('=');\n\t\tlet name = decode ? decodeURIComponent(s[0]) : s[0];\n\t\tret[name] = decode ? decodeURIComponent(s[1]) : s[1];\n\t}\n\treturn ret;\n}\n\nfunction appendArgs2Url(url, urlArgs) {\n\tif(url === undefined || url === null || !urlArgs) {\n\t\treturn url;\n\t}\n\n\tlet index = url.lastIndexOf(\"?\");\n\tlet hashIndex = url.lastIndexOf(\"#\");\n\tif(hashIndex < 0) {\n\t\thashIndex = url.length;\n\t}\n\tlet oldParams = index < 0 ? {} : _toParamsMap(url.substring(index + 1, hashIndex), false);\n\tlet newParams = _toParamsMap(urlArgs, false);\n\tlet has = false;\n\tfor(let k in newParams) {\n\t\tif(oldParams[k] != newParams[k]) {\n\t\t\toldParams[k] = newParams[k];\n\t\t\thas = true;\n\t\t}\n\t}\n\tif(!has) {\n\t\treturn url; //参数没有变化直接返回\n\t}\n\n\tlet paramKeys = [];\n\tfor(let k in oldParams) {\n\t\tparamKeys.push(k);\n\t}\n\tparamKeys.sort();\n\n\tlet path = index < 0 ? url.substring(0, hashIndex) : url.substring(0, index);\n\tlet params = [];\n\n\tfor(let i = 0; i < paramKeys.length; i++) { //保证参数按照顺序\n\t\tlet k = paramKeys[i];\n\t\tparams.push(k + \"=\" + oldParams[k]);\n\t}\n\tparams = params.join(\"&\");\n\tlet hash = \"\";\n\tif(hashIndex >= 0 && hashIndex < url.length) {\n\t\thash = url.substring(hashIndex);\n\t}\n\treturn path + (params ? \"?\" + params : \"\") + (hash ? hash : \"\");\n\n}\n\nfunction queryString2ParamsMap(argsStr, decode) {\n\treturn _toParamsMap(argsStr, decode);\n}\n\nexport default {\n\trandId,\n\txsEval,\n\txsParseJson,\n\txsJson2String,\n\tgetPathWithRelative,\n\tappendArgs2Url,\n\tqueryString2ParamsMap,\n\tIE_VERSION\n};","const ostring = Object.prototype.toString;\n\nfunction isArray(it) {\n\treturn it && (it instanceof Array) || ostring.call(it) === '[object Array]';\n}\n\nfunction isFunction(it) {\n\treturn it && (typeof it == \"function\") || ostring.call(it) === '[object Function]';\n}\n\nfunction isObject(it) {\n\tif(it === null || it === undefined) {\n\t\treturn false;\n\t}\n\treturn(typeof it == \"object\") || ostring.call(it) === '[object Object]';\n}\n\nfunction isString(it) {\n\treturn it && (typeof it == \"string\") || ostring.call(it) === '[object String]';\n}\n\nfunction isDate(it) {\n\treturn it && (it instanceof Date) || ostring.call(it) === '[object Date]';\n}\n\nfunction isRegExp(it) {\n\treturn it && (it instanceof RegExp) || ostring.call(it) === '[object RegExp]';\n}\n\nexport default {\n\tisArray,\n\tisFunction,\n\tisObject,\n\tisString,\n\tisDate,\n\tisRegExp,\n};","import utils from \"../util/index.js\";\n\nconst global = utils.global;\nconst xsloader = global.xsloader;\n\nfunction queryParam(name, otherValue, optionUrl) {\n\tlet search;\n\tif(optionUrl) {\n\t\tlet index = optionUrl.indexOf('?');\n\t\tif(index < 0) {\n\t\t\tindex = 0;\n\t\t} else {\n\t\t\tindex += 1;\n\t\t}\n\t\tsearch = optionUrl.substr(index);\n\t} else {\n\t\tsearch = window.location.search.substr(1);\n\t}\n\n\tlet reg = new RegExp(\"(^|&)\" + name + \"=([^&]*)(&|$)\");\n\tlet r = search.match(reg);\n\tif(r != null) return decodeURIComponent(r[2]);\n\treturn otherValue !== undefined ? otherValue : null;\n}\n\nfunction getUrl(relativeUrl, appendArgs, optionalAbsUrl) {\n\tif(optionalAbsUrl && !utils.dealPathMayAbsolute(optionalAbsUrl).absolute) {\n\t\tthrow new Error(\"expected absolute url:\" + optionalAbsUrl);\n\t}\n\tif(appendArgs === undefined) {\n\t\tappendArgs = true;\n\t}\n\tlet theConfig = xsloader.config();\n\tlet thePageUrl = xsloader.pageUrl();\n\tlet url;\n\tif(relativeUrl === undefined) {\n\t\turl = thePageUrl;\n\t} else if(xsloader.startsWith(relativeUrl, \".\") || utils.dealPathMayAbsolute(relativeUrl).absolute) {\n\t\turl = utils.getPathWithRelative(optionalAbsUrl || thePageUrl, relativeUrl);\n\t} else {\n\t\turl = theConfig.baseUrl + relativeUrl;\n\t}\n\tif(appendArgs) {\n\t\tif(url == thePageUrl) {\n\t\t\turl += location.search + location.hash;\n\t\t}\n\t\treturn theConfig.dealUrl({}, url);\n\t} else {\n\t\treturn url;\n\t}\n}\n\nfunction tryCall(fun, defaultReturn, thiz, exCallback) {\n\tlet rs;\n\ttry {\n\t\tthiz = thiz === undefined ? this : thiz;\n\t\trs = fun.call(thiz);\n\t} catch(e) {\n\t\tif(xsloader.isFunction(exCallback)) {\n\t\t\texCallback(e);\n\t\t} else {\n\t\t\tconsole.warn(e);\n\t\t}\n\t}\n\tif(rs === undefined || rs === null) {\n\t\trs = defaultReturn;\n\t}\n\treturn rs;\n}\n\nfunction dealProperties(obj, properties) {\n\treturn utils.propertiesDeal(obj, properties);\n}\n\nfunction extend(target) {\n\tfor(let i = 1; i < arguments.length; i++) {\n\t\tlet obj = arguments[i];\n\t\tif(!obj) {\n\t\t\tcontinue;\n\t\t}\n\t\tfor(let x in obj) {\n\t\t\tlet value = obj[x];\n\t\t\tif(value === undefined) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\ttarget[x] = obj[x];\n\t\t}\n\t}\n\treturn target;\n}\n\nfunction extendDeep(target) {\n\tif(!target) {\n\t\treturn target;\n\t}\n\tfor(let i = 1; i < arguments.length; i++) {\n\t\tlet obj = arguments[i];\n\t\tif(!obj) {\n\t\t\tcontinue;\n\t\t}\n\n\t\tfor(let x in obj) {\n\t\t\tlet value = obj[x];\n\t\t\tif(value === undefined) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif(xsloader.isObject(value) && xsloader.isObject(target[x])) {\n\t\t\t\ttarget[x] = xsloader.extendDeep(target[x], value);\n\t\t\t} else {\n\t\t\t\ttarget[x] = obj[x];\n\t\t\t}\n\t\t}\n\t}\n\treturn target;\n}\n\nfunction _AsyncCall(useTimer) {\n\tlet thiz = this;\n\tlet count = 0;\n\tlet ctrlCallbackMap = {};\n\n\tfunction initCtrlCallback(callbackObj) {\n\t\tlet mineCount = count + \"\";\n\t\tif(!ctrlCallbackMap[mineCount]) {\n\t\t\tlet ctrlCallback = function() {\n\t\t\t\tcount++;\n\t\t\t\tlet asyncCallQueue = ctrlCallbackMap[mineCount];\n\t\t\t\tdelete ctrlCallbackMap[mineCount];\n\t\t\t\twhile(asyncCallQueue.length) {\n\t\t\t\t\tlet callbackObj = asyncCallQueue.shift();\n\t\t\t\t\tlet lastReturn = undefined;\n\t\t\t\t\ttry {\n\t\t\t\t\t\tif(callbackObj.callback) {\n\t\t\t\t\t\t\tlastReturn = callbackObj.callback.call(callbackObj.handle, callbackObj.obj, mineCount);\n\t\t\t\t\t\t}\n\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\tconsole.error(e);\n\t\t\t\t\t}\n\t\t\t\t\tlet handle;\n\t\t\t\t\twhile(callbackObj.nextCallback.length) {\n\t\t\t\t\t\tlet nextObj = callbackObj.nextCallback.shift();\n\t\t\t\t\t\tif(!handle) {\n\t\t\t\t\t\t\thandle = thiz.pushTask(nextObj.callback, lastReturn);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\thandle.next(nextObj.callback);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t\tctrlCallbackMap[mineCount] = [];\n\t\t\tif(!useTimer && global.Promise && global.Promise.resolve) {\n\t\t\t\tglobal.Promise.resolve().then(ctrlCallback);\n\t\t\t} else {\n\t\t\t\tsetTimeout(ctrlCallback, 0);\n\t\t\t}\n\t\t}\n\t\tlet queue = ctrlCallbackMap[mineCount];\n\t\tqueue.push(callbackObj);\n\t}\n\n\tthis.pushTask = function(callback, obj) {\n\t\tlet callbackObj;\n\t\tlet handle = {\n\t\t\tnext: function(nextCallback, lastReturn) {\n\t\t\t\tcallbackObj.nextCallback.push({\n\t\t\t\t\tcallback: nextCallback,\n\t\t\t\t\tlastReturn: lastReturn\n\t\t\t\t});\n\t\t\t\treturn this;\n\t\t\t}\n\t\t};\n\t\tcallbackObj = {\n\t\t\tcallback: callback,\n\t\t\tobj: obj,\n\t\t\tnextCallback: [],\n\t\t\thandle: handle\n\t\t};\n\n\t\tinitCtrlCallback(callbackObj);\n\n\t\treturn handle;\n\t};\n}\n\nconst theAsyncCall = new _AsyncCall();\nconst theAsyncCallOfTimer = new _AsyncCall(true);\n\nlet asyncCall = function(callback, useTimer) {\n\tif(useTimer) {\n\t\treturn theAsyncCallOfTimer.pushTask(callback);\n\t} else {\n\t\treturn theAsyncCall.pushTask(callback);\n\t}\n};\n\n/**\n * 得到属性\n * @param {Object} obj\n * @param {Object} attrNames \"rs\"、\"rs.total\"等\n */\nfunction getObjectAttr(obj, attrNames, defaultValue) {\n\tif(!obj || !attrNames) {\n\t\treturn undefined;\n\t}\n\tlet attrs = attrNames.split(\".\");\n\tlet rs = defaultValue;\n\tlet i = 0;\n\tfor(; i < attrs.length && obj; i++) {\n\t\tlet k = attrs[i];\n\t\tobj = obj[k];\n\t}\n\tif(i == attrs.length) {\n\t\trs = obj;\n\t}\n\n\treturn rs;\n}\n\n/**\n * 设置属性\n * @param {Object} obj\n * @param {Object} attrNames \"rs\"、\"rs.total\"等\n */\nfunction setObjectAttr(obj, attrNames, value) {\n\tlet _obj = obj;\n\tlet attrs = attrNames.split(\".\");\n\n\tfor(let i = 0; i < attrs.length; i++) {\n\t\tlet k = attrs[i];\n\n\t\tif(i == attrs.length - 1) {\n\t\t\tobj[k] = value;\n\t\t\tbreak;\n\t\t}\n\t\tlet o = obj[k];\n\t\tif(!o) {\n\t\t\to = {};\n\t\t\tobj[k] = o;\n\t\t}\n\t\tobj = o;\n\t}\n\treturn _obj;\n}\n\nfunction clone(obj, isDeep) {\n\t// Handle the 3 simple types, and null or undefined or function\n\tif(!obj || xsloader.isFunction(obj) || xsloader.isString(obj)) return obj;\n\n\tif(xsloader.isRegExp(obj)) {\n\t\treturn new RegExp(obj.source, obj.flags);\n\t}\n\n\t// Handle Date\n\tif(xsloader.isDate(obj)) {\n\t\tlet copy = new Date();\n\t\tcopy.setTime(obj.getTime());\n\t\treturn copy;\n\t}\n\t// Handle Array or Object\n\tif(xsloader.isArray(obj) || xsloader.isObject(obj)) {\n\t\tlet copy = xsloader.isArray(obj) ? [] : {};\n\t\tfor(let attr in obj) {\n\t\t\tif(obj.hasOwnProperty(attr))\n\t\t\t\tcopy[attr] = isDeep ? clone(obj[attr]) : obj[attr];\n\t\t}\n\t\treturn copy;\n\t}\n\treturn obj;\n}\n\nexport default {\n\tqueryParam,\n\tgetUrl,\n\ttryCall,\n\tdealProperties,\n\textend,\n\textendDeep,\n\tasyncCall,\n\tgetObjectAttr,\n\tsetObjectAttr,\n\tclone\n};","import utils from \"../util/index.js\";\n\nconst global = utils.global;\nconst xsloader = global.xsloader;\n\nlet isDOM = (typeof HTMLElement === 'object') ?\n\tfunction(obj) {\n\t\treturn obj && (obj instanceof HTMLElement);\n\t} :\n\tfunction(obj) {\n\t\treturn obj && typeof obj === 'object' && obj.nodeType === 1 && typeof obj.nodeName === 'string';\n\t};\n\nlet onReadyFun = (function() {\n\tlet isGlobalReady = false;\n\tlet bindReadyQueue = [];\n\n\tfunction BindReady(callback) {\n\t\tif(isGlobalReady) {\n\t\t\tcallback();\n\t\t\treturn;\n\t\t}\n\t\tlet isReady = false;\n\n\t\tfunction ready() {\n\t\t\tif(isReady) return;\n\t\t\tisReady = true;\n\t\t\tisGlobalReady = true;\n\t\t\tcallback();\n\t\t}\n\t\t// Mozilla, Opera and webkit nightlies currently support this event\n\t\tif(document.addEventListener) {\n\t\t\tlet fun;\n\t\t\tfun = function() {\n\t\t\t\tdocument.removeEventListener(\"DOMContentLoaded\", fun);\n\t\t\t\tready();\n\t\t\t};\n\t\t\tdocument.addEventListener(\"DOMContentLoaded\", fun);\n\n\t\t} else if(document.attachEvent) {\n\t\t\t// ensure firing before onload,\n\t\t\t// maybe late but safe also for iframes\n\t\t\tlet fun;\n\t\t\tfun = function() {\n\t\t\t\tif(document.readyState === \"complete\") {\n\t\t\t\t\tdocument.detachEvent(\"onreadystatechange\", fun);\n\t\t\t\t\tready();\n\t\t\t\t}\n\t\t\t};\n\t\t\tdocument.attachEvent(\"onreadystatechange\", fun);\n\t\t\t// If IE and not an iframe\n\t\t\t// continually check to see if the document is ready\n\n\t\t\tlet fun2;\n\t\t\tfun2 = function() {\n\t\t\t\tif(isReady) return;\n\t\t\t\ttry {\n\t\t\t\t\t// If IE is used, use the trick by Diego Perini\n\t\t\t\t\t// http://javascript.nwbox.com/IEContentLoaded/\n\t\t\t\t\tdocument.documentElement.doScroll(\"left\");\n\t\t\t\t} catch(error) {\n\t\t\t\t\tsetTimeout(fun2, 0);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t// and execute any waiting functions\n\t\t\t\tready();\n\t\t\t};\n\n\t\t\tif(document.documentElement.doScroll && typeof global.frameElement === \"undefined\")(fun2)();\n\t\t} else {\n\t\t\txsloader.asyncCall(null, true).next(function() {\n\t\t\t\tready();\n\t\t\t});\n\t\t}\n\t\tthis.readyCall = ready;\n\t}\n\tlet onReady = function(callback) {\n\t\tif(document.readyState === \"complete\") {\n\t\t\tisGlobalReady = true;\n\t\t}\n\t\tlet br = new BindReady(callback);\n\t\tif(!isGlobalReady) {\n\t\t\tbindReadyQueue.push(br);\n\t\t}\n\t};\n\tonReady(function() {\n\t\tisGlobalReady = true;\n\t});\n\n\tif(document.readyState === \"complete\") {\n\t\tisGlobalReady = true;\n\t} else {\n\t\tlet addEventHandle;\n\t\tif(global.addEventListener) {\n\t\t\taddEventHandle = function(type, callback) {\n\t\t\t\tglobal.addEventListener(type, callback, false);\n\t\t\t};\n\t\t} else if(global.attachEvent) {\n\t\t\taddEventHandle = function(type, callback) {\n\t\t\t\tglobal.attachEvent(\"on\" + type, callback);\n\t\t\t};\n\t\t} else {\n\t\t\taddEventHandle = function(type, callback) {\n\t\t\t\txsloader.asyncCall(null, true).next(function() {\n\t\t\t\t\tcallback();\n\t\t\t\t});\n\t\t\t};\n\t\t}\n\t\taddEventHandle(\"load\", function() {\n\t\t\tisGlobalReady = true;\n\t\t\twhile(bindReadyQueue.length) {\n\t\t\t\tbindReadyQueue.shift().readyCall();\n\t\t\t}\n\t\t});\n\t}\n\treturn onReady;\n})();\n\nexport default {\n\tisDOM,\n\tonReady: onReadyFun\n};","import utils from \"../util/index.js\";\n////////////////////\n\nimport deprecated from './global-deprecated.js';\nimport base from './global-base.js';\n//////////////////\nimport is from './is.js';\nimport funs from './funs.js';\nimport browser from './browser.js';\n\nconst global = utils.global;\nconst xsloader=global.xsloader;\n\nlet toGlobal = {\n\t...deprecated,\n\t...base\n};\nfor(let k in toGlobal) {\n\txsloader[k] = toGlobal[k];\n\tglobal[k] = toGlobal[k];\n}\n\nlet justLoader = {\n\t...is,\n\t...funs,\n\t...browser,\n\t_ignoreAspect_: {\n\n\t}\n};\nfor(let k in justLoader) {\n\txsloader[k] = justLoader[k];\n}","import utils from \"../util/index.js\";\r\nconst global = utils.global;\r\nconst xsloader = global.xsloader;\r\nconst theDefinedMap = {};\r\nconst lastDefinObjectMap = {};\r\n\r\n//global.__showModules=()=>{\r\n//\tconsole.log(theDefinedMap);\r\n//};\r\n\r\nclass ModuleDef {\r\n\tsrc;\r\n\tdefaultModule; //默认模块（ define时未指定selfname的） 只能有一个\r\n\tmodules; //define的其他模块（含有selfname）\r\n\tisPreDependOn; //用于提前依赖\r\n\t_preModule;\r\n\ttargetDef; //用于提前依赖\r\n\tconstructor(src, isPreDependOn = false) {\r\n\t\tthis.src = src;\r\n\t\tthis.isPreDependOn = isPreDependOn;\r\n\t\tthis.modules = {};\r\n\t\tthis.defaultModule = null;\r\n\t\tthis.targetDef = null;\r\n\t\tif(isPreDependOn) {\r\n\t\t\tthis._preModule = {\r\n\t\t\t\trelyQueue: [],\r\n\t\t\t\tget() {\r\n\t\t\t\t\treturn this;\r\n\t\t\t\t},\r\n\t\t\t\trelyIt() {\r\n\t\t\t\t\tlet args = [];\r\n\t\t\t\t\tfor(let i = 0; i < arguments.length; i++) {\r\n\t\t\t\t\t\targs.push(arguments[i]);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.relyQueue.push(args);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t}\r\n\t}\r\n\tgiveRelys(module) {\r\n\t\tlet queue = this._preModule.relyQueue;\r\n\t\tthis._preModule = null;\r\n\t\twhile(queue.length) {\r\n\t\t\tlet args = queue.shift();\r\n\t\t\tmodule.relyIt.apply(module, args);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction _isSrc(nameOrUrl) {\r\n\tlet isSrc = /^[a-zA-Z0-9]+:\\/\\//.test(nameOrUrl);\r\n\treturn isSrc;\r\n}\r\n\r\nfunction setLastDefineObject(src, defineObject) {\r\n\tsrc = utils.removeQueryHash(src);\r\n\tlastDefinObjectMap[src] = defineObject;\r\n}\r\n\r\nfunction getLastDefineObject(src) {\r\n\tsrc = utils.removeQueryHash(src);\r\n\treturn lastDefinObjectMap[src];\r\n}\r\n\r\n/**\r\n * 获取指定脚本、加载中模块的依赖，并添加到defineObject.deps末尾。(配置里的依赖、不一定被添加到实际模块中，模块别名的缘故)\r\n * @param {Object} src\r\n */\r\nfunction appendLoadingModuleDeps(defineObject) {\r\n\tlet src = defineObject.src;\r\n\tlet deps = defineObject.deps;\r\n\tlet moduleDef = theDefinedMap[src];\r\n\tif(moduleDef) {\r\n\t\tlet mod = moduleDef.defaultModule && moduleDef.defaultModule.state == \"loading\" && moduleDef.defaultModule;\r\n\t\tlet _deps = mod && mod.deps;\r\n\t\tutils.each(_deps, (dep) => {\r\n\t\t\tif(xsloader.indexInArray(deps, dep) == -1) {\r\n\t\t\t\tdeps.push(dep);\r\n\t\t\t}\r\n\t\t});\r\n\t\tif(mod) {\r\n\t\t\tdefineObject.pushName(mod.selfname);\r\n\t\t}\r\n\t\tfor(let k in moduleDef.modules) {\r\n\t\t\tmod = moduleDef.modules[k].state == \"loading\" && moduleDef.modules[k];\r\n\t\t\t_deps = mod && mod.deps;\r\n\r\n\t\t\tif(mod) {\r\n\t\t\t\tdefineObject.pushName(mod.selfname);\r\n\t\t\t}\r\n\r\n\t\t\tutils.each(_deps, (dep) => {\r\n\t\t\t\tif(xsloader.indexInArray(deps, dep) == -1) {\r\n\t\t\t\t\tdeps.push(dep);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n}\r\n\r\n/**\r\n * \r\n * @param {Object} nameOrUrl\r\n * @param {Object} selfname\r\n * @param ifoneThenGet 如果没有找到(排除此模块)，且只有唯一的一个、且状态为loaded或defined、则返回该模块对象。获取的模块不等于此模块。\r\n */\r\nfunction getModule(nameOrUrl, selfname = null, ifoneThenGet = null) {\r\n\tnameOrUrl = utils.removeQueryHash(nameOrUrl);\r\n\tlet isSrc = _isSrc(nameOrUrl);\r\n\r\n\tlet moduleDef = theDefinedMap[nameOrUrl];\r\n\tif(moduleDef) {\r\n\t\tlet module;\r\n\t\tif(isSrc) { //如果提供地址、则获取默认模块\r\n\t\t\tif(selfname) {\r\n\t\t\t\tmodule = moduleDef.modules[selfname];\r\n\t\t\t} else {\r\n\t\t\t\tmodule = moduleDef.defaultModule;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif(moduleDef.isPreDependOn) {\r\n\t\t\t\tmodule = moduleDef._preModule;\r\n\t\t\t} else {\r\n\t\t\t\tmodule = moduleDef.modules[nameOrUrl];\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif(module == ifoneThenGet) {\r\n\t\t\tmodule = null;\r\n\t\t}\r\n\r\n\t\tif(!module && ifoneThenGet) {\r\n\t\t\tlet count = 0;\r\n\t\t\tlet mod = moduleDef.defaultModule;\r\n\t\t\tmod && mod != ifoneThenGet && count++;\r\n\t\t\tfor(let k in moduleDef.modules) {\r\n\t\t\t\tmod = moduleDef.modules[k];\r\n\t\t\t\tmod != ifoneThenGet && count++;\r\n\t\t\t}\r\n\t\t\tif(count == 1 && (mod.state == \"loaded\" || mod.state == \"defined\")) {\r\n\t\t\t\tmodule = mod;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn module ? module.get() : null;\r\n\t} else {\r\n\t\treturn null;\r\n\t}\r\n}\r\n\r\n//提前依赖不存在的模块\r\nfunction preDependOn(name) {\r\n\tlet isSrc = _isSrc(name);\r\n\tif(isSrc) {\r\n\t\tthrow new Error(\"expected name,but src:\" + name);\r\n\t} else if(theDefinedMap[name]) {\r\n\t\tthrow new Error(\"already defined:\" + name);\r\n\t} else {\r\n\t\tlet def = new ModuleDef(null, !!name);\r\n\t\ttheDefinedMap[name] = def;\r\n\t}\r\n}\r\n\r\n/**\r\n * 替换模块的src，用于加载含有多个地址模块的情况（提供多个地址、直到加载成功）\r\n * @param {Object} oldSrc\r\n * @param {Object} module\r\n */\r\nfunction replaceModuleSrc(oldSrc, module) {\r\n\tlet moduleDef = theDefinedMap[oldSrc];\r\n\tif(!moduleDef) {\r\n\t\tthrow new Error(\"not found module:src=\" + oldSrc);\r\n\t} else if(theDefinedMap[module.src]) {\r\n\t\tthrow new Error(\"already exists module:src=\" + module.src);\r\n\t} else {\r\n\t\tmoduleDef.src = module.src;\r\n\t\tdelete theDefinedMap[oldSrc];\r\n\t\ttheDefinedMap[module.src] = moduleDef;\r\n\t}\r\n}\r\n\r\nfunction clearEmptyModuleBySrc(src) {\r\n\tlet moduleDef = theDefinedMap[src];\r\n\tif(moduleDef && !moduleDef.defaultModule) {\r\n\t\tif(moduleDef.defaultModule) {\r\n\t\t\tthrow new Error(\"not empty module:src=\" + src);\r\n\t\t} else {\r\n\t\t\tfor(let x in moduleDef.modules) {\r\n\t\t\t\tthrow new Error(\"not empty module:src=\" + src);\r\n\t\t\t}\r\n\t\t}\r\n\t\tdelete theDefinedMap[src];\r\n\t}\r\n}\r\n\r\n/**\r\n * 同一个模块可重复设置。\r\n * @param {Object} name 模块名字，若为空则表示模块模块。多个不同的名字可能指向同一个模块。\r\n * @param {Object} module 模块，必须含有src\r\n */\r\nfunction setModule(name, module) {\r\n\tlet src = module.src;\r\n\tif(!src) {\r\n\t\tthrow new Error(\"expected module src!\");\r\n\t}\r\n\tlet moduleDef = theDefinedMap[src];\r\n\tif(moduleDef) {\r\n\t\tif(name) {\r\n\t\t\tlet lasfDef = theDefinedMap[name];\r\n\t\t\tif(theDefinedMap[name] && lasfDef != moduleDef && !lasfDef.isPreDependOn) {\r\n\t\t\t\tthrow new Error(\"already define module:\\n\\tname=\" + name + \",current.src=\" + src + \",\\n\\tthat.src=\" + theDefinedMap[name].src);\r\n\t\t\t} else {\r\n\t\t\t\tmoduleDef.modules[name] = module;\r\n\t\t\t\ttheDefinedMap[name] = moduleDef;\r\n\t\t\t\tif(lasfDef && lasfDef.isPreDependOn) {\r\n\t\t\t\t\tlasfDef.giveRelys(module);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t//默认模块\r\n\t\t\tif(moduleDef.defaultModule && moduleDef.defaultModule != module) {\r\n\t\t\t\tthrow new Error(\"already define default module:src=\" + src);\r\n\t\t\t} else {\r\n\t\t\t\tmoduleDef.defaultModule = module;\r\n\t\t\t}\r\n\t\t}\r\n\t} else {\r\n\t\tmoduleDef = new ModuleDef(src);\r\n\t\ttheDefinedMap[src] = moduleDef;\r\n\t\tif(name) {\r\n\t\t\tmoduleDef.modules[name] = module;\r\n\t\t\tlet lasfDef = theDefinedMap[name];\r\n\t\t\tif(lasfDef && !lasfDef.isPreDependOn) {\r\n\t\t\t\tthrow new Error(\"already define module:\\n\\tname=\" + name + \",current.src=\" + src + \",\\n\\tthat.src=\" + theDefinedMap[name].src);\r\n\t\t\t} else {\r\n\t\t\t\ttheDefinedMap[name] = moduleDef;\r\n\t\t\t\tif(lasfDef && lasfDef.isPreDependOn) {\r\n\t\t\t\t\tlasfDef.giveRelys(module);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t//默认模块\r\n\t\t\tmoduleDef.defaultModule = module;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport default {\r\n\tgetModule,\r\n\tsetModule,\r\n\treplaceModuleSrc,\r\n\tclearEmptyModuleBySrc,\r\n\tpreDependOn,\r\n\tsetLastDefineObject,\r\n\tgetLastDefineObject,\r\n\tappendLoadingModuleDeps\r\n};","import utils from \"../util/index.js\";\r\nimport script from \"./script.js\";\r\nimport moduleDef from \"./module-def\";\r\nconst global = utils.global;\r\nconst xsloader = global.xsloader;\r\n\r\n//新建模块实例\r\n//relyCallback(depModuleThis)\r\nfunction newModuleInstance(module, thatInvoker, relyCallback, pluginArgs) {\r\n\tlet instanceModule = {\r\n\t\trelyCallback: relyCallback,\r\n\t\t_invoker: thatInvoker,\r\n\t\t_module_: null,\r\n\t\tinitInvoker: function() {\r\n\t\t\t//确保正确的invoker\r\n\t\t\tif(module.ignoreAspect) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tlet obj = this._object;\r\n\t\t\tlet invoker = this._invoker;\r\n\r\n\t\t\tlet addTheAttrs = (theObj) => {\r\n\t\t\t\ttheObj._invoker_ = invoker;\r\n\t\t\t\tif(theObj._module_) {\r\n\t\t\t\t\ttheObj._modules_ = theObj._modules_ || [];\r\n\t\t\t\t\ttheObj._modules_.push(theObj._module_);\r\n\t\t\t\t}\r\n\t\t\t\ttheObj._module_ = this._module_;\r\n\t\t\t\treturn theObj;\r\n\t\t\t};\r\n\r\n\t\t\tlet isSingle = module.instanceType != \"clone\";\r\n\r\n\t\t\tif(xsloader.isObject(obj)) {\r\n\t\t\t\tif(module.loopObject && !isSingle) {\r\n\t\t\t\t\tthrow new Error(\"loop dependency not support single option:\" + module.description());\r\n\t\t\t\t}\r\n\t\t\t\tthis._object = addTheAttrs(isSingle ? obj : xsloader.clone(obj));\r\n\t\t\t} else if(xsloader.isFunction(obj)) {\r\n\t\t\t\tthis._object = addTheAttrs(obj);\r\n\t\t\t}\r\n\r\n\t\t},\r\n\t\t_object: null,\r\n\t\t_setDepModuleObjectGen: function(obj) {\r\n\t\t\tthis._object = obj;\r\n\t\t\tthis.initInvoker();\r\n\t\t},\r\n\t\tmodule: module,\r\n\t\tmoduleObject: function() {\r\n\t\t\treturn this._object;\r\n\t\t},\r\n\t\tgenExports: function() {\r\n\t\t\tthis._setDepModuleObjectGen({});\r\n\t\t\treturn this._object;\r\n\t\t},\r\n\t\t_getCacheKey: function(pluginArgs) {\r\n\t\t\tif(this._object.getCacheKey) {\r\n\t\t\t\treturn this._object.getCacheKey.call(this.thiz, pluginArgs);\r\n\t\t\t}\r\n\t\t\tlet id = this._invoker.getUrl();\r\n\t\t\treturn id;\r\n\t\t},\r\n\t\t_willCache: function(pluginArgs, cacheResult) {\r\n\t\t\tif(this._object.willCache) {\r\n\t\t\t\treturn this._object.willCache.call(this.thiz, pluginArgs, cacheResult);\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t},\r\n\t\tlastSinglePluginResult: function(pluginArgs) {\r\n\t\t\tlet id = this._getCacheKey(pluginArgs);\r\n\t\t\treturn this.module.lastSinglePluginResult(id, pluginArgs);\r\n\t\t},\r\n\t\tsetSinglePluginResult: function(pluginArgs, obj) {\r\n\t\t\tlet id = this._getCacheKey(pluginArgs);\r\n\t\t\tlet willCache = this._willCache(pluginArgs, obj);\r\n\t\t\treturn this.module.setSinglePluginResult(willCache, id, pluginArgs, obj);\r\n\t\t},\r\n\t\tinitInstance: function(justForSingle) {\r\n\t\t\tlet relyCallback = this.relyCallback;\r\n\t\t\tthis._module_ = this.module.dealInstance(this);\r\n\t\t\tthis._setDepModuleObjectGen(this.module.loopObject || this.module.moduleObject);\r\n\t\t\tif(pluginArgs !== undefined) {\r\n\t\t\t\tif(!this._object) {\r\n\t\t\t\t\tthrow new Error(\"pulgin error:\" + this.module.description());\r\n\t\t\t\t}\r\n\t\t\t\tif(this._object.isSingle === undefined) {\r\n\t\t\t\t\tthis._object.isSingle = true; //同样的参数也需要重新调用\r\n\t\t\t\t}\r\n\t\t\t\tif(justForSingle && !this._object.isSingle) {\r\n\t\t\t\t\tthrow new Error(\"just for single plugin\");\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet hasFinished = false;\r\n\t\t\t\tlet onload = (result, ignoreAspect) => {\r\n\t\t\t\t\tif(result == undefined) {\r\n\t\t\t\t\t\tresult = {\r\n\t\t\t\t\t\t\t__default: true\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t}\r\n\t\t\t\t\thasFinished = true;\r\n\t\t\t\t\tif(this._object.isSingle) {\r\n\t\t\t\t\t\tthis.setSinglePluginResult(pluginArgs, {\r\n\t\t\t\t\t\t\tresult: result,\r\n\t\t\t\t\t\t\tignoreAspect: ignoreAspect\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.module.ignoreAspect = ignoreAspect === undefined || ignoreAspect;\r\n\t\t\t\t\tthis._setDepModuleObjectGen(result);\r\n\t\t\t\t\trelyCallback(this);\r\n\t\t\t\t};\r\n\t\t\t\tlet onerror = (err) => {\r\n\t\t\t\t\thasFinished = true;\r\n\t\t\t\t\trelyCallback(this, new utils.PluginError(err || false));\r\n\t\t\t\t};\r\n\r\n\t\t\t\ttry {\r\n\t\t\t\t\tlet cacheResult;\r\n\t\t\t\t\tif(this._object.isSingle && (cacheResult = this.lastSinglePluginResult(pluginArgs)) !== undefined) {\r\n\t\t\t\t\t\tlet last = cacheResult;\r\n\t\t\t\t\t\tonload(last.result, last.ignoreAspect);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tlet args = [pluginArgs, onload, onerror, xsloader.config()].concat(this.module.args);\r\n\t\t\t\t\t\tthis._object.pluginMain.apply(this.thiz, args);\r\n\t\t\t\t\t}\r\n\t\t\t\t} catch(e) {\r\n\t\t\t\t\t//console.warn(e);\r\n\t\t\t\t\tonerror(e);\r\n\t\t\t\t}\r\n\t\t\t\tif(!hasFinished) {\r\n\t\t\t\t\tsetTimeout(function() {\r\n\t\t\t\t\t\tif(!hasFinished) {\r\n\t\t\t\t\t\t\tconsole.warn(\"invoke plugin may failed:page=\" + location.href + \",plugin=\" + module.selfname + \"!\" + pluginArgs);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}, xsloader.config().waitSeconds * 1000);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\trelyCallback(this);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t};\r\n\r\n\tlet moduleMap = {\r\n\t\tmodule: module,\r\n\t\tsrc: module.src,\r\n\t\tabsUrl: () => module.thiz.absUrl(),\r\n\t\tselfname: module.thiz.getName(),\r\n\t\tinvoker: instanceModule._invoker\r\n\t};\r\n\tinstanceModule.thiz = new script.Invoker(moduleMap);\r\n\r\n\t//\tif(module.selfname == \"css\") {\r\n\t//\t\tconsole.log(\"absUrl=\" + instanceModule.thiz.absUrl() + \",invoker.absUrl=\" + instanceModule.thiz.invoker().absUrl());\r\n\t//\t}\r\n\r\n\t//\tbuildInvoker(instanceModule);\r\n\treturn instanceModule;\r\n}\r\n\r\nfunction _newModule(name, src, thatInvoker, callback) {\r\n\tsrc = utils.removeQueryHash(src);\r\n\tlet defineObject = new script.DefineObject(src, null, [name, null, callback]);\r\n\tdefineObject.thatInvoker = thatInvoker;\r\n\tdefineObject.appendConfigDepsAndEmbedDeps(); //添加配置依赖，该模块对象是加载者、而不是define者\r\n\treturn newModule(defineObject);\r\n}\r\n\r\n//\r\n//模块依赖来源：(另见module.js:mayAddDeps,define.js:theRealDefine)\r\n//1、define里声明的\r\n//2、define或require里直接require('...')\r\n//3、config里配置的\r\n//4、手动通过handle.before或depBefore进行修改的\r\n/*\r\n *模块的名字来源：(另见define.js:onModuleLoaded)\r\n * 1、模块url地址:一定存在\r\n * 2、模块define时提供的：可选\r\n * 3、paths或depsPaths提供的：可选，且可能为默认模块\r\n * 4、name!提供的：可选\r\n */\r\nfunction newModule(defineObject) {\r\n\r\n\tlet instances = []; //所有模块实例\r\n\tlet moduleMap = {\r\n\t\tid: utils.getAndIncIdCount(),\r\n\t\tselfname: defineObject.selfname,\r\n\t\tparent: defineObject.parentDefine,\r\n\t\tdescription() {\r\n\t\t\treturn \"selfname=\" + (this.selfname || \"\") + \",src=\" + this.src;\r\n\t\t},\r\n\t\tdeps: defineObject.deps || [],\r\n\t\trelys: [],\r\n\t\tignoreAspect: false,\r\n\t\targs: null,\r\n\t\tsrc: defineObject.src, //绝对路径,可能等于当前页面路径\r\n\t\tabsUrlFromModule: () => defineObject.absUrlFromDefineObject(),\r\n\t\tgetCallback: () => defineObject.callback,\r\n\t\t_dealApplyArgs: (args) => args,\r\n\t\t_loadCallback: null,\r\n\t\tmoduleObject: undefined, //依赖模块对应的对象\r\n\t\tloopObject: undefined, //循环依赖对象\r\n\t\tinvoker: defineObject.thatInvoker,\r\n\t\tinstanceType: \"single\",\r\n\t\treinitByDefineObject(defineObject) {\r\n\t\t\tthis.deps = defineObject.deps || [];\r\n\t\t\tthis.getCallback = () => defineObject.callback;\r\n\t\t},\r\n\t\tsetInstanceType(instanceType) {\r\n\t\t\tthis.instanceType = instanceType;\r\n\t\t},\r\n\t\t_singlePluginResult: {},\r\n\t\tlastSinglePluginResult(id, pluginArgs) {\r\n\t\t\tif(this._singlePluginResult[id]) {\r\n\t\t\t\treturn this._singlePluginResult[id][pluginArgs];\r\n\t\t\t}\r\n\t\t},\r\n\t\tsetSinglePluginResult(willCache, id, pluginArgs, obj) {\r\n\t\t\tif(willCache) {\r\n\t\t\t\tif(!this._singlePluginResult[id]) {\r\n\t\t\t\t\tthis._singlePluginResult[id] = {};\r\n\t\t\t\t}\r\n\t\t\t\tthis._singlePluginResult[id][pluginArgs] = obj;\r\n\t\t\t} else {\r\n\t\t\t\tif(this._singlePluginResult[id]) {\r\n\t\t\t\t\tdelete this._singlePluginResult[id][pluginArgs];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tfinish(args) {\r\n\t\t\targs = this._dealApplyArgs(args);\r\n\t\t\tthis.args = args;\r\n\t\t\tlet obj;\r\n\t\t\tif(xsloader.isFunction(this.getCallback())) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tscript.currentDefineModuleQueue.push(this);\r\n\t\t\t\t\tobj = this.getCallback().apply(this.thiz, args);\r\n\t\t\t\t\tscript.currentDefineModuleQueue.pop();\r\n\t\t\t\t} catch(e) {\r\n\t\t\t\t\tscript.currentDefineModuleQueue.pop();\r\n\t\t\t\t\tconsole.error(\"error occured,invoker.url=\", this.invoker ? this.invoker.getUrl() : \"\");\r\n\t\t\t\t\tconsole.error(e);\r\n\t\t\t\t\tthis.setState(\"error\", e);\r\n\t\t\t\t\tthrow e;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tobj = this.getCallback();\r\n\t\t\t\tif(this.moduleObject !== undefined) {\r\n\t\t\t\t\tconsole.warn(\"ignore moudule:\" + moduleMap.description());\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tlet isDefault = false;\r\n\t\t\tif(obj === undefined) {\r\n\t\t\t\tisDefault = true;\r\n\t\t\t\tobj = {\r\n\t\t\t\t\t__default: true\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\tif(this.loopObject) {\r\n\t\t\t\tif(!xsloader.isObject(obj)) {\r\n\t\t\t\t\tthrow new Error(\"循环依赖的模块必须是对象：\" + this.description());\r\n\t\t\t\t}\r\n\t\t\t\tfor(let x in obj) {\r\n\t\t\t\t\tthis.loopObject[x] = obj[x];\r\n\t\t\t\t}\r\n\t\t\t\tobj = this.loopObject;\r\n\t\t\t}\r\n\t\t\t//this.moduleObject不为undefined，则使用了exports\r\n\t\t\tif(this.moduleObject === undefined ||\r\n\t\t\t\t!isDefault && obj !== undefined //如果使用了return、则优先使用\r\n\t\t\t) {\r\n\t\t\t\tthis.moduleObject = obj;\r\n\t\t\t}\r\n\t\t\tthis.setState(\"defined\");\r\n\t\t},\r\n\t\tstate: \"init\", //init,loading,loaded,defined,error,\r\n\t\terrinfo: null,\r\n\t\t_callback(fun) {\r\n\t\t\tlet thiz = this;\r\n\t\t\tlet _state = thiz.state;\r\n\t\t\tif(_state == 'defined' || thiz.loopObject) {\r\n\t\t\t\tlet theCallback = function() {\r\n\t\t\t\t\tif(fun) {\r\n\t\t\t\t\t\tlet depModule = newModuleInstance(thiz, fun.thatInvoker, fun.relyCallback, fun.pluginArgs);\r\n\t\t\t\t\t\tdepModule.initInstance();\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t\t//已经加载了模块，仍然需要判断为其另外设置的依赖模块是否已被加载\r\n\t\t\t\tlet deps = !thiz.loopObject && xsloader.config().getDeps(thiz.selfname);\r\n\t\t\t\t//console.log(this.selfname,\":\",deps);\r\n\t\t\t\t//deps=null;\r\n\t\t\t\tif(deps && deps.length > 0) {\r\n\t\t\t\t\txsloader.require(deps, () => {\r\n\t\t\t\t\t\ttheCallback();\r\n\t\t\t\t\t}).then({\r\n\t\t\t\t\t\tdefined_module_for_deps: this.selfname\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttheCallback();\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn false;\r\n\t\t\t} else if(_state == \"timeout\" || _state == \"error\") {\r\n\t\t\t\tif(fun) {\r\n\t\t\t\t\tfun.relyCallback(this, this.errinfo);\r\n\t\t\t\t}\r\n\t\t\t\treturn false;\r\n\t\t\t} else {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t},\r\n\t\tsetState(_state, errinfo) {\r\n\t\t\tthis.state = _state;\r\n\t\t\tthis.errinfo = errinfo;\r\n\t\t\tif(!this._callback()) {\r\n\t\t\t\twhile(this.relys.length) {\r\n\t\t\t\t\tlet fun = this.relys.shift();\r\n\t\t\t\t\tthis._callback(fun);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tget() {\r\n\t\t\tif(this.refmodule) {\r\n\t\t\t\tthis.state = this.refmodule.state; //状态同步,保持与refmodule状态相同\r\n\t\t\t\treturn this.refmodule;\r\n\t\t\t}\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\trefmodule: undefined, //引用指定模块\r\n\t\t/**\r\n\t\t * 依赖当前模块、表示依赖otherModule模块，当前模块为别名或引用。\r\n\t\t * @param {Object} otherModule\r\n\t\t */\r\n\t\ttoOtherModule(otherModule) {\r\n\t\t\tthis.refmodule = otherModule;\r\n\t\t\tthis.get(); //状态同步\r\n\t\t\tlet theRelys = this.relys;\r\n\t\t\tthis.relys = [];\r\n\t\t\twhile(theRelys.length) {\r\n\t\t\t\tlet fun = theRelys.shift();\r\n\t\t\t\tthis.refmodule.relyIt(fun.thatInvoker, fun.relyCallback, fun.pluginArgs);\r\n\t\t\t}\r\n\t\t},\r\n\t\twhenNeed(loadCallback) {\r\n\t\t\tif(this.relys.length || this.refmodule && this.refmodule.relys.length) {\r\n\t\t\t\tloadCallback(); //已经被依赖了\r\n\t\t\t} else {\r\n\t\t\t\tthis._loadCallback = loadCallback;\r\n\t\t\t}\r\n\t\t},\r\n\t\t/**\r\n\t\t * \r\n\t\t * @param {Object} thatInvoker\r\n\t\t * @param {Object} callbackFun function(depModule,err)\r\n\t\t * @param {Object} pluginArgs\r\n\t\t */\r\n\t\trelyIt(thatInvoker, callbackFun, pluginArgs) {\r\n\t\t\tif(this.refmodule) {\r\n\t\t\t\tthis.get(); //状态同步\r\n\t\t\t\tthis.refmodule.relyIt(thatInvoker, callbackFun, pluginArgs); //传递给refmodule\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tlet fun = {\r\n\t\t\t\tthatInvoker: thatInvoker,\r\n\t\t\t\trelyCallback: callbackFun,\r\n\t\t\t\tpluginArgs: pluginArgs\r\n\t\t\t};\r\n\t\t\tif(this._callback(fun)) {\r\n\t\t\t\tthis.relys.push(fun);\r\n\t\t\t}\r\n\t\t\tif(this._loadCallback) { //将会加载此模块及其依赖的模块\r\n\t\t\t\tlet loadCallback = this._loadCallback;\r\n\t\t\t\tthis._loadCallback = null;\r\n\t\t\t\tloadCallback();\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\tnew script.Invoker(moduleMap);\r\n\r\n\t//返回_module_\r\n\tmoduleMap.dealInstance = function(moduleInstance) {\r\n\t\tinstances.push(moduleInstance);\r\n\t\tlet _module_ = {\r\n\t\t\topId: null,\r\n\t\t\tsetToAll(name, value, opId) {\r\n\t\t\t\tif(opId !== undefined && opId == this.opId) {\r\n\t\t\t\t\treturn; //防止循环\r\n\t\t\t\t}\r\n\t\t\t\topId = opId || getModuleId();\r\n\t\t\t\tthis.opId = opId;\r\n\r\n\t\t\t\tlet obj = {};\r\n\t\t\t\tif(xsloader.isString(name)) {\r\n\t\t\t\t\tobj[name] = value;\r\n\t\t\t\t} else if(xsloader.isObject(name)) {\r\n\t\t\t\t\tfor(let k in name) {\r\n\t\t\t\t\t\tobj[k] = name[k];\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthrow new Error(\"unknown param:\" + name);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tutils.each(instances, function(ins) {\r\n\t\t\t\t\tlet mobj = ins.moduleObject();\r\n\t\t\t\t\tfor(let k in obj) {\r\n\t\t\t\t\t\tmobj[k] = obj[k];\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(mobj._modules_) {\r\n\t\t\t\t\t\tutils.each(mobj._modules_, function(_m_) {\r\n\t\t\t\t\t\t\t_m_.setToAll(name, value, opId);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t};\r\n\r\n\t\treturn _module_;\r\n\t};\r\n\r\n\tmoduleMap.printOnNotDefined = function() {\r\n\t\tlet root = {\r\n\t\t\tnodes: []\r\n\t\t};\r\n\t\tthis._printOnNotDefined(root);\r\n\r\n\t\tlet leafs = [];\r\n\r\n\t\tfunction findLeaf(node) {\r\n\t\t\tif(node.nodes.length) {\r\n\t\t\t\tutils.each(node.nodes, function(item) {\r\n\t\t\t\t\tfindLeaf(item);\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tleafs.push(node);\r\n\t\t\t}\r\n\t\t}\r\n\t\tfindLeaf(root);\r\n\r\n\t\tfunction genErrs(node, infos) {\r\n\t\t\tinfos.push(node.err);\r\n\t\t\tif(node.parent) {\r\n\t\t\t\tgenErrs(node.parent, infos);\r\n\t\t\t}\r\n\t\t}\r\n\t\tutils.each(leafs, function(leaf) {\r\n\t\t\tlet infos = [];\r\n\t\t\tgenErrs(leaf, infos);\r\n\t\t\tinfos = infos.reverse();\r\n\t\t\tconsole.error(\"load module error stack:my page=\" + location.href);\r\n\t\t\tfor(let i = 1; i < infos.length;) {\r\n\t\t\t\tlet as = [];\r\n\t\t\t\tfor(let k = 0; k < 3 && i < infos.length; k++) {\r\n\t\t\t\t\tas.push(infos[i++]);\r\n\t\t\t\t}\r\n\t\t\t\tconsole.warn(as.join(\"\\n\\t--->\"));\r\n\t\t\t}\r\n\t\t\tlet errModule = leaf.module;\r\n\t\t\tif(leaf.module && leaf.module.state == \"defined\") {\r\n\t\t\t\terrModule = leaf.parent.module;\r\n\t\t\t}\r\n\t\t\tif(errModule) {\r\n\t\t\t\tlet as = [];\r\n\t\t\t\tfor(let i = 0; i < errModule.deps.length; i++) {\r\n\t\t\t\t\tlet dep = errModule.deps[i];\r\n\t\t\t\t\tlet index = dep.lastIndexOf(\"!\");\r\n\t\t\t\t\tif(index != -1) {\r\n\t\t\t\t\t\tdep = dep.substring(0, index);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlet depMod = moduleDef.getModule(dep);\r\n\t\t\t\t\tif(depMod) {\r\n\t\t\t\t\t\tas.push(dep + \":\" + depMod.state);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tas.push(dep + \":null\");\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tconsole.warn(\"failed module:\" + errModule.description() + \",\\n\\tdeps state infos [\" + as.join(\",\") + \"]\");\r\n\t\t\t\tfor(let i = 0; i < errModule.deps.length; i++) {\r\n\t\t\t\t\tlet dep = errModule.deps[i];\r\n\t\t\t\t\tlet index = dep.lastIndexOf(\"!\");\r\n\t\t\t\t\tif(index != -1) {\r\n\t\t\t\t\t\tdep = dep.substring(0, index);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlet depMod = moduleDef.getModule(dep);\r\n\t\t\t\t\tif(depMod) {\r\n\t\t\t\t\t\tconsole.warn(\"\\t\" + dep + \":src=\" + depMod.src + \",absUrl=\" + (depMod.thiz && depMod.thiz.absUrl()));\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tconsole.warn(dep + \":\");\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t};\r\n\tmoduleMap._printOnNotDefined = function(parentNode) {\r\n\t\tlet node = {\r\n\t\t\terr: \"[\" + this.description() + \"].state=\" + this.state,\r\n\t\t\tmodule: this,\r\n\t\t\tparent: parentNode,\r\n\t\t\tnodes: []\r\n\t\t};\r\n\t\tparentNode.nodes.push(node);\r\n\t\tif(this.state == \"defined\") {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tutils.each(this.deps, function(dep) {\r\n\t\t\tlet indexPlguin = dep.indexOf(\"!\");\r\n\t\t\tif(indexPlguin > 0) {\r\n\t\t\t\tdep = dep.substring(0, indexPlguin);\r\n\t\t\t}\r\n\t\t\tlet mod = moduleDef.getModule(dep);\r\n\t\t\tif(mod && mod.state == \"defined\") {\r\n\t\t\t\tmod._printOnNotDefined(node);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t//只打印一个错误栈\r\n\t\t\tif(mod) {\r\n\t\t\t\tmod._printOnNotDefined && mod._printOnNotDefined(node);\r\n\t\t\t} else {\r\n\t\t\t\tnode.nodes.push({\r\n\t\t\t\t\tparent: parentNode,\r\n\t\t\t\t\tnodes: [],\r\n\t\t\t\t\terr: \"[\" + dep + \"] has not module\"\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t};\r\n\tmoduleDef.setModule(moduleMap.selfname, moduleMap);\r\n\r\n\treturn moduleMap;\r\n}\r\n\r\nlet randModuleIndex = 0;\r\n\r\nfunction getModuleId() {\r\n\treturn \"_xs_req_2019_\" + randModuleIndex++;\r\n}\r\n\r\n//everyOkCallback(depModules,module),errCallback(err,invoker)\r\nfunction everyRequired(defineObject, module, everyOkCallback, errCallback) {\r\n\tif(defineObject.isError) {\r\n\t\treturn;\r\n\t}\r\n\r\n\t//处理相对路径,此时模块的依赖已经全部处理好了\r\n\tdefineObject.dealRelative(module);\r\n\r\n\tlet config = xsloader.config();\r\n\r\n\tlet isError = false,\r\n\t\thasCallErr = false,\r\n\t\ttheExports;\r\n\tlet depCount = module.deps.length;\r\n\t//module.jsScriptCount = 0;\r\n\tlet depModules = new Array(depCount);\r\n\r\n\tlet invoker_of_module = module.thiz;\r\n\r\n\tfunction checkFinish(index, dep_name, depModule, syncHandle) {\r\n\t\tdepModules[index] = depModule;\r\n\r\n\t\tif( /*(depCount == 0 || depCount - module.jsScriptCount == 0)*/ depCount <= 0 && !isError) {\r\n\t\t\teveryOkCallback(depModules, module);\r\n\t\t} else if(isError) {\r\n\t\t\tmodule.setState('error', isError);\r\n\t\t\tif(!hasCallErr) {\r\n\t\t\t\thasCallErr = true;\r\n\t\t\t\terrCallback({\r\n\t\t\t\t\terr: isError,\r\n\t\t\t\t\tindex: index,\r\n\t\t\t\t\tdep_name: dep_name\r\n\t\t\t\t}, invoker_of_module);\r\n\t\t\t}\r\n\t\t}!isError && syncHandle && syncHandle();\r\n\t}\r\n\r\n\tutils.each(module.deps, function(dep, index, ary, syncHandle) {\r\n\t\t//\t\tif(xsloader.startsWith(dep, \"css!\")) {\r\n\t\t//\t\t\tconsole.log(\"src=\" + module.src + \",absUrl=\" + invoker_of_module.absUrl() + \",absolute=\" + invoker_of_module.src());\r\n\t\t//\t\t}\r\n\t\tlet originDep = dep;\r\n\t\tlet pluginArgs = undefined;\r\n\t\tlet pluginIndex = dep.indexOf(\"!\");\r\n\t\tif(pluginIndex > 0) {\r\n\t\t\tpluginArgs = dep.substring(pluginIndex + 1);\r\n\t\t\tdep = dep.substring(0, pluginIndex);\r\n\t\t}\r\n\t\tlet relyItFun = function() {\r\n\t\t\tmoduleDef.getModule(dep)\r\n\t\t\t\t.relyIt(invoker_of_module, function(depModule, err) {\r\n\t\t\t\t\tif(!err) {\r\n\t\t\t\t\t\tdepCount--;\r\n\t\t\t\t\t\tif(dep == \"exports\") {\r\n\t\t\t\t\t\t\tif(theExports) {\r\n\t\t\t\t\t\t\t\tmodule.moduleObject = theExports;\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\ttheExports = module.moduleObject = depModule.genExports();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tisError = err;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcheckFinish(index, originDep, depModule, syncHandle);\r\n\t\t\t\t}, pluginArgs);\r\n\t\t};\r\n\r\n\t\tif(!moduleDef.getModule(dep)) {\r\n\t\t\tlet isJsFile = utils.isJsFile(dep);\r\n\t\t\tdo {\r\n\t\t\t\tlet urls;\r\n\t\t\t\tif(!isJsFile && dep.indexOf(\"/\") < 0 && dep.indexOf(\":\") >= 0) {\r\n\t\t\t\t\tlet i1 = dep.indexOf(\":\");\r\n\t\t\t\t\tlet i2 = dep.indexOf(\":\", i1 + 1);\r\n\t\t\t\t\tlet i3 = i2 > 0 ? dep.indexOf(\":\", i2 + 1) : -1;\r\n\t\t\t\t\tif(i2 == -1) {\r\n\t\t\t\t\t\tisError = \"illegal module:\" + dep;\r\n\t\t\t\t\t\terrCallback(isError, invoker_of_module);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlet version;\r\n\t\t\t\t\tlet groupModule;\r\n\t\t\t\t\tif(i3 == -1) {\r\n\t\t\t\t\t\tversion = config.defaultVersion[dep];\r\n\t\t\t\t\t\tgroupModule = dep + \":\" + version;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tversion = dep.substring(i3 + 1);\r\n\t\t\t\t\t\tgroupModule = dep;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(version === undefined) {\r\n\t\t\t\t\t\tisError = \"unknown version for:\" + dep;\r\n\t\t\t\t\t\terrCallback(isError, invoker_of_module);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlet _url = xsloader._resUrlBuilder(groupModule);\r\n\t\t\t\t\turls = xsloader.isArray(_url) ? _url : [_url];\r\n\t\t\t\t} else if(config.isInUrls(dep)) {\r\n\t\t\t\t\turls = config.getUrls(dep);\r\n\t\t\t\t} else if(isJsFile) {\r\n\t\t\t\t\turls = [dep];\r\n\t\t\t\t} else {\r\n\t\t\t\t\turls = [];\r\n\t\t\t\t}\r\n\r\n\t\t\t\t//TODO errCallback是否无效??\r\n\t\t\t\tif(urls.length == 0) {\r\n\t\t\t\t\t//提前依赖模块\r\n\t\t\t\t\tmoduleDef.preDependOn(dep);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tutils.each(urls, function(url, index) {\r\n\t\t\t\t\t\tif(xsloader.startsWith(url, \".\") || xsloader.startsWith(url, \"/\")) {\r\n\t\t\t\t\t\t\tif(!invoker_of_module.rurl(defineObject)) {\r\n\t\t\t\t\t\t\t\tisError = \"script url is null:'\" + module.description();\r\n\t\t\t\t\t\t\t\terrCallback(isError, invoker_of_module);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\turl = utils.getPathWithRelative(invoker_of_module.rurl(defineObject), url);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tlet absolute = utils.dealPathMayAbsolute(url);\r\n\t\t\t\t\t\t\tif(absolute.absolute) {\r\n\t\t\t\t\t\t\t\turl = absolute.path;\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\turl = config.baseUrl + url;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif(urls[index]==dep){\r\n\t\t\t\t\t\t\tdep=url;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\turls[index] = config.dealUrl(dep, url);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(!isError && urls.length) {\r\n\t\t\t\t\tutils.replaceModulePrefix(config, urls); //前缀替换\r\n\r\n\t\t\t\t\tlet m2Name = isJsFile ? null : dep;\r\n\t\t\t\t\tlet module2 = _newModule(m2Name, urls[0], invoker_of_module);\r\n\t\t\t\t\tmodule2.setState(\"loading\"); //只有此处才设置loading状态\r\n\r\n\t\t\t\t\tlet configDeps = [];\r\n\t\t\t\t\tif(m2Name) {\r\n\t\t\t\t\t\tlet _deps = config.getDeps(m2Name);\r\n\t\t\t\t\t\tutils.each(_deps, (d) => {\r\n\t\t\t\t\t\t\tif(xsloader.indexInArray(configDeps, d) == -1) {\r\n\t\t\t\t\t\t\t\tconfigDeps.push(d);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tutils.each(urls, (url) => {\r\n\t\t\t\t\t\tlet _deps = config.getDeps(url);\r\n\t\t\t\t\t\tutils.each(_deps, (d) => {\r\n\t\t\t\t\t\t\tif(xsloader.indexInArray(configDeps, d) == -1) {\r\n\t\t\t\t\t\t\t\tconfigDeps.push(d);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tif(configDeps.length) {\r\n\t\t\t\t\t\t//先加载配置依赖\r\n\t\t\t\t\t\txsloader.require(configDeps, () => {\r\n\t\t\t\t\t\t\tloadModule();\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tloadModule();\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t//加载模块dep:module2\r\n\t\t\t\t\tfunction loadModule(index = 0) {\r\n\t\t\t\t\t\tif(index >= urls.length) {\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tlet url = urls[index];\r\n\t\t\t\t\t\tmoduleDef.setLastDefineObject(url, defineObject);\r\n\t\t\t\t\t\tif(index > 0) {\r\n\t\t\t\t\t\t\tlet oldSrc = module2.src;\r\n\t\t\t\t\t\t\tmodule2.src = url;\r\n\t\t\t\t\t\t\tmoduleDef.replaceModuleSrc(oldSrc, module2);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tscript.loadScript(module2.selfname, url, (scriptData) => {\r\n\t\t\t\t\t\t\tlet defaultMod;\r\n\t\t\t\t\t\t\tif(module2.state == \"loading\") { //module2.selfname为配置名称，尝试默认模块或者唯一的模块\r\n\t\t\t\t\t\t\t\t//(唯一的模块用于支持：脚本里只有一个define、且指定了模块名、且此处的模块名与其自己指定了不相等)\r\n\t\t\t\t\t\t\t\tdefaultMod = moduleDef.getModule(module2.src, null, module2);\r\n\t\t\t\t\t\t\t\tif(defaultMod && module2 != defaultMod) {\r\n\t\t\t\t\t\t\t\t\tmodule2.toOtherModule(defaultMod);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tif(!defaultMod && module2.state == \"loading\") {\r\n\t\t\t\t\t\t\t\t//isError = \"load module err(may not define default):\" + module2.description();\r\n\t\t\t\t\t\t\t\t//errCallback(isError, invoker_of_module);\r\n\t\t\t\t\t\t\t\t//？？没有define的情况、直接完成\r\n\t\t\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\t\t\tmodule2.finish([]);\r\n\t\t\t\t\t\t\t\t} catch(e) {\r\n\t\t\t\t\t\t\t\t\tisError = e;\r\n\t\t\t\t\t\t\t\t\terrCallback(isError, invoker_of_module);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}, (err) => {\r\n\t\t\t\t\t\t\tif(index + 1 < urls.length) {\r\n\t\t\t\t\t\t\t\tloadModule(index + 1);\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tisError = err;\r\n\t\t\t\t\t\t\t\terrCallback(isError, invoker_of_module);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} while (false);\r\n\t\t}\r\n\t\tif(!isError) {\r\n\t\t\trelyItFun();\r\n\t\t}\r\n\t}, defineObject.handle.orderDep);\r\n\t//TODO STRONG ????ie10及以下版本，js文件一个一个加载，从而解决缓存等造成的混乱问题\r\n}\r\n\r\nexport default {\r\n\t...moduleDef,\r\n\tnewModule,\r\n\teveryRequired,\r\n\tnewModuleInstance,\r\n\tgetModuleId\r\n};","import utils from \"../util/index.js\";\r\nimport moduleScript from \"./module.js\";\r\n\r\nconst global = utils.global;\r\nconst xsloader = global.xsloader;\r\n\r\nconst defContextName = \"xsloader1.1.x\";\r\nconst DATA_ATTR_MODULE = 'data-xsloader-module';\r\nconst DATA_ATTR_CONTEXT = \"data-xsloader-context\";\r\nconst INNER_DEPS_PLUGIN = \"__inner_deps__\";\r\nconst innerDepsMap = {}; //内部依赖加载插件用于保存依赖的临时map\r\nconst globalDefineQueue = []; //没有配置前的define\r\n\r\nconst isOpera = typeof opera !== 'undefined' && opera.toString() === '[object Opera]';\r\nconst safariVersion = (function() {\r\n\tlet ua = navigator.userAgent.toLowerCase();\r\n\tlet s = ua.match(/version\\/([\\d.]+).*safari/);\r\n\treturn s ? parseInt(s[1]) : -1;\r\n})();\r\n\r\nconst readyRegExp = navigator.platform === 'PLAYSTATION 3' ? /^complete$/ : /^(complete|loaded)$/;\r\nconst theLoaderScript = document.currentScript || utils.getScriptBySubname(\"xsloader.js\");\r\nconst theLoaderUrl = utils.getNodeAbsolutePath(theLoaderScript);\r\nconst thePageUrl = (function() {\r\n\tlet url = location.href;\r\n\turl = utils.removeQueryHash(url);\r\n\treturn url;\r\n})();\r\nconst head = document.head || document.getElementsByTagName('head')[0];\r\n\r\nconst currentDefineModuleQueue = []; //当前回调的模块\r\ncurrentDefineModuleQueue.peek = function() {\r\n\tif(this.length > 0) {\r\n\t\treturn this[this.length - 1];\r\n\t}\r\n};\r\n\r\nlet lastAppendHeadDom = theLoaderScript;\r\nlet isSrcFromScriptLoad; //获取脚本的src是否在load事件阶段\r\nlet lastScriptSrc = thePageUrl;\r\nlet theRealDefine;\r\nif(safariVersion > 0 && safariVersion <= 7) {\r\n\tisSrcFromScriptLoad = true;\r\n}\r\n\r\n//处理嵌套依赖\r\nfunction _dealEmbedDeps(deps, defineObject) {\r\n\tfor(let i = 0; i < deps.length; i++) {\r\n\t\tlet dep = deps[i];\r\n\t\tif(xsloader.isArray(dep)) {\r\n\t\t\t//内部的模块顺序加载\r\n\t\t\tlet modName = \"inner_order_\" + moduleScript.getModuleId();\r\n\t\t\tlet isOrderDep = !(dep.length > 0 && dep[0] === false);\r\n\t\t\tif(dep.length > 0 && (dep[0] === false || dep[0] === true)) {\r\n\t\t\t\tdep = dep.slice(1);\r\n\t\t\t}\r\n\t\t\tinnerDepsMap[modName] = {\r\n\t\t\t\tdeps: dep,\r\n\t\t\t\tabsUrl: defineObject.absUrlFromDefineObject(),\r\n\t\t\t\torderDep: isOrderDep,\r\n\t\t\t\tsrc: defineObject.src,\r\n\t\t\t};\r\n\r\n\t\t\t//console.log(innerDepsMap[modName]);\r\n\t\t\tdeps[i] = INNER_DEPS_PLUGIN + \"!\" + modName;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction _getPluginParam(path) {\r\n\tlet pluginIndex = path.indexOf(\"!\");\r\n\tif(pluginIndex > 0) {\r\n\t\treturn path.substring(pluginIndex);\r\n\t} else {\r\n\t\treturn \"\";\r\n\t}\r\n}\r\n\r\n/////////////////////////////\r\nclass Handle {\r\n\tdefineObject;\r\n\tconstructor(defineObject) {\r\n\t\tthis.defineObject = defineObject;\r\n\t}\r\n\r\n\tthen(option) {\r\n\t\tlet defineObject = this.defineObject;\r\n\t\tdefineObject.handle = xsloader.extend(defineObject.handle, option);\r\n\t\treturn this;\r\n\t}\r\n\terror(onError) {\r\n\t\tlet defineObject = this.defineObject;\r\n\t\tdefineObject.handle.onError = onError;\r\n\t\treturn this;\r\n\t}\r\n\tonError(err, invoker) {\r\n\t\tthis.defineObject.handle.onError(err, invoker);\r\n\t}\r\n}\r\n\r\nclass ThisInvoker {\r\n\tinvoker;\r\n\tconstructor(invoker) {\r\n\t\tthis.invoker = invoker;\r\n\t}\r\n}\r\n\r\nfunction _buildInvoker(module) {\r\n\tlet invoker = module[\"thiz\"];\r\n\tmodule = module.module || module;\r\n\tlet id = xsloader.randId();\r\n\tinvoker.getId = function() {\r\n\t\treturn id;\r\n\t};\r\n\tinvoker.getUrl = function(relativeUrl, appendArgs = true, optionalAbsUrl) {\r\n\t\tif(optionalAbsUrl && !utils.dealPathMayAbsolute(optionalAbsUrl).absolute) {\r\n\t\t\tthrow new Error(-1, \"expected absolute url:\" + optionalAbsUrl);\r\n\t\t}\r\n\r\n\t\tlet url;\r\n\t\tif(relativeUrl === undefined) {\r\n\t\t\turl = this.src();\r\n\t\t} else if(xsloader.startsWith(relativeUrl, \".\") || utils.dealPathMayAbsolute(relativeUrl).absolute) {\r\n\t\t\turl = utils.getPathWithRelative(optionalAbsUrl || this.absUrl(), relativeUrl);\r\n\t\t} else {\r\n\t\t\turl = xsloader.config().baseUrl + relativeUrl;\r\n\t\t}\r\n\t\tif(appendArgs) {\r\n\t\t\tif(url == thePageUrl) {\r\n\t\t\t\turl += location.search + location.hash;\r\n\t\t\t}\r\n\t\t\treturn xsloader.config().dealUrl(module, url);\r\n\t\t} else {\r\n\t\t\treturn url;\r\n\t\t}\r\n\t};\r\n\tinvoker.require = function() {\r\n//\t\tconsole.log(\"this.require:absolute=\" + invoker.src() + \",args[0]=\" + arguments[0]);\r\n\t\tlet h = xsloader.require.apply(new ThisInvoker(invoker), arguments);\r\n\t\tif(h instanceof Handle) {\r\n\t\t\th.then({\r\n\t\t\t\tabsUrl: invoker.src()\r\n\t\t\t});\r\n\t\t}\r\n\t\treturn h;\r\n\t};\r\n\tinvoker.define = function() {\r\n//\t\tconsole.log(\"this.define:absolute=\" + invoker.src() + \",args[0]=\" + arguments[0] + (typeof arguments[0] == \"string\" ? (\",args[1]=\" + arguments[1]) : \"\"));\r\n\t\tlet h = xsloader.define.apply(new ThisInvoker(invoker), arguments);\r\n\t\tif(h instanceof Handle) {\r\n\t\t\th.then({\r\n\t\t\t\tabsUrl: invoker.src()\r\n\t\t\t});\r\n\t\t}\r\n\t\treturn h;\r\n\t};\r\n\tinvoker.rurl = function(defineObject) {\r\n\t\treturn defineObject && defineObject.absUrlFromDefineObject() || this.absUrl();\r\n\t};\r\n\tinvoker.defineAsync = function() {\r\n\t\tlet h = invoker.define.apply(invoker, arguments);\r\n\t\treturn h;\r\n\t};\r\n\tinvoker.withAbsUrl = function(absUrlStr) {\r\n\t\tif(!absUrlStr) {\r\n\t\t\tabsUrlStr = invoker.absUrl();\r\n\t\t}\r\n\t\tlet moduleMap = {\r\n\t\t\tmodule: module,\r\n\t\t\tsrc: module.src,\r\n\t\t\tabsUrl: () => absUrlStr,\r\n\t\t\tname: invoker.getName(),\r\n\t\t\tinvoker: invoker.invoker()\r\n\t\t};\r\n\t\treturn new Invoker(moduleMap);\r\n\t};\r\n}\r\n\r\nclass Invoker {\r\n\t_im;\r\n\tconstructor(moduleMap) {\r\n\t\tthis._im = new InVar(moduleMap);\r\n\t\tmoduleMap.thiz = this;\r\n\t\t_buildInvoker(moduleMap);\r\n\t}\r\n\t/**\r\n\t * 获取绝对地址（弃用）\r\n\t */\r\n\tgetAbsoluteUrl() {\r\n\t\treturn this._im.get().src;\r\n\t}\r\n\r\n\t/**\r\n\t * 获取绝对地址\r\n\t */\r\n\tsrc() {\r\n\t\treturn this._im.get().src;\r\n\t}\r\n\r\n\tgetName() {\r\n\t\treturn this._im.get().selfname;\r\n\t}\r\n\r\n\t/**\r\n\t * 获取当前调用者的调用者\r\n\t */\r\n\tinvoker() {\r\n\t\treturn this._im.get().invoker;\r\n\t}\r\n\r\n\tabsUrl() { //用于获取其他模块地址的参考路径\r\n\t\treturn this._im.get().absUrlFromModule();\r\n\t}\r\n}\r\n\r\nfunction getInvoker(thiz, nullNew = false) {\r\n\tif(thiz instanceof ThisInvoker) {\r\n\t\treturn thiz.invoker;\r\n\t} else if(thiz instanceof Invoker) {\r\n\t\treturn thiz;\r\n\t} else if(thiz instanceof DefineObject) {\r\n\t\treturn thiz.thatInvoker;\r\n\t} else {\r\n\t\tlet parentModule = currentDefineModuleQueue.peek();\r\n\t\tif(parentModule) {\r\n\t\t\treturn parentModule.thiz;\r\n\t\t} else if(nullNew) {\r\n\t\t\tlet moduleMap = {\r\n\t\t\t\tmodule: \"\",\r\n\t\t\t\tsrc: thePageUrl,\r\n\t\t\t\tabsUrl: () => thePageUrl,\r\n\t\t\t\tname: \"__root__\",\r\n\t\t\t\tinvoker: null\r\n\t\t\t};\r\n\t\t\treturn new Invoker(moduleMap);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nclass DefineObject {\r\n\tthiz;\r\n\tisRequire;\r\n\tsrc;\r\n\tparentDefine;\r\n\thandle;\r\n\tselfname;\r\n\tdeps;\r\n\tcallback;\r\n\tthatInvoker;\r\n\t_directDepLength = 0;\r\n\tdirectDepLength = 0;\r\n\tnames = [];\r\n\tconstructor(src, thiz, args = [], isRequire = false /*, willDealConfigDeps = false*/ ) {\r\n\t\tthis.parentDefine = currentDefineModuleQueue.peek();\r\n\t\tthis.thatInvoker = getInvoker(thiz);\r\n\r\n\t\tthis.src = src;\r\n\t\tthis.thiz = thiz;\r\n\t\tthis.isRequire = isRequire;\r\n\t\tthis.handle = {\r\n\t\t\tonError(err, invoker) {\r\n\t\t\t\tconsole.warn(err);\r\n\t\t\t},\r\n\t\t\tbefore(deps) {},\r\n\t\t\tdepBefore(index, dep, depDeps) {},\r\n\t\t\torderDep: false,\r\n\t\t\tabsoluteUrl: undefined, //弃用\r\n\t\t\tabsUrl: undefined,\r\n\t\t\tinstance: undefined,\r\n\t\t};\r\n\r\n\t\tif(thiz instanceof ThisInvoker) {\r\n\t\t\t//this.handle.absUrl = thiz.invoker.src(); //设置默认参考地址\r\n\t\t\tthis.src = thiz.invoker.src();\r\n\t\t}\r\n\r\n\t\tlet selfname = args[0];\r\n\t\tlet deps = args[1];\r\n\t\tlet callback = args[2];\r\n\t\tif(args.length == 1) {\r\n\t\t\t//直接定义模块，且没有依赖\r\n\t\t\tcallback = selfname;\r\n\t\t\tselfname = null;\r\n\t\t\tdeps = null;\r\n\t\t} else if(typeof selfname !== 'string') {\r\n\t\t\tcallback = deps;\r\n\t\t\tdeps = selfname;\r\n\t\t\tselfname = null; //为空的、表示定义默认模块\r\n\t\t}\r\n\r\n\t\tif(deps && !xsloader.isArray(deps)) {\r\n\t\t\tcallback = deps;\r\n\t\t\tdeps = null;\r\n\t\t}\r\n\r\n\t\tif(!deps) {\r\n\t\t\tdeps = [];\r\n\t\t}\r\n\r\n\t\t//获取函数体里直接require('...')的依赖\r\n\t\t//if(!isRequire) {\r\n\t\tutils.appendInnerDeps(deps, callback);\r\n\t\t//}\r\n\r\n\t\tthis.selfname = selfname;\r\n\t\tthis.deps = deps;\r\n\t\tthis.pushName(selfname);\r\n\t\tthis.callback = callback;\r\n\t\tthis._directDepLength = deps.length;\r\n\t\tthis.directDepLength = deps.length;\r\n\t}\r\n\r\n\tpushName(name) {\r\n\t\tif(name && xsloader.indexInArray(this.names, name) == -1) {\r\n\t\t\tthis.names.push(name);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * 处理配置依赖及嵌套依赖,同时会替换前缀\r\n\t */\r\n\tappendConfigDepsAndEmbedDeps(module) {\r\n\t\tlet config = xsloader.config();\r\n\t\tlet src = this.src;\r\n\t\tlet deps = this.deps;\r\n\r\n\t\tlet _deps = config.getDeps(src);\r\n\t\tutils.each(_deps, (dep) => {\r\n\t\t\tif(xsloader.indexInArray(deps, dep) == -1) {\r\n\t\t\t\tdeps.push(dep);\r\n\t\t\t}\r\n\t\t});\r\n\t\tutils.each(this.names, (name) => {\r\n\t\t\t_deps = config.getDeps(name);\r\n\t\t\tutils.each(_deps, (dep) => {\r\n\t\t\t\tif(xsloader.indexInArray(deps, dep) == -1) {\r\n\t\t\t\t\tdeps.push(dep);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\t\tif(this.handle.orderDep && this._directDepLength > 1 && deps.length > this._directDepLength) {\r\n\t\t\tlet odeps = [true]; //第一个true表示顺序依赖\r\n\t\t\twhile(this._directDepLength-- > 0) {\r\n\t\t\t\todeps.push(deps.shift());\r\n\t\t\t}\r\n\t\t\tdeps.unshift(odeps);\r\n\t\t\tthis.handle.orderDep = false;\r\n\t\t}\r\n\r\n\t\t//处理嵌套依赖\r\n\t\t_dealEmbedDeps(deps, this);\r\n\t\tutils.replaceModulePrefix(config, deps); //前缀替换\r\n\t\tif(module) {\r\n\t\t\tmodule.deps = deps;\r\n\t\t\tmodule._dealApplyArgs = (function(directDepLength, hasOrderDep) {\r\n\t\t\t\treturn function(applyArgs) {\r\n\t\t\t\t\tif(directDepLength == 0) {\r\n\t\t\t\t\t\treturn [];\r\n\t\t\t\t\t}\r\n\t\t\t\t\t//顺序依赖,还原成最初的顺序,移除额外的依赖。\r\n\t\t\t\t\tlet args = new Array(directDepLength + 1);\r\n\t\t\t\t\tif(hasOrderDep) {\r\n\t\t\t\t\t\targs = applyArgs[0];\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tfor(var i = 0; i < directDepLength; i++) {\r\n\t\t\t\t\t\t\targs[i] = applyArgs[i];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\targs[directDepLength] = applyArgs[applyArgs.length - 1].slice(0, directDepLength);\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn args;\r\n\t\t\t\t};\r\n\t\t\t})(this.directDepLength, this.directDepLength > 0 && this._directDepLength <= 0);\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tdealRelative(module) {\r\n\t\tlet deps = this.deps;\r\n\t\t//处理相对路径\r\n\t\tfor(let i = 0; i < deps.length; i++) {\r\n\t\t\t//console.log(module.selfname+(\"(\"+defineObject.handle.defined_module_for_deps+\")\"), \":\", deps);\r\n\t\t\tlet m = deps[i];\r\n\t\t\tlet jsFilePath = utils.isJsFile(m);\r\n\r\n\t\t\t//替换相对路径为绝对路径\r\n\t\t\tif(jsFilePath && xsloader.startsWith(m, \".\")) {\r\n\t\t\t\tm = utils.getPathWithRelative(module.thiz.rurl(this), jsFilePath.path) + _getPluginParam(m);\r\n\t\t\t\tdeps[i] = m;\r\n\t\t\t}\r\n\r\n\t\t\tlet paths = utils.graphPath.tryAddEdge(this.handle.defined_module_for_deps || module.selfname, m);\r\n\t\t\tif(paths.length > 0) {\r\n\t\t\t\tlet moduleLoop = moduleScript.getModule(m); //该模块必定已经被定义过\r\n\t\t\t\tmoduleLoop.loopObject = {};\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tabsUrlFromDefineObject() {\r\n\t\treturn this.handle.absUrl || this.handle.absoluteUrl || this.src;\r\n\t}\r\n\r\n}\r\n\r\n////////////////////////\r\n\r\n/**\r\n * 获取当前脚本，返回对象：\r\n * src:脚本绝对地址，不含参数\r\n * node:脚本dom对象\r\n * @param {Object} isRemoveQueryHash\r\n */\r\nfunction getCurrentScript(isRemoveQueryHash = true) {\r\n\tfunction _getCurrentScriptOrSrc() { //兼容获取正在运行的js\r\n\t\t//取得正在解析的script节点\r\n\t\tif(document.currentScript !== undefined) { //firefox 4+\r\n\t\t\tlet node = document.currentScript && document.currentScript.src && document.currentScript;\r\n\t\t\tif(node) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tnode,\r\n\t\t\t\t\tsrc: node.src\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(utils.IE_VERSION > 0 && utils.IE_VERSION <= 10) {\r\n\t\t\tlet nodes = document.getElementsByTagName(\"script\"); //只在head标签中寻找\r\n\t\t\t//\t\t\tutils.each(nodes, (node) => {\r\n\t\t\t//\t\t\t\tconsole.log(\"node.src=\" + node.src + \",node.readyState=\" + node.readyState);\r\n\t\t\t//\t\t\t});\r\n\t\t\tfor(let i = nodes.length - 1; i >= 0; i--) {\r\n\t\t\t\tlet node = nodes[i];\r\n\t\t\t\tif(node.readyState === \"interactive\" && node.src) {\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tnode,\r\n\t\t\t\t\t\tsrc: node.src\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tlet stack;\r\n\t\ttry {\r\n\t\t\tlet a = undefined;\r\n\t\t\ta.b.c(); //强制报错,以便捕获e.stack\r\n\t\t} catch(e) { //safari的错误对象只有line,sourceId,sourceURL\r\n\t\t\tstack = e.stack || e.sourceURL || e.stacktrace || '';\r\n\t\t\tif(!stack && window.opera) {\r\n\t\t\t\t//opera 9没有e.stack,但有e.Backtrace,但不能直接取得,需要对e对象转字符串进行抽取\r\n\t\t\t\tstack = (String(e).match(/of linked script \\S+/g) || []).join(\" \");\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(stack) {\r\n\t\t\t/**e.stack最后一行在所有支持的浏览器大致如下:\r\n\t\t\t *chrome23:\r\n\t\t\t * at http://113.93.50.63/data.js:4:1\r\n\t\t\t *firefox17:\r\n\t\t\t *@http://113.93.50.63/query.js:4\r\n\t\t\t *opera12:\r\n\t\t\t *@http://113.93.50.63/data.js:4\r\n\t\t\t *IE10:\r\n\t\t\t *  at Global code (http://113.93.50.63/data.js:4:1)\r\n\t\t\t */\r\n\t\t\tstack = stack.split(/[@ ]/g).pop(); //取得最后一行,最后一个空格或@之后的部分\r\n\t\t\tstack = stack[0] == \"(\" ? stack.slice(1, -1) : stack;\r\n\t\t\tlet s = stack.replace(/(:\\d+)?:\\d+$/i, \"\"); //去掉行号与或许存在的出错字符起始位置\r\n\t\t\treturn {\r\n\t\t\t\tsrc: s\r\n\t\t\t};\r\n\t\t}\r\n\t}\r\n\r\n\tlet rs;\r\n\tlet parentDefine = currentDefineModuleQueue.peek();\r\n\tif(parentDefine) {\r\n\t\trs = {\r\n\t\t\tsrc: parentDefine.src\r\n\t\t};\r\n\t} else {\r\n\t\trs = _getCurrentScriptOrSrc();\r\n\t}\r\n\r\n\tif(!rs) {\r\n\t\trs = {\r\n\t\t\tsrc: thePageUrl\r\n\t\t};\r\n\t}\r\n\r\n\tif(utils.isLoaderEnd() && rs.src == theLoaderUrl) {\r\n\t\trs.src = thePageUrl;\r\n\t\trs.node = null;\r\n\t}\r\n\r\n\tif(!rs.node && rs.src != thePageUrl) {\r\n\t\tlet src = utils.removeQueryHash(rs.src);\r\n\t\tlet nodes = document.getElementsByTagName(\"script\"); //只在head标签中寻找\r\n\t\tfor(let i = 0; i < nodes.length; i++) {\r\n\t\t\tlet node = nodes[i];\r\n\t\t\tif(src == utils.removeQueryHash(node.src)) {\r\n\t\t\t\trs.node = node;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tif(rs.node) {\r\n\t\trs.src = utils.getNodeAbsolutePath(rs.node);\r\n\t}\r\n\tif(isRemoveQueryHash) {\r\n\t\trs.src = utils.removeQueryHash(rs.src);\r\n\t}\r\n\treturn rs;\r\n\r\n}\r\n\r\nfunction __createNode() {\r\n\tlet node = document.createElement('script');\r\n\tnode.type = 'text/javascript';\r\n\tnode.charset = 'utf-8';\r\n\tnode.async = \"async\";\r\n\treturn node;\r\n}\r\n\r\nfunction __removeListener(node, func, name, ieName) {\r\n\tif(node.detachEvent && !isOpera) {\r\n\t\tif(ieName) {\r\n\t\t\tnode.detachEvent(ieName, func);\r\n\t\t}\r\n\t} else {\r\n\t\tnode.removeEventListener(name, func, false);\r\n\t}\r\n}\r\n\r\n/**\r\n * callbackObj.onScriptLoad\r\n * callbackObj.onScriptError\r\n *\r\n */\r\nfunction __browserLoader(moduleName, url, callbackObj) {\r\n\tlet node = __createNode();\r\n\tmoduleName && node.setAttribute(DATA_ATTR_MODULE, moduleName);\r\n\tnode.setAttribute(DATA_ATTR_CONTEXT, defContextName);\r\n\r\n\tlet useAttach = !xsloader.isFunction(node.addEventListener) && node.attachEvent &&\r\n\t\t!(node.attachEvent.toString && node.attachEvent.toString().indexOf('[native code') < 0) &&\r\n\t\t!isOpera;\r\n\r\n\tif(useAttach) {\r\n\t\tnode.attachEvent('onreadystatechange', callbackObj.onScriptLoad);\r\n\t} else {\r\n\t\tnode.addEventListener('load', callbackObj.onScriptLoad, true);\r\n\t\tlet errListen = function() {\r\n\t\t\t__removeListener(node, errListen, 'error');\r\n\t\t\tcallbackObj.onScriptError.apply(this, arguments);\r\n\t\t};\r\n\t\tcallbackObj.errListen = errListen;\r\n\t\tnode.addEventListener('error', errListen, true);\r\n\t}\r\n\tappendHeadDom(node);\r\n\tif(utils.IE_VERSION > 0 && utils.IE_VERSION <= 10) {\r\n\t\txsloader.asyncCall(() => {\r\n\t\t\tnode.src = url; //在ie10-以下，必须在脚本插入head后再进行src的设置、且需要异步设置。\r\n\t\t});\r\n\t} else {\r\n\t\tnode.src = url;\r\n\t}\r\n}\r\n\r\nfunction __getScriptData(evt, callbackObj) {\r\n\tlet node = evt.currentTarget || evt.srcElement;\r\n\t__removeListener(node, callbackObj.onScriptLoad, 'load', 'onreadystatechange');\r\n\t__removeListener(node, callbackObj.errListen, 'error');\r\n\treturn {\r\n\t\tnode: node,\r\n\t\tname: node && node.getAttribute(DATA_ATTR_MODULE),\r\n\t\tsrc: utils.removeQueryHash(node && utils.getNodeAbsolutePath(node))\r\n\t};\r\n}\r\n\r\nfunction appendHeadDom(dom) {\r\n\tif(!xsloader.isDOM(dom)) {\r\n\t\tthrow new Error(\"expected dom object,but provided:\" + dom);\r\n\t}\r\n\tlet nextDom = lastAppendHeadDom.nextSibling;\r\n\thead.insertBefore(dom, nextDom);\r\n\t//\t\t\thead.appendChild(dom);\r\n\tlastAppendHeadDom = dom;\r\n}\r\n\r\n/////////////////////////\r\n\r\nfunction loadScript(moduleName, url, onload, onerror) {\r\n\tlet callbackObj = {};\r\n\tcallbackObj.onScriptLoad = function(evt) {\r\n\t\tif(callbackObj.removed) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(evt.type === 'load' || (readyRegExp.test((evt.currentTarget || evt.srcElement).readyState))) {\r\n\t\t\tcallbackObj.removed = true;\r\n\t\t\tlet scriptData = __getScriptData(evt, callbackObj);\r\n\t\t\tif(isSrcFromScriptLoad) {\r\n\t\t\t\tlastScriptSrc = scriptData.src; //已经不含参数\r\n\t\t\t\txsloader.asyncCall(() => {\r\n\t\t\t\t\tonload(scriptData);\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tif(utils.IE_VERSION > 0 || utils.IE_VERSION == \"edge\") { //ie下确保此事件在脚本之后执行。\r\n\t\t\t\t\txsloader.asyncCall(() => {\r\n\t\t\t\t\t\tonload(scriptData);\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\tonload(scriptData);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\tcallbackObj.onScriptError = function(evt) {\r\n\t\tif(callbackObj.removed) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tcallbackObj.removed = true;\r\n\t\tlet scriptData = __getScriptData(evt, callbackObj);\r\n\t\tonerror(scriptData);\r\n\t};\r\n\t__browserLoader(moduleName, url, callbackObj);\r\n}\r\n\r\nfunction doDefine(thiz, args, isRequire) {\r\n\t//\tconsole.log(\"**********************************[\");\r\n\tlet rs = getCurrentScript(); //已经不含参数\r\n\r\n\t//\tif(typeof args[0] == \"string\") {\r\n\t//\t\tconsole.log(\"args[0]=\" + args[0] + \",args[1]=\" + args[1] + \",src=\" + rs.src);\r\n\t//\t} else {\r\n\t//\t\tconsole.log(\"args[0]=\" + args[0] + \",src=\" + rs.src);\r\n\t//\t}\r\n\t//\tconsole.log(rs.node);\r\n\t//\tconsole.log(\"**********************************]\\n\");\r\n\tlet src = rs.src;\r\n\tlet defineObject = new DefineObject(src, thiz, args, isRequire);\r\n\tif(!isSrcFromScriptLoad) {\r\n\t\ttry { //防止执行其他脚本\r\n\t\t\tif(defineObject.src) {\r\n\t\t\t\tlet node = document.currentScript;\r\n\t\t\t\tif(node && node.getAttribute(\"src\") && node.getAttribute(DATA_ATTR_CONTEXT) != defContextName &&\r\n\t\t\t\t\tdefineObject.src != theLoaderUrl && defineObject.src != thePageUrl) {\r\n\t\t\t\t\tconsole.error(\"unknown js script module:\" + xsloader.xsJson2String(defineObject.src));\r\n\t\t\t\t\tconsole.error(node);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} catch(e) {\r\n\t\t\txsloader.config().error(e);\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tlet handle = new Handle(defineObject);\r\n\r\n\tlet isLoaderEnd = utils.isLoaderEnd();\r\n\txsloader.asyncCall(() => {\r\n\t\tif(isSrcFromScriptLoad && isLoaderEnd) {\r\n\t\t\t//执行顺序：当前脚本define>load事件(获取lastScriptSrc)>当前位置>onload\r\n\t\t\tdefineObject.src = lastScriptSrc;\r\n\t\t}\r\n\t\ttheRealDefine([defineObject]);\r\n\t});\r\n\treturn handle;\r\n}\r\n\r\nfunction predefine() {\r\n\tlet args = [];\r\n\tfor(let i = 0; i < arguments.length; i++) {\r\n\t\targs.push(arguments[i]);\r\n\t}\r\n\treturn doDefine(this, args, false);\r\n}\r\n\r\nfunction prerequire(deps, callback) {\r\n\r\n\tif(!xsloader.config()) { //require必须是在config之后\r\n\t\tthrow new Error(\"not config\");\r\n\t}\r\n\r\n\tif(arguments.length == 1 && xsloader.isString(deps)) { //获取已经加载的模块\r\n\t\tlet originDeps = deps;\r\n\t\tlet pluginArgs = undefined;\r\n\t\tlet pluginIndex = deps.indexOf(\"!\");\r\n\t\tif(pluginIndex > 0) {\r\n\t\t\tpluginArgs = deps.substring(pluginIndex + 1);\r\n\t\t\tdeps = deps.substring(0, pluginIndex);\r\n\t\t\tif(pluginArgs) {\r\n\t\t\t\tlet argArr = [pluginArgs];\r\n\t\t\t\tutils.replaceModulePrefix(xsloader.config(), argArr); //前缀替换\r\n\t\t\t\tpluginArgs = argArr[0];\r\n\t\t\t}\r\n\t\t}\r\n\t\tlet module = moduleScript.getModule(deps);\r\n\t\tlet thatInvoker = getInvoker(this, true);\r\n\t\tif(!module) {\r\n\t\t\tdeps = thatInvoker.getUrl(deps, false);\r\n\t\t\tmodule = moduleScript.getModule(deps);\r\n\t\t}\r\n\t\tif(!module) {\r\n\t\t\tthrow new Error(\"the module '\" + originDeps + \"' is not load!\");\r\n\t\t} else if(module.state != \"defined\") {\r\n\t\t\tthrow new Error(\"the module '\" + originDeps + \"' is not defined:\" + module.state);\r\n\t\t}\r\n\t\tlet theMod;\r\n\t\tmoduleScript.newModuleInstance(module, thatInvoker, (depModule) => {\r\n\t\t\ttheMod = depModule.moduleObject();\r\n\t\t}, pluginArgs).initInstance(true);\r\n\t\tif(theMod === undefined) {\r\n\t\t\tthrow Error(\"the module '\" + originDeps + \"' is not load!\");\r\n\t\t}\r\n\t\treturn theMod;\r\n\t}\r\n\r\n\tlet selfname = xsloader.randId(\"_require\");\r\n\tif(xsloader.isFunction(deps)) {\r\n\t\tcallback = deps;\r\n\t\tdeps = [];\r\n\t}\r\n\tutils.appendInnerDeps(deps, callback);\r\n\tlet timeid;\r\n\tlet handle = doDefine(this, [selfname, deps, function() {\r\n\t\tif(timeid !== undefined) {\r\n\t\t\tclearTimeout(timeid);\r\n\t\t\ttimeid = undefined;\r\n\t\t}\r\n\t\t//\t\tconsole.log(\"2======require:\"+selfname);\r\n\t\t//\t\tconsole.log(callback);\r\n\t\tif(xsloader.isFunction(callback)) {\r\n\t\t\ttry {\r\n\t\t\t\tcallback.apply(this, arguments);\r\n\t\t\t} catch(e) {\r\n\t\t\t\thandle.onError(e);\r\n\t\t\t}\r\n\t\t}\r\n\t}], true);\r\n\tlet customerErrCallback;\r\n\tlet isErr;\r\n\r\n\thandle.error(function(err, invoker) {\r\n\t\tisErr = err;\r\n\t\tif(timeid !== undefined) {\r\n\t\t\tclearTimeout(timeid);\r\n\t\t\ttimeid = undefined;\r\n\t\t}\r\n\t\tif(customerErrCallback) {\r\n\t\t\tcustomerErrCallback(err, invoker);\r\n\t\t} else {\r\n\t\t\tconsole.warn(\"invoker.url:\" + (invoker && invoker.getUrl()));\r\n\t\t\tconsole.warn(err);\r\n\t\t}\r\n\t});\r\n\thandle.error = function(errCallback) {\r\n\t\tcustomerErrCallback = errCallback;\r\n\t\treturn this;\r\n\t};\r\n\r\n\tlet checkResultFun = function() {\r\n\t\ttimeid = undefined;\r\n\t\tlet ifmodule = moduleScript.getModule(selfname);\r\n\t\t//console.log(isErr)\r\n\t\tif((!ifmodule || ifmodule.state != 'defined') && !isErr) {\r\n\t\t\tlet module = ifmodule;\r\n\t\t\tif(module) {\r\n\t\t\t\tutils.each(module.deps, function(dep) {\r\n\t\t\t\t\tlet mod = moduleScript.getModule(dep);\r\n\t\t\t\t\tif(mod && mod.printOnNotDefined) {\r\n\t\t\t\t\t\tmod.printOnNotDefined();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\tconsole.error(\"require timeout:[\" + (deps ? deps.join(\",\") : \"\") + \"]\");\r\n\t\t}\r\n\t};\r\n\ttimeid = setTimeout(checkResultFun, xsloader.config().waitSeconds * 1000);\r\n\treturn handle;\r\n}\r\n\r\n//对于safari7-:在脚本加载事件中可获得正确的脚本地址\r\n\r\nconst initDefine = function(theDefine) {\r\n\ttheRealDefine = (defines, loaded) => {\r\n\t\tif(!xsloader.config()) { //还没有配置\r\n\t\t\tglobalDefineQueue.push(defines);\r\n\t\t} else {\r\n\t\t\ttheDefine(defines, loaded);\r\n\t\t}\r\n\t};\r\n\treturn {\r\n\t\tpredefine,\r\n\t\tprerequire,\r\n\t};\r\n};\r\n\r\nconst onConfigedCallback = function() {\r\n\twhile(globalDefineQueue.length) {\r\n\t\tlet defines = globalDefineQueue.shift();\r\n\t\ttheRealDefine(defines);\r\n\t}\r\n};\r\n\r\nexport default {\r\n\tdefContextName,\r\n\ttheLoaderScript,\r\n\ttheLoaderUrl,\r\n\tthePageUrl,\r\n\tappendHeadDom,\r\n\tinitDefine,\r\n\tHandle,\r\n\tInvoker,\r\n\tDefineObject,\r\n\tloadScript,\r\n\tcurrentDefineModuleQueue,\r\n\tonConfigedCallback,\r\n\tINNER_DEPS_PLUGIN,\r\n\tinnerDepsMap,\r\n};","import loader from './loader.js';\nimport \"../public/index.js\";\nimport utils from \"../util/index.js\";\n\nconst global = utils.global;\nconst xsloader = global.xsloader;\n\nimport script from \"./script.js\";\nimport moduleScript from \"./module.js\";\n\nlet theContext;\nlet theConfig;\nlet argsObject = {};\n\nxsloader.config = function() {\n\treturn theConfig;\n};\nxsloader.script = function() {\n\treturn script.theLoaderScript;\n};\nxsloader.scriptSrc = function() {\n\treturn script.theLoaderUrl;\n};\n\nxsloader.putUrlArgs = function(argsObj) {\n\targsObject = xsloader.extend(argsObject, argsObj);\n};\n\nxsloader.getUrlArgs = function() {\n\tlet obj = xsloader.extend({}, argsObject);\n\treturn obj;\n};\n\nxsloader.clearUrlArgs = function() {\n\targsObject = {};\n};\n\nxsloader.appendHeadDom=script.appendHeadDom;\n\nxsloader.hasDefine = function(name) {\n\tlet has = false;\n\tlet module = moduleScript.getModule(name);\n\tif(!module || module.state == \"init\") {\n\n\t} else {\n\t\thas = true;\n\t}\n\treturn has;\n};\n\n//用于把\"group:project:version\"转换成url地址,返回一个String或包含多个url地址的数组\nxsloader._resUrlBuilder = function(groupName) {\n\tthrow new Error('resUrlBuilder not found!');\n};\n\nxsloader.clear_module_ = function() {\n\tlet modules = arguments;\n\tfor(let i = 0; i < modules.length; i++) {\n\t\tif(modules[i]) {\n\t\t\tdelete modules[i]._module_;\n\t\t\tdelete modules[i]._modules_;\n\t\t}\n\t}\n};\n\nfunction _newContext() {\n\tlet context = {\n\t\tcontextName: script.contextName,\n\t\tdefQueue: []\n\t};\n\treturn context;\n}\n\nloader.loaderFun((option) => {\n\tif(theContext) {\n\t\tthrow new Error(\"already configed!\");\n\t}\n\toption = xsloader.extend({\n\t\tbaseUrl: utils.getPathWithRelative(location.pathname, \"./\", xsloader.endsWith(location.pathname, \"/\")),\n\t\turlArgs: {},\n\t\tignoreProperties: false,\n\t\tpaths: {},\n\t\tdepsPaths: {},\n\t\tdeps: {},\n\t\tjsExts: undefined,\n\t\tproperties: {},\n\t\tmodulePrefix: {},\n\t\tdefineFunction: {},\n\t\tmodulePrefixCount: 0,\n\t\twaitSeconds: 10,\n\t\tautoUrlArgs() {\n\t\t\treturn false;\n\t\t},\n\t\tinstance: \"single\",\n\t\tdealtDeps: {},\n\t\tdealProperties(obj) {\n\t\t\treturn utils.propertiesDeal(obj, option.properties);\n\t\t},\n\t\tisInUrls(m) {\n\t\t\treturn !!this.getUrls(m);\n\t\t},\n\t\tgetUrls(m) {\n\t\t\treturn this.paths[m] || this.depsPaths[m];\n\t\t},\n\t\tgetDeps(m) {\n\t\t\tlet as = this.dealtDeps[m] || [];\n\t\t\tlet deps = [];\n\t\t\tlet hasOrderDep = undefined;\n\n\t\t\tif(as.length > 0 && (as[0] === true || as[0] === false)) {\n\t\t\t\tif(as[0]) {\n\t\t\t\t\tdeps = [\n\t\t\t\t\t\t[]\n\t\t\t\t\t];\n\t\t\t\t\thasOrderDep = true;\n\t\t\t\t} else {\n\t\t\t\t\tas.splice(0, 1);\n\t\t\t\t}\n\t\t\t}\n\t\t\tfor(let i = 0; i < as.length; i++) {\n\t\t\t\tif(hasOrderDep === true) {\n\t\t\t\t\tdeps[0].push(as[i]);\n\t\t\t\t} else {\n\t\t\t\t\tdeps.push(as[i]);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn deps;\n\t\t},\n\t\tdealUrl(module, url) {\n\t\t\tlet urlArg;\n\t\t\tlet nameOrUrl;\n\t\t\tif(this.autoUrlArgs()) {\n\t\t\t\turlArg = \"_t=\" + new Date().getTime();\n\t\t\t} else if(xsloader.isString(module)) {\n\t\t\t\turlArg = this.urlArgs[module];\n\t\t\t\tif(urlArg) {\n\t\t\t\t\tnameOrUrl = module;\n\t\t\t\t} else {\n\t\t\t\t\tnameOrUrl = module;\n\t\t\t\t\turlArg = this.forPrefixSuffix(module);\n\t\t\t\t}\n\n\t\t\t\tif(!urlArg) {\n\t\t\t\t\tnameOrUrl = \"*\";\n\t\t\t\t\turlArg = this.urlArgs[\"*\"];\n\t\t\t\t}\n\n\t\t\t} else {\n\n\t\t\t\turlArg = this.urlArgs[url];\n\t\t\t\tif(urlArg) {\n\t\t\t\t\tnameOrUrl = url;\n\t\t\t\t} else {\n\t\t\t\t\turlArg = this.forPrefixSuffix(url);\n\t\t\t\t}\n\n\t\t\t\tif(!urlArg) {\n\t\t\t\t\tnameOrUrl = module.selfname;\n\t\t\t\t\turlArg = this.urlArgs[nameOrUrl];\n\t\t\t\t}\n\n\t\t\t\tif(!urlArg) {\n\t\t\t\t\tnameOrUrl = module.aurl;\n\t\t\t\t\turlArg = this.forPrefixSuffix(nameOrUrl);\n\t\t\t\t}\n\n\t\t\t\tif(!urlArg) {\n\t\t\t\t\tnameOrUrl = \"*\";\n\t\t\t\t\turlArg = this.urlArgs[\"*\"];\n\t\t\t\t}\n\n\t\t\t}\n\t\t\tif(xsloader.isFunction(urlArg)) {\n\t\t\t\turlArg = urlArg.call(this, nameOrUrl);\n\t\t\t}\n\t\t\tfor(let k in argsObject) { //加入全局的参数\n\t\t\t\turlArg += \"&\" + k + \"=\" + encodeURIComponent(argsObject[k]);\n\t\t\t}\n\t\t\treturn xsloader.appendArgs2Url(url, urlArg);\n\t\t},\n\t\tdealUrlArgs(url) {\n\t\t\turl = utils.getPathWithRelative(location.href, url);\n\t\t\treturn this.dealUrl(url, url);\n\t\t},\n\t\tdefaultVersion: {}\n\t}, option);\n\n\tif(!xsloader.endsWith(option.baseUrl, \"/\")) {\n\t\toption.baseUrl += \"/\";\n\t}\n\toption.baseUrl = utils.getPathWithRelative(location.href, option.baseUrl);\n\n\tif(!option.ignoreProperties) {\n\t\toption = option.dealProperties(option);\n\t}\n\n\tutils.strValue2Arr(option.paths);\n\tutils.strValue2Arr(option.depsPaths);\n\tutils.strValue2Arr(option.deps);\n\n\tif(!xsloader.isFunction(option.autoUrlArgs)) {\n\t\tlet isAutoUrlArgs = option.autoUrlArgs;\n\t\toption.autoUrlArgs = function() {\n\t\t\treturn isAutoUrlArgs;\n\t\t};\n\t}\n\n\tlet modulePrefixCount = 0;\n\tfor(let prefix in option.modulePrefix) {\n\t\tif(xsloader.startsWith(prefix, \".\") || xsloader.startsWith(prefix, \"/\")) {\n\t\t\tthrow new Error(\"modulePrefix can not start with '.' or '/'(\" + prefix + \")\");\n\t\t}\n\t\tmodulePrefixCount++;\n\t}\n\toption.modulePrefixCount = modulePrefixCount;\n\tif(modulePrefixCount > 0) {\n\t\t//替换urlArgs中地址前缀\n\t\tlet star = option.urlArgs[\"*\"];\n\t\tdelete option.urlArgs[\"*\"];\n\n\t\tlet urlArgsArr = [];\n\t\tfor(let k in option.urlArgs) {\n\t\t\tlet url = k;\n\t\t\tif(utils.isJsFile(url)) { //处理相对\n\t\t\t\tif(xsloader.startsWith(url, \".\") || xsloader.startsWith(url, \"/\") && !xsloader.startsWith(url, \"//\")) {\n\t\t\t\t\turl = utils.getPathWithRelative(script.theLoaderUrl, url);\n\t\t\t\t} else {\n\t\t\t\t\tlet absolute = utils.dealPathMayAbsolute(url);\n\t\t\t\t\tif(absolute.absolute) {\n\t\t\t\t\t\turl = absolute.path;\n\t\t\t\t\t} else if(!xsloader.startsWith(url, \"*]\")) { //排除*]；单*[可以有前缀\n\t\t\t\t\t\turl = option.baseUrl + url;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t}\n\t\t\turlArgsArr.push({\n\t\t\t\turl: url,\n\t\t\t\targs: option.urlArgs[k]\n\t\t\t});\n\t\t}\n\n\t\tfor(let prefix in option.modulePrefix) {\n\t\t\tlet replaceStr = option.modulePrefix[prefix].replace;\n\t\t\tfor(let i = 0; i < urlArgsArr.length; i++) {\n\t\t\t\tlet urlArgObj = urlArgsArr[i];\n\t\t\t\tlet starP = \"\";\n\t\t\t\tif(xsloader.startsWith(urlArgObj.url, \"*[\")) {\n\t\t\t\t\tstarP = \"*[\";\n\t\t\t\t\turlArgObj.url = urlArgObj.url.substring(2);\n\t\t\t\t}\n\t\t\t\tif(xsloader.startsWith(urlArgObj.url, prefix)) {\n\t\t\t\t\turlArgObj.url = replaceStr + urlArgObj.url.substring(prefix.length);\n\t\t\t\t}\n\t\t\t\tstarP && (urlArgObj.url = starP + urlArgObj.url);\n\t\t\t}\n\t\t}\n\t\toption.urlArgs = {};\n\t\toption.urlArgs[\"*\"] = star;\n\t\tfor(let i = 0; i < urlArgsArr.length; i++) {\n\t\t\tlet urlArgObj = urlArgsArr[i];\n\t\t\toption.urlArgs[urlArgObj.url] = urlArgObj.args;\n\t\t}\n\t}\n\n\t//预处理urlArgs中的*[与*]\n\tlet _urlArgs_prefix = [];\n\tlet _urlArgs_suffix = [];\n\toption._urlArgs_prefix = _urlArgs_prefix;\n\toption._urlArgs_suffix = _urlArgs_suffix;\n\n\tfor(let k in option.urlArgs) {\n\t\tlet url = k;\n\t\tif(xsloader.startsWith(url, \"*[\")) {\n\t\t\tlet strfix = url.substring(2);\n\t\t\tif(xsloader.startsWith(strfix, \".\") || xsloader.startsWith(strfix, \"/\") && !xsloader.startsWith(strfix, \"//\")) {\n\t\t\t\tstrfix = utils.getPathWithRelative(script.theLoaderUrl, strfix);\n\t\t\t} else {\n\t\t\t\tlet absolute = utils.dealPathMayAbsolute(strfix);\n\t\t\t\tif(absolute.absolute) {\n\t\t\t\t\tstrfix = absolute.path;\n\t\t\t\t} else {\n\t\t\t\t\turl = option.baseUrl + url;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t_urlArgs_prefix.push({\n\t\t\t\tstrfix: strfix,\n\t\t\t\tvalue: option.urlArgs[k]\n\t\t\t});\n\t\t\tdelete option.urlArgs[k];\n\t\t} else if(xsloader.startsWith(url, \"*]\")) {\n\t\t\t_urlArgs_suffix.push({\n\t\t\t\tstrfix: url.substring(2),\n\t\t\t\tvalue: option.urlArgs[k]\n\t\t\t});\n\t\t\tdelete option.urlArgs[k];\n\t\t}\n\t}\n\n\toption.forPrefixSuffix = function(urlOrName) {\n\t\t//前缀判断\n\t\tfor(let i = 0; i < _urlArgs_prefix.length; i++) {\n\t\t\tlet strfixObj = _urlArgs_prefix[i];\n\t\t\tif(xsloader.startsWith(urlOrName, strfixObj.strfix)) {\n\t\t\t\tlet value;\n\t\t\t\tif(xsloader.isFunction(strfixObj.value)) {\n\t\t\t\t\tvalue = strfixObj.value.call(this, urlOrName);\n\t\t\t\t} else {\n\t\t\t\t\tvalue = strfixObj.value;\n\t\t\t\t}\n\t\t\t\treturn value;\n\t\t\t}\n\t\t}\n\n\t\t//后缀判断\n\t\tfor(let i = 0; i < _urlArgs_suffix.length; i++) {\n\t\t\tlet strfixObj = _urlArgs_suffix[i];\n\t\t\tif(xsloader.endsWith(urlOrName, strfixObj.strfix)) {\n\t\t\t\tlet value;\n\t\t\t\tif(xsloader.isFunction(strfixObj.value)) {\n\t\t\t\t\tvalue = strfixObj.value.call(this, urlOrName);\n\t\t\t\t} else {\n\t\t\t\t\tvalue = strfixObj.value;\n\t\t\t\t}\n\t\t\t\treturn value;\n\t\t\t}\n\t\t}\n\t};\n\n\tfor(let name in option.paths) {\n\t\tutils.replaceModulePrefix(option, option.paths[name]); //前缀替换\n\t}\n\tfor(let name in option.depsPaths) {\n\t\tutils.replaceModulePrefix(option, option.depsPaths[name]); //前缀替换\n\t}\n\n\t//处理依赖\n\tlet dealtDeps = option.dealtDeps;\n\n\tlet pushDeps = (dealtDepArray, depsArray) => {\n\t\tutils.each(depsArray, (dep) => {\n\t\t\tdealtDepArray.push(dep);\n\t\t});\n\t};\n\n\tfor(let keyName in option.deps) {\n\t\tlet paths = keyName.split('::');\n\t\tlet depsArray = option.deps[keyName];\n\t\tutils.each(paths, (path) => {\n\t\t\tif(path == '*') {\n\t\t\t\tfor(let m in option.depsPaths) {\n\t\t\t\t\tlet dealtDepArray = dealtDeps[m] = dealtDeps[m] || [];\n\t\t\t\t\tpushDeps(dealtDepArray, depsArray);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tlet dealtDepArray = (dealtDeps[path] = dealtDeps[path] || []);\n\t\t\t\tpushDeps(dealtDepArray, depsArray);\n\t\t\t}\n\t\t});\n\t}\n\n\ttheConfig = option;\n\ttheContext = _newContext();\n\tscript.onConfigedCallback(); //完成配置回调\n\treturn theConfig;\n});","import utils from \"./util/index.js\";\r\nimport script from \"./core/script.js\";\r\nimport moduleScript from \"./core/module.js\";\r\n\r\nconst global = utils.global;\r\nconst xsloader = global.xsloader;\r\n\r\nconst defineHandle = script.initDefine(function theRealDefine(defines, loaded = () => {}) {\r\n\tutils.each(defines, (defineObject) => {\r\n\t\tif(xsloader.isFunction(defineObject.callback)) {\r\n\t\t\tlet originCallback = defineObject.callback;\r\n\t\t\tdefineObject.callback = function() {\r\n\t\t\t\t//\t\t\t\tif(defineObject.isRequire) {\r\n\t\t\t\t//\t\t\t\t\tconsole.log(\"1======require:\" + defineObject.selfname);\r\n\t\t\t\t//\t\t\t\t\tconsole.log(defineObject);\r\n\t\t\t\t//\t\t\t\t\tconsole.log(originCallback);\r\n\t\t\t\t//\t\t\t\t}\r\n\t\t\t\tlet config = xsloader.config();\r\n\t\t\t\tlet rt;\r\n\r\n\t\t\t\tlet defineFun;\r\n\t\t\t\tutils.each(defineObject.names, (name) => {\r\n\t\t\t\t\tlet fun = config.defineFunction[name];\r\n\t\t\t\t\tif(xsloader.isFunction(fun)) {\r\n\t\t\t\t\t\tdefineFun = fun;\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\tif(defineFun) {\r\n\t\t\t\t\tlet args = [];\r\n\t\t\t\t\tfor(let i = 0; i < arguments.length; i++) {\r\n\t\t\t\t\t\targs.push(arguments[i]);\r\n\t\t\t\t\t}\r\n\t\t\t\t\trt = defineFun.apply(this, [originCallback, this, args]);\r\n\t\t\t\t} else {\r\n\t\t\t\t\trt = originCallback.apply(this, arguments);\r\n\t\t\t\t}\r\n\r\n\t\t\t\toriginCallback = null;\r\n\t\t\t\treturn rt;\r\n\t\t\t};\r\n\t\t}\r\n\t\tonModuleLoaded(defineObject, moduleScript.getLastDefineObject(defineObject.src));\r\n\t\tloaded();\r\n\t});\r\n});\r\n\r\n/**\r\n * 当前模块脚本已经完成加载、但其依赖的模块可能需要加载。\r\n * 当前模块：src、selfname已经确定。\r\n * 若当前模块依赖为0、则可以直接finish；若当前模块存在其他依赖、则设置回调，等待被其他地方依赖时再触发。\r\n * @param {Object} defineObject 当前模块\r\n * @param {Object} lastDefineObject 第一次加载当前模块的模块\r\n */\r\nfunction onModuleLoaded(defineObject, lastDefineObject) {\r\n\t//同一个模块可能分属于不同的module对象，加载者module当前处于loading状态、需要将其依赖追加进来、确保依赖完整\r\n\tmoduleScript.appendLoadingModuleDeps(defineObject);\r\n\t//先根据src获取模块\r\n\tlet ifmodule = moduleScript.getModule(defineObject.src, defineObject.selfname);\r\n\tif(ifmodule) {\r\n\t\tif(ifmodule.state == \"loading\") {\r\n\t\t\tifmodule.reinitByDefineObject(defineObject);\r\n\t\t}\r\n\t} else {\r\n\t\tifmodule = moduleScript.newModule(defineObject);\r\n\t}\r\n\r\n\tif(defineObject.selfname != defineObject.src) {\r\n\t\tdefineObject.pushName(defineObject.selfname);\r\n\t}\r\n\r\n\tif(ifmodule.selfname != defineObject.src) {\r\n\t\t//此处的名字可能由配置指定\r\n\t\tdefineObject.pushName(ifmodule.selfname);\r\n\t}\r\n\t//一个模块的所有名字，包括src\r\n\tutils.each(defineObject.names, (name) => {\r\n\t\tmoduleScript.setModule(name, ifmodule);\r\n\t\tif(xsloader._ignoreAspect_[name]) {\r\n\t\t\tifmodule.ignoreAspect = true;\r\n\t\t}\r\n\t});\r\n\tdefineObject.appendConfigDepsAndEmbedDeps(ifmodule); //添加配置依赖:在配置文件里直接通过src、名称配置的\r\n\r\n\tlet module = ifmodule;\r\n\r\n\tif(defineObject.handle.before) {\r\n\t\tdefineObject.handle.before(module.deps);\r\n\t}\r\n\tif(lastDefineObject && lastDefineObject.handle.depBefore) {\r\n\t\tlastDefineObject.handle.depBefore(lastDefineObject.index, module.selfname, module.deps, 2);\r\n\t}\r\n\r\n\tmodule.setState(\"loaded\");\r\n\tmodule.setInstanceType(defineObject.handle.instance || xsloader.config().instance);\r\n\r\n\tif(module.deps.length == 0) {\r\n\t\ttry {\r\n\t\t\tmodule.finish([]); //递归结束\r\n\t\t} catch(e) {\r\n\t\t\tdefineObject.handle.onError(e);\r\n\t\t}\r\n\t} else {\r\n\t\t//在其他模块依赖此模块时进行加载\r\n\t\tlet needCallback = function() {\r\n\t\t\tmoduleScript.everyRequired(defineObject, module, (depModules) => {\r\n\t\t\t\tlet args = [];\r\n\t\t\t\tlet depModuleArgs = [];\r\n\t\t\t\tutils.each(depModules, (depModule) => {\r\n\t\t\t\t\tdepModuleArgs.push(depModule);\r\n\t\t\t\t\targs.push(depModule && depModule.moduleObject());\r\n\t\t\t\t});\r\n\t\t\t\targs.push(depModuleArgs);\r\n\t\t\t\ttry {\r\n\t\t\t\t\tmodule.finish(args);\r\n\t\t\t\t} catch(e) {\r\n\t\t\t\t\tdefineObject.handle.onError(e);\r\n\t\t\t\t}\r\n\t\t\t}, (err, invoker) => {\r\n\t\t\t\tdefineObject.handle.onError(err, invoker);\r\n\t\t\t});\r\n\t\t};\r\n\r\n\t\tif(defineObject.isRequire) {\r\n\t\t\tneedCallback();\r\n\t\t} else {\r\n\t\t\tmodule.whenNeed(needCallback);\r\n\t\t}\r\n\t}\r\n\r\n}\r\n\r\n//定义模块\r\nconst define = function() {\r\n\treturn defineHandle.predefine.apply(this, arguments);\r\n};\r\n\r\nconst require = function() {\r\n\treturn defineHandle.prerequire.apply(this, arguments);\r\n};\r\n\r\nrequire.has = function() {\r\n\tvar args = arguments;\r\n\tif(args.length == 0) {\r\n\t\treturn false;\r\n\t}\r\n\tfor(var i = 0; i < args.length; i++) {\r\n\t\tvar module = moduleScript.getModule(args[i]);\r\n\t\tif(!module || module.state != \"defined\") {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\treturn true;\r\n};\r\n\r\nxsloader.define = define;\r\nxsloader.defineAsync = define;\r\nxsloader.require = require;\r\nglobal.define = define;\r\nglobal.require = require;\r\n\r\ndefine.amd = true;\r\ndefine(\"exports\", function() {});","import script from \"../script.js\";\nimport utils from \"../../util/index.js\";\nconst global = utils.global;\nconst xsloader = global.xsloader;\n\n//内部依赖加载插件\n\nxsloader.define(script.INNER_DEPS_PLUGIN, {\n\tpluginMain(depId, onload, onerror, config) {\n\t\tlet depsObj = script.innerDepsMap[depId];\n\t\tlet deps = depsObj.deps;\n\t\t//delete innerDepsMap[depId];\n\t\tlet newInvoker = this.invoker().withAbsUrl(depsObj.absUrl);\n\t\tnewInvoker.src = () => depsObj.src;\n\t\tnewInvoker.require(deps, function() {\n\t\t\tlet args = [];\n\t\t\tfor(let k = 0; k < arguments.length; k++) {\n\t\t\t\targs.push(arguments[k]);\n\t\t\t}\n\t\t\tonload(args);\n\t\t}).then({\n\t\t\torderDep: depsObj.orderDep,\n\t\t\terror(err, invoker) {\n\t\t\t\tonerror(new utils.PluginError(err, invoker));\n\t\t\t}\n\t\t});\n\t},\n\tgetCacheKey(depId) {\n\t\treturn depId;\n\t}\n});","import utils from \"../../util/index.js\";\nconst global = utils.global;\nconst xsloader = global.xsloader;\n\nxsloader.define(\"ready\", {\n\tpluginMain(depId, onload, onerror, config) {\n\t\txsloader.onReady(function() {\n\t\t\tonload();\n\t\t});\n\t}\n});","import utils from \"../../util/index.js\";\nconst global = utils.global;\nconst xsloader = global.xsloader;\n\n/**\n * 格式:name!module\n */\nxsloader.define(\"try\", {\n\tisSingle: true,\n\tpluginMain(arg, onload, onerror, config) {\n\t\tlet dep = arg;\n\t\tthis.invoker().withAbsUrl().require([dep], function(mod, depModuleArgs) {\n\t\t\tonload(mod);\n\t\t}).error(function(e) {\n\t\t\tconsole.warn(e);\n\t\t\tonload(null);\n\t\t});\n\t}\n});","import utils from \"../../util/index.js\";\nconst global = utils.global;\nconst xsloader = global.xsloader;\n\nxsloader.define(\"nodeps\", {\n\tisSingle: true,\n\tpluginMain(arg, onload, onerror, config) {\n\t\tthis.invoker().withAbsUrl().require([arg], function(mod, depModuleArgs) {\n\t\t\tonload(mod);\n\t\t}).then({\n\t\t\tdepBefore(index, dep, depDeps) {\n\t\t\t\tdepDeps.splice(0, depDeps.length);\n\t\t\t}\n\t\t}).error(function(e) {\n\t\t\tonerror(e);\n\t\t});\n\t}\n});","import moduleScript from \"../module.js\";\nimport utils from \"../../util/index.js\";\nconst global = utils.global;\nconst xsloader = global.xsloader;\n\nxsloader.define(\"exists\", {\n\tisSingle: true,\n\tpluginMain(arg, onload, onerror, config) {\n\t\tlet vars = arg.split(\"|\");\n\t\tfor(let i = 0; i < vars.length; i++) {\n\t\t\tvars[i] = vars[i].trim();\n\t\t}\n\t\tif(vars.length == 0) {\n\t\t\tonerror(\"args error for exists!\");\n\t\t} else {\n\t\t\tlet moduleName = vars[0];\n\t\t\tlet module = moduleScript.getModule(moduleName);\n\t\t\tif(module) {\n\t\t\t\tthis.invoker().withAbsUrl().require([moduleName], function(mod, depModuleArgs) {\n\t\t\t\t\tonload(mod);\n\t\t\t\t}).error(function(e) {\n\t\t\t\t\tonerror(e);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tlet obj = undefined;\n\t\t\t\tfor(let i = 1; i < vars.length; i++) {\n\t\t\t\t\tif(window[vars[i]]) {\n\t\t\t\t\t\tobj = window[vars[i]];\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif(obj === undefined) {\n\t\t\t\t\tonerror(\"not found:\" + arg);\n\t\t\t\t} else {\n\t\t\t\t\tonload(obj);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n});","import moduleScript from \"../module.js\";\nimport utils from \"../../util/index.js\";\nconst global = utils.global;\nconst xsloader = global.xsloader;\n\n/**\n * 格式:name!moduleName=>>modulePath\n */\n\nxsloader.define(\"name\", {\n\tisSingle: true,\n\tpluginMain(arg, onload, onerror, config) {\n\t\tlet index = arg.indexOf(\"=>>\");\n\t\tif(index == -1) {\n\t\t\tonerror(\"expected:=>>\");\n\t\t\treturn;\n\t\t}\n\t\tlet moduleName = arg.substring(0, index);\n\t\tmoduleName = moduleName.replace(/，/g, ',');\n\t\tlet names = moduleName.split(\",\");\n\t\tlet dep = arg.substring(index + 3);\n\t\tthis.invoker().withAbsUrl().require([dep], function(mod, depModuleArgs) {\n\t\t\tlet existsMods = [];\n\t\t\tfor(let i = 0; i < names.length; i++) {\n\t\t\t\tlet newName = names[i];\n\t\t\t\tlet lastM = moduleScript.getModule(newName);\n\t\t\t\tif(lastM && lastM.state != \"init\") {\n\t\t\t\t\texistsMods.push(newName);\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tlet module = depModuleArgs[0].module;\n\t\t\t\tif(lastM) {\n\t\t\t\t\tlastM.toOtherModule(module);\n\t\t\t\t} else {\n\t\t\t\t\tmoduleScript.setModule(newName, module);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif(existsMods.length) {\n\t\t\t\tconsole.warn(\"already exists:\", existsMods.join(','));\n\t\t\t}\n\t\t\tonload(mod);\n\t\t}).error(function(e) {\n\t\t\tonerror(e);\n\t\t});\n\t}\n});","import utils from \"../../util/index.js\";\r\nconst global = utils.global;\r\nconst xsloader = global.xsloader;\r\n\r\n/*\r\n * Require-CSS RequireJS css! loader plugin\r\n * 0.1.8\r\n * Guy Bedford 2014\r\n * MIT\r\n */\r\nxsloader.define(\"css\", function() {\r\n\tif(typeof window == 'undefined')\r\n\t\treturn {\r\n\t\t\tload: function(n, r, load) {\r\n\t\t\t\tload();\r\n\t\t\t}\r\n\t\t};\r\n\tlet engine = window.navigator.userAgent.match(/Trident\\/([^ ;]*)|AppleWebKit\\/([^ ;]*)|Opera\\/([^ ;]*)|rv\\:([^ ;]*)(.*?)Gecko\\/([^ ;]*)|MSIE\\s([^ ;]*)|AndroidWebKit\\/([^ ;]*)/) || 0;\r\n\tlet useImportLoad = false;\r\n\tlet useOnload = true;\r\n\tif(engine[1] || engine[7])\r\n\t\tuseImportLoad = parseInt(engine[1]) < 6 || parseInt(engine[7]) <= 9;\r\n\telse if(engine[2] || engine[8] || 'WebkitAppearance' in document.documentElement.style)\r\n\t\tuseOnload = false;\r\n\telse if(engine[4])\r\n\t\tuseImportLoad = parseInt(engine[4]) < 18;\r\n\tlet cssAPI = {};\r\n\tlet curStyle, curSheet;\r\n\tlet createStyle = function() {\r\n\t\tcurStyle = document.createElement('style');\r\n\t\txsloader.appendHeadDom(curStyle);\r\n\t\tcurSheet = curStyle.styleSheet || curStyle.sheet;\r\n\t};\r\n\tlet ieCnt = 0;\r\n\tlet ieLoads = [];\r\n\tlet ieCurCallback;\r\n\tlet createIeLoad = function(url) {\r\n\t\tcurSheet.addImport(url);\r\n\t\tcurStyle.onload = function() {\r\n\t\t\tprocessIeLoad();\r\n\t\t};\r\n\r\n\t\tieCnt++;\r\n\t\tif(ieCnt == 31) {\r\n\t\t\tcreateStyle();\r\n\t\t\tieCnt = 0;\r\n\t\t}\r\n\t};\r\n\tlet processIeLoad = function() {\r\n\t\tieCurCallback();\r\n\t\tlet nextLoad = ieLoads.shift();\r\n\t\tif(!nextLoad) {\r\n\t\t\tieCurCallback = null;\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tieCurCallback = nextLoad[1];\r\n\t\tcreateIeLoad(nextLoad[0]);\r\n\t};\r\n\tlet importLoad = function(url, callback) {\r\n\t\tcallback = callback || function() {};\r\n\t\tif(!curSheet || !curSheet.addImport)\r\n\t\t\tcreateStyle();\r\n\r\n\t\tif(curSheet && curSheet.addImport) {\r\n\t\t\tif(ieCurCallback) {\r\n\t\t\t\tieLoads.push([url, callback]);\r\n\t\t\t} else {\r\n\t\t\t\tcreateIeLoad(url);\r\n\t\t\t\tieCurCallback = callback;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tcurStyle.textContent = '@import \"' + url + '\";';\r\n\t\t\tlet loadInterval = setInterval(function() {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tcurStyle.sheet.cssRules;\r\n\t\t\t\t\tclearInterval(loadInterval);\r\n\t\t\t\t\tcallback();\r\n\t\t\t\t} catch(e) {\r\n\t\t\t\t\tconsole.warn(e);\r\n\t\t\t\t}\r\n\t\t\t}, 10);\r\n\t\t}\r\n\t};\r\n\tlet linkLoad = function(url, callback) {\r\n\t\tcallback = callback || function() {};\r\n\t\tlet link = document.createElement('link');\r\n\t\tlink.type = 'text/css';\r\n\t\tlink.rel = 'stylesheet';\r\n\t\tif(useOnload)\r\n\t\t\tlink.onload = function() {\r\n\t\t\t\tlink.onload = function() {};\r\n\t\t\t\tsetTimeout(callback, 7);\r\n\t\t\t};\r\n\t\telse {\r\n\t\t\tlet loadInterval = setInterval(function() {\r\n\t\t\t\tfor(let i = 0; i < document.styleSheets.length; i++) {\r\n\t\t\t\t\tlet sheet = document.styleSheets[i];\r\n\t\t\t\t\tif(sheet.href == link.href) {\r\n\t\t\t\t\t\tclearInterval(loadInterval);\r\n\t\t\t\t\t\treturn callback();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}, 10);\r\n\t\t}\r\n\t\tlink.href = url;\r\n\t\txsloader.appendHeadDom(link);\r\n\t};\r\n\tcssAPI.pluginMain = function(cssId, onload, onerror, config) {\r\n\t\t//\t\t\tif(cssId.indexOf(\".css\") != cssId.length - 4) {\r\n\t\t//\t\t\t\tcssId += \".css\";\r\n\t\t//\t\t\t}\r\n//\t\tconsole.log(\"cssId=\"+cssId+\",cssSrc=\"+this.invoker().getUrl(cssId, true)+\",absUrl=\"+this.invoker().absUrl());\r\n\t\t(useImportLoad ? importLoad : linkLoad)(this.invoker().getUrl(cssId, true), onload);\r\n\t};\r\n\tcssAPI.getCacheKey = function(cssId) {\r\n\t\t//\t\t\tif(cssId.indexOf(\".css\") != cssId.length - 4) {\r\n\t\t//\t\t\t\tcssId += \".css\";\r\n\t\t//\t\t\t}\r\n\t\tlet invoker = this.invoker();\r\n\t\treturn invoker ? invoker.getUrl(cssId, true) : cssId;\r\n\t};\r\n\tcssAPI.loadCss = function(cssPath, callback) {\r\n\t\t(useImportLoad ? importLoad : linkLoad)(xsloader.getUrl(cssPath), callback);\r\n\t};\r\n\r\n\tcssAPI.loadCsses = function() {\r\n\t\tlet args = arguments;\r\n\t\tfor(let i = 0; i < args.length; i++) {\r\n\t\t\t(useImportLoad ? importLoad : linkLoad)(xsloader.getUrl(args[i]), null);\r\n\t\t}\r\n\t};\r\n\treturn cssAPI;\r\n});","import utils from \"../../util/index.js\";\nconst global = utils.global;\nconst xsloader = global.xsloader;\n\nxsloader.define(\"text\", [\"xshttp\"], {\n\tisSingle: true,\n\tpluginMain(name, onload, onerror, config, http) {\n\t\tlet url = this.invoker().getUrl(name, true);\n\t\thttp().url(url)\n\t\t\t.handleAs(\"text\")\n\t\t\t.ok(function(text) {\n\t\t\t\tonload(text);\n\t\t\t})\n\t\t\t.fail(function(err) {\n\t\t\t\tonerror(err);\n\t\t\t})\n\t\t\t.done();\n\t}\n});","import utils from \"../../util/index.js\";\nconst global = utils.global;\nconst xsloader = global.xsloader;\n/**\n * 格式：window!varNameInWindow=>>modulePath\n */\n//window插件,用于添加模块到window对象中\nxsloader.define(\"window\", {\n\tisSingle: true,\n\tpluginMain: function(arg, onload, onerror, config, http) {\n\t\tlet index = arg.indexOf(\"=>>\");\n\t\tif(index == -1) {\n\t\t\tonerror(\"expected:=>>\");\n\t\t\treturn;\n\t\t}\n\t\tlet moduleName = arg.substring(0, index);\n\t\tlet dep = arg.substring(index + 3);\n\t\tthis.invoker().withAbsUrl().require([dep], function(mod, depModuleArgs) {\n\t\t\twindow[moduleName] = mod;\n\t\t\tonload(mod);\n\t\t});\n\t}\n});","import utils from \"../../util/index.js\";\nconst global = utils.global;\nconst xsloader = global.xsloader;\n/**\n * 格式:withdeps!modulePath=>>[deps]\n */\nxsloader.define(\"withdeps\", {\n\tpluginMain(arg, onload, onerror, config) {\n\t\tlet index = arg.indexOf(\"=>>\");\n\t\tif(index == -1) {\n\t\t\tonerror(\"expected:=>>\");\n\t\t\treturn;\n\t\t}\n\t\tlet moduleName = arg.substring(0, index);\n\t\tlet depsStr = arg.substring(index + 3);\n\t\tlet deps;\n\t\ttry {\n\t\t\tdeps = xsloader.xsParseJson(depsStr);\n\t\t\tif(!xsloader.isArray(deps)) {\n\t\t\t\tonerror(\"deps is not Array:\" + depsStr);\n\t\t\t\treturn;\n\t\t\t}\n\t\t} catch(e) {\n\t\t\tonerror(\"deps error:\" + depsStr);\n\t\t\treturn;\n\t\t}\n\t\tthis.invoker().withAbsUrl().require([\n\t\t\t[false].concat(deps), moduleName\n\t\t], function(_deps, mod, depModuleArgs) {\n\t\t\tonload(mod);\n\t\t}).then({\n\t\t\torderDep: true\n\t\t});\n\t}\n});","import utils from \"../../util/index.js\";\nconst global = utils.global;\nconst xsloader = global.xsloader;\n\n/**\n * 加载json对象\n */\nxsloader.define(\"json\", [\"xshttp\"], {\n\tisSingle: true,\n\tpluginMain(name, onload, onerror, config, http) {\n\t\tlet url = this.invoker().getUrl(name, true);\n\t\thttp().url(url)\n\t\t\t.handleAs(\"json\")\n\t\t\t.ok(function(json) {\n\t\t\t\tonload(json);\n\t\t\t})\n\t\t\t.fail(function(err) {\n\t\t\t\tonerror(err);\n\t\t\t})\n\t\t\t.done();\n\t}\n});","import utils from \"../../util/index.js\";\nconst global = utils.global;\nconst xsloader = global.xsloader;\n\nlet progIds = ['Msxml2.XMLHTTP', 'Microsoft.XMLHTTP', 'Msxml2.XMLHTTP.4.0'];\n/**\n * option._beforeOpenHook\n * option._onOkResponseHook\n * option._onFailResponseHook\n * \n * @param {Object} option\n */\nfunction httpRequest(option) {\n\tif(!option) {\n\t\toption = {};\n\t}\n\n\tfunction prop(obj, varName, defaultVal) {\n\t\tif(obj[varName] === undefined) {\n\t\t\treturn defaultVal;\n\t\t} else {\n\t\t\treturn obj[varName];\n\t\t}\n\t}\n\n\tfunction putProp(obj, varName, toObj) {\n\t\tif(obj[varName]) {\n\t\t\tfor(let x in obj[varName]) {\n\t\t\t\tlet value = obj[varName][x];\n\t\t\t\tif(value === null || value === undefined) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\ttoObj[x] = value;\n\t\t\t}\n\t\t}\n\t}\n\tlet _url = prop(option, \"url\", \"\"),\n\t\t_method = prop(option, \"method\", \"GET\"),\n\t\t_params = {},\n\t\t_headers = {\n\t\t\t\"X-Requested-With\": \"XMLHttpRequest\"\n\t\t},\n\t\t_async = prop(option, \"async\", true),\n\t\t_multiPart = prop(option, \"multiPart\", false),\n\t\t_handleType = prop(option, \"handleType\", \"json\");\n\tlet _timeout = option.timeout;\n\tputProp(option, \"params\", _params);\n\tputProp(option, \"headers\", _headers);\n\n\tlet okCallback = option.ok;\n\tlet failCallback = option.fail;\n\tlet uploadStartCallback = option.uploadStart;\n\tlet uploadProgressCallback = option.uploadProgress;\n\tlet uploadOkCallback = option.uploadOk;\n\tlet uploadErrorCallback = option.uploadError;\n\tlet uploadEndCallback = option.uploadEnd;\n\n\tlet _beforeOpenHook = option._beforeOpenHook || httpRequest._beforeOpenHook;\n\tlet _onOkResponseHook = option._onOkResponseHook || httpRequest._onOkResponseHook;\n\tlet _onFailResponseHook = option._onFailResponseHook || httpRequest._onFailResponseHook;\n\n\tfunction createXhr() {\n\t\tlet xhr, i, progId;\n\t\tif(typeof XMLHttpRequest !== \"undefined\") {\n\t\t\treturn new XMLHttpRequest();\n\t\t} else if(typeof ActiveXObject !== \"undefined\") {\n\t\t\tfor(i = 0; i < 3; i += 1) {\n\t\t\t\tprogId = progIds[i];\n\t\t\t\ttry {\n\t\t\t\t\txhr = new ActiveXObject(progId);\n\t\t\t\t} catch(e) {\n\t\t\t\t\tconsole.warn(e);\n\t\t\t\t}\n\n\t\t\t\tif(xhr) {\n\t\t\t\t\tprogIds = [progId];\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn xhr;\n\t}\n\n\tfunction conn() {\n\t\t_conn(createXhr());\n\t}\n\n\tfunction _conn(xhr) {\n\t\tlet option = {\n\t\t\turl: _url,\n\t\t\tmethod: _method.toUpperCase(),\n\t\t\tparams: _params,\n\t\t\theaders: _headers,\n\t\t\thandleType: _handleType,\n\t\t\tasync: _async,\n\t\t\tmultiPart: _multiPart,\n\t\t\ttimeout: _timeout\n\t\t};\n\t\t_beforeOpenHook(option, function() {\n\t\t\t_connAfterOpenHook(option, xhr);\n\t\t}, xhr);\n\t}\n\n\tfunction _doOnFailResponseHook(option, xhr, err, extraErr) {\n\t\t_onFailResponseHook(option, function(result) {\n\t\t\tif(result !== false && result !== undefined) {\n\t\t\t\tif(typeof okCallback == \"function\") {\n\t\t\t\t\tokCallback(result, xhr);\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t} else if(typeof failCallback == \"function\") {\n\t\t\t\tfailCallback(err);\n\t\t\t} else {\n\t\t\t\tconsole.error(err);\n\t\t\t}\n\t\t}, xhr, extraErr);\n\t}\n\n\tfunction _connAfterOpenHook(option, xhr) {\n\t\tlet body;\n\t\tif(option.multiPart) {\n\t\t\tlet formData = new FormData();\n\t\t\tfor(let x in option.params) {\n\t\t\t\tlet value = option.params[x];\n\t\t\t\tif(xsloader.isArray(value)) {\n\t\t\t\t\tformData.append(x, xsloader.xsJson2String(value));\n\t\t\t\t} else {\n\t\t\t\t\tformData.append(x, value);\n\t\t\t\t}\n\n\t\t\t}\n\t\t\tbody = formData;\n\t\t} else {\n\t\t\tbody = \"\";\n\t\t\tfor(let x in option.params) {\n\t\t\t\tlet value = option.params[x];\n\t\t\t\tif(value === null || value === undefined) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tif(typeof value == \"object\") {\n\t\t\t\t\tvalue = xsloader.xsJson2String(value);\n\t\t\t\t}\n\t\t\t\tbody += \"&\" + encodeURIComponent(x) + \"=\" + encodeURIComponent(value);\n\t\t\t}\n\t\t\tif(!(option.method == \"POST\" || option.method == \"PUT\")) {\n\t\t\t\tif(option.url.lastIndexOf(\"?\") < 0 && body.length > 0) {\n\t\t\t\t\toption.url += \"?\";\n\t\t\t\t}\n\t\t\t\toption.url += body;\n\t\t\t\toption.url = option.url.replace(\"?&\", \"?\");\n\t\t\t\tbody = null;\n\t\t\t}\n\t\t}\n\n\t\txhr.open(option.method, option.url, option.async);\n\t\tif((option.method == \"POST\" || option.method == \"PUT\") && !option.multiPart && !option.headers.hasOwnProperty(\"Content-Type\")) {\n\n\t\t\txhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded;charset=utf-8');\n\t\t}\n\t\tfor(let header in option.headers) {\n\t\t\txhr.setRequestHeader(header, option.headers[header]);\n\t\t}\n\n\t\tif(typeof uploadStartCallback == \"function\") {\n\t\t\txhr.upload.onloadstart = uploadStartCallback;\n\t\t}\n\n\t\tif(typeof uploadProgressCallback == \"function\") {\n\t\t\txhr.upload.onprogress = uploadProgressCallback;\n\t\t}\n\n\t\tif(typeof uploadOkCallback == \"function\") {\n\t\t\txhr.upload.onload = uploadOkCallback;\n\t\t}\n\n\t\tif(typeof uploadErrorCallback == \"function\") {\n\t\t\txhr.upload.onerror = uploadErrorCallback;\n\t\t}\n\n\t\tif(typeof uploadEndCallback == \"function\") {\n\t\t\txhr.upload.onloadend = uploadEndCallback;\n\t\t}\n\n\t\tlet timeoutTimer;\n\t\tlet isTimeout = false;\n\t\tif(option.timeout) {\n\t\t\ttimeoutTimer = setTimeout(function() {\n\t\t\t\tisTimeout = true;\n\t\t\t\txhr.abort();\n\t\t\t\tclearTimeout(timeoutTimer);\n\t\t\t}, option.timeout);\n\t\t}\n\n\t\txhr.onreadystatechange = function(evt) {\n\t\t\tlet status, err;\n\t\t\tif(xhr.readyState === 4) {\n\t\t\t\tstatus = xhr.status || 0;\n\t\t\t\tif(status > 399 && status < 600 || !status) {\n\t\t\t\t\tlet err = new Error(option.url + ' HTTP status: ' + status);\n\t\t\t\t\terr.xhr = xhr;\n\t\t\t\t\t_doOnFailResponseHook(option, xhr, err);\n\t\t\t\t} else {\n\t\t\t\t\tlet result;\n\t\t\t\t\tif(option.handleType === \"json\") {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tresult = xsloader.xsParseJson(xhr.responseText);\n\t\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\t\t_doOnFailResponseHook(option, xhr, new Error(\"parse-json-error:\" + e), \"parse-json-error\");\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if(option.handleType === \"text\") {\n\t\t\t\t\t\tresult = xhr.responseText;\n\t\t\t\t\t}\n\t\t\t\t\t_onOkResponseHook(result, option, function(result) {\n\t\t\t\t\t\tif(typeof okCallback == \"function\") {\n\t\t\t\t\t\t\tokCallback(result, xhr);\n\t\t\t\t\t\t}\n\t\t\t\t\t}, xhr);\n\t\t\t\t}\n\n\t\t\t} else {\n\t\t\t\tif(timeoutTimer && isTimeout) {\n\t\t\t\t\tlet err = new Error(option.url + ' timeout status: ' + status);\n\t\t\t\t\terr.xhr = xhr;\n\t\t\t\t\t_doOnFailResponseHook(option, xhr, err);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\txhr.send(body);\n\t}\n\n\tlet requestObj = {\n\t\tmultiPart(multiPart) {\n\t\t\t_multiPart = multiPart;\n\t\t\treturn this;\n\t\t},\n\t\tuploadStart(uploadStart) {\n\t\t\tuploadStartCallback = uploadStart;\n\t\t\treturn this;\n\t\t},\n\t\tuploadProgress(uploadProgress) {\n\t\t\tuploadProgressCallback = uploadProgress;\n\t\t\treturn this;\n\t\t},\n\t\tuploadOk(callback) {\n\t\t\tuploadOkCallback = callback;\n\t\t\treturn this;\n\t\t},\n\t\tuploadError(callback) {\n\t\t\tuploadErrorCallback = callback;\n\t\t\treturn this;\n\t\t},\n\t\tuploadEnd(uploadEnd) {\n\t\t\tuploadEndCallback = uploadEnd;\n\t\t\treturn this;\n\t\t},\n\t\turl(urlStr) {\n\t\t\t_url = urlStr;\n\t\t\treturn this;\n\t\t},\n\t\tmethod(methodStr) {\n\t\t\t_method = methodStr;\n\t\t\treturn this;\n\t\t},\n\t\ttimeout(timeout) {\n\t\t\t_timeout = timeout;\n\t\t\treturn this;\n\t\t},\n\t\tasync(isAsync) {\n\t\t\t_async = isAsync;\n\t\t\treturn this;\n\t\t},\n\t\tparams(paramsObj) {\n\t\t\tif(paramsObj) {\n\t\t\t\tfor(let x in paramsObj) {\n\t\t\t\t\tlet value = paramsObj[x];\n\t\t\t\t\tif(value === null || value === undefined) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\t_params[x] = value;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn this;\n\t\t},\n\t\theaders(headersObj) {\n\t\t\tif(headersObj) {\n\t\t\t\tfor(let x in headersObj) {\n\t\t\t\t\t_headers[x] = headersObj[x];\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn this;\n\t\t},\n\t\thandleType(_handleType) {\n\t\t\treturn this.handleAs(_handleType);\n\t\t},\n\t\thandleAs(handleType) {\n\t\t\tif(handleType !== \"json\" && handleType !== \"text\") {\n\t\t\t\tthrow \"unknown handleType:\" + handleType;\n\t\t\t}\n\t\t\t_handleType = handleType;\n\t\t\treturn this;\n\t\t},\n\t\tok(callback) {\n\t\t\tokCallback = callback;\n\t\t\treturn this;\n\t\t},\n\t\tfail(callback) {\n\t\t\tfailCallback = callback;\n\t\t\treturn this;\n\t\t},\n\t\t_beforeOpenHook(callback) {\n\t\t\t_beforeOpenHook = callback;\n\t\t\treturn this;\n\t\t},\n\t\t_onOkResponseHook(callback) {\n\t\t\t_onOkResponseHook = callback;\n\t\t\treturn this;\n\t\t},\n\t\t_onFailResponseHook(callback) {\n\t\t\t_onFailResponseHook = callback;\n\t\t\treturn this;\n\t\t},\n\t\tdone() {\n\t\t\ttry {\n\t\t\t\tconn();\n\t\t\t} catch(e) {\n\t\t\t\tif(typeof failCallback == \"function\") {\n\t\t\t\t\tfailCallback(e);\n\t\t\t\t} else {\n\t\t\t\t\tconsole.error(e);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\treturn requestObj;\n}\n/**\n */\nhttpRequest._beforeOpenHook = function(option, callback, xhr) {\n\tcallback();\n};\n\n/**\n * function(result,option,xhr,callback),callback(result)的result为最终的结果\n */\nhttpRequest._onOkResponseHook = function(result, option, callback, xhr) {\n\tcallback(result);\n};\n/**\n * function(option,xhr,callback,extraErrorType),callback(result)的result为false则不会处理后面的,如果为非undefined则作为成功的结果。\n * extraErrorType==\"parse-json-error\"表示转换成json时出错\n */\nhttpRequest._onFailResponseHook = function(option, callback, xhr, extraErrorType) {\n\tcallback(undefined);\n};\n\nwindow._xshttp_request_ = httpRequest;\n\nxsloader.define(\"xshttp\", [], function() {\n\treturn httpRequest;\n});","import utils from \"../../util/index.js\";\nconst global = utils.global;\nconst xsloader = global.xsloader;\n\nxsloader.define(\"xsrequest\", [\"xshttp\"], function(http) {\n\t/**\n\t * 参数列表:\n\t * callback:function(rs)\n\t * async:始终为true\n\t * 其他参数同xshttp\n\t * 不断返回then(function()).then,当返回false时取消调用后面的回调。\n\t * @param {Object} option\n\t */\n\tlet xsRequest = function(option) {\n\t\toption = xsloader.extend({\n\t\t\tparams: undefined,\n\t\t\theaders: undefined,\n\t\t\tmethod: undefined,\n\t\t\turl: undefined,\n\t\t\tcallback: undefined\n\t\t}, option);\n\t\tlet isResponsed = false;\n\t\tlet callbacksQueue = [function(rs) {\n\t\t\treturn rs;\n\t\t}];\n\t\tif(option.callback) {\n\t\t\tcallbacksQueue.push(option.callback);\n\t\t}\n\t\tcallbacksQueue.callback = function(rs) {\n\t\t\tisResponsed = true;\n\t\t\tfor(let i = 0; i < this.length; i++) {\n\t\t\t\tlet callback = this[i];\n\t\t\t\trs = callback(rs);\n\t\t\t\tif(rs === false) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\toption.ok = function(rs) {\n\t\t\tcallbacksQueue.callback(rs);\n\t\t};\n\t\toption.fail = function(err) {\n\t\t\tcallbacksQueue.callback({\n\t\t\t\tcode: -1,\n\t\t\t\tdesc: err\n\t\t\t});\n\t\t};\n\t\toption.async = true;\n\n\t\tfunction newHandle() {\n\t\t\tlet handle = {\n\t\t\t\tthen: function(callback) {\n\t\t\t\t\tif(isResponsed) {\n\t\t\t\t\t\tthrow new Error(\"already responsed!\");\n\t\t\t\t\t}\n\t\t\t\t\tcallbacksQueue.push(callback);\n\t\t\t\t\treturn newHandle();\n\t\t\t\t}\n\t\t\t};\n\t\t\treturn handle;\n\t\t}\n\t\thttp(option).done();\n\t\treturn newHandle();\n\t};\n\n\treturn xsRequest;\n});","import utils from \"../../util/index.js\";\nconst global = utils.global;\nconst xsloader = global.xsloader;\n\ntry {\n\tlet isXsMsgDebug = false;\n\tlet api = {};\n\n\tfunction isDebug(type) {\n\t\treturn isXsMsgDebug;\n\t}\n\n\tapi.linkedList = function() {\n\t\treturn new LinkedList();\n\t};\n\n\tfunction LinkedList() {\n\t\tfunction newNode(element) {\n\t\t\tlet node = {\n\t\t\t\telement: element,\n\t\t\t\tnext: null,\n\t\t\t\tpre: null\n\t\t\t};\n\t\t\treturn node;\n\t\t}\n\t\tlet length = 0;\n\t\tlet headNode = newNode(),\n\t\t\tlastNode = headNode;\n\n\t\t/**\n\t\t * 在链表末尾添加元素\n\t\t */\n\t\tthis.append = function(element) {\n\t\t\tlet current = newNode(element);\n\n\t\t\tlastNode.next = current;\n\t\t\tcurrent.pre = lastNode;\n\t\t\tlastNode = current;\n\t\t\tlength++;\n\t\t};\n\n\t\t//在链表的任意位置插入元素\n\t\tthis.insert = function(position, element) {\n\t\t\tif(position >= 0 && position <= length) {\n\n\t\t\t\tlet node = newNode(element);\n\t\t\t\tlet pNode = headNode;\n\t\t\t\twhile(position--) {\n\t\t\t\t\tpNode = pNode.next;\n\t\t\t\t}\n\n\t\t\t\tif(pNode.next) {\n\t\t\t\t\tpNode.next.pre = node;\n\t\t\t\t\tnode.next = pNode.next;\n\t\t\t\t}\n\t\t\t\tpNode.next = node;\n\t\t\t\tnode.pre = pNode;\n\t\t\t\tlength++;\n\t\t\t\treturn true;\n\t\t\t} else {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t};\n\n\t\tthis.elementAt = function(position) {\n\t\t\treturn getElement(position);\n\t\t};\n\n\t\tfunction getElement(position, willRemove) {\n\t\t\tif(position >= 0 && position < length) {\n\n\t\t\t\tlet pNode = headNode;\n\t\t\t\twhile(position--) {\n\t\t\t\t\tpNode = pNode.next;\n\t\t\t\t}\n\n\t\t\t\tif(pNode.next) {\n\t\t\t\t\tlet currentNode = pNode.next;\n\t\t\t\t\tif(willRemove) {\n\t\t\t\t\t\tlet nextCurrentNode = currentNode.next;\n\t\t\t\t\t\tif(nextCurrentNode) {\n\t\t\t\t\t\t\tnextCurrentNode.pre = pNode;\n\t\t\t\t\t\t\tpNode.next = nextCurrentNode;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tpNode.next = null;\n\t\t\t\t\t\t\tlastNode = pNode;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tlength--;\n\t\t\t\t\t}\n\t\t\t\t\treturn currentNode.element;\n\t\t\t\t} else {\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * @param callback function 返回true表示移除\n\t\t */\n\t\tthis.eachForRemove = function(callback) {\n\t\t\tlet pNode = headNode.next;\n\t\t\twhile(pNode) {\n\t\t\t\tlet currentNode = pNode;\n\t\t\t\tif(callback(currentNode)) {\n\t\t\t\t\tlet nextCurrentNode = currentNode.next;\n\t\t\t\t\tif(nextCurrentNode) {\n\t\t\t\t\t\tnextCurrentNode.pre = pNode;\n\t\t\t\t\t\tpNode.next = nextCurrentNode;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tpNode.next = null;\n\t\t\t\t\t\tlastNode = pNode;\n\t\t\t\t\t}\n\t\t\t\t\tlength--;\n\t\t\t\t\tpNode = nextCurrentNode;\n\t\t\t\t} else {\n\t\t\t\t\tpNode = pNode.next;\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\t//从链表中移除元素\n\t\tthis.removeAt = function(position) {\n\t\t\treturn getElement(position, true);\n\t\t};\n\n\t\t/**\n\t\t * 移除并获取第一个元素\n\t\t * @param callback function(elem,index)\n\t\t */\n\t\tthis.pop = function(callback) {\n\t\t\treturn this.removeAt(0);\n\t\t};\n\n\t\t/**\n\t\t * 返回元素在链表中的位置\n\t\t * @param element object|function(elem)\n\t\t */\n\t\tthis.indexOf = function(element) {\n\t\t\tlet pNode = headNode.next;\n\t\t\tlet index = 0;\n\t\t\twhile(pNode) {\n\t\t\t\tif(typeof element == \"function\") {\n\t\t\t\t\tif(element(pNode.element)) {\n\t\t\t\t\t\treturn index;\n\t\t\t\t\t}\n\t\t\t\t} else if(pNode.element === element) {\n\t\t\t\t\treturn index;\n\t\t\t\t}\n\t\t\t\tindex++;\n\t\t\t\tpNode = pNode.next;\n\t\t\t}\n\t\t\treturn -1;\n\t\t};\n\n\t\tthis.find = function(element) {\n\t\t\tlet index = this.indexOf(element);\n\t\t\treturn index >= 0 ? this.elementAt(index) : undefined;\n\t\t};\n\n\t\t//移除某个元素\n\t\tthis.remove = function(element) {\n\t\t\tlet index = this.indexOf(element);\n\t\t\treturn this.removeAt(index);\n\t\t};\n\n\t\t//判断链表是否为空\n\n\t\tthis.isEmpty = function() {\n\t\t\treturn length === 0;\n\t\t};\n\n\t\t//返回链表的长度\n\t\tthis.size = function() {\n\t\t\treturn length;\n\t\t};\n\n\t}\n\n\tif(window.addEventListener) {\n\t\tlet postMessageBridge = (function() {\n\t\t\tlet handle = {};\n\n\t\t\tlet instanceMap = {}; //id:listener\n\t\t\tlet cmd2ListenerMap = {}; //cmd:[]\n\t\t\tlet instanceBindMap = {}; //instanceid:true\n\t\t\tlet oinstanceidMap = {}; //已经被绑定的oinstanceid:instanceid\n\n\t\t\t//isActive为false表示监听者\n\t\t\thandle.listen = function(cmd, conndata, connectingSource, source, isActive, _onConned, _onMsg, _onResponse, _onElse) {\n\n\t\t\t\tlet listener = {\n\t\t\t\t\tcmd: cmd,\n\t\t\t\t\t_onConned: _onConned,\n\t\t\t\t\t_onMsg: _onMsg,\n\t\t\t\t\t_onResponse: _onResponse,\n\t\t\t\t\t_onElse: _onElse,\n\t\t\t\t\tconndata: conndata,\n\t\t\t\t\tosource: source,\n\t\t\t\t\tactive: isActive,\n\t\t\t\t\tconnectingSource: connectingSource,\n\t\t\t\t\tid: xsloader.randId(),\n\t\t\t\t\trefused: {}\n\t\t\t\t};\n\n\t\t\t\tif(!cmd2ListenerMap[cmd]) {\n\t\t\t\t\tcmd2ListenerMap[cmd] = [];\n\t\t\t\t}\n\t\t\t\tcmd2ListenerMap[cmd].push(listener);\n\n\t\t\t\tlet instanceid = listener.id;\n\t\t\t\tinstanceMap[instanceid] = listener;\n\t\t\t\treturn instanceid;\n\t\t\t};\n\n\t\t\thandle.remove = function(instanceid) {\n\t\t\t\t//TODO !!!!!!!\n\t\t\t\t/*let listener = listeners[id];\n\t\t\t\tdelete listeners[id];\n\t\t\t\tif(listener.active) {\n\t\t\t\t\tfor(let x in activeListenerMyIds) {\n\t\t\t\t\t\tlet as = activeListenerMyIds[x];\n\t\t\t\t\t\tlet found = false;\n\t\t\t\t\t\tfor(let k = 0; k < as.length; k++) {\n\t\t\t\t\t\t\tif(as[k] == id) {\n\t\t\t\t\t\t\t\tas.splice(k, 1);\n\t\t\t\t\t\t\t\tfound = true;\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif(found) {\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}*/\n\t\t\t};\n\n\t\t\thandle.send = function(data, instanceid, msgid) {\n\t\t\t\tlet listener = instanceMap[instanceid];\n\t\t\t\t_sendData(\"msg\", listener.cmd, listener.osource, data, instanceid, msgid);\n\t\t\t};\n\n\t\t\thandle.sendConn = function(instanceid) {\n\t\t\t\tlet listener = instanceMap[instanceid];\n\t\t\t\t_sendData(\"conn\", listener.cmd, listener.osource, listener.conndata, instanceid);\n\t\t\t};\n\n\t\t\thandle.sendResponse = function(data, instanceid) {\n\t\t\t\tlet listener = instanceMap[instanceid];\n\t\t\t\t_sendData(\"response\", listener.cmd, listener.osource, data, instanceid);\n\t\t\t};\n\n\t\t\tfunction handleConn(cmd, fromSource, originStr, data, oinstanceid) {\n\t\t\t\tif(oinstanceidMap[oinstanceid]) {\n\t\t\t\t\t//console.warn(\"already bind:\" + cmd);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tlet listeners = cmd2ListenerMap[cmd];\n\t\t\t\tif(!listeners) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tfunction Callback(instanceid) {\n\n\t\t\t\t\treturn function(isAccept, msg) {\n\t\t\t\t\t\tif(!isAccept) {\n\t\t\t\t\t\t\tlet listener = instanceMap[instanceid];\n\t\t\t\t\t\t\tlistener.refused[oinstanceid] = true;\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif(oinstanceidMap[oinstanceid]) {\n\t\t\t\t\t\t\tconsole.warn(\"already bind other:\" + cmd + \",my page:\" + location.href);\n\t\t\t\t\t\t} else if(instanceBindMap[instanceid]) {\n\t\t\t\t\t\t\tconsole.warn(\"already self bind:\" + cmd + \",my page:\" + location.href);\n\t\t\t\t\t\t\t_sendData(\"binded\", cmd, fromSource, oinstanceid);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\toinstanceidMap[oinstanceid] = instanceid;\n\t\t\t\t\t\t\tinstanceBindMap[instanceid] = true;\n\t\t\t\t\t\t\tlet listener = instanceMap[instanceid];\n\t\t\t\t\t\t\tlistener.osource = fromSource;\n\t\t\t\t\t\t\tlistener.origin = originStr;\n\t\t\t\t\t\t\t_sendData(\"accept\", cmd, fromSource, listener.conndata, instanceid, oinstanceid);\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\n\t\t\t\t}\n\n\t\t\t\tfor(let i = 0; i < listeners.length; i++) {\n\t\t\t\t\tlet listener = listeners[i];\n\t\t\t\t\tif(!listener.refused[oinstanceid]) {\n\t\t\t\t\t\tlistener.connectingSource(fromSource, originStr, data, Callback(listener.id));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction handleAccept(cmd, fromSource, originStr, data, oinstanceid, minstanceid) {\n\t\t\t\tlet listeners = cmd2ListenerMap[cmd];\n\t\t\t\tif(!listeners) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tfunction Callback(instanceid) {\n\n\t\t\t\t\treturn function(isAccept, msg) {\n\t\t\t\t\t\tif(!isAccept) {\n\t\t\t\t\t\t\tlet listener = instanceMap[instanceid];\n\t\t\t\t\t\t\tlistener.refused[oinstanceid] = true;\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif(oinstanceidMap[oinstanceid]) {\n\t\t\t\t\t\t\tconsole.warn(\"already bind:\" + cmd + \",my page:\" + location.href);\n\t\t\t\t\t\t} else if(instanceBindMap[instanceid]) {\n\t\t\t\t\t\t\tconsole.warn(\"already self bind:\" + cmd + \",my page:\" + location.href);\n\t\t\t\t\t\t\t_sendData(\"binded\", cmd, fromSource, oinstanceid);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\toinstanceidMap[oinstanceid] = instanceid;\n\t\t\t\t\t\t\tinstanceBindMap[instanceid] = true;\n\n\t\t\t\t\t\t\tlet listener = instanceMap[instanceid];\n\t\t\t\t\t\t\tlistener.osource = fromSource;\n\t\t\t\t\t\t\tlistener.origin = originStr;\n\t\t\t\t\t\t\t_sendData(\"conned\", cmd, fromSource, listener.conndata, instanceid);\n\t\t\t\t\t\t\tlistener._onConned(fromSource, data);\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\n\t\t\t\t}\n\n\t\t\t\tfor(let i = 0; i < listeners.length; i++) {\n\t\t\t\t\tlet listener = listeners[i];\n\t\t\t\t\tif(listener.id == minstanceid && !listener.refused[oinstanceid]) { //当前为主动发起连接的页面\n\t\t\t\t\t\tlistener.connectingSource(fromSource, originStr, data, Callback(listener.id));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction handleBinded(cmd, fromSource, originStr, minstanceid) {\n\t\t\t\tlet listener = instanceMap[minstanceid];\n\t\t\t\tlistener._onElse(\"binded\");\n\t\t\t}\n\n\t\t\tfunction checkSource(listener, fromSource, originStr) {\n\t\t\t\tif(listener.osource != fromSource && listener.origin != originStr) {\n\t\t\t\t\tconsole.warn(\"expected:\" + listener.origin + \",but:\" + originStr);\n\t\t\t\t\tthrow new Error(\"source changed!\");\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction handleConned(cmd, fromSource, originStr, data, oinstanceid) {\n\t\t\t\tlet instanceid = oinstanceidMap[oinstanceid];\n\t\t\t\tlet listener = instanceMap[instanceid];\n\t\t\t\tcheckSource(listener, fromSource, originStr);\n\n\t\t\t\tlistener._onConned(listener.osource, data);\n\t\t\t}\n\n\t\t\tfunction handleMsg(cmd, fromSource, originStr, data, oinstanceid, msgid) {\n\t\t\t\tlet instanceid = oinstanceidMap[oinstanceid];\n\t\t\t\tlet listener = instanceMap[instanceid];\n\t\t\t\tcheckSource(listener, fromSource, originStr);\n\n\t\t\t\tlistener._onMsg(data, msgid);\n\t\t\t}\n\n\t\t\tfunction handleResponse(cmd, fromSource, originStr, data, oinstanceid) {\n\t\t\t\tlet instanceid = oinstanceidMap[oinstanceid];\n\t\t\t\tlet listener = instanceMap[instanceid];\n\t\t\t\tcheckSource(listener, fromSource, originStr);\n\n\t\t\t\tlistener._onResponse(data);\n\t\t\t}\n\n\t\t\tfunction _sendData(type, cmd, source, data, instanceid, msgid) {\n\t\t\t\tlet msg = {\n\t\t\t\t\ttype: type,\n\t\t\t\t\tdata: data,\n\t\t\t\t\tcmd: cmd,\n\t\t\t\t\tid: instanceid,\n\t\t\t\t\tmsgid: msgid\n\t\t\t\t};\n\n\t\t\t\tif(isDebug(\"postMessageBridge\")) {\n\t\t\t\t\tconsole.log(\"send from:\" + location.href);\n\t\t\t\t\tconsole.log(msg);\n\t\t\t\t}\n\t\t\t\tsource.postMessage(xsloader.xsJson2String(msg), \"*\");\n\t\t\t}\n\n\t\t\twindow.addEventListener('message', function(event) {\n\t\t\t\tif(isDebug(\"postMessageBridge\")) {\n\t\t\t\t\tconsole.log(\"receive from:\" + event.origin + \",my page:\" + location.href);\n\t\t\t\t\tconsole.log(event.data);\n\t\t\t\t}\n\t\t\t\tlet data;\n\t\t\t\ttry {\n\t\t\t\t\tdata = xsloader.xsParseJson(event.data);\n\t\t\t\t} catch(e) {\n\t\t\t\t\tconsole.warn(e);\n\t\t\t\t}\n\t\t\t\tif(!data || !(data.cmd && data.type)) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tlet cmd = data.cmd;\n\t\t\t\tlet oinstanceid = data.id;\n\t\t\t\tlet rdata = data.data;\n\t\t\t\tlet type = data.type;\n\t\t\t\tlet msgid = data.msgid;\n\n\t\t\t\tif(type == \"conn\") {\n\t\t\t\t\thandleConn(cmd, event.source, event.origin, rdata, oinstanceid);\n\t\t\t\t} else if(type == \"accept\") {\n\t\t\t\t\thandleAccept(cmd, event.source, event.origin, rdata, oinstanceid, msgid);\n\t\t\t\t} else if(type == \"conned\") {\n\t\t\t\t\thandleConned(cmd, event.source, event.origin, rdata, oinstanceid);\n\t\t\t\t} else if(type == \"msg\") {\n\t\t\t\t\thandleMsg(cmd, event.source, event.origin, rdata, oinstanceid, msgid);\n\t\t\t\t} else if(type == \"response\") {\n\t\t\t\t\thandleResponse(cmd, event.source, event.origin, rdata, oinstanceid);\n\t\t\t\t} else if(type == \"binded\") {\n\t\t\t\t\thandleBinded(cmd, event.source, event.origin, rdata);\n\t\t\t\t}\n\n\t\t\t});\n\n\t\t\thandle.runAfter = function(time, callback) {\n\t\t\t\tsetTimeout(callback, time);\n\t\t\t};\n\n\t\t\treturn handle;\n\t\t})();\n\n\t\tfunction CommunicationUnit(cmd, source, connectingSource, onfailed, isActive, conndata) {\n\t\t\tlet msgQueue = new LinkedList();\n\n\t\t\tlet MAX_TRY = 100,\n\t\t\t\tSLEEP = 500;\n\t\t\tlet isConnected = false,\n\t\t\t\tconnectCount = 0;\n\t\t\tlet isCanceled = false;\n\n\t\t\tlet thiz = this;\n\t\t\tlet handleId;\n\n\t\t\tthis.onConnectedListener = null;\n\t\t\tthis.onReceiveListener = null;\n\t\t\tthis.send = function(data) {\n\t\t\t\tlet msg = {\n\t\t\t\t\tid: xsloader.randId(),\n\t\t\t\t\tdata: data\n\t\t\t\t};\n\t\t\t\tmsgQueue.append(msg);\n\t\t\t\tsendTop();\n\t\t\t};\n\n\t\t\tthis.send.release = function() {\n\t\t\t\tpostMessageBridge.remove(handleId);\n\t\t\t};\n\n\t\t\tfunction _onConned(_source, data) {\n\t\t\t\tthiz.onConnectedListener.call(thiz, data);\n\t\t\t\tisConnected = true;\n\t\t\t\tsendTop();\n\t\t\t}\n\n\t\t\tfunction _onMsg(data, msgid) {\n\t\t\t\ttry {\n\t\t\t\t\tthiz.onReceiveListener.call(thiz, data);\n\t\t\t\t} catch(e) {\n\t\t\t\t\tconsole.warn(e);\n\t\t\t\t}\n\t\t\t\tpostMessageBridge.sendResponse({ //回应已经收到\n\t\t\t\t\tid: msgid\n\t\t\t\t}, handleId);\n\t\t\t}\n\n\t\t\tfunction _onResponse(data) {\n\t\t\t\tmsgQueue.remove(function(elem) {\n\t\t\t\t\treturn elem.id = data.id;\n\t\t\t\t});\n\t\t\t\tsendTop();\n\t\t\t}\n\n\t\t\tfunction _onElse(type) {\n\t\t\t\tif(type == \"binded\") {\n\t\t\t\t\tisCanceled = true;\n\t\t\t\t\tconsole.error(\"connect failed,that page already binded:\" + cmd + \",my page:\" + location.href);\n\t\t\t\t\tonfailed(\"canceled\");\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction initListen() {\n\t\t\t\thandleId = postMessageBridge.listen(cmd, conndata, connectingSource, source, isActive, _onConned, _onMsg, _onResponse, _onElse);\n\t\t\t}\n\n\t\t\tfunction sendTop() {\n\t\t\t\tif(isConnected) {\n\t\t\t\t\tlet msg;\n\t\t\t\t\twhile((msg = msgQueue.pop())) {\n\t\t\t\t\t\tpostMessageBridge.send(msg.data, handleId, msg.id);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction init() {\n\t\t\t\tif(isConnected || connectCount > MAX_TRY || isCanceled) {\n\t\t\t\t\tif(!isConnected && !isCanceled) {\n\t\t\t\t\t\tonfailed(\"timeout\");\n\t\t\t\t\t}\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tpostMessageBridge.sendConn(handleId);\n\t\t\t\tconnectCount++;\n\t\t\t\tpostMessageBridge.runAfter(SLEEP, init);\n\t\t\t}\n\t\t\tif(source) {\n\t\t\t\tinitListen();\n\t\t\t\tinit();\n\t\t\t} else if(!isActive) {\n\t\t\t\tinitListen();\n\t\t\t}\n\n\t\t\tthis.setSource = function(_source) {\n\t\t\t\tsource = _source;\n\t\t\t\tif(source) {\n\t\t\t\t\tinitListen();\n\t\t\t\t\tinit();\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\n\t\tlet handleApi = api;\n\n\t\t/**\n\t\t * \n\t\t * @param {Object} winObjOrCallback\n\t\t * @param {Object} option\n\t\t * @param {Object} notActive\n\t\t */\n\t\tfunction _connectWindow(winObjOrCallback, option, notActive) {\n\t\t\toption = xsloader.extendDeep({\n\t\t\t\tcmd: \"default-cmd\",\n\t\t\t\tlistener: null,\n\t\t\t\tconnected: null,\n\t\t\t\tconndata: null,\n\t\t\t\tconnectingSource: function(source, origin, conndata, callback) {\n\t\t\t\t\tlet mine = location.protocol + \"//\" + location.host;\n\t\t\t\t\tcallback(mine == origin, \"default\");\n\t\t\t\t},\n\t\t\t\tonfailed: function(errtype) {\n\t\t\t\t\tif(errtype == \"timeout\") {\n\t\t\t\t\t\tconsole.warn(\"connect may timeout:cmd=\" + option.cmd + \",my page=\" + location.href);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}, option);\n\n\t\t\tlet cmd = option.cmd;\n\t\t\tlet connectedCallback = option.connected;\n\t\t\tlet receiveCallback = option.listener;\n\t\t\tlet conndata = option.conndata;\n\t\t\tlet onfailed = option.onfailed;\n\n\t\t\tlet isActive = !notActive;\n\t\t\tlet connectingSource = option.connectingSource;\n\n\t\t\tlet unit;\n\t\t\tif(typeof winObjOrCallback == \"function\") {\n\t\t\t\tunit = new CommunicationUnit(cmd, null, connectingSource, onfailed, isActive, conndata);\n\t\t\t} else {\n\t\t\t\tunit = new CommunicationUnit(cmd, winObjOrCallback, connectingSource, onfailed, isActive, conndata);\n\t\t\t}\n\n\t\t\tconnectedCallback = connectedCallback || function(sender, conndata) {\n\t\t\t\tconsole.log((isActive ? \"active\" : \"\") + \" connected:\" + cmd);\n\t\t\t};\n\t\t\tif(connectedCallback) {\n\t\t\t\tunit.onConnectedListener = function(conndata) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tconnectedCallback(this.send, conndata);\n\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\tconsole.error(e);\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t}\n\t\t\tif(receiveCallback) {\n\t\t\t\tunit.onReceiveListener = function(data) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\treceiveCallback(data, this.send);\n\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\tconsole.error(e);\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t}\n\t\t\tif(typeof winObjOrCallback == \"function\") {\n\t\t\t\twinObjOrCallback(function(winObj) {\n\t\t\t\t\tunit.setSource(winObj);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn unit.send;\n\t\t}\n\n\t\tfunction _connectIFrame(iframe, option) {\n\t\t\tlet winObj;\n\t\t\tif(typeof iframe == \"string\") {\n\t\t\t\t//iframe = ddocument.querySelector(iframe);\n\t\t\t\twinObj = function(callback) {\n\t\t\t\t\tiframe.onload = function() {\n\t\t\t\t\t\tcallback(this.contentWindow);\n\t\t\t\t\t};\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\twinObj = iframe.contentWindow;\n\t\t\t}\n\t\t\treturn _connectWindow(winObj, option);\n\n\t\t}\n\n\t\t/**\n\t\t * 用于连接iframe.\n\t\t * @param {Object} iframe iframe或selector\n\t\t * @param {Object} option\n\t\t * @return 返回sender\n\t\t */\n\t\thandleApi.connectIFrame = function(iframe, option) {\n\t\t\treturn _connectIFrame(iframe, option);\n\t\t};\n\n\t\t/**\n\t\t * 用于连接父页面.\n\t\t * @param {Object} option\n\t\t * @return 返回sender\n\t\t */\n\t\thandleApi.connectParent = function(option) {\n\t\t\treturn _connectWindow(window.parent, option);\n\t\t};\n\n\t\t/**\n\t\t * 用于连接顶层页面.\n\t\t * @param {Object} option\n\t\t * @return 返回sender\n\t\t */\n\t\thandleApi.connectTop = function(option) {\n\t\t\treturn _connectWindow(window.top, option);\n\t\t};\n\n\t\t/**\n\t\t * 用于连接打开者.\n\t\t * @param {Object} option\n\t\t * @return 返回sender\n\t\t */\n\t\thandleApi.connectOpener = function(option) {\n\t\t\treturn _connectWindow(window.opener, option);\n\t\t};\n\n\t\t/**\n\t\t * 用于监听其他页面发送消息.\n\t\t * @param {Object} option\n\t\t * @return 返回一个sender\n\t\t */\n\t\thandleApi.listenMessage = function(option) {\n\t\t\treturn _connectWindow(null, option, true);\n\t\t};\n\n\t\thandleApi.debug = function(isDebug) {\n\t\t\tisXsMsgDebug = isDebug;\n\t\t};\n\n\t\t/**\n\t\t * *******************\n\t\t * option参数\n\t\t *********************\n\t\t * option.cmd:\n\t\t * option.connectingSource:function(source,origin,conndata,callback(isAccept,msg))默认只选择同源\n\t\t * option.listener: function(data,sender)\n\t\t * option.connected:function(sender,conndata)\n\t\t * option.onfailed:function(errtype):errtype,timeout,canceled\n\t\t * option.conndata:\n\t\t **************\n\t\t * 回调的extra参数\n\t\t **************\n\t\t * originStr:对方页面的地址\n\t\t */\n\t\txsloader.define(\"xsmsg\", handleApi); //TODO STRONG xsmsg\n\t}\n\n\txsloader.define(\"XsLinkedList\", function() {\n\t\treturn LinkedList;\n\t});\n} catch(e) {\n\tconsole.error(e);\n}","// 静态资源服务\r\nimport utils from \"./util/index.js\";\r\n\r\nconst global = utils.global;\r\nconst xsloader = global.xsloader;\r\n\r\nconst http = global._xshttp_request_;\r\nconst DATA_CONF = \"data-conf\",\r\n\tDATA_CONFX = \"data-xsloader-conf\";\r\nconst DATA_CONF2 = \"data-conf2\",\r\n\tDATA_CONF2X = \"data-xsloader-conf2\";\r\nconst DATA_MAIN = \"data-main\",\r\n\tDATA_MAINX = \"data-xsloader-main\";\r\nconst DATA_CONF_TYPE = \"data-conf-type\";\r\n\r\nlet serviceConfigUrl;\r\nlet dataConf = xsloader.script().getAttribute(DATA_CONF) || xsloader.script().getAttribute(DATA_CONFX);\r\nlet dataMain = xsloader.script().getAttribute(DATA_MAIN) || xsloader.script().getAttribute(DATA_MAINX);\r\nlet dataConfType = xsloader.script().getAttribute(DATA_CONF_TYPE);\r\nif(dataConfType !== \"json\" && dataConfType != \"js\") {\r\n\tdataConfType = \"auto\";\r\n}\r\n\r\nlet initFun = () => {\r\n\tfunction getMainPath(config) {\r\n\t\tlet mainPath = config.main.getPath.call(config, dataMain);\r\n\t\tlet path = location.pathname;\r\n\r\n\t\tlet index = path.lastIndexOf(\"/\");\r\n\t\tlet name = path.substring(index + 1);\r\n\t\tif(name === \"\") {\r\n\t\t\tname = \"index\";\r\n\t\t}\r\n\t\tif(xsloader.endsWith(name, \".html\")) {\r\n\t\t\tname = name.substring(0, name.length - 5);\r\n\t\t}\r\n\t\tif(!mainPath) {\r\n\t\t\tmainPath = \"./main/{name}.js\";\r\n\t\t}\r\n\t\tmainPath = mainPath.replace(\"{name}\", name);\r\n\t\treturn mainPath;\r\n\t}\r\n\r\n\tfunction extendConfig(config) {\r\n\t\tconfig = xsloader.extendDeep({\r\n\t\t\tproperties: {},\r\n\t\t\tmain: {\r\n\t\t\t\tgetPath() {\r\n\t\t\t\t\treturn dataMain || \"./main/{name}.js\";\r\n\t\t\t\t},\r\n\t\t\t\tname: \"main\",\r\n\t\t\t\tlocalConfigVar: \"lconfig\",\r\n\t\t\t\tglobalConfigVar: \"gconfig\",\r\n\t\t\t\tbefore(name) {\r\n\t\t\t\t\tconsole.log(\"before:\" + name);\r\n\t\t\t\t},\r\n\t\t\t\tafter(name) {\r\n\t\t\t\t\tconsole.log(\"after:\" + name);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tservice: {\r\n\t\t\t\thasGlobal: false,\r\n\t\t\t\tresUrls: []\r\n\t\t\t},\r\n\t\t\tchooseLoader(localConfig) { //返回一个configName；当此函数为service全局配置的函数时，localConfig为应用的配置对象;本地配置调用时，localConfig为null。\r\n\t\t\t\treturn \"default\";\r\n\t\t\t},\r\n\t\t\tloader: {\r\n\t\t\t\t\"default\": {\r\n\t\t\t\t\tautoUrlArgs: true\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}, config);\r\n\r\n\t\treturn config;\r\n\t}\r\n\r\n\tfunction loadServiceConfig(tag, url, callback, isLocal) {\r\n\t\thttp({\r\n\t\t\turl: url,\r\n\t\t\tmethod: \"get\",\r\n\t\t\ttimeout: 20000,\r\n\t\t\thandleType: \"text\",\r\n\t\t\tok(confText) {\r\n\r\n\t\t\t\tlet conf;\r\n\t\t\t\tif(dataConfType == \"js\") {\r\n\t\t\t\t\tconf = xsloader.xsEval(confText);\r\n\t\t\t\t} else if(dataConfType == \"json\") {\r\n\t\t\t\t\tconf = xsloader.xsParseJson(confText);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif(xsloader.startsWith(url, location.protocol + \"//\" + location.host + \"/\")) {\r\n\t\t\t\t\t\t//同域则默认用脚本解析\r\n\t\t\t\t\t\tconf = xsloader.xsEval(confText);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tconf = xsloader.xsParseJson(confText);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconf = extendConfig(conf);\r\n\t\t\t\tif(conf.beforeDealProperties) {\r\n\t\t\t\t\tconf.beforeDealProperties();\r\n\t\t\t\t}\r\n\t\t\t\tconf = xsloader.dealProperties(conf, conf.properties); //参数处理\r\n\r\n\t\t\t\tif(isLocal && conf.service.hasGlobal) {\r\n\t\t\t\t\tloadServiceConfig(\"global servie\", conf.service.confUrl,\r\n\t\t\t\t\t\tfunction(globalConfig) {\r\n\t\t\t\t\t\t\tlet localConfig = conf;\r\n\t\t\t\t\t\t\tglobal[globalConfig.main && globalConfig.main.localConfigVar || localConfig.main.localConfigVar] = localConfig;\r\n\t\t\t\t\t\t\tglobal[globalConfig.main && globalConfig.main.globalConfigVar || localConfig.main.globalConfigVar] = globalConfig;\r\n\r\n\t\t\t\t\t\t\tlet mainName, mainPath, loaderName;\r\n\r\n\t\t\t\t\t\t\tloaderName = globalConfig.chooseLoader.call(globalConfig, localConfig);\r\n\t\t\t\t\t\t\tlet conf;\r\n\t\t\t\t\t\t\tlet loader;\r\n\t\t\t\t\t\t\tif(loaderName != null) {\r\n\t\t\t\t\t\t\t\tmainName = globalConfig.main.name;\r\n\t\t\t\t\t\t\t\tmainPath = utils.getPathWithRelative(location.href, getMainPath(globalConfig));\r\n\t\t\t\t\t\t\t\tloader = globalConfig.loader[loaderName];\r\n\t\t\t\t\t\t\t\tconf = globalConfig;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tif(!loader) {\r\n\t\t\t\t\t\t\t\tloaderName = localConfig.chooseLoader.call(localConfig, null);\r\n\t\t\t\t\t\t\t\tmainName = localConfig.main.name;\r\n\t\t\t\t\t\t\t\tmainPath = utils.getPathWithRelative(location.href, getMainPath(localConfig));\r\n\t\t\t\t\t\t\t\tloader = localConfig.loader[loaderName];\r\n\t\t\t\t\t\t\t\tconf = localConfig;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tif(!loader) {\r\n\t\t\t\t\t\t\t\tconsole.error(\"unknown loader:\" + loaderName + \"\");\r\n\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tinitXsloader(mainName, mainPath, loader, conf, localConfig);\r\n\r\n\t\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\tcallback(conf);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tfail(err) {\r\n\t\t\t\tconsole.error(\"load \" + tag + \" config err:url=\" + url + \",errinfo=\" + err);\r\n\t\t\t}\r\n\t\t}).done();\r\n\t}\r\n\r\n\tfunction startLoad() {\r\n\t\tloadServiceConfig(\"local\", serviceConfigUrl, function(localConfig) {\r\n\t\t\tglobal[localConfig.main.localConfigVar] = localConfig;\r\n\r\n\t\t\tlet mainName = localConfig.main.name;\r\n\r\n\t\t\tlet href = location.href;\r\n\t\t\tlet index = href.lastIndexOf(\"?\");\r\n\t\t\tif(index >= 0) {\r\n\t\t\t\thref = href.substring(0, index);\r\n\t\t\t}\r\n\r\n\t\t\tlet mainPath = getMainPath(localConfig);\r\n\r\n\t\t\tmainPath = mainPath.indexOf(\"!\") == -1 ? utils.getPathWithRelative(href, mainPath) : mainPath;\r\n\t\t\tlet loaderName = localConfig.chooseLoader.call(localConfig, null);\r\n\r\n\t\t\tlet loader = localConfig.loader[loaderName];\r\n\t\t\tif(!loader) {\r\n\t\t\t\tconsole.error(\"unknown local loader:\" + loaderName);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tinitXsloader(href, mainName, mainPath, loader, localConfig, localConfig);\r\n\t\t}, true);\r\n\t}\r\n\r\n\tfunction initXsloader(pageHref, mainName, mainPath, loader, conf, localConfig) {\r\n\t\tlet resUrls = [];\r\n\t\tconf.service.resUrl && resUrls.push(conf.service.resUrl);\r\n\t\tlocalConfig !== conf && localConfig.service.resUrl && resUrls.push(localConfig.service.resUrl);\r\n\r\n\t\tconf.service.resUrls && Array.pushAll(resUrls, conf.service.resUrls);\r\n\t\tlocalConfig !== conf && localConfig.service.resUrls && Array.pushAll(resUrls, localConfig.service.resUrls);\r\n\r\n\t\txsloader._resUrlBuilder = function(groupModule) {\r\n\t\t\tlet as = [];\r\n\t\t\tutils.each(resUrls, function(url) {\r\n\t\t\t\tas.push(xsloader.appendArgs2Url(url, \"m=\" + encodeURIComponent(groupModule)));\r\n\t\t\t});\r\n\t\t\treturn as;\r\n\t\t};\r\n\t\tloader.ignoreProperties = true;\r\n\t\tloader.defineFunction = loader.defineFunction || {};\r\n\t\tloader.depsPaths = loader.depsPaths || {};\r\n\t\tif(mainPath.indexOf(\"!\") != -1) { //插件调用\r\n\t\t\tlet theConfig = xsloader(loader);\r\n\r\n\t\t\tmainName = \"_plugin_main_\";\r\n\t\t\tlet deps = [];\r\n\t\t\tif(theConfig.deps) { //手动添加*依赖\r\n\t\t\t\tif(theConfig.deps[\"*\"]) {\r\n\t\t\t\t\tArray.pushAll(deps, theConfig.deps[\"*\"]);\r\n\t\t\t\t}\r\n\t\t\t\tif(theConfig.deps[mainName]) {\r\n\t\t\t\t\tArray.pushAll(deps, theConfig.deps[mainName]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tdeps.push(mainPath);\r\n\t\t\txsloader.define(mainName, deps, function() {\r\n\r\n\t\t\t}).then({\r\n\t\t\t\tabsUrl: pageHref\r\n\t\t\t});\r\n\t\t} else if(!xsloader.hasDefine(mainName)) {\r\n\t\t\tloader.depsPaths[mainName] = mainPath; //让其依赖*中的所有依赖\r\n\t\t\txsloader(loader);\r\n\t\t} else {\r\n\t\t\txsloader(loader);\r\n\t\t}\r\n\r\n\t\tloader.defineFunction[mainName] = function(originCallback, originThis, originArgs) {\r\n\t\t\tif(xsloader.isFunction(conf.main.before)) {\r\n\t\t\t\tconf.main.before.call(conf, mainName);\r\n\t\t\t}\r\n\t\t\tlet rt = originCallback.apply(originThis, originArgs);\r\n\r\n\t\t\tif(xsloader.isFunction(conf.main.after)) {\r\n\t\t\t\tconf.main.after.call(conf, mainName);\r\n\t\t\t}\r\n\t\t\treturn rt;\r\n\t\t};\r\n\r\n\t\txsloader.require([mainName], function(main) {}).error((err, invoker) => {\r\n\t\t\tif(invoker) {\r\n\t\t\t\tconsole.error(\"error occured:invoker.url=\", invoker.getUrl());\r\n\t\t\t}\r\n\t\t\tconsole.error(\"invoke main err:\");\r\n\t\t\tconsole.error(err);\r\n\t\t});\r\n\t}\r\n\txsloader.asyncCall(startLoad, true);\r\n};\r\n\r\nif(dataConf) {\r\n\tserviceConfigUrl = utils.getPathWithRelative(location.href, dataConf);\r\n} else if((dataConf = (xsloader.script().getAttribute(DATA_CONF2) || xsloader.script().getAttribute(DATA_CONF2X)))) {\r\n\tserviceConfigUrl = utils.getPathWithRelative(xsloader.scriptSrc(), dataConf);\r\n} else {\r\n\tinitFun = null;\r\n}\r\ninitFun && initFun();","import \"./polyfill/index.js\";\nimport \"./core/index.js\";\nimport \"./define.js\";\nimport \"./core/plugins/index.js\";\nimport \"./service.js\"; //放在最后\nimport utils from \"./util/index.js\";\nutils.loaderEnd();"],"names":["JSON","rx_one","rx_two","rx_three","rx_four","rx_escapable","rx_dangerous","f","n","this_value","valueOf","Date","prototype","toJSON","isFinite","getUTCFullYear","getUTCMonth","getUTCDate","getUTCHours","getUTCMinutes","getUTCSeconds","Boolean","Number","String","gap","indent","meta","rep","quote","string","lastIndex","test","replace","a","c","charCodeAt","toString","slice","str","key","holder","i","k","v","length","mind","partial","value","call","Object","apply","join","push","hasOwnProperty","stringify","replacer","space","Error","parse","text","reviver","j","walk","undefined","eval","SyntaxError","g","window","self","global","InVar","val","get","set","newVal","old","loaderFun","xsloader","arguments","fun","ABSOLUTE_PROTOCOL_REG","ABSOLUTE_PROTOCOL_REG2","defaultJsExts","isJsFile","path","isString","indexOf","pluginIndex","substring","index","theConfig","config","jsExts","endsWith","ext","dealPathMayAbsolute","currentUrl","location","href","rs","exec","finalPath","absolute","protocol","_protocol","_host","host","getPathWithRelative","relative","isPathDir","relativeQuery","qIndex","lastIndexOf","isRelativeDir","prefix","absolute2","index2","stack","split","pop","relatives","result","appendArgs2Url","getNodeAbsolutePath","node","src","getAttribute","removeQueryHash","url","REPLACE_STRING_PROPERTIES_EXP","RegExp","ALL_TYPE_PROPERTIES_EXP","propertiesDeal","configObject","properties","replaceStringProperties","property","propKey","propValue","getObjectAttr","propertyKey","has","replaceProperties","obj","enableKeyAttr","isFunction","isArray","isObject","replaceKeyMap","x","_x","objx","__dealt__","replaceModulePrefix","deps","m","pluginParam","query","is","startsWith","modulePrefixCount","modulePrefix","replaceStr","len","pluginName","dep","getScriptBySubname","subname","ss","document","getElementsByTagName","script","commentRegExp","cjsRequireRegExp","GraphPath","pathEdges","vertexMap","depMap","addEdge","begin","end","hasDep","name","tryAddEdge","paths","hasLoop","visited","recursionStack","checkLoop","edges","edge","strValue2Arr","each","ary","func","isSync","fromEnd","handle","__commentReplace","match","singlePrefix","appendInnerDeps","callback","indexInArray","idCount","getAndIncIdCount","PluginError","err","invoker","isXsLoaderEnd","IE_VERSION","getIEVersion","userAgent","navigator","isIE","isEdge","isIE11","reIE","fIEVersion","parseInt","graphPath","loaderEnd","isLoaderEnd","urls","base","utils","Function","bind","console","method","thiz","e","log","error","warn","Array","elem","offset","pushAll","arr","starts","ends","_indexInArray","array","ele","compare","indexInArrayFrom","trim","randId","suffix","id","getTime","Math","random","xsEval","scriptString","xsParseJson","option","extend","fnStart","fnEnd","rcomment","fnMap","fnOffset","indexStart","indexEnd","fnId","fnStr","fn","jsonObj","xsJSON","reg","message","posStr","pos","_str","e2","xsJson2String","_toParamsMap","argsStr","decode","search","ret","seg","s","decodeURIComponent","urlArgs","hashIndex","oldParams","newParams","paramKeys","sort","params","hash","queryString2ParamsMap","ostring","it","isDate","isRegExp","queryParam","otherValue","optionUrl","substr","r","getUrl","relativeUrl","appendArgs","optionalAbsUrl","thePageUrl","pageUrl","baseUrl","dealUrl","tryCall","defaultReturn","exCallback","dealProperties","target","extendDeep","_AsyncCall","useTimer","count","ctrlCallbackMap","initCtrlCallback","callbackObj","mineCount","ctrlCallback","asyncCallQueue","shift","lastReturn","nextCallback","nextObj","pushTask","next","Promise","resolve","then","setTimeout","queue","theAsyncCall","theAsyncCallOfTimer","asyncCall","attrNames","defaultValue","attrs","setObjectAttr","_obj","o","clone","isDeep","source","flags","copy","setTime","attr","isDOM","HTMLElement","nodeType","nodeName","onReadyFun","isGlobalReady","bindReadyQueue","BindReady","isReady","ready","addEventListener","removeEventListener","attachEvent","readyState","detachEvent","fun2","documentElement","doScroll","frameElement","readyCall","onReady","br","addEventHandle","type","toGlobal","deprecated","justLoader","funs","browser","_ignoreAspect_","theDefinedMap","lastDefinObjectMap","ModuleDef","isPreDependOn","modules","defaultModule","targetDef","_preModule","relyQueue","relyIt","args","module","_isSrc","nameOrUrl","isSrc","setLastDefineObject","defineObject","getLastDefineObject","appendLoadingModuleDeps","moduleDef","mod","state","_deps","pushName","selfname","getModule","ifoneThenGet","preDependOn","def","replaceModuleSrc","oldSrc","clearEmptyModuleBySrc","setModule","lasfDef","giveRelys","newModuleInstance","thatInvoker","relyCallback","pluginArgs","instanceModule","_invoker","_module_","initInvoker","ignoreAspect","_object","addTheAttrs","theObj","_invoker_","_modules_","isSingle","instanceType","loopObject","description","_setDepModuleObjectGen","moduleObject","genExports","_getCacheKey","getCacheKey","_willCache","cacheResult","willCache","lastSinglePluginResult","setSinglePluginResult","initInstance","justForSingle","dealInstance","hasFinished","onload","__default","onerror","last","concat","pluginMain","waitSeconds","moduleMap","absUrl","getName","Invoker","_newModule","DefineObject","appendConfigDepsAndEmbedDeps","newModule","instances","parent","parentDefine","relys","absUrlFromModule","absUrlFromDefineObject","getCallback","_dealApplyArgs","_loadCallback","reinitByDefineObject","setInstanceType","_singlePluginResult","finish","currentDefineModuleQueue","setState","isDefault","errinfo","_callback","_state","theCallback","depModule","getDeps","require","defined_module_for_deps","refmodule","toOtherModule","otherModule","theRelys","whenNeed","loadCallback","callbackFun","moduleInstance","opId","setToAll","getModuleId","ins","mobj","_m_","printOnNotDefined","root","nodes","_printOnNotDefined","leafs","findLeaf","item","genErrs","infos","leaf","reverse","as","errModule","depMod","parentNode","indexPlguin","randModuleIndex","everyRequired","everyOkCallback","errCallback","isError","dealRelative","hasCallErr","theExports","depCount","depModules","invoker_of_module","checkFinish","dep_name","syncHandle","originDep","relyItFun","i1","i2","i3","version","groupModule","defaultVersion","_url","_resUrlBuilder","isInUrls","getUrls","rurl","loadModule","module2","loadScript","scriptData","defaultMod","m2Name","configDeps","d","orderDep","defContextName","DATA_ATTR_MODULE","DATA_ATTR_CONTEXT","INNER_DEPS_PLUGIN","innerDepsMap","globalDefineQueue","isOpera","opera","safariVersion","ua","toLowerCase","readyRegExp","platform","theLoaderScript","currentScript","theLoaderUrl","head","peek","lastAppendHeadDom","isSrcFromScriptLoad","lastScriptSrc","theRealDefine","_dealEmbedDeps","modName","moduleScript","isOrderDep","_getPluginParam","Handle","onError","ThisInvoker","_buildInvoker","getId","h","define","defineAsync","withAbsUrl","absUrlStr","_im","getInvoker","nullNew","parentModule","isRequire","before","depBefore","depDeps","absoluteUrl","instance","_directDepLength","directDepLength","names","odeps","unshift","hasOrderDep","applyArgs","jsFilePath","moduleLoop","getCurrentScript","isRemoveQueryHash","_getCurrentScriptOrSrc","b","sourceURL","stacktrace","__createNode","createElement","charset","async","__removeListener","ieName","__browserLoader","moduleName","setAttribute","useAttach","onScriptLoad","errListen","onScriptError","appendHeadDom","__getScriptData","evt","currentTarget","srcElement","dom","nextDom","nextSibling","insertBefore","removed","doDefine","predefine","prerequire","originDeps","argArr","theMod","timeid","clearTimeout","customerErrCallback","isErr","checkResultFun","ifmodule","initDefine","theDefine","defines","loaded","onConfigedCallback","theContext","argsObject","scriptSrc","putUrlArgs","argsObj","getUrlArgs","clearUrlArgs","hasDefine","groupName","clear_module_","_newContext","context","contextName","defQueue","loader","pathname","ignoreProperties","depsPaths","defineFunction","autoUrlArgs","dealtDeps","splice","urlArg","forPrefixSuffix","aurl","encodeURIComponent","dealUrlArgs","isAutoUrlArgs","star","urlArgsArr","urlArgObj","starP","_urlArgs_prefix","_urlArgs_suffix","strfix","urlOrName","strfixObj","pushDeps","dealtDepArray","depsArray","keyName","defineHandle","originCallback","rt","defineFun","onModuleLoaded","lastDefineObject","needCallback","depModuleArgs","amd","depId","depsObj","newInvoker","arg","vars","existsMods","newName","lastM","load","engine","useImportLoad","useOnload","style","cssAPI","curStyle","curSheet","createStyle","styleSheet","sheet","ieCnt","ieLoads","ieCurCallback","createIeLoad","addImport","processIeLoad","nextLoad","importLoad","textContent","loadInterval","setInterval","cssRules","clearInterval","linkLoad","link","rel","styleSheets","cssId","loadCss","cssPath","loadCsses","http","handleAs","ok","fail","done","depsStr","json","progIds","httpRequest","prop","varName","defaultVal","putProp","toObj","_method","_params","_headers","_async","_multiPart","_handleType","_timeout","timeout","okCallback","failCallback","uploadStartCallback","uploadStart","uploadProgressCallback","uploadProgress","uploadOkCallback","uploadOk","uploadErrorCallback","uploadError","uploadEndCallback","uploadEnd","_beforeOpenHook","_onOkResponseHook","_onFailResponseHook","createXhr","xhr","progId","XMLHttpRequest","ActiveXObject","conn","_conn","toUpperCase","headers","handleType","multiPart","_connAfterOpenHook","_doOnFailResponseHook","extraErr","body","formData","FormData","append","open","setRequestHeader","header","upload","onloadstart","onprogress","onloadend","timeoutTimer","isTimeout","abort","onreadystatechange","status","responseText","send","requestObj","urlStr","methodStr","isAsync","paramsObj","headersObj","extraErrorType","_xshttp_request_","xsRequest","isResponsed","callbacksQueue","code","desc","newHandle","isDebug","isXsMsgDebug","LinkedList","newNode","element","pre","headNode","lastNode","current","insert","position","pNode","elementAt","getElement","willRemove","currentNode","nextCurrentNode","eachForRemove","removeAt","find","remove","isEmpty","size","api","linkedList","CommunicationUnit","cmd","connectingSource","onfailed","isActive","conndata","msgQueue","MAX_TRY","SLEEP","isConnected","connectCount","isCanceled","handleId","onConnectedListener","onReceiveListener","data","msg","sendTop","release","postMessageBridge","_onConned","_source","_onMsg","msgid","sendResponse","_onResponse","_onElse","initListen","listen","init","sendConn","runAfter","setSource","_connectWindow","winObjOrCallback","notActive","listener","connected","origin","mine","errtype","connectedCallback","receiveCallback","unit","sender","winObj","_connectIFrame","iframe","contentWindow","instanceMap","cmd2ListenerMap","instanceBindMap","oinstanceidMap","osource","active","refused","instanceid","_sendData","handleConn","fromSource","originStr","oinstanceid","listeners","Callback","isAccept","handleAccept","minstanceid","handleBinded","checkSource","handleConned","handleMsg","handleResponse","postMessage","event","rdata","time","handleApi","connectIFrame","connectParent","connectTop","top","connectOpener","opener","listenMessage","debug","DATA_CONF","DATA_CONFX","DATA_CONF2","DATA_CONF2X","DATA_MAIN","DATA_MAINX","DATA_CONF_TYPE","serviceConfigUrl","dataConf","dataMain","dataConfType","initFun","getMainPath","mainPath","main","getPath","extendConfig","localConfigVar","globalConfigVar","after","service","hasGlobal","resUrls","chooseLoader","localConfig","loadServiceConfig","tag","isLocal","confText","conf","beforeDealProperties","confUrl","globalConfig","mainName","loaderName","initXsloader","startLoad","pageHref","resUrl","originThis","originArgs"],"mappings":"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"}