{"version":3,"file":"xsloader.min.js","sources":["../src/polyfill/json.js","../src/util/global.js","../src/core/loader.js","../src/util/urls.js","../src/util/base.js","../src/util/loading.js","../src/util/index.js","../src/public/global-deprecated.js","../src/public/global-base.js","../src/public/is.js","../src/public/funs.js","../src/public/browser.js","../src/public/index.js","../src/core/module-def.js","../src/core/module.js","../src/core/script.js","../src/core/index.js","../src/define.js","../src/core/plugins/inner-dep.js","../src/core/plugins/ready.js","../src/core/plugins/try.js","../src/core/plugins/nodeps.js","../src/core/plugins/exists.js","../src/core/plugins/name.js","../src/core/plugins/css.js","../src/core/plugins/text.js","../src/core/plugins/window.js","../src/core/plugins/withdeps.js","../src/core/plugins/json.js","../src/core/plugins/xshttp.js","../src/core/plugins/request.js","../src/core/plugins/xsmsg.js","../src/service.js","../src/main.js"],"sourcesContent":["//https://github.com/douglascrockford/JSON-js\r\n//  json2.js\r\n//  2017-06-12\r\n//  Public Domain.\r\n//  NO WARRANTY EXPRESSED OR IMPLIED. USE AT YOUR OWN RISK.\r\n\r\n//  USE YOUR OWN COPY. IT IS EXTREMELY UNWISE TO LOAD CODE FROM SERVERS YOU DO\r\n//  NOT CONTROL.\r\nconst JSON = {};\r\n\r\nexport default JSON;\r\n\r\nlet rx_one = /^[\\],:{}\\s]*$/;\r\nlet rx_two = /\\\\(?:[\"\\\\\\/bfnrt]|u[0-9a-fA-F]{4})/g;\r\nlet rx_three = /\"[^\"\\\\\\n\\r]*\"|true|false|null|-?\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d+)?/g;\r\nlet rx_four = /(?:^|:|,)(?:\\s*\\[)+/g;\r\nlet rx_escapable = /[\\\\\"\\u0000-\\u001f\\u007f-\\u009f\\u00ad\\u0600-\\u0604\\u070f\\u17b4\\u17b5\\u200c-\\u200f\\u2028-\\u202f\\u2060-\\u206f\\ufeff\\ufff0-\\uffff]/g;\r\nlet rx_dangerous = /[\\u0000\\u00ad\\u0600-\\u0604\\u070f\\u17b4\\u17b5\\u200c-\\u200f\\u2028-\\u202f\\u2060-\\u206f\\ufeff\\ufff0-\\uffff]/g;\r\n\r\nfunction f(n) {\r\n\t// Format integers to have at least two digits.\r\n\treturn(n < 10) ?\r\n\t\t\"0\" + n :\r\n\t\tn;\r\n}\r\n\r\nfunction this_value() {\r\n\treturn this.valueOf();\r\n}\r\n\r\nif(typeof Date.prototype.toJSON !== \"function\") {\r\n\r\n\tDate.prototype.toJSON = function() {\r\n\t\treturn isFinite(this.valueOf()) ?\r\n\t\t\t(\r\n\t\t\t\tthis.getUTCFullYear() +\r\n\t\t\t\t\"-\" +\r\n\t\t\t\tf(this.getUTCMonth() + 1) +\r\n\t\t\t\t\"-\" +\r\n\t\t\t\tf(this.getUTCDate()) +\r\n\t\t\t\t\"T\" +\r\n\t\t\t\tf(this.getUTCHours()) +\r\n\t\t\t\t\":\" +\r\n\t\t\t\tf(this.getUTCMinutes()) +\r\n\t\t\t\t\":\" +\r\n\t\t\t\tf(this.getUTCSeconds()) +\r\n\t\t\t\t\"Z\"\r\n\t\t\t) :\r\n\t\t\tnull;\r\n\t};\r\n\r\n\tBoolean.prototype.toJSON = this_value;\r\n\tNumber.prototype.toJSON = this_value;\r\n\tString.prototype.toJSON = this_value;\r\n}\r\n\r\nlet gap;\r\nlet indent;\r\nlet meta;\r\nlet rep;\r\n\r\nfunction quote(string) {\r\n\r\n\t// If the string contains no control characters, no quote characters, and no\r\n\t// backslash characters, then we can safely slap some quotes around it.\r\n\t// Otherwise we must also replace the offending characters with safe escape\r\n\t// sequences.\r\n\r\n\trx_escapable.lastIndex = 0;\r\n\treturn rx_escapable.test(string) ?\r\n\t\t\"\\\"\" + string.replace(rx_escapable, function(a) {\r\n\t\t\tlet c = meta[a];\r\n\t\t\treturn typeof c === \"string\" ?\r\n\t\t\t\tc :\r\n\t\t\t\t\"\\\\u\" + (\"0000\" + a.charCodeAt(0).toString(16)).slice(-4);\r\n\t\t}) + \"\\\"\" :\r\n\t\t\"\\\"\" + string + \"\\\"\";\r\n}\r\n\r\nfunction str(key, holder) {\r\n\t// Produce a string from holder[key].\r\n\tlet i; // The loop counter.\r\n\tlet k; // The member key.\r\n\tlet v; // The member value.\r\n\tlet length;\r\n\tlet mind = gap;\r\n\tlet partial;\r\n\tlet value = holder[key];\r\n\r\n\t// If the value has a toJSON method, call it to obtain a replacement value.\r\n\tif(\r\n\t\tvalue &&\r\n\t\ttypeof value === \"object\" &&\r\n\t\ttypeof value.toJSON === \"function\"\r\n\t) {\r\n\t\tvalue = value.toJSON(key);\r\n\t}\r\n\r\n\t// If we were called with a replacer function, then call the replacer to\r\n\t// obtain a replacement value.\r\n\r\n\tif(typeof rep === \"function\") {\r\n\t\tvalue = rep.call(holder, key, value);\r\n\t}\r\n\r\n\t// What happens next depends on the value's type.\r\n\r\n\tswitch(typeof value) {\r\n\t\tcase \"string\":\r\n\t\t\treturn quote(value);\r\n\t\tcase \"number\":\r\n\t\t\t// JSON numbers must be finite. Encode non-finite numbers as null.\r\n\t\t\treturn(isFinite(value)) ?\r\n\t\t\t\tString(value) :\r\n\t\t\t\t\"null\";\r\n\r\n\t\tcase \"boolean\":\r\n\t\tcase \"null\":\r\n\t\t\t// If the value is a boolean or null, convert it to a string. Note:\r\n\t\t\t// typeof null does not produce \"null\". The case is included here in\r\n\t\t\t// the remote chance that this gets fixed someday.\r\n\t\t\treturn String(value);\r\n\r\n\t\t\t// If the type is \"object\", we might be dealing with an object or an array or\r\n\t\t\t// null.\r\n\t\tcase \"object\":\r\n\t\t\t// Due to a specification blunder in ECMAScript, typeof null is \"object\",\r\n\t\t\t// so watch out for that case.\r\n\t\t\tif(!value) {\r\n\t\t\t\treturn \"null\";\r\n\t\t\t}\r\n\r\n\t\t\t// Make an array to hold the partial results of stringifying this object value.\r\n\r\n\t\t\tgap += indent;\r\n\t\t\tpartial = [];\r\n\t\t\t// Is the value an array?\r\n\t\t\tif(Object.prototype.toString.apply(value) === \"[object Array]\") {\r\n\r\n\t\t\t\t// The value is an array. Stringify every element. Use null as a placeholder\r\n\t\t\t\t// for non-JSON values.\r\n\t\t\t\tlength = value.length;\r\n\t\t\t\tfor(i = 0; i < length; i += 1) {\r\n\t\t\t\t\tpartial[i] = str(i, value) || \"null\";\r\n\t\t\t\t}\r\n\t\t\t\t// Join all of the elements together, separated with commas, and wrap them in\r\n\t\t\t\t// brackets.\r\n\r\n\t\t\t\tv = partial.length === 0 ?\r\n\t\t\t\t\t\"[]\" :\r\n\t\t\t\t\tgap ?\r\n\t\t\t\t\t(\r\n\t\t\t\t\t\t\"[\\n\" +\r\n\t\t\t\t\t\tgap +\r\n\t\t\t\t\t\tpartial.join(\",\\n\" + gap) +\r\n\t\t\t\t\t\t\"\\n\" +\r\n\t\t\t\t\t\tmind +\r\n\t\t\t\t\t\t\"]\"\r\n\t\t\t\t\t) :\r\n\t\t\t\t\t\"[\" + partial.join(\",\") + \"]\";\r\n\t\t\t\tgap = mind;\r\n\t\t\t\treturn v;\r\n\t\t\t}\r\n\r\n\t\t\t// If the replacer is an array, use it to select the members to be stringified.\r\n\t\t\tif(rep && typeof rep === \"object\") {\r\n\t\t\t\tlength = rep.length;\r\n\t\t\t\tfor(i = 0; i < length; i += 1) {\r\n\t\t\t\t\tif(typeof rep[i] === \"string\") {\r\n\t\t\t\t\t\tk = rep[i];\r\n\t\t\t\t\t\tv = str(k, value);\r\n\t\t\t\t\t\tif(v) {\r\n\t\t\t\t\t\t\tpartial.push(quote(k) + (\r\n\t\t\t\t\t\t\t\t(gap) ?\r\n\t\t\t\t\t\t\t\t\": \" : \":\"\r\n\t\t\t\t\t\t\t) + v);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\t// Otherwise, iterate through all of the keys in the object.\r\n\t\t\t\tfor(k in value) {\r\n\t\t\t\t\tif(Object.prototype.hasOwnProperty.call(value, k)) {\r\n\t\t\t\t\t\tv = str(k, value);\r\n\t\t\t\t\t\tif(v) {\r\n\t\t\t\t\t\t\tpartial.push(quote(k) + (\r\n\t\t\t\t\t\t\t\t(gap) ?\r\n\t\t\t\t\t\t\t\t\": \" :\r\n\t\t\t\t\t\t\t\t\":\"\r\n\t\t\t\t\t\t\t) + v);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Join all of the member texts together, separated with commas,\r\n\t\t\t// and wrap them in braces.\r\n\r\n\t\t\tv = partial.length === 0 ?\r\n\t\t\t\t\"{}\" : gap ?\r\n\t\t\t\t\"{\\n\" + gap + partial.join(\",\\n\" + gap) + \"\\n\" + mind + \"}\" :\r\n\t\t\t\t\"{\" + partial.join(\",\") + \"}\";\r\n\t\t\tgap = mind;\r\n\t\t\treturn v;\r\n\t}\r\n}\r\n\r\n// If the JSON object does not yet have a stringify method, give it one.\r\nif(typeof JSON.stringify !== \"function\") {\r\n\tmeta = { // table of character substitutions\r\n\t\t\"\\b\": \"\\\\b\",\r\n\t\t\"\\t\": \"\\\\t\",\r\n\t\t\"\\n\": \"\\\\n\",\r\n\t\t\"\\f\": \"\\\\f\",\r\n\t\t\"\\r\": \"\\\\r\",\r\n\t\t\"\\\"\": \"\\\\\\\"\",\r\n\t\t\"\\\\\": \"\\\\\\\\\"\r\n\t};\r\n\tJSON.stringify = function(value, replacer, space) {\r\n\r\n\t\t// The stringify method takes a value and an optional replacer, and an optional\r\n\t\t// space parameter, and returns a JSON text. The replacer can be a function\r\n\t\t// that can replace values, or an array of strings that will select the keys.\r\n\t\t// A default replacer method can be provided. Use of the space parameter can\r\n\t\t// produce text that is more easily readable.\r\n\r\n\t\tlet i;\r\n\t\tgap = \"\";\r\n\t\tindent = \"\";\r\n\t\t// If the space parameter is a number, make an indent string containing that\r\n\t\t// many spaces.\r\n\t\tif(typeof space === \"number\") {\r\n\t\t\tfor(i = 0; i < space; i += 1) {\r\n\t\t\t\tindent += \" \";\r\n\t\t\t}\r\n\r\n\t\t\t// If the space parameter is a string, it will be used as the indent string.\r\n\r\n\t\t} else if(typeof space === \"string\") {\r\n\t\t\tindent = space;\r\n\t\t}\r\n\r\n\t\t// If there is a replacer, it must be a function or an array.\r\n\t\t// Otherwise, throw an error.\r\n\r\n\t\trep = replacer;\r\n\t\tif(replacer && typeof replacer !== \"function\" && (\r\n\t\t\t\ttypeof replacer !== \"object\" ||\r\n\t\t\t\ttypeof replacer.length !== \"number\"\r\n\t\t\t)) {\r\n\t\t\tthrow new Error(\"JSON.stringify\");\r\n\t\t}\r\n\r\n\t\t// Make a fake root object containing our value under the key of \"\".\r\n\t\t// Return the result of stringifying the value.\r\n\r\n\t\treturn str(\"\", {\r\n\t\t\t\"\": value\r\n\t\t});\r\n\t};\r\n}\r\n\r\n// If the JSON object does not yet have a parse method, give it one.\r\n\r\nif(typeof JSON.parse !== \"function\") {\r\n\tJSON.parse = function(text, reviver) {\r\n\t\t// The parse method takes a text and an optional reviver function, and returns\r\n\t\t// a JavaScript value if the text is a valid JSON text.\r\n\t\tlet j;\r\n\r\n\t\tfunction walk(holder, key) {\r\n\t\t\t// The walk method is used to recursively walk the resulting structure so\r\n\t\t\t// that modifications can be made.\r\n\t\t\tlet k;\r\n\t\t\tlet v;\r\n\t\t\tlet value = holder[key];\r\n\t\t\tif(value && typeof value === \"object\") {\r\n\t\t\t\tfor(k in value) {\r\n\t\t\t\t\tif(Object.prototype.hasOwnProperty.call(value, k)) {\r\n\t\t\t\t\t\tv = walk(value, k);\r\n\t\t\t\t\t\tif(v !== undefined) {\r\n\t\t\t\t\t\t\tvalue[k] = v;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tdelete value[k];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn reviver.call(holder, key, value);\r\n\t\t}\r\n\r\n\t\t// Parsing happens in four stages. In the first stage, we replace certain\r\n\t\t// Unicode characters with escape sequences. JavaScript handles many characters\r\n\t\t// incorrectly, either silently deleting them, or treating them as line endings.\r\n\t\ttext = String(text);\r\n\t\trx_dangerous.lastIndex = 0;\r\n\t\tif(rx_dangerous.test(text)) {\r\n\t\t\ttext = text.replace(rx_dangerous, function(a) {\r\n\t\t\t\treturn(\r\n\t\t\t\t\t\"\\\\u\" +\r\n\t\t\t\t\t(\"0000\" + a.charCodeAt(0).toString(16)).slice(-4)\r\n\t\t\t\t);\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// In the second stage, we run the text against regular expressions that look\r\n\t\t// for non-JSON patterns. We are especially concerned with \"()\" and \"new\"\r\n\t\t// because they can cause invocation, and \"=\" because it can cause mutation.\r\n\t\t// But just to be safe, we want to reject all unexpected forms.\r\n\r\n\t\t// We split the second stage into 4 regexp operations in order to work around\r\n\t\t// crippling inefficiencies in IE's and Safari's regexp engines. First we\r\n\t\t// replace the JSON backslash pairs with \"@\" (a non-JSON character). Second, we\r\n\t\t// replace all simple value tokens with \"]\" characters. Third, we delete all\r\n\t\t// open brackets that follow a colon or comma or that begin the text. Finally,\r\n\t\t// we look to see that the remaining characters are only whitespace or \"]\" or\r\n\t\t// \",\" or \":\" or \"{\" or \"}\". If that is so, then the text is safe for eval.\r\n\r\n\t\tif(\r\n\t\t\trx_one.test(\r\n\t\t\t\ttext\r\n\t\t\t\t.replace(rx_two, \"@\")\r\n\t\t\t\t.replace(rx_three, \"]\")\r\n\t\t\t\t.replace(rx_four, \"\")\r\n\t\t\t)\r\n\t\t) {\r\n\r\n\t\t\t// In the third stage we use the eval function to compile the text into a\r\n\t\t\t// JavaScript structure. The \"{\" operator is subject to a syntactic ambiguity\r\n\t\t\t// in JavaScript: it can begin a block or an object literal. We wrap the text\r\n\t\t\t// in parens to eliminate the ambiguity.\r\n\t\t\tj = eval(\"(\" + text + \")\");\r\n\t\t\t// In the optional fourth stage, we recursively walk the new structure, passing\r\n\t\t\t// each name/value pair to a reviver function for possible transformation.\r\n\r\n\t\t\treturn(typeof reviver === \"function\") ?\r\n\t\t\t\twalk({\r\n\t\t\t\t\t\"\": j\r\n\t\t\t\t}, \"\") : j;\r\n\t\t}\r\n\t\t// If the text is not JSON parseable, then a SyntaxError is thrown.\r\n\t\tthrow new SyntaxError(\"JSON.parse\");\r\n\t};\r\n}","let g;\r\nif(typeof window !== undefined) {\r\n\tg = window;\r\n} else if(typeof self !== undefined) {\r\n\tg = self;\r\n} else if(typeof global !== undefined) {\r\n\tg = global;\r\n} else {\r\n\tthrow new Error(\"not found global var!\");\r\n}\r\n\r\n/**\r\n * 用于包装变量，防止JSON.stringify等时输出指定变量。\r\n * @param {Object} val\r\n */\r\nfunction InVar(val) {\r\n\tthis.get = function() {\r\n\t\treturn val;\r\n\t};\r\n\r\n\tthis.set = function(newVal) {\r\n\t\tlet old = val;\r\n\t\tval = newVal;\r\n\t\treturn old;\r\n\t};\r\n}\r\ng.InVar = InVar;\r\n\r\nexport default g;","import global from '../util/global.js';\r\nlet loaderFun;\r\nlet xsloader = global.xsloader = function() {\r\n\treturn loaderFun.apply(this, arguments);\r\n};\r\n\r\nexport default {\r\n\tloaderFun: (fun) => {\r\n\t\tloaderFun = fun;\r\n\t}\r\n};","const ABSOLUTE_PROTOCOL_REG = /^(([a-zA-Z0-9_]*:\\/\\/)|(\\/)|(\\/\\/))/;\r\nconst ABSOLUTE_PROTOCOL_REG2 = /^([a-zA-Z0-9_]+:)\\/\\/([^/\\s]+)/;\r\nconst defaultJsExts = [\".js\", \".js+\", \".js++\", \".es\", \"es6\", \".jsx\", \".vue\"];\r\n\r\nimport global from './global.js';\r\nconst xsloader = global.xsloader;\r\n\r\nfunction isJsFile(path) {\r\n\tif(!xsloader.isString(path) || path.indexOf(\".\") == -1) {\r\n\t\treturn false;\r\n\t}\r\n\tvar pluginIndex = path.indexOf(\"!\");\r\n\tif(pluginIndex > 0) {\r\n\t\tpath = path.substring(0, pluginIndex);\r\n\t}\r\n\tvar index = path.indexOf(\"?\");\r\n\tif(index > 0) {\r\n\t\tpath = path.substring(0, index);\r\n\t}\r\n\tindex = path.indexOf(\"#\");\r\n\tif(index > 0) {\r\n\t\tpath = path.substring(0, index);\r\n\t}\r\n\tlet theConfig = xsloader.config();\r\n\r\n\tvar jsExts = theConfig && theConfig.jsExts || defaultJsExts;\r\n\tfor(var i = 0; i < jsExts.length; i++) {\r\n\t\tif(xsloader.endsWith(path, jsExts[i])) {\r\n\t\t\treturn {\r\n\t\t\t\text: jsExts[i],\r\n\t\t\t\tpath: path\r\n\t\t\t};\r\n\t\t}\r\n\t}\r\n\treturn false;\r\n}\r\n\r\nfunction dealPathMayAbsolute(path, currentUrl) {\r\n\tcurrentUrl = currentUrl || location.href;\r\n\tlet rs = ABSOLUTE_PROTOCOL_REG.exec(path);\r\n\r\n\tlet finalPath;\r\n\tlet absolute;\r\n\tif(rs) {\r\n\t\tlet protocol = rs[1];\r\n\t\tabsolute = true;\r\n\r\n\t\trs = ABSOLUTE_PROTOCOL_REG2.exec(currentUrl);\r\n\t\tlet _protocol = rs && rs[1] || location.protocol;\r\n\t\tlet _host = rs && rs[2] || location.host;\r\n\r\n\t\tif(protocol == \"//\") {\r\n\t\t\tfinalPath = _protocol + \"//\" + path;\r\n\t\t} else if(protocol == \"/\") {\r\n\t\t\tfinalPath = _protocol + \"//\" + _host + path;\r\n\t\t} else {\r\n\t\t\tfinalPath = path;\r\n\t\t}\r\n\r\n\t} else {\r\n\t\tabsolute = false;\r\n\t\tfinalPath = path;\r\n\t}\r\n\treturn {\r\n\t\tabsolute: absolute,\r\n\t\tpath: finalPath\r\n\t};\r\n}\r\n\r\nfunction getPathWithRelative(path, relative, isPathDir) {\r\n\r\n\tlet relativeQuery = \"\";\r\n\tlet qIndex = path.lastIndexOf(\"?\");\r\n\tif(qIndex >= 0) {\r\n\t\tpath = path.substring(0, qIndex);\r\n\t} else {\r\n\t\tqIndex = path.lastIndexOf(\"#\");\r\n\t\tif(qIndex >= 0) {\r\n\t\t\tpath = path.substring(0, qIndex);\r\n\t\t}\r\n\t}\r\n\r\n\tqIndex = relative.lastIndexOf(\"?\");\r\n\tif(qIndex >= 0) {\r\n\t\trelativeQuery = relative.substring(qIndex);\r\n\t\trelative = relative.substring(0, qIndex);\r\n\t} else {\r\n\t\tqIndex = relative.lastIndexOf(\"#\");\r\n\t\tif(qIndex >= 0) {\r\n\t\t\trelativeQuery = relative.substring(qIndex);\r\n\t\t\trelative = relative.substring(0, qIndex);\r\n\t\t}\r\n\t}\r\n\r\n\tlet absolute = dealPathMayAbsolute(relative);\r\n\tif(absolute.absolute) {\r\n\t\treturn absolute.path + relativeQuery;\r\n\t}\r\n\r\n\tif(isPathDir === undefined) {\r\n\t\tlet index = path.lastIndexOf(\"/\");\r\n\t\tif(index == path.length - 1) {\r\n\t\t\tisPathDir = true;\r\n\t\t} else {\r\n\t\t\tif(index == -1) {\r\n\t\t\t\tindex = 0;\r\n\t\t\t} else {\r\n\t\t\t\tindex++;\r\n\t\t\t}\r\n\t\t\tisPathDir = path.indexOf(\".\", index) == -1;\r\n\t\t}\r\n\t}\r\n\r\n\tif(xsloader.endsWith(path, \"/\")) {\r\n\t\tpath = path.substring(0, path.length - 1);\r\n\t}\r\n\r\n\tlet isRelativeDir = false;\r\n\tif(relative == \".\" || xsloader.endsWith(relative, \"/\")) {\r\n\t\trelative = relative.substring(0, relative.length - 1);\r\n\t\tisRelativeDir = true;\r\n\t} else if(relative == \".\" || relative == \"..\" || xsloader.endsWith(\"/.\") || xsloader.endsWith(\"/..\")) {\r\n\t\tisRelativeDir = true;\r\n\t}\r\n\r\n\tlet prefix = \"\";\r\n\tlet index = -1;\r\n\tlet absolute2 = dealPathMayAbsolute(path);\r\n\tif(absolute2.absolute) {\r\n\t\tpath = absolute2.path;\r\n\t\tlet index2 = path.indexOf(\"//\");\r\n\t\tindex = path.indexOf(\"/\", index2 + 2);\r\n\t\tif(index == -1) {\r\n\t\t\tindex = path.length;\r\n\t\t}\r\n\t}\r\n\r\n\tprefix = path.substring(0, index + 1);\r\n\tpath = path.substring(index + 1);\r\n\r\n\tlet stack = path.split(\"/\");\r\n\tif(!isPathDir && stack.length > 0) {\r\n\t\tstack.pop();\r\n\t}\r\n\tlet relatives = relative.split(\"/\");\r\n\tfor(let i = 0; i < relatives.length; i++) {\r\n\t\tlet str = relatives[i];\r\n\t\tif(\"..\" == str) {\r\n\t\t\tif(stack.length == 0) {\r\n\t\t\t\t\r\n\t\t\t\tthrow new Error(\"no more upper path:path=\"+arguments[0]+\",relative=\"+arguments[1]);\r\n\t\t\t}\r\n\t\t\tstack.pop();\r\n\t\t} else if(\".\" != str) {\r\n\t\t\tstack.push(str);\r\n\t\t}\r\n\t}\r\n\tif(stack.length == 0) {\r\n\t\treturn \"\";\r\n\t}\r\n\tlet result = prefix + stack.join(\"/\");\r\n\tif(isRelativeDir && !xsloader.endsWith(result, \"/\")) {\r\n\t\tresult += \"/\";\r\n\t}\r\n\tresult = xsloader.appendArgs2Url(result, relativeQuery);\r\n\treturn result;\r\n}\r\n\r\nfunction getNodeAbsolutePath(node) {\r\n\tlet src = node.src || node.getAttribute(\"src\");\r\n\treturn getPathWithRelative(location.href, src);\r\n}\r\n\r\n//去掉url的query参数和#参数\r\nfunction removeQueryHash(url) {\r\n\tif(url) {\r\n\t\tlet index = url.indexOf(\"?\");\r\n\t\tif(index >= 0) {\r\n\t\t\turl = url.substring(0, index);\r\n\t\t}\r\n\r\n\t\tindex = url.indexOf(\"#\");\r\n\t\tif(index >= 0) {\r\n\t\t\turl = url.substring(0, index);\r\n\t\t}\r\n\t}\r\n\treturn url;\r\n}\r\n\r\nconst REPLACE_STRING_PROPERTIES_EXP = new RegExp(\"\\\\$\\\\{([^\\\\{]+)\\\\}\");\r\nconst ALL_TYPE_PROPERTIES_EXP = new RegExp(\"^\\\\$\\\\[([^\\\\[\\\\]]+)\\\\]$\");\r\n\r\nfunction propertiesDeal(configObject, properties) {\r\n\tif(!properties) {\r\n\t\treturn configObject;\r\n\t}\r\n\r\n\tfunction replaceStringProperties(string, properties, property) {\r\n\t\tlet rs;\r\n\t\tlet str = string;\r\n\t\trs = ALL_TYPE_PROPERTIES_EXP.exec(str);\r\n\t\tif(rs) {\r\n\t\t\tlet propKey = rs[1];\r\n\t\t\tlet propValue = xsloader.getObjectAttr(properties, propKey);\r\n\t\t\tif(propValue === undefined) {\r\n\t\t\t\treturn str;\r\n\t\t\t} else {\r\n\t\t\t\treturn propValue;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlet result = \"\";\r\n\t\twhile(true) {\r\n\t\t\trs = REPLACE_STRING_PROPERTIES_EXP.exec(str);\r\n\t\t\tif(!rs) {\r\n\t\t\t\tresult += str;\r\n\t\t\t\tbreak;\r\n\t\t\t} else {\r\n\t\t\t\tlet propKey = rs[1];\r\n\t\t\t\tif(property !== undefined && property.propertyKey == propKey) {\r\n\t\t\t\t\tthrow new Error(\"replace property error:propertyKey=\" + propKey);\r\n\t\t\t\t} else if(property) {\r\n\t\t\t\t\tproperty.has = true;\r\n\t\t\t\t}\r\n\t\t\t\tresult += str.substring(0, rs.index);\r\n\t\t\t\tresult += xsloader.getObjectAttr(properties, propKey);\r\n\t\t\t\tstr = str.substring(rs.index + rs[0].length);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n\r\n\t//处理属性引用\r\n\tfunction replaceProperties(obj, property, enableKeyAttr) {\r\n\t\tif(!obj) {\r\n\t\t\treturn obj;\r\n\t\t}\r\n\t\tif(xsloader.isFunction(obj)) {\r\n\t\t\treturn obj;\r\n\t\t} else if(xsloader.isArray(obj)) {\r\n\t\t\tfor(let i = 0; i < obj.length; i++) {\r\n\t\t\t\tobj[i] = replaceProperties(obj[i], property, enableKeyAttr);\r\n\t\t\t}\r\n\t\t} else if(xsloader.isString(obj)) {\r\n\t\t\tobj = replaceStringProperties(obj, properties, property);\r\n\t\t} else if(xsloader.isObject(obj)) {\r\n\t\t\tif(property) {\r\n\t\t\t\tproperty.has = false;\r\n\t\t\t}\r\n\t\t\tlet replaceKeyMap = {};\r\n\t\t\tfor(let x in obj) {\r\n\t\t\t\tif(property) {\r\n\t\t\t\t\tproperty.propertyKey = x;\r\n\t\t\t\t}\r\n\t\t\t\tobj[x] = replaceProperties(obj[x], property, enableKeyAttr);\r\n\t\t\t\tif(enableKeyAttr) {\r\n\t\t\t\t\tlet _x = replaceStringProperties(x, properties, property);\r\n\t\t\t\t\tif(_x !== x) {\r\n\t\t\t\t\t\treplaceKeyMap[x] = _x;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tfor(let x in replaceKeyMap) {\r\n\t\t\t\tlet objx = obj[x];\r\n\t\t\t\tdelete obj[x];\r\n\t\t\t\tobj[replaceKeyMap[x]] = objx;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn obj;\r\n\r\n\t}\r\n\r\n\tif(!properties.__dealt__) {\r\n\t\tlet property = {\r\n\t\t\thas: false\r\n\t\t};\r\n\r\n\t\tfor(let x in properties) {\r\n\t\t\tlet fun = properties[x];\r\n\t\t\tif(xsloader.isFunction(fun)) {\r\n\t\t\t\tproperties[x] = fun.call(properties);\r\n\t\t\t}\r\n\t\t}\r\n\t\tdo {\r\n\t\t\treplaceProperties(properties, property);\r\n\t\t} while (property.has);\r\n\t\tproperties.__dealt__ = true;\r\n\t}\r\n\r\n\treturn replaceProperties(configObject, undefined, true);\r\n}\r\n\r\nfunction replaceModulePrefix(config, deps) {\r\n\r\n\tif(!deps||deps.length==0) {\r\n\t\treturn;\r\n\t}\r\n\r\n\tfor(let i = 0; i < deps.length; i++) {\r\n\t\tlet m = deps[i];\r\n\t\tif(typeof m == \"string\") {\r\n\t\t\tlet index = m.indexOf(\"!\");\r\n\t\t\tlet pluginParam = index > 0 ? m.substring(index) : \"\";\r\n\t\t\tm = index > 0 ? m.substring(0, index) : m;\r\n\r\n\t\t\tindex = m.indexOf(\"?\");\r\n\t\t\tlet query = index > 0 ? m.substring(index) : \"\";\r\n\t\t\tm = index > 0 ? m.substring(0, index) : m;\r\n\r\n\t\t\tlet is = isJsFile(m);\r\n\t\t\tif(!is && !/\\.[^\\/\\s]*$/.test(m) && (xsloader.startsWith(m, \".\") || dealPathMayAbsolute(m).absolute)) {\r\n\t\t\t\tdeps[i] = m + \".js\" + query + pluginParam;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tif(config.modulePrefixCount) {\r\n\t\t//模块地址的前缀替换\r\n\t\tfor(let prefix in config.modulePrefix) {\r\n\t\t\tlet replaceStr = config.modulePrefix[prefix].replace;\r\n\t\t\tlet len = prefix.length;\r\n\t\t\tfor(let i = 0; i < deps.length; i++) {\r\n\t\t\t\tlet m = deps[i];\r\n\t\t\t\tif(typeof m == \"string\") {\r\n\t\t\t\t\tlet pluginIndex = m.indexOf(\"!\");\r\n\t\t\t\t\tlet pluginName = null;\r\n\t\t\t\t\tif(pluginIndex >= 0) {\r\n\t\t\t\t\t\tpluginName = m.substring(0, pluginIndex + 1);\r\n\t\t\t\t\t\tm = m.substring(pluginIndex + 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(xsloader.startsWith(m, prefix)) {\r\n\t\t\t\t\t\tlet dep = replaceStr + m.substring(len);\r\n\t\t\t\t\t\tdeps[i] = pluginName ? pluginName + dep : dep;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction getScriptBySubname(subname) {\r\n\tlet ss = document.getElementsByTagName('script');\r\n\tif(subname) {\r\n\t\tfor(let i = 0; i < ss.length; i++) {\r\n\t\t\tlet script = ss[i];\r\n\t\t\tlet src = script.src;\r\n\t\t\tsrc = src.substring(src.lastIndexOf(\"/\"));\r\n\t\t\tif(src.indexOf(subname) >= 0) {\r\n\t\t\t\treturn script;\r\n\t\t\t}\r\n\t\t}\r\n\t} else {\r\n\t\treturn ss;\r\n\t}\r\n}\r\n\r\nconst thePageUrl = (function() {\r\n\tlet url = location.href;\r\n\turl = removeQueryHash(url);\r\n\treturn url;\r\n})();\r\n\r\nexport default {\r\n\tgetPathWithRelative,\r\n\tgetNodeAbsolutePath,\r\n\tdealPathMayAbsolute,\r\n\tremoveQueryHash,\r\n\tpropertiesDeal,\r\n\treplaceModulePrefix,\r\n\tisJsFile,\r\n\tgetScriptBySubname,\r\n\tthePageUrl,\r\n};","import global from './global.js';\r\nconst xsloader = global.xsloader;\r\nconst commentRegExp = /\\/\\*[\\s\\S]*?\\*\\/|([^:\"'=]|^)\\/\\/.*$/mg;\r\nconst cjsRequireRegExp = /[^.]require\\s*\\(\\s*[\"']([^'\"\\r\\n]+)[\"']\\s*\\)/g;\r\n\r\n//基于有向图进行循环依赖检测\r\nfunction GraphPath() {\r\n\tlet pathEdges = {};\r\n\tlet vertexMap = {};\r\n\tlet depMap = {};\r\n\tthis.addEdge = function(begin, end) {\r\n\t\tdepMap[begin + \"|\" + end] = true;\r\n\t\tif(!pathEdges[begin]) {\r\n\t\t\tpathEdges[begin] = [];\r\n\t\t}\r\n\t\tif(!vertexMap[begin]) {\r\n\t\t\tvertexMap[begin] = true;\r\n\t\t}\r\n\t\tif(!vertexMap[end]) {\r\n\t\t\tvertexMap[end] = true;\r\n\t\t}\r\n\t\tpathEdges[begin].push({\r\n\t\t\tbegin: begin,\r\n\t\t\tend: end\r\n\t\t});\r\n\t};\r\n\r\n\tthis.hasDep = function(name, dep) {\r\n\t\treturn depMap[name + \"|\" + dep];\r\n\t};\r\n\r\n\tthis.tryAddEdge = function(begin, end) {\r\n\t\tthis.addEdge(begin, end);\r\n\t\tlet paths = this.hasLoop();\r\n\t\tif(paths.length > 0) {\r\n\t\t\tpathEdges[begin].pop();\r\n\t\t}\r\n\t\treturn paths;\r\n\t};\r\n\r\n\tthis.hasLoop = function() {\r\n\t\tlet visited = {};\r\n\t\tlet recursionStack = {};\r\n\r\n\t\tfor(let x in vertexMap) {\r\n\t\t\tvisited[x] = false;\r\n\t\t\trecursionStack[x] = false;\r\n\t\t}\r\n\r\n\t\tlet has = false;\r\n\t\tlet paths = [];\r\n\t\tfor(let name in vertexMap) {\r\n\t\t\tpaths = [];\r\n\t\t\tif(checkLoop(name, visited, recursionStack, paths)) {\r\n\t\t\t\thas = true;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn has ? paths : [];\r\n\t};\r\n\r\n\tfunction checkLoop(v, visited, recursionStack, paths) {\r\n\t\tif(!visited[v]) {\r\n\t\t\tvisited[v] = true;\r\n\t\t\trecursionStack[v] = true;\r\n\t\t\tpaths.push(v);\r\n\r\n\t\t\tif(pathEdges[v]) {\r\n\t\t\t\tlet edges = pathEdges[v];\r\n\t\t\t\tfor(let i = 0; i < edges.length; i++) {\r\n\t\t\t\t\tlet edge = edges[i];\r\n\t\t\t\t\tif(!visited[edge.end] && checkLoop(edge.end, visited, recursionStack, paths)) {\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t} else if(recursionStack[edge.end]) {\r\n\t\t\t\t\t\tpaths.push(edge.end);\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\trecursionStack[v] = false;\r\n\t\treturn false;\r\n\t}\r\n}\r\n\r\n//使得内部的字符串变成数组\r\nfunction strValue2Arr(obj) {\r\n\tif(!obj || xsloader.isArray(obj)) {\r\n\t\treturn;\r\n\t}\r\n\tfor(let x in obj) {\r\n\t\tif(xsloader.isString(obj[x])) {\r\n\t\t\tobj[x] = [obj[x]];\r\n\t\t}\r\n\t}\r\n}\r\n\r\n/**\r\n * 同步模式下，返回false表示终止循环。\r\n * @param {Object} ary\r\n * @param {Object} func\r\n * @param {Object} isSync\r\n * @param {Object} fromEnd\r\n */\r\nfunction each(ary, func, isSync, fromEnd) {\r\n\tif(ary) {\r\n\t\tif(isSync) {\r\n\t\t\tfunction fun(index) {\r\n\t\t\t\tif(fromEnd ? index < 0 : index >= ary.length) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tlet handle = function(rs) {\r\n\t\t\t\t\tif(rs) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfun(fromEnd ? index - 1 : index + 1);\r\n\t\t\t\t};\r\n\t\t\t\tfunc(ary[index], index, ary, handle);\r\n\t\t\t}\r\n\t\t\tfun(fromEnd ? ary.length - 1 : 0);\r\n\t\t} else {\r\n\t\t\tif(fromEnd) {\r\n\t\t\t\tfor(let i = ary.length - 1; i >= 0; i--) {\r\n\t\t\t\t\tif(func(ary[i], i, ary) === false) {\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tfor(let i = 0; i < ary.length; i++) {\r\n\t\t\t\t\tif(func(ary[i], i, ary) === false) {\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t}\r\n}\r\n\r\nfunction __commentReplace(match, singlePrefix) {\r\n\treturn singlePrefix || '';\r\n}\r\n//添加内部直接require('...')的模块\r\nfunction appendInnerDeps(deps, callback) {\r\n\tif(xsloader.isFunction(callback)) {\r\n\t\tcallback\r\n\t\t\t.toString()\r\n\t\t\t.replace(commentRegExp, __commentReplace)\r\n\t\t\t.replace(cjsRequireRegExp, function(match, dep) {\r\n\t\t\t\tif(xsloader.indexInArray(deps, dep) == -1) {\r\n\t\t\t\t\tdeps.push(dep);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t}\r\n}\r\n\r\nlet idCount = 2019;\r\n\r\nfunction getAndIncIdCount() {\r\n\treturn idCount++;\r\n}\r\n\r\nclass PluginError {\r\n\tconstructor(err, invoker) {\r\n\t\tif(err instanceof PluginError) {\r\n\t\t\tthis.err = err.err;\r\n\t\t\tthis.invoker = err.invoker;\r\n\t\t} else {\r\n\t\t\tthis.err = err;\r\n\t\t\tthis.invoker = invoker;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nlet isXsLoaderEnd = false;\r\nconst IE_VERSION = (function getIEVersion() {\r\n\tlet userAgent = navigator.userAgent; //取得浏览器的userAgent字符串  \r\n\tlet isIE = userAgent.indexOf(\"compatible\") > -1 && userAgent.indexOf(\"MSIE\") > -1; //判断是否IE<11浏览器  \r\n\tlet isEdge = userAgent.indexOf(\"Edge\") > -1 && !isIE; //判断是否IE的Edge浏览器  \r\n\tlet isIE11 = userAgent.indexOf('Trident') > -1 && userAgent.indexOf(\"rv:11.0\") > -1;\r\n\tif(isIE) {\r\n\t\tlet reIE = new RegExp(\"MSIE[\\\\s]+([0-9.]+);\").exec(userAgent);\r\n\t\tlet fIEVersion = parseInt(reIE && reIE[1] || -1);\r\n\t\treturn fIEVersion == -1 ? -1 : fIEVersion;\r\n\t} else if(isEdge) {\r\n\t\treturn 'edge'; //edge\r\n\t} else if(isIE11) {\r\n\t\treturn 11; //IE11  \r\n\t} else {\r\n\t\treturn -1; //不是ie浏览器\r\n\t}\r\n})();\r\n\r\nexport default {\r\n\tgraphPath: new GraphPath(),\r\n\tstrValue2Arr,\r\n\teach,\r\n\tappendInnerDeps,\r\n\tgetAndIncIdCount,\r\n\tPluginError,\r\n\tloaderEnd() {\r\n\t\tisXsLoaderEnd = true;\r\n\t},\r\n\tisLoaderEnd() {\r\n\t\treturn isXsLoaderEnd;\r\n\t},\r\n\tIE_VERSION,\r\n};","//顶部加载条功能\r\n/*\r\n ** ToProgress v0.1.1\r\n ** http://github.com/djyde/ToProgress\r\n */\r\n\r\n// Animation Detection\r\nfunction whichTransitionEvent() {\r\n\tlet t,\r\n\t\tel = document.createElement(\"fakeelement\");\r\n\r\n\tlet transitions = {\r\n\t\t\"transition\": \"transitionend\",\r\n\t\t\"OTransition\": \"oTransitionEnd\",\r\n\t\t\"MozTransition\": \"transitionend\",\r\n\t\t\"WebkitTransition\": \"webkitTransitionEnd\"\r\n\t};\r\n\r\n\tfor(t in transitions) {\r\n\t\tif(el.style[t] !== undefined) {\r\n\t\t\treturn transitions[t];\r\n\t\t}\r\n\t}\r\n}\r\n\r\nlet transitionEvent = whichTransitionEvent();\r\n\r\nconst ToProgress = function(opt) {\r\n\t// Attributes\r\n\tthis.progress = 0;\r\n\tthis.options = {\r\n\t\tid: 'xsloader-top-progress-bar',\r\n\t\tcolor: '#F44336',\r\n\t\tbgColor:undefined,\r\n\t\theight: 2,\r\n\t\tduration: 0.2\r\n\t};\r\n\tif(opt && typeof opt === 'object') {\r\n\t\tfor(let key in opt) {\r\n\t\t\tthis.options[key] = opt[key];\r\n\t\t}\r\n\t}\r\n\tthis.options.opacityDuration = 0; //this.options.duration * 3;\r\n\tthis.progressBar = document.createElement('div');\r\n\tthis.container = document.createElement('div');\r\n\tthis.container.setCSS = function(style) {\r\n\t\tfor(let property in style) {\r\n\t\t\tthis.style[property] = style[property];\r\n\t\t}\r\n\t};\r\n\tthis.container.id = this.options.id;\r\n\r\n\tthis.progressBar.setCSS = function(style) {\r\n\t\tfor(let property in style) {\r\n\t\t\tthis.style[property] = style[property];\r\n\t\t}\r\n\t};\r\n\r\n\tthis.container.setCSS({\r\n\t\t\"position\": \"fixed\",\r\n\t\t\"padding\": \"0\",\r\n\t\t\"margin\": \"0\",\r\n\t\t\"top\": \"0\",\r\n\t\t\"left\": \"0\",\r\n\t\t\"right\": \"0\",\r\n\t\t\"height\": (this.options.height + 1) + \"px\",\r\n\t\t\"width\": \"100%\",\r\n\t\t\"opacity\": \"1\",\r\n\t\t'z-index': '9999999999',\r\n\t\t'background-color': this.options.bgColor,\r\n\t});\r\n\r\n\tthis.progressBar.setCSS({\r\n\t\t\"position\": \"absolute\",\r\n\t\t\"padding\": \"0\",\r\n\t\t\"margin\": \"0\",\r\n\t\t\"top\": \"0\",\r\n\t\t\"left\": \"0\",\r\n\t\t\"right\": \"0\",\r\n\t\t\"background-color\": this.options.color,\r\n\t\t\"height\": this.options.height + \"px\",\r\n\t\t\"width\": \"0%\",\r\n\t\t\"transition\": \"width \" + this.options.duration + \"s\" + \", opacity \" + this.options.opacityDuration + \"s\",\r\n\t\t\"-moz-transition\": \"width \" + this.options.duration + \"s\" + \", opacity \" + this.options.opacityDuration + \"s\",\r\n\t\t\"-webkit-transition\": \"width \" + this.options.duration + \"s\" + \", opacity \" + this.options.opacityDuration + \"s\"\r\n\t});\r\n\tthis.container.appendChild(this.progressBar);\r\n\tdocument.body.appendChild(this.container);\r\n};\r\n\r\n////////////////////////////////////\r\nToProgress.prototype.setColor = function(color) {\r\n\tthis.progressBar.style.backgroundColor = color;\r\n};\r\n\r\nToProgress.prototype._isAuto = false;\r\nToProgress.prototype._timer = null;\r\n\r\nToProgress.prototype.stopAuto = function() {\r\n\tthis._isAuto = false;\r\n\tif(this._timer) {\r\n\t\tclearInterval(this._timer);\r\n\t\tthis._timer = null;\r\n\t}\r\n};\r\n\r\nToProgress.prototype.autoIncrement = function(time = 100) {\r\n\tthis.stopAuto();\r\n\tthis._isAuto = true;\r\n\tlet dt = time < 100 ? 100 : time;\r\n\r\n\tlet k = 100; //\r\n\tlet step = 0.05;\r\n\tlet x = 1 - step / 2;\r\n\tthis._timer = setInterval(() => {\r\n\t\tx += step;\r\n\t\tthis.setProgress(100 - k / x);\r\n\t}, dt);\r\n};\r\n\r\nToProgress.prototype.toError = function(errColor) {\r\n\tthis.setProgress(this.progress < 60 ? 60 : this.progress);\r\n\tthis.setColor(errColor);\r\n\tthis.stopAuto();\r\n};\r\n\r\n///////////////////////////////////\r\n\r\nToProgress.prototype.transit = function() {\r\n\tthis.progressBar.style.width = this.progress + '%';\r\n};\r\n\r\nToProgress.prototype.getProgress = function() {\r\n\treturn this.progress;\r\n};\r\n\r\nToProgress.prototype.setProgress = function(progress, callback) {\r\n\tthis.show();\r\n\tif(progress > 100) {\r\n\t\tthis.progress = 100;\r\n\t} else if(progress < 0) {\r\n\t\tthis.progress = 0;\r\n\t} else {\r\n\t\tthis.progress = progress;\r\n\t}\r\n\tthis.transit();\r\n\tcallback && callback();\r\n};\r\n\r\nToProgress.prototype.increase = function(toBeIncreasedProgress, callback) {\r\n\tthis.show();\r\n\tthis.setProgress(this.progress + toBeIncreasedProgress, callback);\r\n};\r\n\r\nToProgress.prototype.decrease = function(toBeDecreasedProgress, callback) {\r\n\tthis.show();\r\n\tthis.setProgress(this.progress - toBeDecreasedProgress, callback);\r\n};\r\n\r\nToProgress.prototype.finish = function(callback) {\r\n\tthis.setProgress(100, callback);\r\n\tsetTimeout(() => {\r\n\t\tthis.hide();\r\n//\t\tlet fun;\r\n//\t\tfun = (e) => {\r\n//\t\t\tthis.reset();\r\n//\t\t\tthis.progressBar.removeEventListener(e.type, fun);\r\n//\t\t\tthis.container.parentNode.removeChild(this.container);\r\n//\t\t};\r\n//\t\ttransitionEvent && this.progressBar.addEventListener(transitionEvent, fun);\r\n//\t\tif(!transitionEvent) {\r\n//\t\t\tthis.container.parentNode.removeChild(this.container);\r\n//\t\t}\r\n\t\tthis.container.parentNode.removeChild(this.container);\r\n\t}, 500);\r\n};\r\n\r\nToProgress.prototype.reset = function(callback) {\r\n\tthis.progress = 0;\r\n\tthis.transit();\r\n\tcallback && callback();\r\n};\r\n\r\nToProgress.prototype.hide = function() {\r\n\tthis.progressBar.style.opacity = '0';\r\n\tthis.container.style.display = 'none';\r\n};\r\n\r\nToProgress.prototype.show = function() {\r\n\tthis.progressBar.style.opacity = '1';\r\n\tthis.container.style.display = 'block';\r\n};\r\n\r\nexport default {\r\n\tToProgress\r\n};","import urls from './urls.js';\r\nimport global from './global.js';\r\nimport base from './base.js';\r\nimport loading from './loading.js';\r\n\r\nexport default {\r\n\t...urls,\r\n\tglobal,\r\n\t...base,\r\n\t...loading,\r\n};","import utils from \"../util/index.js\";\r\n\r\nconst global = utils.global;\r\nconst xsloader = global.xsloader;\r\n\r\n//ie9\r\ntry {\r\n\tif(Function.prototype.bind && console && (typeof console['log'] == \"object\")) {\r\n\t\tutils.each([\"log\", \"info\", \"warn\", \"error\", \"assert\", \"dir\", \"clear\", \"profile\", \"profileEnd\"], (method) => {\r\n\t\t\tlet thiz = Function.prototype.bind;\r\n\t\t\tconsole[method] = thiz.call(console[method], console);\r\n\t\t});\r\n\t}\r\n} catch(e) {\r\n\tglobal.console = {\r\n\t\tlog: function() {},\r\n\t\terror: function() {},\r\n\t\twarn: function() {}\r\n\t};\r\n}\r\n\r\ntry {\r\n\r\n\tif(!Array.prototype.indexOf) {\r\n\t\tArray.prototype.indexOf = function(elem, offset) {\r\n\t\t\tfor(let i = offset === undefined ? 0 : offset; i < this.length; i++) {\r\n\t\t\t\tif(this[i] == elem) {\r\n\t\t\t\t\treturn i;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn -1;\r\n\t\t};\r\n\t}\r\n\r\n\tif(!Array.pushAll) {\r\n\t\tArray.pushAll = function(thiz, arr) {\r\n\t\t\tif(!xsloader.isArray(arr)) {\r\n\t\t\t\tthrow new Error(\"not array:\" + arr);\r\n\t\t\t}\r\n\t\t\tfor(let i = 0; i < arr.length; i++) {\r\n\t\t\t\tthiz.push(arr[i]);\r\n\t\t\t}\r\n\t\t\treturn thiz;\r\n\t\t};\r\n\t}\r\n} catch(e) {\r\n\tconsole.error(e);\r\n}\r\n\r\nfunction startsWith(str, starts) {\r\n\tif(!(typeof str == \"string\")) {\r\n\t\treturn false;\r\n\t}\r\n\treturn str.indexOf(starts) == 0;\r\n}\r\n\r\nfunction endsWith(str, ends) {\r\n\tif(!(typeof str == \"string\")) {\r\n\t\treturn false;\r\n\t}\r\n\tlet index = str.lastIndexOf(ends);\r\n\tif(index >= 0 && (str.length - ends.length == index)) {\r\n\t\treturn true;\r\n\t} else {\r\n\t\treturn false;\r\n\t}\r\n}\r\n\r\nfunction _indexInArray(array, ele, offset = 0, compare) {\r\n\tlet index = -1;\r\n\tif(array) {\r\n\t\tfor(let i = offset || 0; i < array.length; i++) {\r\n\t\t\tif(compare) {\r\n\t\t\t\tif(compare(array[i], ele, i, array)) {\r\n\t\t\t\t\tindex = i;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif(array[i] == ele) {\r\n\t\t\t\t\tindex = i;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t}\r\n\treturn index;\r\n}\r\n\r\nfunction indexInArray(array, ele, compare) {\r\n\treturn _indexInArray(array, ele, 0, compare);\r\n}\r\n\r\nfunction indexInArrayFrom(array, ele, offset, compare) {\r\n\treturn _indexInArray(array, ele, offset, compare);\r\n}\r\n\r\nexport default {\r\n\tstartsWith,\r\n\tendsWith,\r\n\tindexInArray,\r\n\tindexInArrayFrom\r\n};","import {\r\n\tJSON as xsJSON\r\n} from \"../polyfill/index.js\";\r\nimport utils from \"../util/index.js\";\r\n\r\nconst global = utils.global;\r\nconst xsloader = global.xsloader;\r\nconst IE_VERSION = utils.IE_VERSION;\r\n\r\nif(!String.prototype.trim) {\r\n\tString.prototype.trim = function() {\r\n\t\treturn this.replace(/^\\s\\s*/, '').replace(/\\s\\s*$/, '');\r\n\t};\r\n}\r\n\r\n//生成一个随机的id，只保证在本页面是唯一的\r\nfunction randId(suffix) {\r\n\tlet id = \"r\" + parseInt(new Date().getTime() / 1000) + \"_\" + parseInt(Math.random() * 1000) + \"_\" + utils.getAndIncIdCount();\r\n\tif(suffix !== undefined) {\r\n\t\tid += suffix;\r\n\t}\r\n\treturn id;\r\n}\r\n\r\nfunction xsEval(scriptString) {\r\n\ttry {\r\n\t\tlet rs = IE_VERSION > 0 && IE_VERSION < 9 ? eval(\"[\" + scriptString + \"][0]\") : eval(\"(\" + scriptString + \")\");\r\n\t\treturn rs;\r\n\t} catch(e) {\r\n\t\tthrow e;\r\n\t}\r\n}\r\n\r\n/**\r\n * 注意key需要用引号包裹\r\n * @param {Object} str\r\n * @param {Object} option\r\n */\r\nfunction xsParseJson(str, option) {\r\n\tif(str === \"\" || str === null || str === undefined || !xsloader.isString(str)) {\r\n\t\treturn str;\r\n\t}\r\n\r\n\toption = xsloader.extend({\r\n\t\tfnStart: \"\", //\"/*{f}*/\",\r\n\t\tfnEnd: \"\", //\"/*{f}*/\",\r\n\t\trcomment: \"\\\\/\\\\/#\\\\/\\\\/\"\r\n\t}, option);\r\n\r\n\tlet fnMap = {};\r\n\tlet fnOffset = 0;\r\n\tlet replacer = undefined;\r\n\tif(option.fnStart && option.fnEnd) {\r\n\t\twhile(true) {\r\n\t\t\tlet indexStart = str.indexOf(option.fnStart, fnOffset);\r\n\t\t\tlet indexEnd = str.indexOf(option.fnEnd, indexStart == -1 ? fnOffset : indexStart + option.fnStart.length);\r\n\t\t\tif(indexStart == -1 && indexEnd == -1) {\r\n\t\t\t\tbreak;\r\n\t\t\t} else if(indexStart == -1) {\r\n\t\t\t\tconsole.warn(\"found end:\" + option.fnEnd + \",may lack start:\" + option.fnStart);\r\n\t\t\t\tbreak;\r\n\t\t\t} else if(indexEnd == -1) {\r\n\t\t\t\tconsole.warn(\"found start:\" + option.fnStart + \",may lack end:\" + option.fnEnd);\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tlet fnId = \"_[_\" + randId() + \"_]_\";\r\n\t\t\tlet fnStr = str.substring(indexStart + option.fnStart.length, indexEnd).trim();\r\n\t\t\tif(!xsloader.startsWith(fnStr, \"function(\")) {\r\n\t\t\t\tthrow \"not a function:\" + fnStr;\r\n\t\t\t}\r\n\t\t\ttry {\r\n\t\t\t\tstr = str.substring(0, indexStart) + '\"' + fnId + '\"' + str.substring(indexEnd + option.fnEnd.length);\r\n\t\t\t\tlet fn = xsloader.xsEval(fnStr);\r\n\t\t\t\tfnMap[fnId] = fn;\r\n\t\t\t} catch(e) {\r\n\t\t\t\tconsole.error(fnStr);\r\n\t\t\t\tthrow e;\r\n\t\t\t}\r\n\t\t\tfnOffset = indexStart + fnId.length;\r\n\t\t}\r\n\t\treplacer = function(key, val) {\r\n\t\t\tif(xsloader.isString(val) && fnMap[val]) {\r\n\t\t\t\treturn fnMap[val];\r\n\t\t\t} else {\r\n\t\t\t\treturn val;\r\n\t\t\t}\r\n\t\t};\r\n\t}\r\n\r\n\tif(option.rcomment) {\r\n\t\tstr = str.replace(/(\\r\\n)|\\r/g, \"\\n\"); //统一换行符号\r\n\t\tstr = str.replace(new RegExp(option.rcomment + \"[^\\\\n]*(\\\\n|$)\", \"g\"), \"\"); //去除行注释\r\n\t}\r\n\r\n\ttry {\r\n\t\tlet jsonObj = xsJSON;\r\n\t\treturn jsonObj.parse(str, replacer);\r\n\t} catch(e) {\r\n\t\ttry {\r\n\t\t\tlet reg = new RegExp('position[\\\\s]*([0-9]+)[\\\\s]*$');\r\n\t\t\tif(e.message && reg.test(e.message)) {\r\n\t\t\t\tlet posStr = e.message.substring(e.message.lastIndexOf(\"position\") + 8);\r\n\t\t\t\tlet pos = parseInt(posStr.trim());\r\n\t\t\t\tlet _str = str.substring(pos);\r\n\t\t\t\tconsole.error(e.message + \":\" + _str.substring(0, _str.length > 100 ? 100 : _str.length));\r\n\t\t\t}\r\n\t\t} catch(e2) {\r\n\t\t\tconsole.warn(e2);\r\n\t\t}\r\n\t\tthrow e;\r\n\t}\r\n}\r\n\r\nfunction xsJson2String(obj) {\r\n\tlet jsonObj = xsJSON;\r\n\treturn jsonObj.stringify(obj);\r\n}\r\n\r\nconst getPathWithRelative = utils.getPathWithRelative;\r\n\r\nfunction _toParamsMap(argsStr, decode = true) {\r\n\tif(xsloader.isObject(argsStr)) {\r\n\t\treturn argsStr;\r\n\t}\r\n\tif(!argsStr) {\r\n\t\targsStr = location.search;\r\n\t}\r\n\r\n\tlet index = argsStr.indexOf(\"?\");\r\n\tif(index >= 0) {\r\n\t\targsStr = argsStr.substring(index + 1);\r\n\t} else {\r\n\t\tif(utils.dealPathMayAbsolute(argsStr).absolute) {\r\n\t\t\treturn {};\r\n\t\t}\r\n\t}\r\n\tindex = argsStr.lastIndexOf(\"#\");\r\n\tif(index >= 0) {\r\n\t\targsStr = argsStr.substring(0, index);\r\n\t}\r\n\r\n\tlet ret = {},\r\n\t\tseg = argsStr.split('&'),\r\n\t\ts;\r\n\tfor(let i = 0; i < seg.length; i++) {\r\n\t\tif(!seg[i]) {\r\n\t\t\tcontinue;\r\n\t\t}\r\n\t\ts = seg[i].split('=');\r\n\t\tlet name = decode ? decodeURIComponent(s[0]) : s[0];\r\n\t\tret[name] = decode ? decodeURIComponent(s[1]) : s[1];\r\n\t}\r\n\treturn ret;\r\n}\r\n\r\nfunction appendArgs2Url(url, urlArgs) {\r\n\tif(url === undefined || url === null || !urlArgs) {\r\n\t\treturn url;\r\n\t}\r\n\r\n\tlet index = url.lastIndexOf(\"?\");\r\n\tlet hashIndex = url.lastIndexOf(\"#\");\r\n\tif(hashIndex < 0) {\r\n\t\thashIndex = url.length;\r\n\t}\r\n\tlet oldParams = index < 0 ? {} : _toParamsMap(url.substring(index + 1, hashIndex), false);\r\n\tlet newParams = _toParamsMap(urlArgs, false);\r\n\tlet has = false;\r\n\tfor(let k in newParams) {\r\n\t\tif(oldParams[k] != newParams[k]) {\r\n\t\t\toldParams[k] = newParams[k];\r\n\t\t\thas = true;\r\n\t\t}\r\n\t}\r\n\tif(!has) {\r\n\t\treturn url; //参数没有变化直接返回\r\n\t}\r\n\r\n\tlet paramKeys = [];\r\n\tfor(let k in oldParams) {\r\n\t\tparamKeys.push(k);\r\n\t}\r\n\tparamKeys.sort();\r\n\r\n\tlet path = index < 0 ? url.substring(0, hashIndex) : url.substring(0, index);\r\n\tlet params = [];\r\n\r\n\tfor(let i = 0; i < paramKeys.length; i++) { //保证参数按照顺序\r\n\t\tlet k = paramKeys[i];\r\n\t\tparams.push(k + \"=\" + oldParams[k]);\r\n\t}\r\n\tparams = params.join(\"&\");\r\n\tlet hash = \"\";\r\n\tif(hashIndex >= 0 && hashIndex < url.length) {\r\n\t\thash = url.substring(hashIndex);\r\n\t}\r\n\treturn path + (params ? \"?\" + params : \"\") + (hash ? hash : \"\");\r\n\r\n}\r\n\r\nfunction queryString2ParamsMap(argsStr, decode) {\r\n\treturn _toParamsMap(argsStr, decode);\r\n}\r\n\r\nexport default {\r\n\trandId,\r\n\txsEval,\r\n\txsParseJson,\r\n\txsJson2String,\r\n\tgetPathWithRelative,\r\n\tappendArgs2Url,\r\n\tqueryString2ParamsMap,\r\n\tIE_VERSION\r\n};","const ostring = Object.prototype.toString;\r\n\r\nfunction isArray(it) {\r\n\treturn it && (it instanceof Array) || ostring.call(it) === '[object Array]';\r\n}\r\n\r\nfunction isFunction(it) {\r\n\treturn it && (typeof it == \"function\") || ostring.call(it) === '[object Function]';\r\n}\r\n\r\nfunction isObject(it) {\r\n\tif(it === null || it === undefined) {\r\n\t\treturn false;\r\n\t}\r\n\treturn(typeof it == \"object\") || ostring.call(it) === '[object Object]';\r\n}\r\n\r\nfunction isString(it) {\r\n\treturn it && (typeof it == \"string\") || ostring.call(it) === '[object String]';\r\n}\r\n\r\nfunction isDate(it) {\r\n\treturn it && (it instanceof Date) || ostring.call(it) === '[object Date]';\r\n}\r\n\r\nfunction isRegExp(it) {\r\n\treturn it && (it instanceof RegExp) || ostring.call(it) === '[object RegExp]';\r\n}\r\n\r\nexport default {\r\n\tisArray,\r\n\tisFunction,\r\n\tisObject,\r\n\tisString,\r\n\tisDate,\r\n\tisRegExp,\r\n};","import utils from \"../util/index.js\";\r\n\r\nconst global = utils.global;\r\nconst xsloader = global.xsloader;\r\n\r\nfunction queryParam(name, otherValue, optionUrl) {\r\n\tlet search;\r\n\tif(optionUrl) {\r\n\t\tlet index = optionUrl.indexOf('?');\r\n\t\tif(index < 0) {\r\n\t\t\tindex = 0;\r\n\t\t} else {\r\n\t\t\tindex += 1;\r\n\t\t}\r\n\t\tsearch = optionUrl.substr(index);\r\n\t} else {\r\n\t\tsearch = window.location.search.substr(1);\r\n\t}\r\n\r\n\tlet reg = new RegExp(\"(^|&)\" + name + \"=([^&]*)(&|$)\");\r\n\tlet r = search.match(reg);\r\n\tif(r != null) return decodeURIComponent(r[2]);\r\n\treturn otherValue !== undefined ? otherValue : null;\r\n}\r\n\r\nfunction getUrl(relativeUrl, appendArgs, optionalAbsUrl) {\r\n\tif(optionalAbsUrl && !utils.dealPathMayAbsolute(optionalAbsUrl).absolute) {\r\n\t\tthrow new Error(\"expected absolute url:\" + optionalAbsUrl);\r\n\t}\r\n\tif(appendArgs === undefined) {\r\n\t\tappendArgs = true;\r\n\t}\r\n\tlet theConfig = xsloader.config();\r\n\tlet thePageUrl = utils.thePageUrl;\r\n\tlet url;\r\n\tif(relativeUrl === undefined) {\r\n\t\turl = thePageUrl;\r\n\t} else if(xsloader.startsWith(relativeUrl, \".\") || utils.dealPathMayAbsolute(relativeUrl).absolute) {\r\n\t\turl = utils.getPathWithRelative(optionalAbsUrl || thePageUrl, relativeUrl);\r\n\t} else {\r\n\t\turl = theConfig.baseUrl + relativeUrl;\r\n\t}\r\n\tif(appendArgs) {\r\n\t\tif(url == thePageUrl) {\r\n\t\t\turl += location.search + location.hash;\r\n\t\t}\r\n\t\treturn theConfig.dealUrl({}, url);\r\n\t} else {\r\n\t\treturn url;\r\n\t}\r\n}\r\n\r\nfunction tryCall(fun, defaultReturn, thiz, exCallback) {\r\n\tlet rs;\r\n\ttry {\r\n\t\tthiz = thiz === undefined ? this : thiz;\r\n\t\trs = fun.call(thiz);\r\n\t} catch(e) {\r\n\t\tif(xsloader.isFunction(exCallback)) {\r\n\t\t\texCallback(e);\r\n\t\t} else {\r\n\t\t\tconsole.warn(e);\r\n\t\t}\r\n\t}\r\n\tif(rs === undefined || rs === null) {\r\n\t\trs = defaultReturn;\r\n\t}\r\n\treturn rs;\r\n}\r\n\r\nfunction dealProperties(obj, properties) {\r\n\treturn utils.propertiesDeal(obj, properties);\r\n}\r\n\r\nfunction extend(target) {\r\n\tfor(let i = 1; i < arguments.length; i++) {\r\n\t\tlet obj = arguments[i];\r\n\t\tif(!obj) {\r\n\t\t\tcontinue;\r\n\t\t}\r\n\t\tfor(let x in obj) {\r\n\t\t\tlet value = obj[x];\r\n\t\t\tif(value === undefined) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\ttarget[x] = obj[x];\r\n\t\t}\r\n\t}\r\n\treturn target;\r\n}\r\n\r\nfunction extendDeep(target) {\r\n\tif(!target) {\r\n\t\treturn target;\r\n\t}\r\n\tfor(let i = 1; i < arguments.length; i++) {\r\n\t\tlet obj = arguments[i];\r\n\t\tif(!obj) {\r\n\t\t\tcontinue;\r\n\t\t}\r\n\r\n\t\tfor(let x in obj) {\r\n\t\t\tlet value = obj[x];\r\n\t\t\tif(value === undefined) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tif(xsloader.isObject(value) && xsloader.isObject(target[x])) {\r\n\t\t\t\ttarget[x] = xsloader.extendDeep(target[x], value);\r\n\t\t\t} else {\r\n\t\t\t\ttarget[x] = obj[x];\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn target;\r\n}\r\n\r\nfunction _AsyncCall(useTimer) {\r\n\tlet thiz = this;\r\n\tlet count = 0;\r\n\tlet ctrlCallbackMap = {};\r\n\r\n\tfunction initCtrlCallback(callbackObj) {\r\n\t\tlet mineCount = count + \"\";\r\n\t\tif(!ctrlCallbackMap[mineCount]) {\r\n\t\t\tlet ctrlCallback = function() {\r\n\t\t\t\tcount++;\r\n\t\t\t\tlet asyncCallQueue = ctrlCallbackMap[mineCount];\r\n\t\t\t\tdelete ctrlCallbackMap[mineCount];\r\n\t\t\t\twhile(asyncCallQueue.length) {\r\n\t\t\t\t\tlet callbackObj = asyncCallQueue.shift();\r\n\t\t\t\t\tlet lastReturn = undefined;\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tif(callbackObj.callback) {\r\n\t\t\t\t\t\t\tlastReturn = callbackObj.callback.call(callbackObj.handle, callbackObj.obj, mineCount);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} catch(e) {\r\n\t\t\t\t\t\tconsole.error(e);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlet handle;\r\n\t\t\t\t\twhile(callbackObj.nextCallback.length) {\r\n\t\t\t\t\t\tlet nextObj = callbackObj.nextCallback.shift();\r\n\t\t\t\t\t\tif(!handle) {\r\n\t\t\t\t\t\t\thandle = thiz.pushTask(nextObj.callback, lastReturn);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\thandle.next(nextObj.callback);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\tctrlCallbackMap[mineCount] = [];\r\n\t\t\tif(!useTimer && global.Promise && global.Promise.resolve) {\r\n\t\t\t\tglobal.Promise.resolve().then(ctrlCallback);\r\n\t\t\t} else {\r\n\t\t\t\tsetTimeout(ctrlCallback, 0);\r\n\t\t\t}\r\n\t\t}\r\n\t\tlet queue = ctrlCallbackMap[mineCount];\r\n\t\tqueue.push(callbackObj);\r\n\t}\r\n\r\n\tthis.pushTask = function(callback, obj) {\r\n\t\tlet callbackObj;\r\n\t\tlet handle = {\r\n\t\t\tnext: function(nextCallback, lastReturn) {\r\n\t\t\t\tcallbackObj.nextCallback.push({\r\n\t\t\t\t\tcallback: nextCallback,\r\n\t\t\t\t\tlastReturn: lastReturn\r\n\t\t\t\t});\r\n\t\t\t\treturn this;\r\n\t\t\t}\r\n\t\t};\r\n\t\tcallbackObj = {\r\n\t\t\tcallback: callback,\r\n\t\t\tobj: obj,\r\n\t\t\tnextCallback: [],\r\n\t\t\thandle: handle\r\n\t\t};\r\n\r\n\t\tinitCtrlCallback(callbackObj);\r\n\r\n\t\treturn handle;\r\n\t};\r\n}\r\n\r\nconst theAsyncCall = new _AsyncCall();\r\nconst theAsyncCallOfTimer = new _AsyncCall(true);\r\n\r\nlet asyncCall = function(callback, useTimer) {\r\n\tif(useTimer) {\r\n\t\treturn theAsyncCallOfTimer.pushTask(callback);\r\n\t} else {\r\n\t\treturn theAsyncCall.pushTask(callback);\r\n\t}\r\n};\r\n\r\n/**\r\n * 得到属性\r\n * @param {Object} obj\r\n * @param {Object} attrNames \"rs\"、\"rs.total\"等\r\n */\r\nfunction getObjectAttr(obj, attrNames, defaultValue) {\r\n\tif(!obj || !attrNames) {\r\n\t\treturn undefined;\r\n\t}\r\n\tlet attrs = attrNames.split(\".\");\r\n\tlet rs = defaultValue;\r\n\tlet i = 0;\r\n\tfor(; i < attrs.length && obj; i++) {\r\n\t\tlet k = attrs[i];\r\n\t\tobj = obj[k];\r\n\t}\r\n\tif(i == attrs.length) {\r\n\t\trs = obj;\r\n\t}\r\n\r\n\treturn rs;\r\n}\r\n\r\n/**\r\n * 设置属性\r\n * @param {Object} obj\r\n * @param {Object} attrNames \"rs\"、\"rs.total\"等\r\n */\r\nfunction setObjectAttr(obj, attrNames, value) {\r\n\tlet _obj = obj;\r\n\tlet attrs = attrNames.split(\".\");\r\n\r\n\tfor(let i = 0; i < attrs.length; i++) {\r\n\t\tlet k = attrs[i];\r\n\r\n\t\tif(i == attrs.length - 1) {\r\n\t\t\tobj[k] = value;\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tlet o = obj[k];\r\n\t\tif(!o) {\r\n\t\t\to = {};\r\n\t\t\tobj[k] = o;\r\n\t\t}\r\n\t\tobj = o;\r\n\t}\r\n\treturn _obj;\r\n}\r\n\r\nfunction clone(obj, isDeep) {\r\n\t// Handle the 3 simple types, and null or undefined or function\r\n\tif(!obj || xsloader.isFunction(obj) || xsloader.isString(obj)) return obj;\r\n\r\n\tif(xsloader.isRegExp(obj)) {\r\n\t\treturn new RegExp(obj.source, obj.flags);\r\n\t}\r\n\r\n\t// Handle Date\r\n\tif(xsloader.isDate(obj)) {\r\n\t\tlet copy = new Date();\r\n\t\tcopy.setTime(obj.getTime());\r\n\t\treturn copy;\r\n\t}\r\n\t// Handle Array or Object\r\n\tif(xsloader.isArray(obj) || xsloader.isObject(obj)) {\r\n\t\tlet copy = xsloader.isArray(obj) ? [] : {};\r\n\t\tfor(let attr in obj) {\r\n\t\t\tif(obj.hasOwnProperty(attr))\r\n\t\t\t\tcopy[attr] = isDeep ? clone(obj[attr]) : obj[attr];\r\n\t\t}\r\n\t\treturn copy;\r\n\t}\r\n\treturn obj;\r\n}\r\n\r\nexport default {\r\n\tqueryParam,\r\n\tgetUrl,\r\n\ttryCall,\r\n\tdealProperties,\r\n\textend,\r\n\textendDeep,\r\n\tasyncCall,\r\n\tgetObjectAttr,\r\n\tsetObjectAttr,\r\n\tclone\r\n};","import utils from \"../util/index.js\";\r\n\r\nconst global = utils.global;\r\nconst xsloader = global.xsloader;\r\n\r\nlet isDOM = (typeof HTMLElement === 'object') ?\r\n\tfunction(obj) {\r\n\t\treturn obj && (obj instanceof HTMLElement);\r\n\t} :\r\n\tfunction(obj) {\r\n\t\treturn obj && typeof obj === 'object' && obj.nodeType === 1 && typeof obj.nodeName === 'string';\r\n\t};\r\n\r\nlet onReadyFun = (function() {\r\n\tlet isGlobalReady = false;\r\n\tlet bindReadyQueue = [];\r\n\r\n\tfunction BindReady(callback) {\r\n\t\tif(isGlobalReady) {\r\n\t\t\tcallback();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet isReady = false;\r\n\r\n\t\tfunction ready() {\r\n\t\t\tif(isReady) return;\r\n\t\t\tisReady = true;\r\n\t\t\tisGlobalReady = true;\r\n\t\t\tcallback();\r\n\t\t}\r\n\t\t// Mozilla, Opera and webkit nightlies currently support this event\r\n\t\tif(document.addEventListener) {\r\n\t\t\tlet fun;\r\n\t\t\tfun = function() {\r\n\t\t\t\tdocument.removeEventListener(\"DOMContentLoaded\", fun);\r\n\t\t\t\tready();\r\n\t\t\t};\r\n\t\t\tdocument.addEventListener(\"DOMContentLoaded\", fun);\r\n\r\n\t\t} else if(document.attachEvent) {\r\n\t\t\t// ensure firing before onload,\r\n\t\t\t// maybe late but safe also for iframes\r\n\t\t\tlet fun;\r\n\t\t\tfun = function() {\r\n\t\t\t\tif(document.readyState === \"complete\") {\r\n\t\t\t\t\tdocument.detachEvent(\"onreadystatechange\", fun);\r\n\t\t\t\t\tready();\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\tdocument.attachEvent(\"onreadystatechange\", fun);\r\n\t\t\t// If IE and not an iframe\r\n\t\t\t// continually check to see if the document is ready\r\n\r\n\t\t\tlet fun2;\r\n\t\t\tfun2 = function() {\r\n\t\t\t\tif(isReady) return;\r\n\t\t\t\ttry {\r\n\t\t\t\t\t// If IE is used, use the trick by Diego Perini\r\n\t\t\t\t\t// http://javascript.nwbox.com/IEContentLoaded/\r\n\t\t\t\t\tdocument.documentElement.doScroll(\"left\");\r\n\t\t\t\t} catch(error) {\r\n\t\t\t\t\tsetTimeout(fun2, 0);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\t// and execute any waiting functions\r\n\t\t\t\tready();\r\n\t\t\t};\r\n\r\n\t\t\tif(document.documentElement.doScroll && typeof global.frameElement === \"undefined\")(fun2)();\r\n\t\t} else {\r\n\t\t\txsloader.asyncCall(null, true).next(function() {\r\n\t\t\t\tready();\r\n\t\t\t});\r\n\t\t}\r\n\t\tthis.readyCall = ready;\r\n\t}\r\n\tlet onReady = function(callback) {\r\n\t\tif(document.readyState === \"complete\") {\r\n\t\t\tisGlobalReady = true;\r\n\t\t}\r\n\t\tlet br = new BindReady(callback);\r\n\t\tif(!isGlobalReady) {\r\n\t\t\tbindReadyQueue.push(br);\r\n\t\t}\r\n\t};\r\n\tonReady(function() {\r\n\t\tisGlobalReady = true;\r\n\t});\r\n\r\n\tif(document.readyState === \"complete\") {\r\n\t\tisGlobalReady = true;\r\n\t} else {\r\n\t\tlet addEventHandle;\r\n\t\tif(global.addEventListener) {\r\n\t\t\taddEventHandle = function(type, callback) {\r\n\t\t\t\tglobal.addEventListener(type, callback, false);\r\n\t\t\t};\r\n\t\t} else if(global.attachEvent) {\r\n\t\t\taddEventHandle = function(type, callback) {\r\n\t\t\t\tglobal.attachEvent(\"on\" + type, callback);\r\n\t\t\t};\r\n\t\t} else {\r\n\t\t\taddEventHandle = function(type, callback) {\r\n\t\t\t\txsloader.asyncCall(null, true).next(function() {\r\n\t\t\t\t\tcallback();\r\n\t\t\t\t});\r\n\t\t\t};\r\n\t\t}\r\n\t\taddEventHandle(\"load\", function() {\r\n\t\t\tisGlobalReady = true;\r\n\t\t\twhile(bindReadyQueue.length) {\r\n\t\t\t\tbindReadyQueue.shift().readyCall();\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\treturn onReady;\r\n})();\r\n\r\nexport default {\r\n\tisDOM,\r\n\tonReady: onReadyFun\r\n};","import utils from \"../util/index.js\";\r\n////////////////////\r\n\r\nimport deprecated from './global-deprecated.js';\r\nimport base from './global-base.js';\r\n//////////////////\r\nimport is from './is.js';\r\nimport funs from './funs.js';\r\nimport browser from './browser.js';\r\n\r\nconst global = utils.global;\r\nconst xsloader=global.xsloader;\r\n\r\nlet toGlobal = {\r\n\t...deprecated,\r\n\t...base\r\n};\r\nfor(let k in toGlobal) {\r\n\txsloader[k] = toGlobal[k];\r\n\tglobal[k] = toGlobal[k];\r\n}\r\n\r\nlet justLoader = {\r\n\t...is,\r\n\t...funs,\r\n\t...browser,\r\n\t_ignoreAspect_: {\r\n\r\n\t}\r\n};\r\nfor(let k in justLoader) {\r\n\txsloader[k] = justLoader[k];\r\n}","import utils from \"../util/index.js\";\r\nconst global = utils.global;\r\nconst xsloader = global.xsloader;\r\nconst theDefinedMap = {};\r\nconst lastDefinObjectMap = {};\r\n\r\n//global.__showModules=()=>{\r\n//\tconsole.log(theDefinedMap);\r\n//};\r\n\r\nclass ModuleDef {\r\n\tsrc;\r\n\tdefaultModule; //默认模块（ define时未指定selfname的） 只能有一个\r\n\tmodules; //define的其他模块（含有selfname）\r\n\tisPreDependOn; //用于提前依赖\r\n\t_preModule;\r\n\ttargetDef; //用于提前依赖\r\n\tconstructor(src, isPreDependOn = false) {\r\n\t\tthis.src = src;\r\n\t\tthis.isPreDependOn = isPreDependOn;\r\n\t\tthis.modules = {};\r\n\t\tthis.defaultModule = null;\r\n\t\tthis.targetDef = null;\r\n\t\tif(isPreDependOn) {\r\n\t\t\tthis._preModule = {\r\n\t\t\t\tpreDependModule:true,\r\n\t\t\t\trelyQueue: [],\r\n\t\t\t\tget() {\r\n\t\t\t\t\treturn this;\r\n\t\t\t\t},\r\n\t\t\t\trelyIt() {\r\n\t\t\t\t\tlet args = [];\r\n\t\t\t\t\tfor(let i = 0; i < arguments.length; i++) {\r\n\t\t\t\t\t\targs.push(arguments[i]);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.relyQueue.push(args);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t}\r\n\t}\r\n\tgiveRelys(module) {\r\n\t\tlet queue = this._preModule.relyQueue;\r\n\t\tthis._preModule = null;\r\n\t\twhile(queue.length) {\r\n\t\t\tlet args = queue.shift();\r\n\t\t\tmodule.relyIt.apply(module, args);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction _isSrc(nameOrUrl) {\r\n\tlet isSrc = /^[a-zA-Z0-9]+:\\/\\//.test(nameOrUrl);\r\n\treturn isSrc;\r\n}\r\n\r\nfunction setLastDefineObject(src, defineObject) {\r\n\tsrc = utils.removeQueryHash(src);\r\n\tlastDefinObjectMap[src] = defineObject;\r\n}\r\n\r\nfunction getLastDefineObject(src) {\r\n\tsrc = utils.removeQueryHash(src);\r\n\treturn lastDefinObjectMap[src];\r\n}\r\n\r\n/**\r\n * 获取指定脚本、加载中模块的依赖，并添加到defineObject.deps末尾。(配置里的依赖、不一定被添加到实际模块中，模块别名的缘故)\r\n * @param {Object} src\r\n */\r\nfunction appendLoadingModuleDeps(defineObject) {\r\n\tlet src = defineObject.src;\r\n\tlet deps = defineObject.deps;\r\n\tlet moduleDef = theDefinedMap[src];\r\n\tif(moduleDef) {\r\n\t\tlet mod = moduleDef.defaultModule && moduleDef.defaultModule.state == \"loading\" && moduleDef.defaultModule;\r\n\t\tlet _deps = mod && mod.deps;\r\n\t\tutils.each(_deps, (dep) => {\r\n\t\t\tif(xsloader.indexInArray(deps, dep) == -1) {\r\n\t\t\t\tdeps.push(dep);\r\n\t\t\t}\r\n\t\t});\r\n\t\tif(mod) {\r\n\t\t\tdefineObject.pushName(mod.selfname);\r\n\t\t}\r\n\t\tfor(let k in moduleDef.modules) {\r\n\t\t\tmod = moduleDef.modules[k].state == \"loading\" && moduleDef.modules[k];\r\n\t\t\t_deps = mod && mod.deps;\r\n\r\n\t\t\tif(mod) {\r\n\t\t\t\tdefineObject.pushName(mod.selfname);\r\n\t\t\t}\r\n\r\n\t\t\tutils.each(_deps, (dep) => {\r\n\t\t\t\tif(xsloader.indexInArray(deps, dep) == -1) {\r\n\t\t\t\t\tdeps.push(dep);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n}\r\n\r\n/**\r\n * \r\n * @param {Object} nameOrUrl\r\n * @param {Object} selfname\r\n * @param ifoneThenGet 如果没有找到(排除此模块)，且只有唯一的一个、且状态为loaded或defined、则返回该模块对象。获取的模块不等于此模块。\r\n */\r\nfunction getModule(nameOrUrl, selfname = null, ifoneThenGet = null) {\r\n\tnameOrUrl = utils.removeQueryHash(nameOrUrl);\r\n\tlet isSrc = _isSrc(nameOrUrl);\r\n\r\n\tlet moduleDef = theDefinedMap[nameOrUrl];\r\n\tif(moduleDef) {\r\n\t\tlet module;\r\n\t\tif(isSrc) { //如果提供地址、则获取默认模块\r\n\t\t\tif(selfname) {\r\n\t\t\t\tmodule = moduleDef.modules[selfname];\r\n\t\t\t} else {\r\n\t\t\t\tmodule = moduleDef.defaultModule;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif(moduleDef.isPreDependOn) {\r\n\t\t\t\tmodule = moduleDef._preModule;\r\n\t\t\t} else {\r\n\t\t\t\tmodule = moduleDef.modules[nameOrUrl];\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif(module == ifoneThenGet) {\r\n\t\t\tmodule = null;\r\n\t\t}\r\n\r\n\t\tif(!module && ifoneThenGet) {\r\n\t\t\tlet count = 0;\r\n\t\t\tlet mod = moduleDef.defaultModule;\r\n\t\t\tmod && mod != ifoneThenGet && count++;\r\n\t\t\tfor(let k in moduleDef.modules) {\r\n\t\t\t\tmod = moduleDef.modules[k];\r\n\t\t\t\tmod != ifoneThenGet && count++;\r\n\t\t\t}\r\n\t\t\tif(count == 1 && (mod.state == \"loaded\" || mod.state == \"defined\")) {\r\n\t\t\t\tmodule = mod;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn module ? module.get() : null;\r\n\t} else {\r\n\t\treturn null;\r\n\t}\r\n}\r\n\r\n//提前依赖不存在的模块\r\nfunction preDependOn(name) {\r\n\tlet isSrc = _isSrc(name);\r\n\tif(isSrc) {\r\n\t\tthrow new Error(\"expected name,but src:\" + name);\r\n\t} else if(theDefinedMap[name]) {\r\n\t\tthrow new Error(\"already defined:\" + name);\r\n\t} else {\r\n\t\tlet def = new ModuleDef(null, !!name);\r\n\t\ttheDefinedMap[name] = def;\r\n\t}\r\n}\r\n\r\n/**\r\n * 替换模块的src，用于加载含有多个地址模块的情况（提供多个地址、直到加载成功）\r\n * @param {Object} oldSrc\r\n * @param {Object} module\r\n */\r\nfunction replaceModuleSrc(oldSrc, module) {\r\n\tlet moduleDef = theDefinedMap[oldSrc];\r\n\tif(!moduleDef) {\r\n\t\tthrow new Error(\"not found module:src=\" + oldSrc);\r\n\t} else if(theDefinedMap[module.src]) {\r\n\t\tthrow new Error(\"already exists module:src=\" + module.src);\r\n\t} else {\r\n\t\tmoduleDef.src = module.src;\r\n\t\tdelete theDefinedMap[oldSrc];\r\n\t\ttheDefinedMap[module.src] = moduleDef;\r\n\t}\r\n}\r\n\r\nfunction clearEmptyModuleBySrc(src) {\r\n\tlet moduleDef = theDefinedMap[src];\r\n\tif(moduleDef && !moduleDef.defaultModule) {\r\n\t\tif(moduleDef.defaultModule) {\r\n\t\t\tthrow new Error(\"not empty module:src=\" + src);\r\n\t\t} else {\r\n\t\t\tfor(let x in moduleDef.modules) {\r\n\t\t\t\tthrow new Error(\"not empty module:src=\" + src);\r\n\t\t\t}\r\n\t\t}\r\n\t\tdelete theDefinedMap[src];\r\n\t}\r\n}\r\n\r\n/**\r\n * 同一个模块可重复设置。\r\n * @param {Object} name 模块名字，若为空则表示模块模块。多个不同的名字可能指向同一个模块。\r\n * @param {Object} module 模块，必须含有src\r\n */\r\nfunction setModule(name, module) {\r\n\tlet src = module.src;\r\n\tif(!src) {\r\n\t\tthrow new Error(\"expected module src!\");\r\n\t}\r\n\tlet moduleDef = theDefinedMap[src];\r\n\tif(moduleDef) {\r\n\t\tif(name) {\r\n\t\t\tlet lasfDef = theDefinedMap[name];\r\n\t\t\tif(theDefinedMap[name] && lasfDef != moduleDef && !lasfDef.isPreDependOn) {\r\n\t\t\t\tthrow new Error(\"already define module:\\n\\tname=\" + name + \",current.src=\" + src + \",\\n\\tthat.src=\" + theDefinedMap[name].src);\r\n\t\t\t} else {\r\n\t\t\t\tmoduleDef.modules[name] = module;\r\n\t\t\t\ttheDefinedMap[name] = moduleDef;\r\n\t\t\t\tif(lasfDef && lasfDef.isPreDependOn) {\r\n\t\t\t\t\tlasfDef.giveRelys(module);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t//默认模块\r\n\t\t\tif(moduleDef.defaultModule && moduleDef.defaultModule != module) {\r\n\t\t\t\tthrow new Error(\"already define default module:src=\" + src);\r\n\t\t\t} else {\r\n\t\t\t\tmoduleDef.defaultModule = module;\r\n\t\t\t}\r\n\t\t}\r\n\t} else {\r\n\t\tmoduleDef = new ModuleDef(src);\r\n\t\ttheDefinedMap[src] = moduleDef;\r\n\t\tif(name) {\r\n\t\t\tmoduleDef.modules[name] = module;\r\n\t\t\tlet lasfDef = theDefinedMap[name];\r\n\t\t\tif(lasfDef && !lasfDef.isPreDependOn) {\r\n\t\t\t\tthrow new Error(\"already define module:\\n\\tname=\" + name + \",current.src=\" + src + \",\\n\\tthat.src=\" + theDefinedMap[name].src);\r\n\t\t\t} else {\r\n\t\t\t\ttheDefinedMap[name] = moduleDef;\r\n\t\t\t\tif(lasfDef && lasfDef.isPreDependOn) {\r\n\t\t\t\t\tlasfDef.giveRelys(module);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t//默认模块\r\n\t\t\tmoduleDef.defaultModule = module;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport default {\r\n\tgetModule,\r\n\tsetModule,\r\n\treplaceModuleSrc,\r\n\tclearEmptyModuleBySrc,\r\n\tpreDependOn,\r\n\tsetLastDefineObject,\r\n\tgetLastDefineObject,\r\n\tappendLoadingModuleDeps\r\n};","import utils from \"../util/index.js\";\r\nimport script from \"./script.js\";\r\nimport moduleDef from \"./module-def\";\r\nconst global = utils.global;\r\nconst xsloader = global.xsloader;\r\n\r\n//新建模块实例\r\n//relyCallback(depModuleThis)\r\nfunction newModuleInstance(module, thatInvoker, relyCallback, pluginArgs) {\r\n\tlet instanceModule = {\r\n\t\trelyCallback: relyCallback,\r\n\t\t_invoker: thatInvoker,\r\n\t\t_module_: null,\r\n\t\tinitInvoker: function() {\r\n\t\t\t//确保正确的invoker\r\n\t\t\tif(module.ignoreAspect) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tlet obj = this._object;\r\n\t\t\tlet invoker = this._invoker;\r\n\r\n\t\t\tlet addTheAttrs = (theObj) => {\r\n\t\t\t\ttheObj._invoker_ = invoker;\r\n\t\t\t\tif(theObj._module_) {\r\n\t\t\t\t\ttheObj._modules_ = theObj._modules_ || [];\r\n\t\t\t\t\ttheObj._modules_.push(theObj._module_);\r\n\t\t\t\t}\r\n\t\t\t\ttheObj._module_ = this._module_;\r\n\t\t\t\treturn theObj;\r\n\t\t\t};\r\n\r\n\t\t\tlet isSingle = module.instanceType != \"clone\";\r\n\r\n\t\t\tif(xsloader.isObject(obj)) {\r\n\t\t\t\tif(module.loopObject && !isSingle) {\r\n\t\t\t\t\tthrow new Error(\"loop dependency not support single option:\" + module.description());\r\n\t\t\t\t}\r\n\t\t\t\tthis._object = addTheAttrs(isSingle ? obj : xsloader.clone(obj));\r\n\t\t\t} else if(xsloader.isFunction(obj)) {\r\n\t\t\t\tthis._object = addTheAttrs(obj);\r\n\t\t\t}\r\n\r\n\t\t},\r\n\t\t_object: null,\r\n\t\t_setDepModuleObjectGen: function(obj) {\r\n\t\t\tthis._object = obj;\r\n\t\t\tthis.initInvoker();\r\n\t\t},\r\n\t\tmodule: module,\r\n\t\tmoduleObject: function() {\r\n\t\t\treturn this._object;\r\n\t\t},\r\n\t\tgenExports: function() {\r\n\t\t\tthis._setDepModuleObjectGen({});\r\n\t\t\treturn this._object;\r\n\t\t},\r\n\t\t_getCacheKey: function(pluginArgs) {\r\n\t\t\tif(this._object.getCacheKey) {\r\n\t\t\t\treturn this._object.getCacheKey.call(this.thiz, pluginArgs);\r\n\t\t\t}\r\n\t\t\tlet id = this._invoker.getUrl();\r\n\t\t\treturn id;\r\n\t\t},\r\n\t\t_willCache: function(pluginArgs, cacheResult) {\r\n\t\t\tif(this._object.willCache) {\r\n\t\t\t\treturn this._object.willCache.call(this.thiz, pluginArgs, cacheResult);\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t},\r\n\t\tlastSinglePluginResult: function(pluginArgs) {\r\n\t\t\tlet id = this._getCacheKey(pluginArgs);\r\n\t\t\treturn this.module.lastSinglePluginResult(id, pluginArgs);\r\n\t\t},\r\n\t\tsetSinglePluginResult: function(pluginArgs, obj) {\r\n\t\t\tlet id = this._getCacheKey(pluginArgs);\r\n\t\t\tlet willCache = this._willCache(pluginArgs, obj);\r\n\t\t\treturn this.module.setSinglePluginResult(willCache, id, pluginArgs, obj);\r\n\t\t},\r\n\t\tinitInstance: function(justForSingle) {\r\n\t\t\tlet relyCallback = this.relyCallback;\r\n\t\t\tthis._module_ = this.module.dealInstance(this);\r\n\t\t\tthis._setDepModuleObjectGen(this.module.loopObject || this.module.moduleObject);\r\n\t\t\tif(pluginArgs !== undefined) {\r\n\t\t\t\tif(!this._object) {\r\n\t\t\t\t\tthrow new Error(\"pulgin error:\" + this.module.description());\r\n\t\t\t\t}\r\n\t\t\t\tif(this._object.isSingle === undefined) {\r\n\t\t\t\t\tthis._object.isSingle = true; //同样的参数也需要重新调用\r\n\t\t\t\t}\r\n\t\t\t\tif(justForSingle && !this._object.isSingle) {\r\n\t\t\t\t\tthrow new Error(\"just for single plugin\");\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet hasFinished = false;\r\n\t\t\t\tlet onload = (result, ignoreAspect) => {\r\n\t\t\t\t\tif(result == undefined) {\r\n\t\t\t\t\t\tresult = {\r\n\t\t\t\t\t\t\t__default: true\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t}\r\n\t\t\t\t\thasFinished = true;\r\n\t\t\t\t\tif(this._object.isSingle) {\r\n\t\t\t\t\t\tthis.setSinglePluginResult(pluginArgs, {\r\n\t\t\t\t\t\t\tresult: result,\r\n\t\t\t\t\t\t\tignoreAspect: ignoreAspect\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.module.ignoreAspect = ignoreAspect === undefined || ignoreAspect;\r\n\t\t\t\t\tthis._setDepModuleObjectGen(result);\r\n\t\t\t\t\trelyCallback(this);\r\n\t\t\t\t};\r\n\t\t\t\tlet onerror = (err) => {\r\n\t\t\t\t\thasFinished = true;\r\n\t\t\t\t\trelyCallback(this, new utils.PluginError(err || false));\r\n\t\t\t\t};\r\n\r\n\t\t\t\ttry {\r\n\t\t\t\t\tlet cacheResult;\r\n\t\t\t\t\tif(this._object.isSingle && (cacheResult = this.lastSinglePluginResult(pluginArgs)) !== undefined) {\r\n\t\t\t\t\t\tlet last = cacheResult;\r\n\t\t\t\t\t\tonload(last.result, last.ignoreAspect);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tlet args = [pluginArgs, onload, onerror, xsloader.config()].concat(this.module.args);\r\n\t\t\t\t\t\tthis._object.pluginMain.apply(this.thiz, args);\r\n\t\t\t\t\t}\r\n\t\t\t\t} catch(e) {\r\n\t\t\t\t\t//console.warn(e);\r\n\t\t\t\t\tonerror(e);\r\n\t\t\t\t}\r\n\t\t\t\tif(!hasFinished) {\r\n\t\t\t\t\tsetTimeout(function() {\r\n\t\t\t\t\t\tif(!hasFinished) {\r\n\t\t\t\t\t\t\tconsole.warn(\"invoke plugin may failed:page=\" + location.href + \",plugin=\" + module.selfname + \"!\" + pluginArgs);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}, xsloader.config().waitSeconds * 1000);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\trelyCallback(this);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t};\r\n\r\n\tlet moduleMap = {\r\n\t\tmodule: module,\r\n\t\tsrc: module.src,\r\n\t\tabsUrl: () => module.thiz.absUrl(),\r\n\t\tselfname: module.thiz.getName(),\r\n\t\tinvoker: instanceModule._invoker\r\n\t};\r\n\tinstanceModule.thiz = new script.Invoker(moduleMap);\r\n\r\n\t//\tif(module.selfname == \"css\") {\r\n\t//\t\tconsole.log(\"absUrl=\" + instanceModule.thiz.absUrl() + \",invoker.absUrl=\" + instanceModule.thiz.invoker().absUrl());\r\n\t//\t}\r\n\r\n\t//\tbuildInvoker(instanceModule);\r\n\treturn instanceModule;\r\n}\r\n\r\nfunction _newModule(name, src, thatInvoker, callback) {\r\n\tsrc = utils.removeQueryHash(src);\r\n\tlet defineObject = new script.DefineObject(src, null, [name, null, callback]);\r\n\tdefineObject.thatInvoker = thatInvoker;\r\n\tdefineObject.appendConfigDepsAndEmbedDeps(); //添加配置依赖，该模块对象是加载者、而不是define者\r\n\treturn newModule(defineObject);\r\n}\r\n\r\n//\r\n//模块依赖来源：(另见module.js:mayAddDeps,define.js:theRealDefine)\r\n//1、define里声明的\r\n//2、define或require里直接require('...')\r\n//3、config里配置的\r\n//4、手动通过handle.before或depBefore进行修改的\r\n/*\r\n *模块的名字来源：(另见define.js:onModuleLoaded)\r\n * 1、模块url地址:一定存在\r\n * 2、模块define时提供的：可选\r\n * 3、paths或depsPaths提供的：可选，且可能为默认模块\r\n * 4、name!提供的：可选\r\n */\r\nfunction newModule(defineObject) {\r\n\r\n\tlet instances = []; //所有模块实例\r\n\tlet moduleMap = {\r\n\t\tid: utils.getAndIncIdCount(),\r\n\t\tselfname: defineObject.selfname,\r\n\t\tparent: defineObject.parentDefine,\r\n\t\tdescription() {\r\n\t\t\treturn \"selfname=\" + (this.selfname || \"\") + \",src=\" + this.src;\r\n\t\t},\r\n\t\tdeps: defineObject.deps || [],\r\n\t\trelys: [],\r\n\t\tignoreAspect: false,\r\n\t\targs: null,\r\n\t\tsrc: defineObject.src, //绝对路径,可能等于当前页面路径\r\n\t\tabsUrlFromModule: () => defineObject.absUrlFromDefineObject(),\r\n\t\tgetCallback: () => defineObject.callback,\r\n\t\t_dealApplyArgs: (args) => args,\r\n\t\t_loadCallback: null,\r\n\t\tmoduleObject: undefined, //依赖模块对应的对象\r\n\t\tloopObject: undefined, //循环依赖对象\r\n\t\tinvoker: defineObject.thatInvoker,\r\n\t\tinstanceType: \"single\",\r\n\t\treinitByDefineObject(defineObject) {\r\n\t\t\tthis.deps = defineObject.deps || [];\r\n\t\t\tthis.getCallback = () => defineObject.callback;\r\n\t\t},\r\n\t\tsetInstanceType(instanceType) {\r\n\t\t\tthis.instanceType = instanceType;\r\n\t\t},\r\n\t\t_singlePluginResult: {},\r\n\t\tlastSinglePluginResult(id, pluginArgs) {\r\n\t\t\tif(this._singlePluginResult[id]) {\r\n\t\t\t\treturn this._singlePluginResult[id][pluginArgs];\r\n\t\t\t}\r\n\t\t},\r\n\t\tsetSinglePluginResult(willCache, id, pluginArgs, obj) {\r\n\t\t\tif(willCache) {\r\n\t\t\t\tif(!this._singlePluginResult[id]) {\r\n\t\t\t\t\tthis._singlePluginResult[id] = {};\r\n\t\t\t\t}\r\n\t\t\t\tthis._singlePluginResult[id][pluginArgs] = obj;\r\n\t\t\t} else {\r\n\t\t\t\tif(this._singlePluginResult[id]) {\r\n\t\t\t\t\tdelete this._singlePluginResult[id][pluginArgs];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tfinish(args) {\r\n\t\t\targs = this._dealApplyArgs(args);\r\n\t\t\tthis.args = args;\r\n\t\t\tlet obj;\r\n\t\t\tif(xsloader.isFunction(this.getCallback())) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tscript.currentDefineModuleQueue.push(this);\r\n\t\t\t\t\tobj = this.getCallback().apply(this.thiz, args);\r\n\t\t\t\t\tscript.currentDefineModuleQueue.pop();\r\n\t\t\t\t} catch(e) {\r\n\t\t\t\t\tscript.currentDefineModuleQueue.pop();\r\n\t\t\t\t\tconsole.error(\"error occured,invoker.url=\", this.invoker ? this.invoker.getUrl() : \"\");\r\n\t\t\t\t\tconsole.error(e);\r\n\t\t\t\t\tthis.setState(\"error\", e);\r\n\t\t\t\t\tthrow e;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tobj = this.getCallback();\r\n\t\t\t\tif(this.moduleObject !== undefined) {\r\n\t\t\t\t\tconsole.warn(\"ignore moudule:\" + moduleMap.description());\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tlet isDefault = false;\r\n\t\t\tif(obj === undefined) {\r\n\t\t\t\tisDefault = true;\r\n\t\t\t\tobj = {\r\n\t\t\t\t\t__default: true\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\tif(this.loopObject) {\r\n\t\t\t\tif(!xsloader.isObject(obj)) {\r\n\t\t\t\t\tthrow new Error(\"循环依赖的模块必须是对象：\" + this.description());\r\n\t\t\t\t}\r\n\t\t\t\tfor(let x in obj) {\r\n\t\t\t\t\tthis.loopObject[x] = obj[x];\r\n\t\t\t\t}\r\n\t\t\t\tobj = this.loopObject;\r\n\t\t\t}\r\n\t\t\t//this.moduleObject不为undefined，则使用了exports\r\n\t\t\tif(this.moduleObject === undefined ||\r\n\t\t\t\t!isDefault && obj !== undefined //如果使用了return、则优先使用\r\n\t\t\t) {\r\n\t\t\t\tthis.moduleObject = obj;\r\n\t\t\t}\r\n\t\t\tthis.setState(\"defined\");\r\n\t\t},\r\n\t\tstate: \"init\", //init,loading,loaded,defined,error,\r\n\t\terrinfo: null,\r\n\t\t_callback(fun) {\r\n\t\t\tlet thiz = this;\r\n\t\t\tlet _state = thiz.state;\r\n\t\t\tif(_state == 'defined' || thiz.loopObject) {\r\n\t\t\t\tlet theCallback = function() {\r\n\t\t\t\t\tif(fun) {\r\n\t\t\t\t\t\tlet depModule = newModuleInstance(thiz, fun.thatInvoker, fun.relyCallback, fun.pluginArgs);\r\n\t\t\t\t\t\tdepModule.initInstance();\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t\t//已经加载了模块，仍然需要判断为其另外设置的依赖模块是否已被加载\r\n\t\t\t\tlet deps = !thiz.loopObject && xsloader.config().getDeps(thiz.selfname);\r\n\t\t\t\t//console.log(this.selfname,\":\",deps);\r\n\t\t\t\t//deps=null;\r\n\t\t\t\tif(deps && deps.length > 0) {\r\n\t\t\t\t\txsloader.require(deps, () => {\r\n\t\t\t\t\t\ttheCallback();\r\n\t\t\t\t\t}).then({\r\n\t\t\t\t\t\tdefined_module_for_deps: this.selfname\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttheCallback();\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn false;\r\n\t\t\t} else if(_state == \"timeout\" || _state == \"error\") {\r\n\t\t\t\tif(fun) {\r\n\t\t\t\t\tfun.relyCallback(this, this.errinfo);\r\n\t\t\t\t}\r\n\t\t\t\treturn false;\r\n\t\t\t} else {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t},\r\n\t\tsetState(_state, errinfo) {\r\n\t\t\tthis.state = _state;\r\n\t\t\tthis.errinfo = errinfo;\r\n\t\t\tif(!this._callback()) {\r\n\t\t\t\twhile(this.relys.length) {\r\n\t\t\t\t\tlet fun = this.relys.shift();\r\n\t\t\t\t\tthis._callback(fun);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tget() {\r\n\t\t\tif(this.refmodule) {\r\n\t\t\t\tthis.state = this.refmodule.state; //状态同步,保持与refmodule状态相同\r\n\t\t\t\treturn this.refmodule;\r\n\t\t\t}\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\trefmodule: undefined, //引用指定模块\r\n\t\t/**\r\n\t\t * 依赖当前模块、表示依赖otherModule模块，当前模块为别名或引用。\r\n\t\t * @param {Object} otherModule\r\n\t\t */\r\n\t\ttoOtherModule(otherModule) {\r\n\t\t\tthis.refmodule = otherModule;\r\n\t\t\tthis.get(); //状态同步\r\n\t\t\tlet theRelys = this.relys;\r\n\t\t\tthis.relys = [];\r\n\t\t\twhile(theRelys.length) {\r\n\t\t\t\tlet fun = theRelys.shift();\r\n\t\t\t\tthis.refmodule.relyIt(fun.thatInvoker, fun.relyCallback, fun.pluginArgs);\r\n\t\t\t}\r\n\t\t},\r\n\t\twhenNeed(loadCallback) {\r\n\t\t\tif(this.relys.length || this.refmodule && this.refmodule.relys.length) {\r\n\t\t\t\tloadCallback(); //已经被依赖了\r\n\t\t\t} else {\r\n\t\t\t\tthis._loadCallback = loadCallback;\r\n\t\t\t}\r\n\t\t},\r\n\t\t/**\r\n\t\t * \r\n\t\t * @param {Object} thatInvoker\r\n\t\t * @param {Object} callbackFun function(depModule,err)\r\n\t\t * @param {Object} pluginArgs\r\n\t\t */\r\n\t\trelyIt(thatInvoker, callbackFun, pluginArgs) {\r\n\t\t\tif(this.refmodule) {\r\n\t\t\t\tthis.get(); //状态同步\r\n\t\t\t\tthis.refmodule.relyIt(thatInvoker, callbackFun, pluginArgs); //传递给refmodule\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tlet fun = {\r\n\t\t\t\tthatInvoker: thatInvoker,\r\n\t\t\t\trelyCallback: callbackFun,\r\n\t\t\t\tpluginArgs: pluginArgs\r\n\t\t\t};\r\n\t\t\tif(this._callback(fun)) {\r\n\t\t\t\tthis.relys.push(fun);\r\n\t\t\t}\r\n\t\t\tif(this._loadCallback) { //将会加载此模块及其依赖的模块\r\n\t\t\t\tlet loadCallback = this._loadCallback;\r\n\t\t\t\tthis._loadCallback = null;\r\n\t\t\t\tloadCallback();\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\tnew script.Invoker(moduleMap);\r\n\r\n\t//返回_module_\r\n\tmoduleMap.dealInstance = function(moduleInstance) {\r\n\t\tinstances.push(moduleInstance);\r\n\t\tlet _module_ = {\r\n\t\t\topId: null,\r\n\t\t\tsetToAll(name, value, opId) {\r\n\t\t\t\tif(opId !== undefined && opId == this.opId) {\r\n\t\t\t\t\treturn; //防止循环\r\n\t\t\t\t}\r\n\t\t\t\topId = opId || getModuleId();\r\n\t\t\t\tthis.opId = opId;\r\n\r\n\t\t\t\tlet obj = {};\r\n\t\t\t\tif(xsloader.isString(name)) {\r\n\t\t\t\t\tobj[name] = value;\r\n\t\t\t\t} else if(xsloader.isObject(name)) {\r\n\t\t\t\t\tfor(let k in name) {\r\n\t\t\t\t\t\tobj[k] = name[k];\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthrow new Error(\"unknown param:\" + name);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tutils.each(instances, function(ins) {\r\n\t\t\t\t\tlet mobj = ins.moduleObject();\r\n\t\t\t\t\tfor(let k in obj) {\r\n\t\t\t\t\t\tmobj[k] = obj[k];\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(mobj._modules_) {\r\n\t\t\t\t\t\tutils.each(mobj._modules_, function(_m_) {\r\n\t\t\t\t\t\t\t_m_.setToAll(name, value, opId);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t};\r\n\r\n\t\treturn _module_;\r\n\t};\r\n\tmoduleMap.printOnNotDefined = function() {\r\n\t\tlet root = {\r\n\t\t\tnodes: []\r\n\t\t};\r\n\t\tthis._printOnNotDefined(root);\r\n\t\tlet leafs = [];\r\n\r\n\t\tfunction findLeaf(node) {\r\n\t\t\tif(node.nodes.length) {\r\n\t\t\t\tutils.each(node.nodes, function(item) {\r\n\t\t\t\t\tfindLeaf(item);\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tleafs.push(node);\r\n\t\t\t}\r\n\t\t}\r\n\t\tfindLeaf(root);\r\n\r\n\t\tfunction genErrs(node, infos) {\r\n\t\t\tinfos.push(node.err);\r\n\t\t\tif(node.parent) {\r\n\t\t\t\tgenErrs(node.parent, infos);\r\n\t\t\t}\r\n\t\t}\r\n\t\tconsole.error(\"{-----------------------------------------------------------------------------------------------\");\r\n\t\tconsole.error(\"load module error:id=\" + this.id + \",\" + (this.selfname ? \"selfname=\" + this.selfname + \",\" : \"\") + \"my page=\" + location.href);\r\n\t\tutils.each(leafs, function(leaf) {\r\n\t\t\tlet infos = [];\r\n\t\t\tgenErrs(leaf, infos);\r\n\t\t\tinfos = infos.reverse();\r\n\t\t\tfor(let i = 1; i < infos.length;) {\r\n\t\t\t\tlet as = [];\r\n\t\t\t\tfor(let k = 0; k < 3 && i < infos.length; k++) {\r\n\t\t\t\t\tas.push(infos[i++]);\r\n\t\t\t\t}\r\n\t\t\t\tconsole.warn(as.join(\"\\n\\t--->\"));\r\n\t\t\t}\r\n\t\t\tlet errModule = leaf.module;\r\n\t\t\tif(leaf.module && leaf.module.state == \"defined\") {\r\n\t\t\t\terrModule = leaf.parent.module;\r\n\t\t\t}\r\n\t\t\tif(errModule) {\r\n\t\t\t\tlet as = [];\r\n\t\t\t\tfor(let i = 0; i < errModule.deps.length; i++) {\r\n\t\t\t\t\tlet dep = errModule.deps[i];\r\n\t\t\t\t\tlet index = dep.lastIndexOf(\"!\");\r\n\t\t\t\t\tif(index != -1) {\r\n\t\t\t\t\t\tdep = dep.substring(0, index);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlet depMod = moduleDef.getModule(dep);\r\n\t\t\t\t\tif(depMod) {\r\n\t\t\t\t\t\tas.push(dep + \":\" + depMod.state);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tas.push(dep + \":null\");\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tconsole.warn(\"failed module:\" + errModule.description() + \",\\n\\tdeps state infos [\" + as.join(\",\") + \"]\");\r\n\t\t\t\tfor(let i = 0; i < errModule.deps.length; i++) {\r\n\t\t\t\t\tlet dep = errModule.deps[i];\r\n\t\t\t\t\tlet index = dep.lastIndexOf(\"!\");\r\n\t\t\t\t\tif(index != -1) {\r\n\t\t\t\t\t\tdep = dep.substring(0, index);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlet depMod = moduleDef.getModule(dep);\r\n\t\t\t\t\tif(depMod) {\r\n\t\t\t\t\t\tconsole.warn(\"\\t\" + dep + \":src=\" + depMod.src + \",absUrl=\" + (depMod.thiz && depMod.thiz.absUrl()));\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tconsole.warn(dep + \":\");\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\tconsole.error(\"}-----------------------------------------------------------------------------------------------\");\r\n\t};\r\n\tmoduleMap._printOnNotDefined = function(parentNode) {\r\n\t\tlet node = {\r\n\t\t\terr: \"[\" + this.description() + \"].state=\" + this.state,\r\n\t\t\tmodule: this,\r\n\t\t\tparent: parentNode,\r\n\t\t\tnodes: []\r\n\t\t};\r\n\t\tparentNode.nodes.push(node);\r\n\t\tif(this.state == \"defined\") {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tutils.each(this.deps, function(dep) {\r\n\t\t\tlet indexPlguin = dep.indexOf(\"!\");\r\n\t\t\tif(indexPlguin > 0) {\r\n\t\t\t\tdep = dep.substring(0, indexPlguin);\r\n\t\t\t}\r\n\t\t\tlet mod = moduleDef.getModule(dep);\r\n\t\t\tif(mod && mod.state == \"defined\") {\r\n\t\t\t\tmod._printOnNotDefined(node);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t//只打印一个错误栈\r\n\t\t\tif(mod) {\r\n\t\t\t\tmod._printOnNotDefined && mod._printOnNotDefined(node);\r\n\t\t\t} else {\r\n\t\t\t\tnode.nodes.push({\r\n\t\t\t\t\tparent: parentNode,\r\n\t\t\t\t\tnodes: [],\r\n\t\t\t\t\terr: \"[\" + dep + \"] has not module\"\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t};\r\n\tmoduleDef.setModule(moduleMap.selfname, moduleMap);\r\n\r\n\treturn moduleMap;\r\n}\r\n\r\nlet randModuleIndex = 0;\r\n\r\nfunction getModuleId() {\r\n\treturn \"_xs_req_2019_\" + randModuleIndex++;\r\n}\r\n\r\n//everyOkCallback(depModules,module),errCallback(err,invoker)\r\nfunction everyRequired(defineObject, module, everyOkCallback, errCallback) {\r\n\tif(defineObject.isError) {\r\n\t\treturn;\r\n\t}\r\n\r\n\t//处理相对路径,此时模块的依赖已经全部处理好了\r\n\tdefineObject.dealRelative(module);\r\n\r\n\tlet config = xsloader.config();\r\n\r\n\tlet isError = false,\r\n\t\thasCallErr = false,\r\n\t\ttheExports;\r\n\tlet depCount = module.deps.length;\r\n\t//module.jsScriptCount = 0;\r\n\tlet depModules = new Array(depCount);\r\n\r\n\tlet invoker_of_module = module.thiz;\r\n\r\n\tfunction checkFinish(index, dep_name, depModule, syncHandle) {\r\n\t\tdepModules[index] = depModule;\r\n\r\n\t\tif( /*(depCount == 0 || depCount - module.jsScriptCount == 0)*/ depCount <= 0 && !isError) {\r\n\t\t\teveryOkCallback(depModules, module);\r\n\t\t} else if(isError) {\r\n\t\t\tmodule.setState('error', isError);\r\n\t\t\tif(!hasCallErr) {\r\n\t\t\t\thasCallErr = true;\r\n\t\t\t\terrCallback({\r\n\t\t\t\t\terr: isError,\r\n\t\t\t\t\tindex: index,\r\n\t\t\t\t\tdep_name: dep_name\r\n\t\t\t\t}, invoker_of_module);\r\n\t\t\t}\r\n\t\t}!isError && syncHandle && syncHandle();\r\n\t}\r\n\r\n\tutils.each(module.deps, function(dep, index, ary, syncHandle) {\r\n\t\t//\t\tif(xsloader.startsWith(dep, \"css!\")) {\r\n\t\t//\t\t\tconsole.log(\"src=\" + module.src + \",absUrl=\" + invoker_of_module.absUrl() + \",absolute=\" + invoker_of_module.src());\r\n\t\t//\t\t}\r\n\t\tlet originDep = dep;\r\n\t\tlet pluginArgs = undefined;\r\n\t\tlet pluginIndex = dep.indexOf(\"!\");\r\n\t\tif(pluginIndex > 0) {\r\n\t\t\tpluginArgs = dep.substring(pluginIndex + 1);\r\n\t\t\tdep = dep.substring(0, pluginIndex);\r\n\t\t}\r\n\t\tlet relyItFun = function() {\r\n\t\t\tmoduleDef.getModule(dep)\r\n\t\t\t\t.relyIt(invoker_of_module, function(depModule, err) {\r\n\t\t\t\t\tif(!err) {\r\n\t\t\t\t\t\tdepCount--;\r\n\t\t\t\t\t\tif(dep == \"exports\") {\r\n\t\t\t\t\t\t\tif(theExports) {\r\n\t\t\t\t\t\t\t\tmodule.moduleObject = theExports;\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\ttheExports = module.moduleObject = depModule.genExports();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tisError = err;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcheckFinish(index, originDep, depModule, syncHandle);\r\n\t\t\t\t}, pluginArgs);\r\n\t\t};\r\n\r\n\t\tif(!moduleDef.getModule(dep)) {\r\n\t\t\tlet isJsFile = utils.isJsFile(dep);\r\n\t\t\tdo {\r\n\t\t\t\tlet urls;\r\n\t\t\t\tif(!isJsFile && dep.indexOf(\"/\") < 0 && dep.indexOf(\":\") >= 0) {\r\n\t\t\t\t\tlet i1 = dep.indexOf(\":\");\r\n\t\t\t\t\tlet i2 = dep.indexOf(\":\", i1 + 1);\r\n\t\t\t\t\tlet i3 = i2 > 0 ? dep.indexOf(\":\", i2 + 1) : -1;\r\n\t\t\t\t\tif(i2 == -1) {\r\n\t\t\t\t\t\tisError = \"illegal module:\" + dep;\r\n\t\t\t\t\t\terrCallback(isError, invoker_of_module);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlet version;\r\n\t\t\t\t\tlet groupModule;\r\n\t\t\t\t\tif(i3 == -1) {\r\n\t\t\t\t\t\tversion = config.defaultVersion[dep];\r\n\t\t\t\t\t\tgroupModule = dep + \":\" + version;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tversion = dep.substring(i3 + 1);\r\n\t\t\t\t\t\tgroupModule = dep;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(version === undefined) {\r\n\t\t\t\t\t\tisError = \"unknown version for:\" + dep;\r\n\t\t\t\t\t\terrCallback(isError, invoker_of_module);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlet _url = xsloader._resUrlBuilder(groupModule);\r\n\t\t\t\t\turls = xsloader.isArray(_url) ? _url : [_url];\r\n\t\t\t\t} else if(config.isInUrls(dep)) {\r\n\t\t\t\t\turls = config.getUrls(dep);\r\n\t\t\t\t} else if(isJsFile) {\r\n\t\t\t\t\turls = [dep];\r\n\t\t\t\t} else {\r\n\t\t\t\t\turls = [];\r\n\t\t\t\t}\r\n\r\n\t\t\t\t//TODO errCallback是否无效??\r\n\t\t\t\tif(urls.length == 0) {\r\n\t\t\t\t\t//提前依赖模块\r\n\t\t\t\t\tmoduleDef.preDependOn(dep);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tutils.each(urls, function(url, index) {\r\n\t\t\t\t\t\tif(xsloader.startsWith(url, \".\") || xsloader.startsWith(url, \"/\")) {\r\n\t\t\t\t\t\t\tif(!invoker_of_module.rurl(defineObject)) {\r\n\t\t\t\t\t\t\t\tisError = \"script url is null:'\" + module.description();\r\n\t\t\t\t\t\t\t\terrCallback(isError, invoker_of_module);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\turl = utils.getPathWithRelative(invoker_of_module.rurl(defineObject), url);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tlet absolute = utils.dealPathMayAbsolute(url);\r\n\t\t\t\t\t\t\tif(absolute.absolute) {\r\n\t\t\t\t\t\t\t\turl = absolute.path;\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\turl = config.baseUrl + url;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif(urls[index] == dep) {\r\n\t\t\t\t\t\t\tdep = url;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\turls[index] = config.dealUrl(dep, url);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(!isError && urls.length) {\r\n\t\t\t\t\tutils.replaceModulePrefix(config, urls); //前缀替换\r\n\r\n\t\t\t\t\tlet m2Name = isJsFile ? null : dep;\r\n\t\t\t\t\tlet module2 = _newModule(m2Name, urls[0], invoker_of_module);\r\n\t\t\t\t\tmodule2.setState(\"loading\"); //只有此处才设置loading状态\r\n\r\n\t\t\t\t\tlet configDeps = [];\r\n\t\t\t\t\tif(m2Name) {\r\n\t\t\t\t\t\tlet _deps = config.getDeps(m2Name);\r\n\t\t\t\t\t\tutils.each(_deps, (d) => {\r\n\t\t\t\t\t\t\tif(xsloader.indexInArray(configDeps, d) == -1) {\r\n\t\t\t\t\t\t\t\tconfigDeps.push(d);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tutils.each(urls, (url) => {\r\n\t\t\t\t\t\tlet _deps = config.getDeps(url);\r\n\t\t\t\t\t\tutils.each(_deps, (d) => {\r\n\t\t\t\t\t\t\tif(xsloader.indexInArray(configDeps, d) == -1) {\r\n\t\t\t\t\t\t\t\tconfigDeps.push(d);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tif(configDeps.length) {\r\n\t\t\t\t\t\t//先加载配置依赖\r\n\t\t\t\t\t\txsloader.require(configDeps, () => {\r\n\t\t\t\t\t\t\tloadModule();\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tloadModule();\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t//加载模块dep:module2\r\n\t\t\t\t\tfunction loadModule(index = 0) {\r\n\t\t\t\t\t\tif(index >= urls.length) {\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tlet url = urls[index];\r\n\t\t\t\t\t\tmoduleDef.setLastDefineObject(url, defineObject);\r\n\t\t\t\t\t\tif(index > 0) {\r\n\t\t\t\t\t\t\tlet oldSrc = module2.src;\r\n\t\t\t\t\t\t\tmodule2.src = url;\r\n\t\t\t\t\t\t\tmoduleDef.replaceModuleSrc(oldSrc, module2);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tscript.loadScript(module2.selfname, url, (scriptData) => {\r\n\t\t\t\t\t\t\tlet defaultMod;\r\n\t\t\t\t\t\t\tif(module2.state == \"loading\") { //module2.selfname为配置名称，尝试默认模块或者唯一的模块\r\n\t\t\t\t\t\t\t\t//(唯一的模块用于支持：脚本里只有一个define、且指定了模块名、且此处的模块名与其自己指定了不相等)\r\n\t\t\t\t\t\t\t\tdefaultMod = moduleDef.getModule(module2.src, null, module2);\r\n\t\t\t\t\t\t\t\tif(defaultMod && module2 != defaultMod) {\r\n\t\t\t\t\t\t\t\t\tmodule2.toOtherModule(defaultMod);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tif(!defaultMod && module2.state == \"loading\") {\r\n\t\t\t\t\t\t\t\t//isError = \"load module err(may not define default):\" + module2.description();\r\n\t\t\t\t\t\t\t\t//errCallback(isError, invoker_of_module);\r\n\t\t\t\t\t\t\t\t//？？没有define的情况、直接完成\r\n\t\t\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\t\t\tmodule2.finish([]);\r\n\t\t\t\t\t\t\t\t} catch(e) {\r\n\t\t\t\t\t\t\t\t\tisError = e;\r\n\t\t\t\t\t\t\t\t\terrCallback(isError, invoker_of_module);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}, (err) => {\r\n\t\t\t\t\t\t\tif(index + 1 < urls.length) {\r\n\t\t\t\t\t\t\t\tloadModule(index + 1);\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tisError = err;\r\n\t\t\t\t\t\t\t\terrCallback(isError, invoker_of_module);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} while (false);\r\n\t\t}\r\n\t\tif(!isError) {\r\n\t\t\trelyItFun();\r\n\t\t}\r\n\t}, defineObject.handle.orderDep);\r\n\t//TODO STRONG ????ie10及以下版本，js文件一个一个加载，从而解决缓存等造成的混乱问题\r\n}\r\n\r\nexport default {\r\n\t...moduleDef,\r\n\tnewModule,\r\n\teveryRequired,\r\n\tnewModuleInstance,\r\n\tgetModuleId\r\n};","import utils from \"../util/index.js\";\r\nimport moduleScript from \"./module.js\";\r\n\r\nconst global = utils.global;\r\nconst xsloader = global.xsloader;\r\n\r\nconst defContextName = \"xsloader1.1.x\";\r\nconst DATA_ATTR_MODULE = 'data-xsloader-module';\r\nconst DATA_ATTR_CONTEXT = \"data-xsloader-context\";\r\nconst INNER_DEPS_PLUGIN = \"__inner_deps__\";\r\nconst innerDepsMap = {}; //内部依赖加载插件用于保存依赖的临时map\r\nconst globalDefineQueue = []; //没有配置前的define\r\n\r\nconst isOpera = typeof opera !== 'undefined' && opera.toString() === '[object Opera]';\r\nconst safariVersion = (function() {\r\n\tlet ua = navigator.userAgent.toLowerCase();\r\n\tlet s = ua.match(/version\\/([\\d.]+)\\s+safari/);\r\n\treturn s ? parseInt(s[1]) : -1;\r\n})();\r\n\r\nconst readyRegExp = navigator.platform === 'PLAYSTATION 3' ? /^complete$/ : /^(complete|loaded)$/;\r\nconst theLoaderScript = document.currentScript || utils.getScriptBySubname(\"xsloader.js\");\r\nconst theLoaderUrl = utils.getNodeAbsolutePath(theLoaderScript);\r\nconst thePageUrl = utils.thePageUrl;\r\nconst head = document.head || document.getElementsByTagName('head')[0];\r\n\r\nconst currentDefineModuleQueue = []; //当前回调的模块\r\ncurrentDefineModuleQueue.peek = function() {\r\n\tif(this.length > 0) {\r\n\t\treturn this[this.length - 1];\r\n\t}\r\n};\r\n\r\nlet lastAppendHeadDom = theLoaderScript;\r\nlet isSrcFromScriptLoad; //获取脚本的src是否在load事件阶段\r\nlet lastScriptSrc = thePageUrl;\r\nlet theRealDefine;\r\nif(safariVersion > 0 && safariVersion <= 7) {\r\n\tisSrcFromScriptLoad = true;\r\n}\r\n\r\n//处理嵌套依赖\r\nfunction _dealEmbedDeps(deps, defineObject) {\r\n\tfor(let i = 0; i < deps.length; i++) {\r\n\t\tlet dep = deps[i];\r\n\t\tif(xsloader.isArray(dep)) {\r\n\t\t\t//内部的模块顺序加载\r\n\t\t\tlet modName = \"inner_order_\" + moduleScript.getModuleId();\r\n\t\t\tlet isOrderDep = !(dep.length > 0 && dep[0] === false);\r\n\t\t\tif(dep.length > 0 && (dep[0] === false || dep[0] === true)) {\r\n\t\t\t\tdep = dep.slice(1);\r\n\t\t\t}\r\n\t\t\tinnerDepsMap[modName] = {\r\n\t\t\t\tdeps: dep,\r\n\t\t\t\tabsUrl: defineObject.absUrlFromDefineObject(),\r\n\t\t\t\torderDep: isOrderDep,\r\n\t\t\t\tsrc: defineObject.src,\r\n\t\t\t};\r\n\r\n\t\t\t//console.log(innerDepsMap[modName]);\r\n\t\t\tdeps[i] = INNER_DEPS_PLUGIN + \"!\" + modName;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction _getPluginParam(path) {\r\n\tlet pluginIndex = path.indexOf(\"!\");\r\n\tif(pluginIndex > 0) {\r\n\t\treturn path.substring(pluginIndex);\r\n\t} else {\r\n\t\treturn \"\";\r\n\t}\r\n}\r\n\r\n/////////////////////////////\r\nclass Handle {\r\n\tdefineObject;\r\n\tconstructor(defineObject) {\r\n\t\tthis.defineObject = defineObject;\r\n\t}\r\n\r\n\tthen(option) {\r\n\t\tlet defineObject = this.defineObject;\r\n\t\tdefineObject.handle = xsloader.extend(defineObject.handle, option);\r\n\t\treturn this;\r\n\t}\r\n\terror(onError) {\r\n\t\tlet defineObject = this.defineObject;\r\n\t\tdefineObject.handle.onError = onError;\r\n\t\treturn this;\r\n\t}\r\n\tonError(err, invoker) {\r\n\t\tthis.defineObject.handle.onError(err, invoker);\r\n\t}\r\n}\r\n\r\nclass ThisInvoker {\r\n\tinvoker;\r\n\tconstructor(invoker) {\r\n\t\tthis.invoker = invoker;\r\n\t}\r\n}\r\n\r\nfunction _buildInvoker(module) {\r\n\tlet invoker = module[\"thiz\"];\r\n\tmodule = module.module || module;\r\n\tlet id = xsloader.randId();\r\n\tinvoker.getId = function() {\r\n\t\treturn id;\r\n\t};\r\n\tinvoker.getUrl = function(relativeUrl, appendArgs = true, optionalAbsUrl) {\r\n\t\tif(optionalAbsUrl && !utils.dealPathMayAbsolute(optionalAbsUrl).absolute) {\r\n\t\t\tthrow new Error(-1, \"expected absolute url:\" + optionalAbsUrl);\r\n\t\t}\r\n\r\n\t\tlet url;\r\n\t\tif(relativeUrl === undefined) {\r\n\t\t\turl = this.src();\r\n\t\t} else if(xsloader.startsWith(relativeUrl, \".\") || utils.dealPathMayAbsolute(relativeUrl).absolute) {\r\n\t\t\turl = utils.getPathWithRelative(optionalAbsUrl || this.absUrl(), relativeUrl);\r\n\t\t} else {\r\n\t\t\turl = xsloader.config().baseUrl + relativeUrl;\r\n\t\t}\r\n\t\tif(appendArgs) {\r\n\t\t\tif(url == thePageUrl) {\r\n\t\t\t\turl += location.search + location.hash;\r\n\t\t\t}\r\n\t\t\treturn xsloader.config().dealUrl(module, url);\r\n\t\t} else {\r\n\t\t\treturn url;\r\n\t\t}\r\n\t};\r\n\tinvoker.require = function() {\r\n\t\t//\t\tconsole.log(\"this.require:absolute=\" + invoker.src() + \",args[0]=\" + arguments[0]);\r\n\t\tlet h = xsloader.require.apply(new ThisInvoker(invoker), arguments);\r\n\t\tif(h instanceof Handle) {\r\n\t\t\th.then({\r\n\t\t\t\tabsUrl: invoker.src()\r\n\t\t\t});\r\n\t\t}\r\n\t\treturn h;\r\n\t};\r\n\tinvoker.define = function() {\r\n\t\t//\t\tconsole.log(\"this.define:absolute=\" + invoker.src() + \",args[0]=\" + arguments[0] + (typeof arguments[0] == \"string\" ? (\",args[1]=\" + arguments[1]) : \"\"));\r\n\t\tlet h = xsloader.define.apply(new ThisInvoker(invoker), arguments);\r\n\t\tif(h instanceof Handle) {\r\n\t\t\th.then({\r\n\t\t\t\tabsUrl: invoker.src()\r\n\t\t\t});\r\n\t\t}\r\n\t\treturn h;\r\n\t};\r\n\tinvoker.rurl = function(defineObject) {\r\n\t\treturn defineObject && defineObject.absUrlFromDefineObject() || this.absUrl();\r\n\t};\r\n\tinvoker.defineAsync = function() {\r\n\t\tlet h = invoker.define.apply(invoker, arguments);\r\n\t\treturn h;\r\n\t};\r\n\tinvoker.withAbsUrl = function(absUrlStr) {\r\n\t\tif(!absUrlStr) {\r\n\t\t\tabsUrlStr = invoker.absUrl();\r\n\t\t}\r\n\t\tlet moduleMap = {\r\n\t\t\tmodule: module,\r\n\t\t\tsrc: module.src,\r\n\t\t\tabsUrl: () => absUrlStr,\r\n\t\t\tname: invoker.getName(),\r\n\t\t\tinvoker: invoker.invoker()\r\n\t\t};\r\n\t\treturn new Invoker(moduleMap);\r\n\t};\r\n}\r\n\r\nclass Invoker {\r\n\t_im;\r\n\tconstructor(moduleMap) {\r\n\t\tthis._im = new InVar(moduleMap);\r\n\t\tmoduleMap.thiz = this;\r\n\t\t_buildInvoker(moduleMap);\r\n\t}\r\n\t/**\r\n\t * 获取绝对地址（弃用）\r\n\t */\r\n\tgetAbsoluteUrl() {\r\n\t\treturn this._im.get().src;\r\n\t}\r\n\r\n\t/**\r\n\t * 获取绝对地址\r\n\t */\r\n\tsrc() {\r\n\t\treturn this._im.get().src;\r\n\t}\r\n\r\n\tgetName() {\r\n\t\treturn this._im.get().selfname;\r\n\t}\r\n\r\n\t/**\r\n\t * 获取当前调用者的调用者\r\n\t */\r\n\tinvoker() {\r\n\t\treturn this._im.get().invoker;\r\n\t}\r\n\r\n\tabsUrl() { //用于获取其他模块地址的参考路径\r\n\t\treturn this._im.get().absUrlFromModule();\r\n\t}\r\n}\r\n\r\nfunction getInvoker(thiz, nullNew = true) {\r\n\tif(thiz instanceof ThisInvoker) {\r\n\t\treturn thiz.invoker;\r\n\t} else if(thiz instanceof Invoker) {\r\n\t\treturn thiz;\r\n\t} else if(thiz instanceof DefineObject) {\r\n\t\treturn thiz.thatInvoker;\r\n\t} else {\r\n\t\tlet parentModule = currentDefineModuleQueue.peek();\r\n\t\tif(parentModule) {\r\n\t\t\treturn parentModule.thiz;\r\n\t\t} else if(nullNew) {\r\n\t\t\tlet moduleMap = {\r\n\t\t\t\tmodule: \"\",\r\n\t\t\t\tsrc: thePageUrl,\r\n\t\t\t\tabsUrl: () => thePageUrl,\r\n\t\t\t\tname: \"__root__\",\r\n\t\t\t\tinvoker: null\r\n\t\t\t};\r\n\t\t\treturn new Invoker(moduleMap);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nclass DefineObject {\r\n\tthiz;\r\n\tisRequire;\r\n\tsrc;\r\n\tparentDefine;\r\n\thandle;\r\n\tselfname;\r\n\tdeps;\r\n\tcallback;\r\n\tthatInvoker;\r\n\t_directDepLength = 0;\r\n\tdirectDepLength = 0;\r\n\tnames = [];\r\n\tconstructor(src, thiz, args = [], isRequire = false /*, willDealConfigDeps = false*/ ) {\r\n\t\tthis.parentDefine = currentDefineModuleQueue.peek();\r\n\t\tthis.thatInvoker = getInvoker(thiz);\r\n\r\n\t\tthis.src = src;\r\n\t\tthis.thiz = thiz;\r\n\t\tthis.isRequire = isRequire;\r\n\t\tthis.handle = {\r\n\t\t\tonError(err, invoker) {\r\n\t\t\t\tconsole.warn(err);\r\n\t\t\t},\r\n\t\t\tbefore(deps) {},\r\n\t\t\tdepBefore(index, dep, depDeps) {},\r\n\t\t\torderDep: false,\r\n\t\t\tabsoluteUrl: undefined, //弃用\r\n\t\t\tabsUrl: undefined,\r\n\t\t\tinstance: undefined,\r\n\t\t};\r\n\r\n\t\tif(thiz instanceof ThisInvoker) {\r\n\t\t\t//this.handle.absUrl = thiz.invoker.src(); //设置默认参考地址\r\n\t\t\tthis.src = thiz.invoker.src();\r\n\t\t}\r\n\r\n\t\tlet selfname = args[0];\r\n\t\tlet deps = args[1];\r\n\t\tlet callback = args[2];\r\n\t\tif(args.length == 1) {\r\n\t\t\t//直接定义模块，且没有依赖\r\n\t\t\tcallback = selfname;\r\n\t\t\tselfname = null;\r\n\t\t\tdeps = null;\r\n\t\t} else if(typeof selfname !== 'string') {\r\n\t\t\tcallback = deps;\r\n\t\t\tdeps = selfname;\r\n\t\t\tselfname = null; //为空的、表示定义默认模块\r\n\t\t}\r\n\r\n\t\tif(deps && !xsloader.isArray(deps)) {\r\n\t\t\tcallback = deps;\r\n\t\t\tdeps = null;\r\n\t\t}\r\n\r\n\t\tif(!deps) {\r\n\t\t\tdeps = [];\r\n\t\t}\r\n\r\n\t\t//获取函数体里直接require('...')的依赖\r\n\t\t//if(!isRequire) {\r\n\t\tutils.appendInnerDeps(deps, callback);\r\n\t\t//}\r\n\r\n\t\tthis.selfname = selfname;\r\n\t\tthis.deps = deps;\r\n\t\tthis.pushName(selfname);\r\n\t\tthis.callback = callback;\r\n\t\tthis._directDepLength = deps.length;\r\n\t\tthis.directDepLength = deps.length;\r\n\t}\r\n\r\n\tpushName(name) {\r\n\t\tif(name && xsloader.indexInArray(this.names, name) == -1) {\r\n\t\t\tthis.names.push(name);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * 处理配置依赖及嵌套依赖,同时会替换前缀\r\n\t */\r\n\tappendConfigDepsAndEmbedDeps(module) {\r\n\t\tlet config = xsloader.config();\r\n\t\tlet src = this.src;\r\n\t\tlet deps = this.deps;\r\n\r\n\t\tlet _deps = config.getDeps(src);\r\n\t\tutils.each(_deps, (dep) => {\r\n\t\t\tif(xsloader.indexInArray(deps, dep) == -1) {\r\n\t\t\t\tdeps.push(dep);\r\n\t\t\t}\r\n\t\t});\r\n\t\tutils.each(this.names, (name) => {\r\n\t\t\t_deps = config.getDeps(name);\r\n\t\t\tutils.each(_deps, (dep) => {\r\n\t\t\t\tif(xsloader.indexInArray(deps, dep) == -1) {\r\n\t\t\t\t\tdeps.push(dep);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\t\tif(this.handle.orderDep && this._directDepLength > 1 && deps.length > this._directDepLength) {\r\n\t\t\tlet odeps = [true]; //第一个true表示顺序依赖\r\n\t\t\twhile(this._directDepLength-- > 0) {\r\n\t\t\t\todeps.push(deps.shift());\r\n\t\t\t}\r\n\t\t\tdeps.unshift(odeps);\r\n\t\t\tthis.handle.orderDep = false;\r\n\t\t}\r\n\r\n\t\t//处理嵌套依赖\r\n\t\t_dealEmbedDeps(deps, this);\r\n\t\tutils.replaceModulePrefix(config, deps); //前缀替换\r\n\t\tif(module) {\r\n\t\t\tmodule.deps = deps;\r\n\t\t\tmodule._dealApplyArgs = (function(directDepLength, hasOrderDep) {\r\n\t\t\t\treturn function(applyArgs) {\r\n\t\t\t\t\tif(directDepLength == 0) {\r\n\t\t\t\t\t\treturn [];\r\n\t\t\t\t\t}\r\n\t\t\t\t\t//顺序依赖,还原成最初的顺序,移除额外的依赖。\r\n\t\t\t\t\tlet args = new Array(directDepLength + 1);\r\n\t\t\t\t\tif(hasOrderDep) {\r\n\t\t\t\t\t\targs = applyArgs[0];\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tfor(var i = 0; i < directDepLength; i++) {\r\n\t\t\t\t\t\t\targs[i] = applyArgs[i];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\targs[directDepLength] = applyArgs[applyArgs.length - 1].slice(0, directDepLength);\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn args;\r\n\t\t\t\t};\r\n\t\t\t})(this.directDepLength, this.directDepLength > 0 && this._directDepLength <= 0);\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tdealRelative(module) {\r\n\t\tlet deps = this.deps;\r\n\t\t//处理相对路径\r\n\t\tfor(let i = 0; i < deps.length; i++) {\r\n\t\t\t//console.log(module.selfname+(\"(\"+defineObject.handle.defined_module_for_deps+\")\"), \":\", deps);\r\n\t\t\tlet m = deps[i];\r\n\t\t\tlet jsFilePath = utils.isJsFile(m);\r\n\r\n\t\t\t//替换相对路径为绝对路径\r\n\t\t\tif(jsFilePath && xsloader.startsWith(m, \".\")) {\r\n\t\t\t\tm = utils.getPathWithRelative(module.thiz.rurl(this), jsFilePath.path) + _getPluginParam(m);\r\n\t\t\t\tdeps[i] = m;\r\n\t\t\t}\r\n\r\n\t\t\tlet paths = utils.graphPath.tryAddEdge(this.handle.defined_module_for_deps || module.selfname, m);\r\n\t\t\tif(paths.length > 0) {\r\n\t\t\t\tlet moduleLoop = moduleScript.getModule(m); //该模块必定已经被定义过\r\n\t\t\t\tmoduleLoop.loopObject = {};\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tabsUrlFromDefineObject() {\r\n\t\treturn this.handle.absUrl || this.handle.absoluteUrl || this.src;\r\n\t}\r\n\r\n}\r\n\r\n////////////////////////\r\n\r\n/**\r\n * 获取当前脚本，返回对象：\r\n * src:脚本绝对地址，不含参数\r\n * node:脚本dom对象\r\n * @param {Object} isRemoveQueryHash\r\n */\r\nfunction getCurrentScript(isRemoveQueryHash = true) {\r\n\tfunction _getCurrentScriptOrSrc() { //兼容获取正在运行的js\r\n\t\t//取得正在解析的script节点\r\n\t\tif(document.currentScript !== undefined) { //firefox 4+\r\n\t\t\tlet node = document.currentScript && document.currentScript.src && document.currentScript;\r\n\t\t\tif(node) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tnode,\r\n\t\t\t\t\tsrc: node.src\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(utils.IE_VERSION > 0 && utils.IE_VERSION <= 10) {\r\n\t\t\tlet nodes = document.getElementsByTagName(\"script\"); //只在head标签中寻找\r\n\t\t\t//\t\t\tutils.each(nodes, (node) => {\r\n\t\t\t//\t\t\t\tconsole.log(\"node.src=\" + node.src + \",node.readyState=\" + node.readyState);\r\n\t\t\t//\t\t\t});\r\n\t\t\tfor(let i = nodes.length - 1; i >= 0; i--) {\r\n\t\t\t\tlet node = nodes[i];\r\n\t\t\t\tif(node.readyState === \"interactive\" && node.src) {\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tnode,\r\n\t\t\t\t\t\tsrc: node.src\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tlet stack;\r\n\t\ttry {\r\n\t\t\tlet a = undefined;\r\n\t\t\ta.b.c(); //强制报错,以便捕获e.stack\r\n\t\t} catch(e) { //safari的错误对象只有line,sourceId,sourceURL\r\n\t\t\tstack = e.stack || e.sourceURL || e.stacktrace || '';\r\n\t\t\tif(!stack && window.opera) {\r\n\t\t\t\t//opera 9没有e.stack,但有e.Backtrace,但不能直接取得,需要对e对象转字符串进行抽取\r\n\t\t\t\tstack = (String(e).match(/of linked script \\S+/g) || []).join(\" \");\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(stack) {\r\n\t\t\t/**e.stack最后一行在所有支持的浏览器大致如下:\r\n\t\t\t *chrome23:\r\n\t\t\t * at http://113.93.50.63/data.js:4:1\r\n\t\t\t *firefox17:\r\n\t\t\t *@http://113.93.50.63/query.js:4\r\n\t\t\t *opera12:\r\n\t\t\t *@http://113.93.50.63/data.js:4\r\n\t\t\t *IE10:\r\n\t\t\t *  at Global code (http://113.93.50.63/data.js:4:1)\r\n\t\t\t */\r\n\t\t\tstack = stack.split(/[@ ]/g).pop(); //取得最后一行,最后一个空格或@之后的部分\r\n\t\t\tstack = stack[0] == \"(\" ? stack.slice(1, -1) : stack;\r\n\t\t\tlet s = stack.replace(/(:\\d+)?:\\d+$/i, \"\"); //去掉行号与或许存在的出错字符起始位置\r\n\t\t\treturn {\r\n\t\t\t\tsrc: s\r\n\t\t\t};\r\n\t\t}\r\n\t}\r\n\r\n\tlet rs;\r\n\tlet parentDefine = currentDefineModuleQueue.peek();\r\n\tif(parentDefine) {\r\n\t\trs = {\r\n\t\t\tsrc: parentDefine.src\r\n\t\t};\r\n\t} else {\r\n\t\trs = _getCurrentScriptOrSrc();\r\n\t}\r\n\r\n\tif(!rs) {\r\n\t\trs = {\r\n\t\t\tsrc: thePageUrl\r\n\t\t};\r\n\t}\r\n\r\n\tif(utils.isLoaderEnd() && rs.src == theLoaderUrl) {\r\n\t\trs.src = thePageUrl;\r\n\t\trs.node = null;\r\n\t}\r\n\r\n\tif(!rs.node && rs.src != thePageUrl) {\r\n\t\tlet src = utils.removeQueryHash(rs.src);\r\n\t\tlet nodes = document.getElementsByTagName(\"script\"); //只在head标签中寻找\r\n\t\tfor(let i = 0; i < nodes.length; i++) {\r\n\t\t\tlet node = nodes[i];\r\n\t\t\tif(src == utils.removeQueryHash(node.src)) {\r\n\t\t\t\trs.node = node;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tif(rs.node) {\r\n\t\trs.src = utils.getNodeAbsolutePath(rs.node);\r\n\t}\r\n\tif(isRemoveQueryHash) {\r\n\t\trs.src = utils.removeQueryHash(rs.src);\r\n\t}\r\n\treturn rs;\r\n\r\n}\r\n\r\nfunction __createNode() {\r\n\tlet node = document.createElement('script');\r\n\tnode.type = 'text/javascript';\r\n\tnode.charset = 'utf-8';\r\n\tnode.async = \"async\";\r\n\treturn node;\r\n}\r\n\r\nfunction __removeListener(node, func, name, ieName) {\r\n\tif(node.detachEvent && !isOpera) {\r\n\t\tif(ieName) {\r\n\t\t\tnode.detachEvent(ieName, func);\r\n\t\t}\r\n\t} else {\r\n\t\tnode.removeEventListener(name, func, false);\r\n\t}\r\n}\r\n\r\n/**\r\n * callbackObj.onScriptLoad\r\n * callbackObj.onScriptError\r\n *\r\n */\r\nfunction __browserLoader(moduleName, url, callbackObj) {\r\n\tlet node = __createNode();\r\n\tmoduleName && node.setAttribute(DATA_ATTR_MODULE, moduleName);\r\n\tnode.setAttribute(DATA_ATTR_CONTEXT, defContextName);\r\n\r\n\tlet useAttach = !xsloader.isFunction(node.addEventListener) && node.attachEvent &&\r\n\t\t!(node.attachEvent.toString && node.attachEvent.toString().indexOf('[native code') < 0) &&\r\n\t\t!isOpera;\r\n\r\n\tif(useAttach) {\r\n\t\tnode.attachEvent('onreadystatechange', callbackObj.onScriptLoad);\r\n\t} else {\r\n\t\tnode.addEventListener('load', callbackObj.onScriptLoad, true);\r\n\t\tlet errListen = function() {\r\n\t\t\t__removeListener(node, errListen, 'error');\r\n\t\t\tcallbackObj.onScriptError.apply(this, arguments);\r\n\t\t};\r\n\t\tcallbackObj.errListen = errListen;\r\n\t\tnode.addEventListener('error', errListen, true);\r\n\t}\r\n\tappendHeadDom(node);\r\n\tif(utils.IE_VERSION > 0 && utils.IE_VERSION <= 10) {\r\n\t\txsloader.asyncCall(() => {\r\n\t\t\tnode.src = url; //在ie10-以下，必须在脚本插入head后再进行src的设置、且需要异步设置。\r\n\t\t});\r\n\t} else {\r\n\t\tnode.src = url;\r\n\t}\r\n}\r\n\r\nfunction __getScriptData(evt, callbackObj) {\r\n\tlet node = evt.currentTarget || evt.srcElement;\r\n\t__removeListener(node, callbackObj.onScriptLoad, 'load', 'onreadystatechange');\r\n\t__removeListener(node, callbackObj.errListen, 'error');\r\n\treturn {\r\n\t\tnode: node,\r\n\t\tname: node && node.getAttribute(DATA_ATTR_MODULE),\r\n\t\tsrc: utils.removeQueryHash(node && utils.getNodeAbsolutePath(node))\r\n\t};\r\n}\r\n\r\nfunction appendHeadDom(dom) {\r\n\tif(!xsloader.isDOM(dom)) {\r\n\t\tthrow new Error(\"expected dom object,but provided:\" + dom);\r\n\t}\r\n\tlet nextDom = lastAppendHeadDom.nextSibling;\r\n\thead.insertBefore(dom, nextDom);\r\n\t//\t\t\thead.appendChild(dom);\r\n\tlastAppendHeadDom = dom;\r\n}\r\n\r\n/////////////////////////\r\n\r\nfunction loadScript(moduleName, url, onload, onerror) {\r\n\tlet callbackObj = {};\r\n\tcallbackObj.onScriptLoad = function(evt) {\r\n\t\tif(callbackObj.removed) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(evt.type === 'load' || (readyRegExp.test((evt.currentTarget || evt.srcElement).readyState))) {\r\n\t\t\tcallbackObj.removed = true;\r\n\t\t\tlet scriptData = __getScriptData(evt, callbackObj);\r\n\t\t\tif(isSrcFromScriptLoad) {\r\n\t\t\t\tlastScriptSrc = scriptData.src; //已经不含参数\r\n\t\t\t\txsloader.asyncCall(() => {\r\n\t\t\t\t\tonload(scriptData);\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tif(utils.IE_VERSION > 0 || utils.IE_VERSION == \"edge\") { //ie下确保此事件在脚本之后执行。\r\n\t\t\t\t\txsloader.asyncCall(() => {\r\n\t\t\t\t\t\tonload(scriptData);\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\tonload(scriptData);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\tcallbackObj.onScriptError = function(evt) {\r\n\t\tif(callbackObj.removed) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tcallbackObj.removed = true;\r\n\t\tlet scriptData = __getScriptData(evt, callbackObj);\r\n\t\tonerror(scriptData);\r\n\t};\r\n\t__browserLoader(moduleName, url, callbackObj);\r\n}\r\n\r\nfunction doDefine(thiz, args, isRequire) {\r\n\t//\tconsole.log(\"**********************************[\");\r\n\tlet rs = getCurrentScript(); //已经不含参数\r\n\r\n\t//\tif(typeof args[0] == \"string\") {\r\n\t//\t\tconsole.log(\"args[0]=\" + args[0] + \",args[1]=\" + args[1] + \",src=\" + rs.src);\r\n\t//\t} else {\r\n\t//\t\tconsole.log(\"args[0]=\" + args[0] + \",src=\" + rs.src);\r\n\t//\t}\r\n\t//\tconsole.log(rs.node);\r\n\t//\tconsole.log(\"**********************************]\\n\");\r\n\tlet src = rs.src;\r\n\tlet defineObject = new DefineObject(src, thiz, args, isRequire);\r\n\tif(!isSrcFromScriptLoad) {\r\n\t\ttry { //防止执行其他脚本\r\n\t\t\tif(defineObject.src) {\r\n\t\t\t\tlet node = document.currentScript;\r\n\t\t\t\tif(node && node.getAttribute(\"src\") && node.getAttribute(DATA_ATTR_CONTEXT) != defContextName &&\r\n\t\t\t\t\tdefineObject.src != theLoaderUrl && defineObject.src != thePageUrl) {\r\n\t\t\t\t\tconsole.error(\"unknown js script module:\" + xsloader.xsJson2String(defineObject.src));\r\n\t\t\t\t\tconsole.error(node);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} catch(e) {\r\n\t\t\txsloader.config().error(e);\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tlet handle = new Handle(defineObject);\r\n\r\n\tlet isLoaderEnd = utils.isLoaderEnd();\r\n\txsloader.asyncCall(() => {\r\n\t\tif(isSrcFromScriptLoad && isLoaderEnd) {\r\n\t\t\t//执行顺序：当前脚本define>load事件(获取lastScriptSrc)>当前位置>onload\r\n\t\t\tdefineObject.src = lastScriptSrc;\r\n\t\t}\r\n\t\ttheRealDefine([defineObject]);\r\n\t});\r\n\treturn handle;\r\n}\r\n\r\nfunction predefine() {\r\n\tlet args = [];\r\n\tfor(let i = 0; i < arguments.length; i++) {\r\n\t\targs.push(arguments[i]);\r\n\t}\r\n\treturn doDefine(this, args, false);\r\n}\r\n\r\nlet isFirstRequire = true;\r\n\r\nfunction prerequire(deps, callback) {\r\n\tlet config = xsloader.config();\r\n\tif(!config) { //require必须是在config之后\r\n\t\tthrow new Error(\"not config\");\r\n\t}\r\n\r\n\tif(arguments.length == 1 && xsloader.isString(deps)) { //获取已经加载的模块\r\n\t\tlet originDeps = deps;\r\n\t\tlet pluginArgs = undefined;\r\n\t\tlet pluginIndex = deps.indexOf(\"!\");\r\n\t\tif(pluginIndex > 0) {\r\n\t\t\tpluginArgs = deps.substring(pluginIndex + 1);\r\n\t\t\tdeps = deps.substring(0, pluginIndex);\r\n\t\t\tif(pluginArgs) {\r\n\t\t\t\tlet argArr = [pluginArgs];\r\n\t\t\t\tutils.replaceModulePrefix(config, argArr); //前缀替换\r\n\t\t\t\tpluginArgs = argArr[0];\r\n\t\t\t}\r\n\t\t}\r\n\t\tlet module = moduleScript.getModule(deps);\r\n\t\tlet thatInvoker = getInvoker(this);\r\n\t\tif(!module) {\r\n\t\t\tdeps = thatInvoker.getUrl(deps, false);\r\n\t\t\tmodule = moduleScript.getModule(deps);\r\n\t\t}\r\n\t\tif(!module) {\r\n\t\t\tthrow new Error(\"the module '\" + originDeps + \"' is not load!\");\r\n\t\t} else if(module.state != \"defined\") {\r\n\t\t\tthrow new Error(\"the module '\" + originDeps + \"' is not defined:\" + module.state);\r\n\t\t}\r\n\t\tlet theMod;\r\n\t\tmoduleScript.newModuleInstance(module, thatInvoker, (depModule) => {\r\n\t\t\ttheMod = depModule.moduleObject();\r\n\t\t}, pluginArgs).initInstance(true);\r\n\t\tif(theMod === undefined) {\r\n\t\t\tthrow Error(\"the module '\" + originDeps + \"' is not load!\");\r\n\t\t}\r\n\t\treturn theMod;\r\n\t}\r\n\r\n\tlet selfname = xsloader.randId(\"_require\");\r\n\tif(xsloader.isFunction(deps)) {\r\n\t\tcallback = deps;\r\n\t\tdeps = [];\r\n\t}\r\n\tutils.appendInnerDeps(deps, callback);\r\n\tlet timeid;\r\n\tlet loading;\r\n\tlet isOk = false;\r\n\tlet customerErrCallback;\r\n\tlet isErr;\r\n\tif(isFirstRequire && config.loading.enable) {\r\n\t\tisFirstRequire = false;\r\n\t\tsetTimeout(() => {\r\n\t\t\tif(!isOk) {\r\n\t\t\t\tloading = new utils.ToProgress(config.loading);\r\n\t\t\t\tloading.autoIncrement();\r\n\t\t\t\tif(isErr) {\r\n\t\t\t\t\tloading.toError(config.loading.errColor);\r\n\t\t\t\t\tloading = null;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}, config.loading.delay);\r\n\t}\r\n\tlet clearTimer = function(isErr = false) {\r\n\t\tif(loading) {\r\n\t\t\tif(isErr) {\r\n\t\t\t\tloading.toError(config.loading.errColor);\r\n\t\t\t} else {\r\n\t\t\t\tloading.stopAuto();\r\n\t\t\t\tloading.finish();\r\n\t\t\t}\r\n\t\t\tloading = null;\r\n\t\t}\r\n\t\tif(timeid !== undefined) {\r\n\t\t\tclearTimeout(timeid);\r\n\t\t\ttimeid = undefined;\r\n\t\t}\r\n\t};\r\n\r\n\tlet handle = doDefine(this, [selfname, deps, function() {\r\n\t\tisOk = true;\r\n\t\tclearTimer();\r\n\t\t//\t\tconsole.log(\"2======require:\"+selfname);\r\n\t\t//\t\tconsole.log(callback);\r\n\t\tif(xsloader.isFunction(callback)) {\r\n\t\t\ttry {\r\n\t\t\t\tcallback.apply(this, arguments);\r\n\t\t\t} catch(e) {\r\n\t\t\t\thandle.onError(e);\r\n\t\t\t}\r\n\t\t}\r\n\t}], true);\r\n\r\n\thandle.error(function(err, invoker) {\r\n\t\tisErr = err;\r\n\t\tclearTimer(true);\r\n\t\tif(customerErrCallback) {\r\n\t\t\tcustomerErrCallback(err, invoker);\r\n\t\t} else {\r\n\t\t\tconsole.warn(\"invoker.url:\" + (invoker ? invoker.getUrl() : \"\"));\r\n\t\t\tconsole.warn(err);\r\n\t\t}\r\n\t});\r\n\thandle.error = function(errCallback) {\r\n\t\tcustomerErrCallback = errCallback;\r\n\t\treturn this;\r\n\t};\r\n\r\n\tlet checkResultFun = function() {\r\n\t\ttry {\r\n\t\t\tlet ifmodule = moduleScript.getModule(selfname);\r\n\t\t\t//console.log(isErr)\r\n\t\t\tif((!ifmodule || ifmodule.state != 'defined') && !isErr) {\r\n\t\t\t\tlet module = ifmodule;\r\n\t\t\t\thandle.onError(\"require timeout:selfname=\" + selfname + \",\\n\\tdeps=[\" + (deps ? deps.join(\",\") : \"\") + \"]\");\r\n\t\t\t\tif(module) {\r\n\t\t\t\t\tutils.each(module.deps, function(dep) {\r\n\t\t\t\t\t\tlet mod = moduleScript.getModule(dep);\r\n\t\t\t\t\t\tif(mod && mod.printOnNotDefined) {\r\n\t\t\t\t\t\t\tmod.printOnNotDefined();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} catch(e) {\r\n\t\t\tconsole.error(e);\r\n\t\t}\r\n\t\tclearTimer();\r\n\t};\r\n\ttimeid = setTimeout(checkResultFun, config.waitSeconds * 1000);\r\n\treturn handle;\r\n}\r\n\r\n//对于safari7-:在脚本加载事件中可获得正确的脚本地址\r\n\r\nconst initDefine = function(theDefine) {\r\n\ttheRealDefine = (defines, loaded) => {\r\n\t\tif(!xsloader.config()) { //还没有配置\r\n\t\t\tglobalDefineQueue.push(defines);\r\n\t\t} else {\r\n\t\t\ttheDefine(defines, loaded);\r\n\t\t}\r\n\t};\r\n\treturn {\r\n\t\tpredefine,\r\n\t\tprerequire,\r\n\t};\r\n};\r\n\r\nconst onConfigedCallback = function() {\r\n\twhile(globalDefineQueue.length) {\r\n\t\tlet defines = globalDefineQueue.shift();\r\n\t\ttheRealDefine(defines);\r\n\t}\r\n};\r\n\r\nexport default {\r\n\tdefContextName,\r\n\ttheLoaderScript,\r\n\ttheLoaderUrl,\r\n\tthePageUrl,\r\n\tappendHeadDom,\r\n\tinitDefine,\r\n\tHandle,\r\n\tInvoker,\r\n\tDefineObject,\r\n\tloadScript,\r\n\tcurrentDefineModuleQueue,\r\n\tonConfigedCallback,\r\n\tINNER_DEPS_PLUGIN,\r\n\tinnerDepsMap,\r\n};","import loader from './loader.js';\r\nimport \"../public/index.js\";\r\nimport utils from \"../util/index.js\";\r\n\r\nconst global = utils.global;\r\nconst xsloader = global.xsloader;\r\n\r\nimport script from \"./script.js\";\r\nimport moduleScript from \"./module.js\";\r\n\r\nlet theContext;\r\nlet theConfig;\r\nlet argsObject = {};\r\n\r\nxsloader.config = function() {\r\n\treturn theConfig;\r\n};\r\nxsloader.script = function() {\r\n\treturn script.theLoaderScript;\r\n};\r\nxsloader.scriptSrc = function() {\r\n\treturn script.theLoaderUrl;\r\n};\r\n\r\nxsloader.putUrlArgs = function(argsObj) {\r\n\targsObject = xsloader.extend(argsObject, argsObj);\r\n};\r\n\r\nxsloader.getUrlArgs = function() {\r\n\tlet obj = xsloader.extend({}, argsObject);\r\n\treturn obj;\r\n};\r\n\r\nxsloader.clearUrlArgs = function() {\r\n\targsObject = {};\r\n};\r\n\r\nxsloader.appendHeadDom = script.appendHeadDom;\r\n\r\nxsloader.hasDefine = function(name) {\r\n\tlet has = false;\r\n\tlet module = moduleScript.getModule(name);\r\n\tif(!module || module.state == \"init\") {\r\n\r\n\t} else {\r\n\t\thas = true;\r\n\t}\r\n\treturn has;\r\n};\r\n\r\n//用于把\"group:project:version\"转换成url地址,返回一个String或包含多个url地址的数组\r\nxsloader._resUrlBuilder = function(groupName) {\r\n\tthrow new Error('resUrlBuilder not found!');\r\n};\r\n\r\nxsloader.clear_module_ = function() {\r\n\tlet modules = arguments;\r\n\tfor(let i = 0; i < modules.length; i++) {\r\n\t\tif(modules[i]) {\r\n\t\t\tdelete modules[i]._module_;\r\n\t\t\tdelete modules[i]._modules_;\r\n\t\t}\r\n\t}\r\n};\r\n\r\nfunction _newContext() {\r\n\tlet context = {\r\n\t\tcontextName: script.contextName,\r\n\t\tdefQueue: []\r\n\t};\r\n\treturn context;\r\n}\r\n\r\nloader.loaderFun((option) => {\r\n\tif(theContext) {\r\n\t\tthrow new Error(\"already configed!\");\r\n\t}\r\n\toption = xsloader.extend({\r\n\t\tbaseUrl: utils.getPathWithRelative(location.pathname, \"./\", xsloader.endsWith(location.pathname, \"/\")),\r\n\t\turlArgs: {},\r\n\t\tignoreProperties: false,\r\n\t\tpaths: {},\r\n\t\tdepsPaths: {},\r\n\t\tdeps: {},\r\n\t\tjsExts: undefined,\r\n\t\tproperties: {},\r\n\t\tloading: { //顶部加载进度条\r\n\r\n\t\t},\r\n\t\tmodulePrefix: {},\r\n\t\tdefineFunction: {},\r\n\t\tmodulePrefixCount: 0,\r\n\t\twaitSeconds: 20,\r\n\t\tautoUrlArgs() {\r\n\t\t\treturn false;\r\n\t\t},\r\n\t\tinstance: \"single\",\r\n\t\tdealtDeps: {},\r\n\t\tdealProperties(obj) {\r\n\t\t\treturn utils.propertiesDeal(obj, option.properties);\r\n\t\t},\r\n\t\tisInUrls(m) {\r\n\t\t\treturn !!this.getUrls(m);\r\n\t\t},\r\n\t\tgetUrls(m) {\r\n\t\t\treturn this.paths[m] || this.depsPaths[m];\r\n\t\t},\r\n\t\tgetDeps(m) {\r\n\t\t\tlet as = this.dealtDeps[m] || [];\r\n\t\t\tlet deps = [];\r\n\t\t\tlet hasOrderDep = undefined;\r\n\r\n\t\t\tif(as.length > 0 && (as[0] === true || as[0] === false)) {\r\n\t\t\t\tif(as[0]) {\r\n\t\t\t\t\tdeps = [\r\n\t\t\t\t\t\t[]\r\n\t\t\t\t\t];\r\n\t\t\t\t\thasOrderDep = true;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tas.splice(0, 1);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tfor(let i = 0; i < as.length; i++) {\r\n\t\t\t\tif(hasOrderDep === true) {\r\n\t\t\t\t\tdeps[0].push(as[i]);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tdeps.push(as[i]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn deps;\r\n\t\t},\r\n\t\tdealUrl(module, url) {\r\n\t\t\tlet urlArg;\r\n\t\t\tlet nameOrUrl;\r\n\t\t\tif(this.autoUrlArgs()) {\r\n\t\t\t\turlArg = \"_t=\" + new Date().getTime();\r\n\t\t\t} else if(xsloader.isString(module)) {\r\n\t\t\t\turlArg = this.urlArgs[module];\r\n\t\t\t\tif(urlArg) {\r\n\t\t\t\t\tnameOrUrl = module;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tnameOrUrl = module;\r\n\t\t\t\t\turlArg = this.forPrefixSuffix(module);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(!urlArg) {\r\n\t\t\t\t\tnameOrUrl = \"*\";\r\n\t\t\t\t\turlArg = this.urlArgs[\"*\"];\r\n\t\t\t\t}\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\turlArg = this.urlArgs[url];\r\n\t\t\t\tif(urlArg) {\r\n\t\t\t\t\tnameOrUrl = url;\r\n\t\t\t\t} else {\r\n\t\t\t\t\turlArg = this.forPrefixSuffix(url);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(!urlArg) {\r\n\t\t\t\t\tnameOrUrl = module.selfname;\r\n\t\t\t\t\turlArg = this.urlArgs[nameOrUrl];\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(!urlArg) {\r\n\t\t\t\t\tnameOrUrl = module.aurl;\r\n\t\t\t\t\turlArg = this.forPrefixSuffix(nameOrUrl);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(!urlArg) {\r\n\t\t\t\t\tnameOrUrl = \"*\";\r\n\t\t\t\t\turlArg = this.urlArgs[\"*\"];\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\t\t\tif(xsloader.isFunction(urlArg)) {\r\n\t\t\t\turlArg = urlArg.call(this, nameOrUrl);\r\n\t\t\t}\r\n\t\t\tfor(let k in argsObject) { //加入全局的参数\r\n\t\t\t\turlArg += \"&\" + k + \"=\" + encodeURIComponent(argsObject[k]);\r\n\t\t\t}\r\n\t\t\treturn xsloader.appendArgs2Url(url, urlArg);\r\n\t\t},\r\n\t\tdealUrlArgs(url) {\r\n\t\t\turl = utils.getPathWithRelative(location.href, url);\r\n\t\t\treturn this.dealUrl(url, url);\r\n\t\t},\r\n\t\tdefaultVersion: {}\r\n\t}, option);\r\n\r\n\toption.loading = xsloader.extend({\r\n        enable: true,\r\n        color: '#2196f3',\r\n        bgColor:'rgba(0,0,0,0.1)',\r\n        errColor: '#f5222d',\r\n        duration: 0.2,\r\n        height: 1,\r\n        delay: 500,\r\n\t}, option.loading);\r\n\r\n\tif(!xsloader.endsWith(option.baseUrl, \"/\")) {\r\n\t\toption.baseUrl += \"/\";\r\n\t}\r\n\toption.baseUrl = utils.getPathWithRelative(location.href, option.baseUrl);\r\n\r\n\tif(!option.ignoreProperties) {\r\n\t\toption = option.dealProperties(option);\r\n\t}\r\n\r\n\tutils.strValue2Arr(option.paths);\r\n\tutils.strValue2Arr(option.depsPaths);\r\n\tutils.strValue2Arr(option.deps);\r\n\r\n\tif(!xsloader.isFunction(option.autoUrlArgs)) {\r\n\t\tlet isAutoUrlArgs = option.autoUrlArgs;\r\n\t\toption.autoUrlArgs = function() {\r\n\t\t\treturn isAutoUrlArgs;\r\n\t\t};\r\n\t}\r\n\r\n\tlet modulePrefixCount = 0;\r\n\tfor(let prefix in option.modulePrefix) {\r\n\t\tif(xsloader.startsWith(prefix, \".\") || xsloader.startsWith(prefix, \"/\")) {\r\n\t\t\tthrow new Error(\"modulePrefix can not start with '.' or '/'(\" + prefix + \")\");\r\n\t\t}\r\n\t\tmodulePrefixCount++;\r\n\t}\r\n\toption.modulePrefixCount = modulePrefixCount;\r\n\tif(modulePrefixCount > 0) {\r\n\t\t//替换urlArgs中地址前缀\r\n\t\tlet star = option.urlArgs[\"*\"];\r\n\t\tdelete option.urlArgs[\"*\"];\r\n\r\n\t\tlet urlArgsArr = [];\r\n\t\tfor(let k in option.urlArgs) {\r\n\t\t\tlet url = k;\r\n\t\t\tif(utils.isJsFile(url)) { //处理相对\r\n\t\t\t\tif(xsloader.startsWith(url, \".\") || xsloader.startsWith(url, \"/\") && !xsloader.startsWith(url, \"//\")) {\r\n\t\t\t\t\turl = utils.getPathWithRelative(script.theLoaderUrl, url);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tlet absolute = utils.dealPathMayAbsolute(url);\r\n\t\t\t\t\tif(absolute.absolute) {\r\n\t\t\t\t\t\turl = absolute.path;\r\n\t\t\t\t\t} else if(!xsloader.startsWith(url, \"*]\")) { //排除*]；单*[可以有前缀\r\n\t\t\t\t\t\turl = option.baseUrl + url;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\t\t\turlArgsArr.push({\r\n\t\t\t\turl: url,\r\n\t\t\t\targs: option.urlArgs[k]\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tfor(let prefix in option.modulePrefix) {\r\n\t\t\tlet replaceStr = option.modulePrefix[prefix].replace;\r\n\t\t\tfor(let i = 0; i < urlArgsArr.length; i++) {\r\n\t\t\t\tlet urlArgObj = urlArgsArr[i];\r\n\t\t\t\tlet starP = \"\";\r\n\t\t\t\tif(xsloader.startsWith(urlArgObj.url, \"*[\")) {\r\n\t\t\t\t\tstarP = \"*[\";\r\n\t\t\t\t\turlArgObj.url = urlArgObj.url.substring(2);\r\n\t\t\t\t}\r\n\t\t\t\tif(xsloader.startsWith(urlArgObj.url, prefix)) {\r\n\t\t\t\t\turlArgObj.url = replaceStr + urlArgObj.url.substring(prefix.length);\r\n\t\t\t\t}\r\n\t\t\t\tstarP && (urlArgObj.url = starP + urlArgObj.url);\r\n\t\t\t}\r\n\t\t}\r\n\t\toption.urlArgs = {};\r\n\t\toption.urlArgs[\"*\"] = star;\r\n\t\tfor(let i = 0; i < urlArgsArr.length; i++) {\r\n\t\t\tlet urlArgObj = urlArgsArr[i];\r\n\t\t\toption.urlArgs[urlArgObj.url] = urlArgObj.args;\r\n\t\t}\r\n\t}\r\n\r\n\t//预处理urlArgs中的*[与*]\r\n\tlet _urlArgs_prefix = [];\r\n\tlet _urlArgs_suffix = [];\r\n\toption._urlArgs_prefix = _urlArgs_prefix;\r\n\toption._urlArgs_suffix = _urlArgs_suffix;\r\n\r\n\tfor(let k in option.urlArgs) {\r\n\t\tlet url = k;\r\n\t\tif(xsloader.startsWith(url, \"*[\")) {\r\n\t\t\tlet strfix = url.substring(2);\r\n\t\t\tif(xsloader.startsWith(strfix, \".\") || xsloader.startsWith(strfix, \"/\") && !xsloader.startsWith(strfix, \"//\")) {\r\n\t\t\t\tstrfix = utils.getPathWithRelative(script.theLoaderUrl, strfix);\r\n\t\t\t} else {\r\n\t\t\t\tlet absolute = utils.dealPathMayAbsolute(strfix);\r\n\t\t\t\tif(absolute.absolute) {\r\n\t\t\t\t\tstrfix = absolute.path;\r\n\t\t\t\t} else {\r\n\t\t\t\t\turl = option.baseUrl + url;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t_urlArgs_prefix.push({\r\n\t\t\t\tstrfix: strfix,\r\n\t\t\t\tvalue: option.urlArgs[k]\r\n\t\t\t});\r\n\t\t\tdelete option.urlArgs[k];\r\n\t\t} else if(xsloader.startsWith(url, \"*]\")) {\r\n\t\t\t_urlArgs_suffix.push({\r\n\t\t\t\tstrfix: url.substring(2),\r\n\t\t\t\tvalue: option.urlArgs[k]\r\n\t\t\t});\r\n\t\t\tdelete option.urlArgs[k];\r\n\t\t}\r\n\t}\r\n\r\n\toption.forPrefixSuffix = function(urlOrName) {\r\n\t\t//前缀判断\r\n\t\tfor(let i = 0; i < _urlArgs_prefix.length; i++) {\r\n\t\t\tlet strfixObj = _urlArgs_prefix[i];\r\n\t\t\tif(xsloader.startsWith(urlOrName, strfixObj.strfix)) {\r\n\t\t\t\tlet value;\r\n\t\t\t\tif(xsloader.isFunction(strfixObj.value)) {\r\n\t\t\t\t\tvalue = strfixObj.value.call(this, urlOrName);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvalue = strfixObj.value;\r\n\t\t\t\t}\r\n\t\t\t\treturn value;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//后缀判断\r\n\t\tfor(let i = 0; i < _urlArgs_suffix.length; i++) {\r\n\t\t\tlet strfixObj = _urlArgs_suffix[i];\r\n\t\t\tif(xsloader.endsWith(urlOrName, strfixObj.strfix)) {\r\n\t\t\t\tlet value;\r\n\t\t\t\tif(xsloader.isFunction(strfixObj.value)) {\r\n\t\t\t\t\tvalue = strfixObj.value.call(this, urlOrName);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvalue = strfixObj.value;\r\n\t\t\t\t}\r\n\t\t\t\treturn value;\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tfor(let name in option.paths) {\r\n\t\tutils.replaceModulePrefix(option, option.paths[name]); //前缀替换\r\n\t}\r\n\tfor(let name in option.depsPaths) {\r\n\t\tutils.replaceModulePrefix(option, option.depsPaths[name]); //前缀替换\r\n\t}\r\n\r\n\t//处理依赖\r\n\tlet dealtDeps = option.dealtDeps;\r\n\r\n\tlet pushDeps = (dealtDepArray, depsArray) => {\r\n\t\tutils.each(depsArray, (dep) => {\r\n\t\t\tdealtDepArray.push(dep);\r\n\t\t});\r\n\t};\r\n\r\n\tfor(let keyName in option.deps) {\r\n\t\tlet paths = keyName.split('::');\r\n\t\tlet depsArray = option.deps[keyName];\r\n\t\tutils.each(paths, (path) => {\r\n\t\t\tif(path == '*') {\r\n\t\t\t\tfor(let m in option.depsPaths) {\r\n\t\t\t\t\tlet dealtDepArray = dealtDeps[m] = dealtDeps[m] || [];\r\n\t\t\t\t\tpushDeps(dealtDepArray, depsArray);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tlet dealtDepArray = (dealtDeps[path] = dealtDeps[path] || []);\r\n\t\t\t\tpushDeps(dealtDepArray, depsArray);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\ttheConfig = option;\r\n\ttheContext = _newContext();\r\n\tscript.onConfigedCallback(); //完成配置回调\r\n\treturn theConfig;\r\n});","import utils from \"./util/index.js\";\r\nimport script from \"./core/script.js\";\r\nimport moduleScript from \"./core/module.js\";\r\n\r\nconst global = utils.global;\r\nconst xsloader = global.xsloader;\r\n\r\nconst defineHandle = script.initDefine(function theRealDefine(defines, loaded = () => {}) {\r\n\tutils.each(defines, (defineObject) => {\r\n\t\tif(xsloader.isFunction(defineObject.callback)) {\r\n\t\t\tlet originCallback = defineObject.callback;\r\n\t\t\tdefineObject.callback = function() {\r\n\t\t\t\t//\t\t\t\tif(defineObject.isRequire) {\r\n\t\t\t\t//\t\t\t\t\tconsole.log(\"1======require:\" + defineObject.selfname);\r\n\t\t\t\t//\t\t\t\t\tconsole.log(defineObject);\r\n\t\t\t\t//\t\t\t\t\tconsole.log(originCallback);\r\n\t\t\t\t//\t\t\t\t}\r\n\t\t\t\tlet config = xsloader.config();\r\n\t\t\t\tlet rt;\r\n\r\n\t\t\t\tlet defineFun;\r\n\t\t\t\tutils.each(defineObject.names, (name) => {\r\n\t\t\t\t\tlet fun = config.defineFunction[name];\r\n\t\t\t\t\tif(xsloader.isFunction(fun)) {\r\n\t\t\t\t\t\tdefineFun = fun;\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\tif(defineFun) {\r\n\t\t\t\t\tlet args = [];\r\n\t\t\t\t\tfor(let i = 0; i < arguments.length; i++) {\r\n\t\t\t\t\t\targs.push(arguments[i]);\r\n\t\t\t\t\t}\r\n\t\t\t\t\trt = defineFun.apply(this, [originCallback, this, args]);\r\n\t\t\t\t} else {\r\n\t\t\t\t\trt = originCallback.apply(this, arguments);\r\n\t\t\t\t}\r\n\r\n\t\t\t\toriginCallback = null;\r\n\t\t\t\treturn rt;\r\n\t\t\t};\r\n\t\t}\r\n\t\tonModuleLoaded(defineObject, moduleScript.getLastDefineObject(defineObject.src));\r\n\t\tloaded();\r\n\t});\r\n});\r\n\r\n/**\r\n * 当前模块脚本已经完成加载、但其依赖的模块可能需要加载。\r\n * 当前模块：src、selfname已经确定。\r\n * 若当前模块依赖为0、则可以直接finish；若当前模块存在其他依赖、则设置回调，等待被其他地方依赖时再触发。\r\n * @param {Object} defineObject 当前模块\r\n * @param {Object} lastDefineObject 第一次加载当前模块的模块\r\n */\r\nfunction onModuleLoaded(defineObject, lastDefineObject) {\r\n\t//同一个模块可能分属于不同的module对象，加载者module当前处于loading状态、需要将其依赖追加进来、确保依赖完整\r\n\tmoduleScript.appendLoadingModuleDeps(defineObject);\r\n\t//先根据src获取模块\r\n\tlet ifmodule = moduleScript.getModule(defineObject.src, defineObject.selfname);\r\n\tif(ifmodule) {\r\n\t\tif(ifmodule.state == \"loading\") {\r\n\t\t\tifmodule.reinitByDefineObject(defineObject);\r\n\t\t}\r\n\t} else {\r\n\t\tifmodule = moduleScript.newModule(defineObject);\r\n\t}\r\n\r\n\tif(defineObject.selfname != defineObject.src) {\r\n\t\tdefineObject.pushName(defineObject.selfname);\r\n\t}\r\n\r\n\tif(ifmodule.selfname != defineObject.src) {\r\n\t\t//此处的名字可能由配置指定\r\n\t\tdefineObject.pushName(ifmodule.selfname);\r\n\t}\r\n\t//一个模块的所有名字，包括src\r\n\tutils.each(defineObject.names, (name) => {\r\n\t\tmoduleScript.setModule(name, ifmodule);\r\n\t\tif(xsloader._ignoreAspect_[name]) {\r\n\t\t\tifmodule.ignoreAspect = true;\r\n\t\t}\r\n\t});\r\n\tdefineObject.appendConfigDepsAndEmbedDeps(ifmodule); //添加配置依赖:在配置文件里直接通过src、名称配置的\r\n\r\n\tlet module = ifmodule;\r\n\r\n\tif(defineObject.handle.before) {\r\n\t\tdefineObject.handle.before(module.deps);\r\n\t}\r\n\tif(lastDefineObject && lastDefineObject.handle.depBefore) {\r\n\t\tlastDefineObject.handle.depBefore(lastDefineObject.index, module.selfname, module.deps, 2);\r\n\t}\r\n\r\n\tmodule.setState(\"loaded\");\r\n\tmodule.setInstanceType(defineObject.handle.instance || xsloader.config().instance);\r\n\r\n\tif(module.deps.length == 0) {\r\n\t\ttry {\r\n\t\t\tmodule.finish([]); //递归结束\r\n\t\t} catch(e) {\r\n\t\t\tdefineObject.handle.onError(e);\r\n\t\t}\r\n\t} else {\r\n\t\t//在其他模块依赖此模块时进行加载\r\n\t\tlet needCallback = function() {\r\n\t\t\tmoduleScript.everyRequired(defineObject, module, (depModules) => {\r\n\t\t\t\tlet args = [];\r\n\t\t\t\tlet depModuleArgs = [];\r\n\t\t\t\tutils.each(depModules, (depModule) => {\r\n\t\t\t\t\tdepModuleArgs.push(depModule);\r\n\t\t\t\t\targs.push(depModule && depModule.moduleObject());\r\n\t\t\t\t});\r\n\t\t\t\targs.push(depModuleArgs);\r\n\t\t\t\ttry {\r\n\t\t\t\t\tmodule.finish(args);\r\n\t\t\t\t} catch(e) {\r\n\t\t\t\t\tdefineObject.handle.onError(e);\r\n\t\t\t\t}\r\n\t\t\t}, (err, invoker) => {\r\n\t\t\t\tdefineObject.handle.onError(err, invoker);\r\n\t\t\t});\r\n\t\t};\r\n\r\n\t\tif(defineObject.isRequire) {\r\n\t\t\tneedCallback();\r\n\t\t} else {\r\n\t\t\tmodule.whenNeed(needCallback);\r\n\t\t}\r\n\t}\r\n\r\n}\r\n\r\n//定义模块\r\nconst define = function() {\r\n\treturn defineHandle.predefine.apply(this, arguments);\r\n};\r\n\r\nconst require = function() {\r\n\treturn defineHandle.prerequire.apply(this, arguments);\r\n};\r\n\r\nrequire.has = function() {\r\n\tvar args = arguments;\r\n\tif(args.length == 0) {\r\n\t\treturn false;\r\n\t}\r\n\tfor(var i = 0; i < args.length; i++) {\r\n\t\tvar module = moduleScript.getModule(args[i]);\r\n\t\tif(!module || module.state != \"defined\") {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\treturn true;\r\n};\r\n\r\nxsloader.define = define;\r\nxsloader.defineAsync = define;\r\nxsloader.require = require;\r\nglobal.define = define;\r\nglobal.require = require;\r\n\r\ndefine.amd = true;\r\ndefine(\"exports\", function() {});","import script from \"../script.js\";\r\nimport utils from \"../../util/index.js\";\r\nconst global = utils.global;\r\nconst xsloader = global.xsloader;\r\n\r\n//内部依赖加载插件\r\n\r\nxsloader.define(script.INNER_DEPS_PLUGIN, {\r\n\tpluginMain(depId, onload, onerror, config) {\r\n\t\tlet depsObj = script.innerDepsMap[depId];\r\n\t\tlet deps = depsObj.deps;\r\n\t\t//delete innerDepsMap[depId];\r\n\t\tlet newInvoker = this.invoker().withAbsUrl(depsObj.absUrl);\r\n\t\tnewInvoker.src = () => depsObj.src;\r\n\t\tnewInvoker.require(deps, function() {\r\n\t\t\tlet args = [];\r\n\t\t\tfor(let k = 0; k < arguments.length; k++) {\r\n\t\t\t\targs.push(arguments[k]);\r\n\t\t\t}\r\n\t\t\tonload(args);\r\n\t\t}).then({\r\n\t\t\torderDep: depsObj.orderDep,\r\n\t\t\terror(err, invoker) {\r\n\t\t\t\tonerror(new utils.PluginError(err, invoker));\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\tgetCacheKey(depId) {\r\n\t\treturn depId;\r\n\t}\r\n});","import utils from \"../../util/index.js\";\r\nconst global = utils.global;\r\nconst xsloader = global.xsloader;\r\n\r\nxsloader.define(\"ready\", {\r\n\tpluginMain(depId, onload, onerror, config) {\r\n\t\txsloader.onReady(function() {\r\n\t\t\tonload();\r\n\t\t});\r\n\t}\r\n});","import utils from \"../../util/index.js\";\r\nconst global = utils.global;\r\nconst xsloader = global.xsloader;\r\n\r\n/**\r\n * 格式:name!module\r\n */\r\nxsloader.define(\"try\", {\r\n\tisSingle: true,\r\n\tpluginMain(arg, onload, onerror, config) {\r\n\t\tlet dep = arg;\r\n\t\tthis.invoker().withAbsUrl().require([dep], function(mod, depModuleArgs) {\r\n\t\t\tonload(mod);\r\n\t\t}).error(function(e) {\r\n\t\t\tconsole.warn(e);\r\n\t\t\tonload(null);\r\n\t\t});\r\n\t}\r\n});","import utils from \"../../util/index.js\";\r\nconst global = utils.global;\r\nconst xsloader = global.xsloader;\r\n\r\nxsloader.define(\"nodeps\", {\r\n\tisSingle: true,\r\n\tpluginMain(arg, onload, onerror, config) {\r\n\t\tthis.invoker().withAbsUrl().require([arg], function(mod, depModuleArgs) {\r\n\t\t\tonload(mod);\r\n\t\t}).then({\r\n\t\t\tdepBefore(index, dep, depDeps) {\r\n\t\t\t\tdepDeps.splice(0, depDeps.length);\r\n\t\t\t}\r\n\t\t}).error(function(e) {\r\n\t\t\tonerror(e);\r\n\t\t});\r\n\t}\r\n});","import moduleScript from \"../module.js\";\r\nimport utils from \"../../util/index.js\";\r\nconst global = utils.global;\r\nconst xsloader = global.xsloader;\r\n\r\nxsloader.define(\"exists\", {\r\n\tisSingle: true,\r\n\tpluginMain(arg, onload, onerror, config) {\r\n\t\tlet vars = arg.split(\"|\");\r\n\t\tfor(let i = 0; i < vars.length; i++) {\r\n\t\t\tvars[i] = vars[i].trim();\r\n\t\t}\r\n\t\tif(vars.length == 0) {\r\n\t\t\tonerror(\"args error for exists!\");\r\n\t\t} else {\r\n\t\t\tlet moduleName = vars[0];\r\n\t\t\tlet module = moduleScript.getModule(moduleName);\r\n\t\t\tif(module) {\r\n\t\t\t\tthis.invoker().withAbsUrl().require([moduleName], function(mod, depModuleArgs) {\r\n\t\t\t\t\tonload(mod);\r\n\t\t\t\t}).error(function(e) {\r\n\t\t\t\t\tonerror(e);\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tlet obj = undefined;\r\n\t\t\t\tfor(let i = 1; i < vars.length; i++) {\r\n\t\t\t\t\tif(window[vars[i]]) {\r\n\t\t\t\t\t\tobj = window[vars[i]];\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif(obj === undefined) {\r\n\t\t\t\t\tonerror(\"not found:\" + arg);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tonload(obj);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n});","import moduleScript from \"../module.js\";\r\nimport utils from \"../../util/index.js\";\r\nconst global = utils.global;\r\nconst xsloader = global.xsloader;\r\n\r\n/**\r\n * 格式:name!moduleName=>>modulePath\r\n */\r\n\r\nxsloader.define(\"name\", {\r\n\tisSingle: true,\r\n\tpluginMain(arg, onload, onerror, config) {\r\n\t\tlet index = arg.indexOf(\"=>>\");\r\n\t\tif(index == -1) {\r\n\t\t\tonerror(\"expected:=>>\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet moduleName = arg.substring(0, index);\r\n\t\tmoduleName = moduleName.replace(/，/g, ',');\r\n\t\tlet names = moduleName.split(\",\");\r\n\t\tlet dep = arg.substring(index + 3);\r\n\t\tthis.invoker().withAbsUrl().require([dep], function(mod, depModuleArgs) {\r\n\t\t\tlet existsMods = [];\r\n\t\t\tfor(let i = 0; i < names.length; i++) {\r\n\t\t\t\tlet newName = names[i];\r\n\t\t\t\tlet lastM = moduleScript.getModule(newName);\r\n\t\t\t\tif(lastM && lastM.state != \"init\" && !lastM.preDependModule) {\r\n\t\t\t\t\texistsMods.push(\"\\tselfname=\" + newName + \",state=\" + lastM.state + \",src=\" + lastM.src);\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tlet module = depModuleArgs[0].module;\r\n\t\t\t\tif(lastM && !lastM.preDependModule) {\r\n\t\t\t\t\tlastM.toOtherModule(module);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tmoduleScript.setModule(newName, module);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(existsMods.length) {\r\n\t\t\t\tonerror(\"already exists:\" + existsMods.join('\\n'));\r\n\t\t\t} else {\r\n\t\t\t\tonload(mod);\r\n\t\t\t}\r\n\t\t}).error(function(e) {\r\n\t\t\tonerror(e);\r\n\t\t});\r\n\t}\r\n});","import utils from \"../../util/index.js\";\r\nconst global = utils.global;\r\nconst xsloader = global.xsloader;\r\n\r\n/*\r\n * Require-CSS RequireJS css! loader plugin\r\n * 0.1.8\r\n * Guy Bedford 2014\r\n * MIT\r\n */\r\nxsloader.define(\"css\", function() {\r\n\tif(typeof window == 'undefined')\r\n\t\treturn {\r\n\t\t\tload: function(n, r, load) {\r\n\t\t\t\tload();\r\n\t\t\t}\r\n\t\t};\r\n\tlet engine = window.navigator.userAgent.match(/Trident\\/([^ ;]*)|AppleWebKit\\/([^ ;]*)|Opera\\/([^ ;]*)|rv\\:([^ ;]*)(.*?)Gecko\\/([^ ;]*)|MSIE\\s([^ ;]*)|AndroidWebKit\\/([^ ;]*)/) || 0;\r\n\tlet useImportLoad = false;\r\n\tlet useOnload = true;\r\n\tif(engine[1] || engine[7])\r\n\t\tuseImportLoad = parseInt(engine[1]) < 6 || parseInt(engine[7]) <= 9;\r\n\telse if(engine[2] || engine[8] || 'WebkitAppearance' in document.documentElement.style)\r\n\t\tuseOnload = false;\r\n\telse if(engine[4])\r\n\t\tuseImportLoad = parseInt(engine[4]) < 18;\r\n\tlet cssAPI = {};\r\n\tlet curStyle, curSheet;\r\n\tlet createStyle = function() {\r\n\t\tcurStyle = document.createElement('style');\r\n\t\txsloader.appendHeadDom(curStyle);\r\n\t\tcurSheet = curStyle.styleSheet || curStyle.sheet;\r\n\t};\r\n\tlet ieCnt = 0;\r\n\tlet ieLoads = [];\r\n\tlet ieCurCallback;\r\n\tlet createIeLoad = function(url) {\r\n\t\tcurSheet.addImport(url);\r\n\t\tcurStyle.onload = function() {\r\n\t\t\tprocessIeLoad();\r\n\t\t};\r\n\r\n\t\tieCnt++;\r\n\t\tif(ieCnt == 31) {\r\n\t\t\tcreateStyle();\r\n\t\t\tieCnt = 0;\r\n\t\t}\r\n\t};\r\n\tlet processIeLoad = function() {\r\n\t\tieCurCallback();\r\n\t\tlet nextLoad = ieLoads.shift();\r\n\t\tif(!nextLoad) {\r\n\t\t\tieCurCallback = null;\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tieCurCallback = nextLoad[1];\r\n\t\tcreateIeLoad(nextLoad[0]);\r\n\t};\r\n\tlet importLoad = function(url, callback) {\r\n\t\tcallback = callback || function() {};\r\n\t\tif(!curSheet || !curSheet.addImport)\r\n\t\t\tcreateStyle();\r\n\r\n\t\tif(curSheet && curSheet.addImport) {\r\n\t\t\tif(ieCurCallback) {\r\n\t\t\t\tieLoads.push([url, callback]);\r\n\t\t\t} else {\r\n\t\t\t\tcreateIeLoad(url);\r\n\t\t\t\tieCurCallback = callback;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tcurStyle.textContent = '@import \"' + url + '\";';\r\n\t\t\tlet loadInterval = setInterval(function() {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tcurStyle.sheet.cssRules;\r\n\t\t\t\t\tclearInterval(loadInterval);\r\n\t\t\t\t\tcallback();\r\n\t\t\t\t} catch(e) {\r\n\t\t\t\t\tconsole.warn(e);\r\n\t\t\t\t}\r\n\t\t\t}, 10);\r\n\t\t}\r\n\t};\r\n\tlet linkLoad = function(url, callback) {\r\n\t\tcallback = callback || function() {};\r\n\t\tlet link = document.createElement('link');\r\n\t\tlink.type = 'text/css';\r\n\t\tlink.rel = 'stylesheet';\r\n\t\tif(useOnload)\r\n\t\t\tlink.onload = function() {\r\n\t\t\t\tlink.onload = function() {};\r\n\t\t\t\tsetTimeout(callback, 7);\r\n\t\t\t};\r\n\t\telse {\r\n\t\t\tlet loadInterval = setInterval(function() {\r\n\t\t\t\tfor(let i = 0; i < document.styleSheets.length; i++) {\r\n\t\t\t\t\tlet sheet = document.styleSheets[i];\r\n\t\t\t\t\tif(sheet.href == link.href) {\r\n\t\t\t\t\t\tclearInterval(loadInterval);\r\n\t\t\t\t\t\treturn callback();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}, 10);\r\n\t\t}\r\n\t\tlink.href = url;\r\n\t\txsloader.appendHeadDom(link);\r\n\t};\r\n\tcssAPI.pluginMain = function(cssId, onload, onerror, config) {\r\n\t\t//\t\t\tif(cssId.indexOf(\".css\") != cssId.length - 4) {\r\n\t\t//\t\t\t\tcssId += \".css\";\r\n\t\t//\t\t\t}\r\n//\t\tconsole.log(\"cssId=\"+cssId+\",cssSrc=\"+this.invoker().getUrl(cssId, true)+\",absUrl=\"+this.invoker().absUrl());\r\n\t\t(useImportLoad ? importLoad : linkLoad)(this.invoker().getUrl(cssId, true), onload);\r\n\t};\r\n\tcssAPI.getCacheKey = function(cssId) {\r\n\t\t//\t\t\tif(cssId.indexOf(\".css\") != cssId.length - 4) {\r\n\t\t//\t\t\t\tcssId += \".css\";\r\n\t\t//\t\t\t}\r\n\t\tlet invoker = this.invoker();\r\n\t\treturn invoker ? invoker.getUrl(cssId, true) : cssId;\r\n\t};\r\n\tcssAPI.loadCss = function(cssPath, callback) {\r\n\t\t(useImportLoad ? importLoad : linkLoad)(xsloader.getUrl(cssPath), callback);\r\n\t};\r\n\r\n\tcssAPI.loadCsses = function() {\r\n\t\tlet args = arguments;\r\n\t\tfor(let i = 0; i < args.length; i++) {\r\n\t\t\t(useImportLoad ? importLoad : linkLoad)(xsloader.getUrl(args[i]), null);\r\n\t\t}\r\n\t};\r\n\treturn cssAPI;\r\n});","import utils from \"../../util/index.js\";\r\nconst global = utils.global;\r\nconst xsloader = global.xsloader;\r\n\r\nxsloader.define(\"text\", [\"xshttp\"], {\r\n\tisSingle: true,\r\n\tpluginMain(name, onload, onerror, config, http) {\r\n\t\tlet url = this.invoker().getUrl(name, true);\r\n\t\thttp().url(url)\r\n\t\t\t.handleAs(\"text\")\r\n\t\t\t.ok(function(text) {\r\n\t\t\t\tonload(text);\r\n\t\t\t})\r\n\t\t\t.fail(function(err) {\r\n\t\t\t\tonerror(err);\r\n\t\t\t})\r\n\t\t\t.done();\r\n\t}\r\n});","import utils from \"../../util/index.js\";\r\nconst global = utils.global;\r\nconst xsloader = global.xsloader;\r\n/**\r\n * 格式：window!varNameInWindow=>>modulePath\r\n */\r\n//window插件,用于添加模块到window对象中\r\nxsloader.define(\"window\", {\r\n\tisSingle: true,\r\n\tpluginMain: function(arg, onload, onerror, config, http) {\r\n\t\tlet index = arg.indexOf(\"=>>\");\r\n\t\tif(index == -1) {\r\n\t\t\tonerror(\"expected:=>>\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet moduleName = arg.substring(0, index);\r\n\t\tlet dep = arg.substring(index + 3);\r\n\t\tthis.invoker().withAbsUrl().require([dep], function(mod, depModuleArgs) {\r\n\t\t\twindow[moduleName] = mod;\r\n\t\t\tonload(mod);\r\n\t\t});\r\n\t}\r\n});","import utils from \"../../util/index.js\";\r\nconst global = utils.global;\r\nconst xsloader = global.xsloader;\r\n/**\r\n * 格式:withdeps!modulePath=>>[deps]\r\n */\r\nxsloader.define(\"withdeps\", {\r\n\tpluginMain(arg, onload, onerror, config) {\r\n\t\tlet index = arg.indexOf(\"=>>\");\r\n\t\tif(index == -1) {\r\n\t\t\tonerror(\"expected:=>>\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet moduleName = arg.substring(0, index);\r\n\t\tlet depsStr = arg.substring(index + 3);\r\n\t\tlet deps;\r\n\t\ttry {\r\n\t\t\tdeps = xsloader.xsParseJson(depsStr);\r\n\t\t\tif(!xsloader.isArray(deps)) {\r\n\t\t\t\tonerror(\"deps is not Array:\" + depsStr);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t} catch(e) {\r\n\t\t\tonerror(\"deps error:\" + depsStr);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.invoker().withAbsUrl().require([\r\n\t\t\t[false].concat(deps), moduleName\r\n\t\t], function(_deps, mod, depModuleArgs) {\r\n\t\t\tonload(mod);\r\n\t\t}).then({\r\n\t\t\torderDep: true\r\n\t\t});\r\n\t}\r\n});","import utils from \"../../util/index.js\";\r\nconst global = utils.global;\r\nconst xsloader = global.xsloader;\r\n\r\n/**\r\n * 加载json对象\r\n */\r\nxsloader.define(\"json\", [\"xshttp\"], {\r\n\tisSingle: true,\r\n\tpluginMain(name, onload, onerror, config, http) {\r\n\t\tlet url = this.invoker().getUrl(name, true);\r\n\t\thttp().url(url)\r\n\t\t\t.handleAs(\"json\")\r\n\t\t\t.ok(function(json) {\r\n\t\t\t\tonload(json);\r\n\t\t\t})\r\n\t\t\t.fail(function(err) {\r\n\t\t\t\tonerror(err);\r\n\t\t\t})\r\n\t\t\t.done();\r\n\t}\r\n});","import utils from \"../../util/index.js\";\r\nconst global = utils.global;\r\nconst xsloader = global.xsloader;\r\n\r\nlet progIds = ['Msxml2.XMLHTTP', 'Microsoft.XMLHTTP', 'Msxml2.XMLHTTP.4.0'];\r\n/**\r\n * option._beforeOpenHook\r\n * option._onOkResponseHook\r\n * option._onFailResponseHook\r\n * \r\n * @param {Object} option\r\n */\r\nfunction httpRequest(option) {\r\n\tif(!option) {\r\n\t\toption = {};\r\n\t}\r\n\r\n\tfunction prop(obj, varName, defaultVal) {\r\n\t\tif(obj[varName] === undefined) {\r\n\t\t\treturn defaultVal;\r\n\t\t} else {\r\n\t\t\treturn obj[varName];\r\n\t\t}\r\n\t}\r\n\r\n\tfunction putProp(obj, varName, toObj) {\r\n\t\tif(obj[varName]) {\r\n\t\t\tfor(let x in obj[varName]) {\r\n\t\t\t\tlet value = obj[varName][x];\r\n\t\t\t\tif(value === null || value === undefined) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\ttoObj[x] = value;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tlet _url = prop(option, \"url\", \"\"),\r\n\t\t_method = prop(option, \"method\", \"GET\"),\r\n\t\t_params = {},\r\n\t\t_headers = {\r\n\t\t\t\"X-Requested-With\": \"XMLHttpRequest\"\r\n\t\t},\r\n\t\t_async = prop(option, \"async\", true),\r\n\t\t_multiPart = prop(option, \"multiPart\", false),\r\n\t\t_handleType = prop(option, \"handleType\", \"json\");\r\n\tlet _timeout = option.timeout;\r\n\tputProp(option, \"params\", _params);\r\n\tputProp(option, \"headers\", _headers);\r\n\r\n\tlet okCallback = option.ok;\r\n\tlet failCallback = option.fail;\r\n\tlet uploadStartCallback = option.uploadStart;\r\n\tlet uploadProgressCallback = option.uploadProgress;\r\n\tlet uploadOkCallback = option.uploadOk;\r\n\tlet uploadErrorCallback = option.uploadError;\r\n\tlet uploadEndCallback = option.uploadEnd;\r\n\r\n\tlet _beforeOpenHook = option._beforeOpenHook || httpRequest._beforeOpenHook;\r\n\tlet _onOkResponseHook = option._onOkResponseHook || httpRequest._onOkResponseHook;\r\n\tlet _onFailResponseHook = option._onFailResponseHook || httpRequest._onFailResponseHook;\r\n\r\n\tfunction createXhr() {\r\n\t\tlet xhr, i, progId;\r\n\t\tif(typeof XMLHttpRequest !== \"undefined\") {\r\n\t\t\treturn new XMLHttpRequest();\r\n\t\t} else if(typeof ActiveXObject !== \"undefined\") {\r\n\t\t\tfor(i = 0; i < 3; i += 1) {\r\n\t\t\t\tprogId = progIds[i];\r\n\t\t\t\ttry {\r\n\t\t\t\t\txhr = new ActiveXObject(progId);\r\n\t\t\t\t} catch(e) {\r\n\t\t\t\t\tconsole.warn(e);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(xhr) {\r\n\t\t\t\t\tprogIds = [progId];\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn xhr;\r\n\t}\r\n\r\n\tfunction conn() {\r\n\t\t_conn(createXhr());\r\n\t}\r\n\r\n\tfunction _conn(xhr) {\r\n\t\tlet option = {\r\n\t\t\turl: _url,\r\n\t\t\tmethod: _method.toUpperCase(),\r\n\t\t\tparams: _params,\r\n\t\t\theaders: _headers,\r\n\t\t\thandleType: _handleType,\r\n\t\t\tasync: _async,\r\n\t\t\tmultiPart: _multiPart,\r\n\t\t\ttimeout: _timeout\r\n\t\t};\r\n\t\t_beforeOpenHook(option, function() {\r\n\t\t\t_connAfterOpenHook(option, xhr);\r\n\t\t}, xhr);\r\n\t}\r\n\r\n\tfunction _doOnFailResponseHook(option, xhr, err, extraErr) {\r\n\t\t_onFailResponseHook(option, function(result) {\r\n\t\t\tif(result !== false && result !== undefined) {\r\n\t\t\t\tif(typeof okCallback == \"function\") {\r\n\t\t\t\t\tokCallback(result, xhr);\r\n\t\t\t\t}\r\n\t\t\t\treturn;\r\n\t\t\t} else if(typeof failCallback == \"function\") {\r\n\t\t\t\tfailCallback(err);\r\n\t\t\t} else {\r\n\t\t\t\tconsole.error(err);\r\n\t\t\t}\r\n\t\t}, xhr, extraErr);\r\n\t}\r\n\r\n\tfunction _connAfterOpenHook(option, xhr) {\r\n\t\tlet body;\r\n\t\tif(option.multiPart) {\r\n\t\t\tlet formData = new FormData();\r\n\t\t\tfor(let x in option.params) {\r\n\t\t\t\tlet value = option.params[x];\r\n\t\t\t\tif(xsloader.isArray(value)) {\r\n\t\t\t\t\tformData.append(x, xsloader.xsJson2String(value));\r\n\t\t\t\t} else {\r\n\t\t\t\t\tformData.append(x, value);\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\t\t\tbody = formData;\r\n\t\t} else {\r\n\t\t\tbody = \"\";\r\n\t\t\tfor(let x in option.params) {\r\n\t\t\t\tlet value = option.params[x];\r\n\t\t\t\tif(value === null || value === undefined) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tif(typeof value == \"object\") {\r\n\t\t\t\t\tvalue = xsloader.xsJson2String(value);\r\n\t\t\t\t}\r\n\t\t\t\tbody += \"&\" + encodeURIComponent(x) + \"=\" + encodeURIComponent(value);\r\n\t\t\t}\r\n\t\t\tif(!(option.method == \"POST\" || option.method == \"PUT\")) {\r\n\t\t\t\tif(option.url.lastIndexOf(\"?\") < 0 && body.length > 0) {\r\n\t\t\t\t\toption.url += \"?\";\r\n\t\t\t\t}\r\n\t\t\t\toption.url += body;\r\n\t\t\t\toption.url = option.url.replace(\"?&\", \"?\");\r\n\t\t\t\tbody = null;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\txhr.open(option.method, option.url, option.async);\r\n\t\tif((option.method == \"POST\" || option.method == \"PUT\") && !option.multiPart && !option.headers.hasOwnProperty(\"Content-Type\")) {\r\n\r\n\t\t\txhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded;charset=utf-8');\r\n\t\t}\r\n\t\tfor(let header in option.headers) {\r\n\t\t\txhr.setRequestHeader(header, option.headers[header]);\r\n\t\t}\r\n\r\n\t\tif(typeof uploadStartCallback == \"function\") {\r\n\t\t\txhr.upload.onloadstart = uploadStartCallback;\r\n\t\t}\r\n\r\n\t\tif(typeof uploadProgressCallback == \"function\") {\r\n\t\t\txhr.upload.onprogress = uploadProgressCallback;\r\n\t\t}\r\n\r\n\t\tif(typeof uploadOkCallback == \"function\") {\r\n\t\t\txhr.upload.onload = uploadOkCallback;\r\n\t\t}\r\n\r\n\t\tif(typeof uploadErrorCallback == \"function\") {\r\n\t\t\txhr.upload.onerror = uploadErrorCallback;\r\n\t\t}\r\n\r\n\t\tif(typeof uploadEndCallback == \"function\") {\r\n\t\t\txhr.upload.onloadend = uploadEndCallback;\r\n\t\t}\r\n\r\n\t\tlet timeoutTimer;\r\n\t\tlet isTimeout = false;\r\n\t\tif(option.timeout) {\r\n\t\t\ttimeoutTimer = setTimeout(function() {\r\n\t\t\t\tisTimeout = true;\r\n\t\t\t\txhr.abort();\r\n\t\t\t\tclearTimeout(timeoutTimer);\r\n\t\t\t}, option.timeout);\r\n\t\t}\r\n\r\n\t\txhr.onreadystatechange = function(evt) {\r\n\t\t\tlet status, err;\r\n\t\t\tif(xhr.readyState === 4) {\r\n\t\t\t\tstatus = xhr.status || 0;\r\n\t\t\t\tif(status > 399 && status < 600 || !status) {\r\n\t\t\t\t\tlet err = new Error(option.url + ' HTTP status: ' + status);\r\n\t\t\t\t\terr.xhr = xhr;\r\n\t\t\t\t\t_doOnFailResponseHook(option, xhr, err);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tlet result;\r\n\t\t\t\t\tif(option.handleType === \"json\") {\r\n\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\tresult = xsloader.xsParseJson(xhr.responseText);\r\n\t\t\t\t\t\t} catch(e) {\r\n\t\t\t\t\t\t\t_doOnFailResponseHook(option, xhr, new Error(\"parse-json-error:\" + e), \"parse-json-error\");\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else if(option.handleType === \"text\") {\r\n\t\t\t\t\t\tresult = xhr.responseText;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t_onOkResponseHook(result, option, function(result) {\r\n\t\t\t\t\t\tif(typeof okCallback == \"function\") {\r\n\t\t\t\t\t\t\tokCallback(result, xhr);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}, xhr);\r\n\t\t\t\t}\r\n\r\n\t\t\t} else {\r\n\t\t\t\tif(timeoutTimer && isTimeout) {\r\n\t\t\t\t\tlet err = new Error(option.url + ' timeout status: ' + status);\r\n\t\t\t\t\terr.xhr = xhr;\r\n\t\t\t\t\t_doOnFailResponseHook(option, xhr, err);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\t\txhr.send(body);\r\n\t}\r\n\r\n\tlet requestObj = {\r\n\t\tmultiPart(multiPart) {\r\n\t\t\t_multiPart = multiPart;\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\tuploadStart(uploadStart) {\r\n\t\t\tuploadStartCallback = uploadStart;\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\tuploadProgress(uploadProgress) {\r\n\t\t\tuploadProgressCallback = uploadProgress;\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\tuploadOk(callback) {\r\n\t\t\tuploadOkCallback = callback;\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\tuploadError(callback) {\r\n\t\t\tuploadErrorCallback = callback;\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\tuploadEnd(uploadEnd) {\r\n\t\t\tuploadEndCallback = uploadEnd;\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\turl(urlStr) {\r\n\t\t\t_url = urlStr;\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\tmethod(methodStr) {\r\n\t\t\t_method = methodStr;\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\ttimeout(timeout) {\r\n\t\t\t_timeout = timeout;\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\tasync(isAsync) {\r\n\t\t\t_async = isAsync;\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\tparams(paramsObj) {\r\n\t\t\tif(paramsObj) {\r\n\t\t\t\tfor(let x in paramsObj) {\r\n\t\t\t\t\tlet value = paramsObj[x];\r\n\t\t\t\t\tif(value === null || value === undefined) {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t_params[x] = value;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\theaders(headersObj) {\r\n\t\t\tif(headersObj) {\r\n\t\t\t\tfor(let x in headersObj) {\r\n\t\t\t\t\t_headers[x] = headersObj[x];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\thandleType(_handleType) {\r\n\t\t\treturn this.handleAs(_handleType);\r\n\t\t},\r\n\t\thandleAs(handleType) {\r\n\t\t\tif(handleType !== \"json\" && handleType !== \"text\") {\r\n\t\t\t\tthrow \"unknown handleType:\" + handleType;\r\n\t\t\t}\r\n\t\t\t_handleType = handleType;\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\tok(callback) {\r\n\t\t\tokCallback = callback;\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\tfail(callback) {\r\n\t\t\tfailCallback = callback;\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\t_beforeOpenHook(callback) {\r\n\t\t\t_beforeOpenHook = callback;\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\t_onOkResponseHook(callback) {\r\n\t\t\t_onOkResponseHook = callback;\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\t_onFailResponseHook(callback) {\r\n\t\t\t_onFailResponseHook = callback;\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\tdone() {\r\n\t\t\ttry {\r\n\t\t\t\tconn();\r\n\t\t\t} catch(e) {\r\n\t\t\t\tif(typeof failCallback == \"function\") {\r\n\t\t\t\t\tfailCallback(e);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconsole.error(e);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\treturn requestObj;\r\n}\r\n/**\r\n */\r\nhttpRequest._beforeOpenHook = function(option, callback, xhr) {\r\n\tcallback();\r\n};\r\n\r\n/**\r\n * function(result,option,xhr,callback),callback(result)的result为最终的结果\r\n */\r\nhttpRequest._onOkResponseHook = function(result, option, callback, xhr) {\r\n\tcallback(result);\r\n};\r\n/**\r\n * function(option,xhr,callback,extraErrorType),callback(result)的result为false则不会处理后面的,如果为非undefined则作为成功的结果。\r\n * extraErrorType==\"parse-json-error\"表示转换成json时出错\r\n */\r\nhttpRequest._onFailResponseHook = function(option, callback, xhr, extraErrorType) {\r\n\tcallback(undefined);\r\n};\r\n\r\nwindow._xshttp_request_ = httpRequest;\r\n\r\nxsloader.define(\"xshttp\", [], function() {\r\n\treturn httpRequest;\r\n});","import utils from \"../../util/index.js\";\r\nconst global = utils.global;\r\nconst xsloader = global.xsloader;\r\n\r\n/**\r\n * 返回Request返回一个Promise\r\n */\r\nxsloader.define(\"request\", [\"xshttp\"], function(http) {\r\n\t/**\r\n\t * 参数列表:\r\n\t * async:始终为true\r\n\t * ok与fail失效\r\n\t * 其他参数同xshttp\r\n\t * 不断返回then(function()).then,当返回false时取消调用后面的回调。\r\n\t * @param {Object} option\r\n\t */\r\n\tlet Request = function(option) {\r\n\t\toption = xsloader.extend({\r\n\t\t\tparams: undefined,\r\n\t\t\theaders: undefined,\r\n\t\t\tmethod: undefined,\r\n\t\t\turl: undefined,\r\n\t\t\tcallback: undefined\r\n\t\t}, option);\r\n\t\toption.async = true;\r\n\r\n\t\tlet promise = new Promise((resolve, reject) => {\r\n\t\t\toption.ok = function(rs) {\r\n\t\t\t\tresolve(rs);\r\n\t\t\t};\r\n\t\t\toption.fail = function(err) {\r\n\t\t\t\treject(err);\r\n\t\t\t};\r\n\t\t\thttp(option).done();\r\n\t\t});\r\n\r\n\t\treturn promise;\r\n\t};\r\n\r\n\treturn Request;\r\n});","import utils from \"../../util/index.js\";\r\nconst global = utils.global;\r\nconst xsloader = global.xsloader;\r\n\r\ntry {\r\n\tlet isXsMsgDebug = false;\r\n\tlet api = {};\r\n\r\n\tfunction isDebug(type) {\r\n\t\treturn isXsMsgDebug;\r\n\t}\r\n\r\n\tapi.linkedList = function() {\r\n\t\treturn new LinkedList();\r\n\t};\r\n\r\n\tfunction LinkedList() {\r\n\t\tfunction newNode(element) {\r\n\t\t\tlet node = {\r\n\t\t\t\telement: element,\r\n\t\t\t\tnext: null,\r\n\t\t\t\tpre: null\r\n\t\t\t};\r\n\t\t\treturn node;\r\n\t\t}\r\n\t\tlet length = 0;\r\n\t\tlet headNode = newNode(),\r\n\t\t\tlastNode = headNode;\r\n\r\n\t\t/**\r\n\t\t * 在链表末尾添加元素\r\n\t\t */\r\n\t\tthis.append = function(element) {\r\n\t\t\tlet current = newNode(element);\r\n\r\n\t\t\tlastNode.next = current;\r\n\t\t\tcurrent.pre = lastNode;\r\n\t\t\tlastNode = current;\r\n\t\t\tlength++;\r\n\t\t};\r\n\r\n\t\t//在链表的任意位置插入元素\r\n\t\tthis.insert = function(position, element) {\r\n\t\t\tif(position >= 0 && position <= length) {\r\n\r\n\t\t\t\tlet node = newNode(element);\r\n\t\t\t\tlet pNode = headNode;\r\n\t\t\t\twhile(position--) {\r\n\t\t\t\t\tpNode = pNode.next;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(pNode.next) {\r\n\t\t\t\t\tpNode.next.pre = node;\r\n\t\t\t\t\tnode.next = pNode.next;\r\n\t\t\t\t}\r\n\t\t\t\tpNode.next = node;\r\n\t\t\t\tnode.pre = pNode;\r\n\t\t\t\tlength++;\r\n\t\t\t\treturn true;\r\n\t\t\t} else {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tthis.elementAt = function(position) {\r\n\t\t\treturn getElement(position);\r\n\t\t};\r\n\r\n\t\tfunction getElement(position, willRemove) {\r\n\t\t\tif(position >= 0 && position < length) {\r\n\r\n\t\t\t\tlet pNode = headNode;\r\n\t\t\t\twhile(position--) {\r\n\t\t\t\t\tpNode = pNode.next;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(pNode.next) {\r\n\t\t\t\t\tlet currentNode = pNode.next;\r\n\t\t\t\t\tif(willRemove) {\r\n\t\t\t\t\t\tlet nextCurrentNode = currentNode.next;\r\n\t\t\t\t\t\tif(nextCurrentNode) {\r\n\t\t\t\t\t\t\tnextCurrentNode.pre = pNode;\r\n\t\t\t\t\t\t\tpNode.next = nextCurrentNode;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tpNode.next = null;\r\n\t\t\t\t\t\t\tlastNode = pNode;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tlength--;\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn currentNode.element;\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn undefined;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\treturn undefined;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * @param callback function 返回true表示移除\r\n\t\t */\r\n\t\tthis.eachForRemove = function(callback) {\r\n\t\t\tlet pNode = headNode.next;\r\n\t\t\twhile(pNode) {\r\n\t\t\t\tlet currentNode = pNode;\r\n\t\t\t\tif(callback(currentNode)) {\r\n\t\t\t\t\tlet nextCurrentNode = currentNode.next;\r\n\t\t\t\t\tif(nextCurrentNode) {\r\n\t\t\t\t\t\tnextCurrentNode.pre = pNode;\r\n\t\t\t\t\t\tpNode.next = nextCurrentNode;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tpNode.next = null;\r\n\t\t\t\t\t\tlastNode = pNode;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlength--;\r\n\t\t\t\t\tpNode = nextCurrentNode;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tpNode = pNode.next;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\t//从链表中移除元素\r\n\t\tthis.removeAt = function(position) {\r\n\t\t\treturn getElement(position, true);\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t * 移除并获取第一个元素\r\n\t\t * @param callback function(elem,index)\r\n\t\t */\r\n\t\tthis.pop = function(callback) {\r\n\t\t\treturn this.removeAt(0);\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t * 返回元素在链表中的位置\r\n\t\t * @param element object|function(elem)\r\n\t\t */\r\n\t\tthis.indexOf = function(element) {\r\n\t\t\tlet pNode = headNode.next;\r\n\t\t\tlet index = 0;\r\n\t\t\twhile(pNode) {\r\n\t\t\t\tif(typeof element == \"function\") {\r\n\t\t\t\t\tif(element(pNode.element)) {\r\n\t\t\t\t\t\treturn index;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if(pNode.element === element) {\r\n\t\t\t\t\treturn index;\r\n\t\t\t\t}\r\n\t\t\t\tindex++;\r\n\t\t\t\tpNode = pNode.next;\r\n\t\t\t}\r\n\t\t\treturn -1;\r\n\t\t};\r\n\r\n\t\tthis.find = function(element) {\r\n\t\t\tlet index = this.indexOf(element);\r\n\t\t\treturn index >= 0 ? this.elementAt(index) : undefined;\r\n\t\t};\r\n\r\n\t\t//移除某个元素\r\n\t\tthis.remove = function(element) {\r\n\t\t\tlet index = this.indexOf(element);\r\n\t\t\treturn this.removeAt(index);\r\n\t\t};\r\n\r\n\t\t//判断链表是否为空\r\n\r\n\t\tthis.isEmpty = function() {\r\n\t\t\treturn length === 0;\r\n\t\t};\r\n\r\n\t\t//返回链表的长度\r\n\t\tthis.size = function() {\r\n\t\t\treturn length;\r\n\t\t};\r\n\r\n\t}\r\n\r\n\tif(window.addEventListener) {\r\n\t\tlet postMessageBridge = (function() {\r\n\t\t\tlet handle = {};\r\n\r\n\t\t\tlet instanceMap = {}; //id:listener\r\n\t\t\tlet cmd2ListenerMap = {}; //cmd:[]\r\n\t\t\tlet instanceBindMap = {}; //instanceid:true\r\n\t\t\tlet oinstanceidMap = {}; //已经被绑定的oinstanceid:instanceid\r\n\r\n\t\t\t//isActive为false表示监听者\r\n\t\t\thandle.listen = function(cmd, conndata, connectingSource, source, isActive, _onConned, _onMsg, _onResponse, _onElse) {\r\n\r\n\t\t\t\tlet listener = {\r\n\t\t\t\t\tcmd: cmd,\r\n\t\t\t\t\t_onConned: _onConned,\r\n\t\t\t\t\t_onMsg: _onMsg,\r\n\t\t\t\t\t_onResponse: _onResponse,\r\n\t\t\t\t\t_onElse: _onElse,\r\n\t\t\t\t\tconndata: conndata,\r\n\t\t\t\t\tosource: source,\r\n\t\t\t\t\tactive: isActive,\r\n\t\t\t\t\tconnectingSource: connectingSource,\r\n\t\t\t\t\tid: xsloader.randId(),\r\n\t\t\t\t\trefused: {}\r\n\t\t\t\t};\r\n\r\n\t\t\t\tif(!cmd2ListenerMap[cmd]) {\r\n\t\t\t\t\tcmd2ListenerMap[cmd] = [];\r\n\t\t\t\t}\r\n\t\t\t\tcmd2ListenerMap[cmd].push(listener);\r\n\r\n\t\t\t\tlet instanceid = listener.id;\r\n\t\t\t\tinstanceMap[instanceid] = listener;\r\n\t\t\t\treturn instanceid;\r\n\t\t\t};\r\n\r\n\t\t\thandle.remove = function(instanceid) {\r\n\t\t\t\t//TODO !!!!!!!\r\n\t\t\t\t/*let listener = listeners[id];\r\n\t\t\t\tdelete listeners[id];\r\n\t\t\t\tif(listener.active) {\r\n\t\t\t\t\tfor(let x in activeListenerMyIds) {\r\n\t\t\t\t\t\tlet as = activeListenerMyIds[x];\r\n\t\t\t\t\t\tlet found = false;\r\n\t\t\t\t\t\tfor(let k = 0; k < as.length; k++) {\r\n\t\t\t\t\t\t\tif(as[k] == id) {\r\n\t\t\t\t\t\t\t\tas.splice(k, 1);\r\n\t\t\t\t\t\t\t\tfound = true;\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif(found) {\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}*/\r\n\t\t\t};\r\n\r\n\t\t\thandle.send = function(data, instanceid, msgid) {\r\n\t\t\t\tlet listener = instanceMap[instanceid];\r\n\t\t\t\t_sendData(\"msg\", listener.cmd, listener.osource, data, instanceid, msgid);\r\n\t\t\t};\r\n\r\n\t\t\thandle.sendConn = function(instanceid) {\r\n\t\t\t\tlet listener = instanceMap[instanceid];\r\n\t\t\t\t_sendData(\"conn\", listener.cmd, listener.osource, listener.conndata, instanceid);\r\n\t\t\t};\r\n\r\n\t\t\thandle.sendResponse = function(data, instanceid) {\r\n\t\t\t\tlet listener = instanceMap[instanceid];\r\n\t\t\t\t_sendData(\"response\", listener.cmd, listener.osource, data, instanceid);\r\n\t\t\t};\r\n\r\n\t\t\tfunction handleConn(cmd, fromSource, originStr, data, oinstanceid) {\r\n\t\t\t\tif(oinstanceidMap[oinstanceid]) {\r\n\t\t\t\t\t//console.warn(\"already bind:\" + cmd);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tlet listeners = cmd2ListenerMap[cmd];\r\n\t\t\t\tif(!listeners) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfunction Callback(instanceid) {\r\n\r\n\t\t\t\t\treturn function(isAccept, msg) {\r\n\t\t\t\t\t\tif(!isAccept) {\r\n\t\t\t\t\t\t\tlet listener = instanceMap[instanceid];\r\n\t\t\t\t\t\t\tlistener.refused[oinstanceid] = true;\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif(oinstanceidMap[oinstanceid]) {\r\n\t\t\t\t\t\t\tconsole.warn(\"already bind other:\" + cmd + \",my page:\" + location.href);\r\n\t\t\t\t\t\t} else if(instanceBindMap[instanceid]) {\r\n\t\t\t\t\t\t\tconsole.warn(\"already self bind:\" + cmd + \",my page:\" + location.href);\r\n\t\t\t\t\t\t\t_sendData(\"binded\", cmd, fromSource, oinstanceid);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\toinstanceidMap[oinstanceid] = instanceid;\r\n\t\t\t\t\t\t\tinstanceBindMap[instanceid] = true;\r\n\t\t\t\t\t\t\tlet listener = instanceMap[instanceid];\r\n\t\t\t\t\t\t\tlistener.osource = fromSource;\r\n\t\t\t\t\t\t\tlistener.origin = originStr;\r\n\t\t\t\t\t\t\t_sendData(\"accept\", cmd, fromSource, listener.conndata, instanceid, oinstanceid);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfor(let i = 0; i < listeners.length; i++) {\r\n\t\t\t\t\tlet listener = listeners[i];\r\n\t\t\t\t\tif(!listener.refused[oinstanceid]) {\r\n\t\t\t\t\t\tlistener.connectingSource(fromSource, originStr, data, Callback(listener.id));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfunction handleAccept(cmd, fromSource, originStr, data, oinstanceid, minstanceid) {\r\n\t\t\t\tlet listeners = cmd2ListenerMap[cmd];\r\n\t\t\t\tif(!listeners) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfunction Callback(instanceid) {\r\n\r\n\t\t\t\t\treturn function(isAccept, msg) {\r\n\t\t\t\t\t\tif(!isAccept) {\r\n\t\t\t\t\t\t\tlet listener = instanceMap[instanceid];\r\n\t\t\t\t\t\t\tlistener.refused[oinstanceid] = true;\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif(oinstanceidMap[oinstanceid]) {\r\n\t\t\t\t\t\t\tconsole.warn(\"already bind:\" + cmd + \",my page:\" + location.href);\r\n\t\t\t\t\t\t} else if(instanceBindMap[instanceid]) {\r\n\t\t\t\t\t\t\tconsole.warn(\"already self bind:\" + cmd + \",my page:\" + location.href);\r\n\t\t\t\t\t\t\t_sendData(\"binded\", cmd, fromSource, oinstanceid);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\toinstanceidMap[oinstanceid] = instanceid;\r\n\t\t\t\t\t\t\tinstanceBindMap[instanceid] = true;\r\n\r\n\t\t\t\t\t\t\tlet listener = instanceMap[instanceid];\r\n\t\t\t\t\t\t\tlistener.osource = fromSource;\r\n\t\t\t\t\t\t\tlistener.origin = originStr;\r\n\t\t\t\t\t\t\t_sendData(\"conned\", cmd, fromSource, listener.conndata, instanceid);\r\n\t\t\t\t\t\t\tlistener._onConned(fromSource, data);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfor(let i = 0; i < listeners.length; i++) {\r\n\t\t\t\t\tlet listener = listeners[i];\r\n\t\t\t\t\tif(listener.id == minstanceid && !listener.refused[oinstanceid]) { //当前为主动发起连接的页面\r\n\t\t\t\t\t\tlistener.connectingSource(fromSource, originStr, data, Callback(listener.id));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfunction handleBinded(cmd, fromSource, originStr, minstanceid) {\r\n\t\t\t\tlet listener = instanceMap[minstanceid];\r\n\t\t\t\tlistener._onElse(\"binded\");\r\n\t\t\t}\r\n\r\n\t\t\tfunction checkSource(listener, fromSource, originStr) {\r\n\t\t\t\tif(listener.osource != fromSource && listener.origin != originStr) {\r\n\t\t\t\t\tconsole.warn(\"expected:\" + listener.origin + \",but:\" + originStr);\r\n\t\t\t\t\tthrow new Error(\"source changed!\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfunction handleConned(cmd, fromSource, originStr, data, oinstanceid) {\r\n\t\t\t\tlet instanceid = oinstanceidMap[oinstanceid];\r\n\t\t\t\tlet listener = instanceMap[instanceid];\r\n\t\t\t\tcheckSource(listener, fromSource, originStr);\r\n\r\n\t\t\t\tlistener._onConned(listener.osource, data);\r\n\t\t\t}\r\n\r\n\t\t\tfunction handleMsg(cmd, fromSource, originStr, data, oinstanceid, msgid) {\r\n\t\t\t\tlet instanceid = oinstanceidMap[oinstanceid];\r\n\t\t\t\tlet listener = instanceMap[instanceid];\r\n\t\t\t\tcheckSource(listener, fromSource, originStr);\r\n\r\n\t\t\t\tlistener._onMsg(data, msgid);\r\n\t\t\t}\r\n\r\n\t\t\tfunction handleResponse(cmd, fromSource, originStr, data, oinstanceid) {\r\n\t\t\t\tlet instanceid = oinstanceidMap[oinstanceid];\r\n\t\t\t\tlet listener = instanceMap[instanceid];\r\n\t\t\t\tcheckSource(listener, fromSource, originStr);\r\n\r\n\t\t\t\tlistener._onResponse(data);\r\n\t\t\t}\r\n\r\n\t\t\tfunction _sendData(type, cmd, source, data, instanceid, msgid) {\r\n\t\t\t\tlet msg = {\r\n\t\t\t\t\ttype: type,\r\n\t\t\t\t\tdata: data,\r\n\t\t\t\t\tcmd: cmd,\r\n\t\t\t\t\tid: instanceid,\r\n\t\t\t\t\tmsgid: msgid\r\n\t\t\t\t};\r\n\r\n\t\t\t\tif(isDebug(\"postMessageBridge\")) {\r\n\t\t\t\t\tconsole.log(\"send from:\" + location.href);\r\n\t\t\t\t\tconsole.log(msg);\r\n\t\t\t\t}\r\n\t\t\t\tsource.postMessage(xsloader.xsJson2String(msg), \"*\");\r\n\t\t\t}\r\n\r\n\t\t\twindow.addEventListener('message', function(event) {\r\n\t\t\t\tif(isDebug(\"postMessageBridge\")) {\r\n\t\t\t\t\tconsole.log(\"receive from:\" + event.origin + \",my page:\" + location.href);\r\n\t\t\t\t\tconsole.log(event.data);\r\n\t\t\t\t}\r\n\t\t\t\tlet data;\r\n\t\t\t\ttry {\r\n\t\t\t\t\tdata = xsloader.xsParseJson(event.data);\r\n\t\t\t\t} catch(e) {\r\n\t\t\t\t\tconsole.warn(e);\r\n\t\t\t\t}\r\n\t\t\t\tif(!data || !(data.cmd && data.type)) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet cmd = data.cmd;\r\n\t\t\t\tlet oinstanceid = data.id;\r\n\t\t\t\tlet rdata = data.data;\r\n\t\t\t\tlet type = data.type;\r\n\t\t\t\tlet msgid = data.msgid;\r\n\r\n\t\t\t\tif(type == \"conn\") {\r\n\t\t\t\t\thandleConn(cmd, event.source, event.origin, rdata, oinstanceid);\r\n\t\t\t\t} else if(type == \"accept\") {\r\n\t\t\t\t\thandleAccept(cmd, event.source, event.origin, rdata, oinstanceid, msgid);\r\n\t\t\t\t} else if(type == \"conned\") {\r\n\t\t\t\t\thandleConned(cmd, event.source, event.origin, rdata, oinstanceid);\r\n\t\t\t\t} else if(type == \"msg\") {\r\n\t\t\t\t\thandleMsg(cmd, event.source, event.origin, rdata, oinstanceid, msgid);\r\n\t\t\t\t} else if(type == \"response\") {\r\n\t\t\t\t\thandleResponse(cmd, event.source, event.origin, rdata, oinstanceid);\r\n\t\t\t\t} else if(type == \"binded\") {\r\n\t\t\t\t\thandleBinded(cmd, event.source, event.origin, rdata);\r\n\t\t\t\t}\r\n\r\n\t\t\t});\r\n\r\n\t\t\thandle.runAfter = function(time, callback) {\r\n\t\t\t\tsetTimeout(callback, time);\r\n\t\t\t};\r\n\r\n\t\t\treturn handle;\r\n\t\t})();\r\n\r\n\t\tfunction CommunicationUnit(cmd, source, connectingSource, onfailed, isActive, conndata) {\r\n\t\t\tlet msgQueue = new LinkedList();\r\n\r\n\t\t\tlet MAX_TRY = 100,\r\n\t\t\t\tSLEEP = 500;\r\n\t\t\tlet isConnected = false,\r\n\t\t\t\tconnectCount = 0;\r\n\t\t\tlet isCanceled = false;\r\n\r\n\t\t\tlet thiz = this;\r\n\t\t\tlet handleId;\r\n\r\n\t\t\tthis.onConnectedListener = null;\r\n\t\t\tthis.onReceiveListener = null;\r\n\t\t\tthis.send = function(data) {\r\n\t\t\t\tlet msg = {\r\n\t\t\t\t\tid: xsloader.randId(),\r\n\t\t\t\t\tdata: data\r\n\t\t\t\t};\r\n\t\t\t\tmsgQueue.append(msg);\r\n\t\t\t\tsendTop();\r\n\t\t\t};\r\n\r\n\t\t\tthis.send.release = function() {\r\n\t\t\t\tpostMessageBridge.remove(handleId);\r\n\t\t\t};\r\n\r\n\t\t\tfunction _onConned(_source, data) {\r\n\t\t\t\tthiz.onConnectedListener.call(thiz, data);\r\n\t\t\t\tisConnected = true;\r\n\t\t\t\tsendTop();\r\n\t\t\t}\r\n\r\n\t\t\tfunction _onMsg(data, msgid) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tthiz.onReceiveListener.call(thiz, data);\r\n\t\t\t\t} catch(e) {\r\n\t\t\t\t\tconsole.warn(e);\r\n\t\t\t\t}\r\n\t\t\t\tpostMessageBridge.sendResponse({ //回应已经收到\r\n\t\t\t\t\tid: msgid\r\n\t\t\t\t}, handleId);\r\n\t\t\t}\r\n\r\n\t\t\tfunction _onResponse(data) {\r\n\t\t\t\tmsgQueue.remove(function(elem) {\r\n\t\t\t\t\treturn elem.id = data.id;\r\n\t\t\t\t});\r\n\t\t\t\tsendTop();\r\n\t\t\t}\r\n\r\n\t\t\tfunction _onElse(type) {\r\n\t\t\t\tif(type == \"binded\") {\r\n\t\t\t\t\tisCanceled = true;\r\n\t\t\t\t\tconsole.error(\"connect failed,that page already binded:\" + cmd + \",my page:\" + location.href);\r\n\t\t\t\t\tonfailed(\"canceled\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfunction initListen() {\r\n\t\t\t\thandleId = postMessageBridge.listen(cmd, conndata, connectingSource, source, isActive, _onConned, _onMsg, _onResponse, _onElse);\r\n\t\t\t}\r\n\r\n\t\t\tfunction sendTop() {\r\n\t\t\t\tif(isConnected) {\r\n\t\t\t\t\tlet msg;\r\n\t\t\t\t\twhile((msg = msgQueue.pop())) {\r\n\t\t\t\t\t\tpostMessageBridge.send(msg.data, handleId, msg.id);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfunction init() {\r\n\t\t\t\tif(isConnected || connectCount > MAX_TRY || isCanceled) {\r\n\t\t\t\t\tif(!isConnected && !isCanceled) {\r\n\t\t\t\t\t\tonfailed(\"timeout\");\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tpostMessageBridge.sendConn(handleId);\r\n\t\t\t\tconnectCount++;\r\n\t\t\t\tpostMessageBridge.runAfter(SLEEP, init);\r\n\t\t\t}\r\n\t\t\tif(source) {\r\n\t\t\t\tinitListen();\r\n\t\t\t\tinit();\r\n\t\t\t} else if(!isActive) {\r\n\t\t\t\tinitListen();\r\n\t\t\t}\r\n\r\n\t\t\tthis.setSource = function(_source) {\r\n\t\t\t\tsource = _source;\r\n\t\t\t\tif(source) {\r\n\t\t\t\t\tinitListen();\r\n\t\t\t\t\tinit();\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tlet handleApi = api;\r\n\r\n\t\t/**\r\n\t\t * \r\n\t\t * @param {Object} winObjOrCallback\r\n\t\t * @param {Object} option\r\n\t\t * @param {Object} notActive\r\n\t\t */\r\n\t\tfunction _connectWindow(winObjOrCallback, option, notActive) {\r\n\t\t\toption = xsloader.extendDeep({\r\n\t\t\t\tcmd: \"default-cmd\",\r\n\t\t\t\tlistener: null,\r\n\t\t\t\tconnected: null,\r\n\t\t\t\tconndata: null,\r\n\t\t\t\tconnectingSource: function(source, origin, conndata, callback) {\r\n\t\t\t\t\tlet mine = location.protocol + \"//\" + location.host;\r\n\t\t\t\t\tcallback(mine == origin, \"default\");\r\n\t\t\t\t},\r\n\t\t\t\tonfailed: function(errtype) {\r\n\t\t\t\t\tif(errtype == \"timeout\") {\r\n\t\t\t\t\t\tconsole.warn(\"connect may timeout:cmd=\" + option.cmd + \",my page=\" + location.href);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}, option);\r\n\r\n\t\t\tlet cmd = option.cmd;\r\n\t\t\tlet connectedCallback = option.connected;\r\n\t\t\tlet receiveCallback = option.listener;\r\n\t\t\tlet conndata = option.conndata;\r\n\t\t\tlet onfailed = option.onfailed;\r\n\r\n\t\t\tlet isActive = !notActive;\r\n\t\t\tlet connectingSource = option.connectingSource;\r\n\r\n\t\t\tlet unit;\r\n\t\t\tif(typeof winObjOrCallback == \"function\") {\r\n\t\t\t\tunit = new CommunicationUnit(cmd, null, connectingSource, onfailed, isActive, conndata);\r\n\t\t\t} else {\r\n\t\t\t\tunit = new CommunicationUnit(cmd, winObjOrCallback, connectingSource, onfailed, isActive, conndata);\r\n\t\t\t}\r\n\r\n\t\t\tconnectedCallback = connectedCallback || function(sender, conndata) {\r\n\t\t\t\tconsole.log((isActive ? \"active\" : \"\") + \" connected:\" + cmd);\r\n\t\t\t};\r\n\t\t\tif(connectedCallback) {\r\n\t\t\t\tunit.onConnectedListener = function(conndata) {\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tconnectedCallback(this.send, conndata);\r\n\t\t\t\t\t} catch(e) {\r\n\t\t\t\t\t\tconsole.error(e);\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\tif(receiveCallback) {\r\n\t\t\t\tunit.onReceiveListener = function(data) {\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\treceiveCallback(data, this.send);\r\n\t\t\t\t\t} catch(e) {\r\n\t\t\t\t\t\tconsole.error(e);\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\tif(typeof winObjOrCallback == \"function\") {\r\n\t\t\t\twinObjOrCallback(function(winObj) {\r\n\t\t\t\t\tunit.setSource(winObj);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\treturn unit.send;\r\n\t\t}\r\n\r\n\t\tfunction _connectIFrame(iframe, option) {\r\n\t\t\tlet winObj;\r\n\t\t\tif(typeof iframe == \"string\") {\r\n\t\t\t\t//iframe = ddocument.querySelector(iframe);\r\n\t\t\t\twinObj = function(callback) {\r\n\t\t\t\t\tiframe.onload = function() {\r\n\t\t\t\t\t\tcallback(this.contentWindow);\r\n\t\t\t\t\t};\r\n\t\t\t\t};\r\n\t\t\t} else {\r\n\t\t\t\twinObj = iframe.contentWindow;\r\n\t\t\t}\r\n\t\t\treturn _connectWindow(winObj, option);\r\n\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * 用于连接iframe.\r\n\t\t * @param {Object} iframe iframe或selector\r\n\t\t * @param {Object} option\r\n\t\t * @return 返回sender\r\n\t\t */\r\n\t\thandleApi.connectIFrame = function(iframe, option) {\r\n\t\t\treturn _connectIFrame(iframe, option);\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t * 用于连接父页面.\r\n\t\t * @param {Object} option\r\n\t\t * @return 返回sender\r\n\t\t */\r\n\t\thandleApi.connectParent = function(option) {\r\n\t\t\treturn _connectWindow(window.parent, option);\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t * 用于连接顶层页面.\r\n\t\t * @param {Object} option\r\n\t\t * @return 返回sender\r\n\t\t */\r\n\t\thandleApi.connectTop = function(option) {\r\n\t\t\treturn _connectWindow(window.top, option);\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t * 用于连接打开者.\r\n\t\t * @param {Object} option\r\n\t\t * @return 返回sender\r\n\t\t */\r\n\t\thandleApi.connectOpener = function(option) {\r\n\t\t\treturn _connectWindow(window.opener, option);\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t * 用于监听其他页面发送消息.\r\n\t\t * @param {Object} option\r\n\t\t * @return 返回一个sender\r\n\t\t */\r\n\t\thandleApi.listenMessage = function(option) {\r\n\t\t\treturn _connectWindow(null, option, true);\r\n\t\t};\r\n\r\n\t\thandleApi.debug = function(isDebug) {\r\n\t\t\tisXsMsgDebug = isDebug;\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t * *******************\r\n\t\t * option参数\r\n\t\t *********************\r\n\t\t * option.cmd:\r\n\t\t * option.connectingSource:function(source,origin,conndata,callback(isAccept,msg))默认只选择同源\r\n\t\t * option.listener: function(data,sender)\r\n\t\t * option.connected:function(sender,conndata)\r\n\t\t * option.onfailed:function(errtype):errtype,timeout,canceled\r\n\t\t * option.conndata:\r\n\t\t **************\r\n\t\t * 回调的extra参数\r\n\t\t **************\r\n\t\t * originStr:对方页面的地址\r\n\t\t */\r\n\t\txsloader.define(\"xsmsg\", handleApi); //TODO STRONG xsmsg\r\n\t}\r\n\r\n\txsloader.define(\"XsLinkedList\", function() {\r\n\t\treturn LinkedList;\r\n\t});\r\n} catch(e) {\r\n\tconsole.error(e);\r\n}","// 静态资源服务\r\nimport utils from \"./util/index.js\";\r\n\r\nconst global = utils.global;\r\nconst xsloader = global.xsloader;\r\n\r\nconst http = global._xshttp_request_;\r\nconst DATA_CONF = \"data-conf\",\r\n\tDATA_CONFX = \"data-xsloader-conf\";\r\nconst DATA_CONF2 = \"data-conf2\",\r\n\tDATA_CONF2X = \"data-xsloader-conf2\";\r\nconst DATA_MAIN = \"data-main\",\r\n\tDATA_MAINX = \"data-xsloader-main\";\r\nconst DATA_CONF_TYPE = \"data-conf-type\";\r\n\r\nlet serviceConfigUrl;\r\nlet dataConf = xsloader.script().getAttribute(DATA_CONF) || xsloader.script().getAttribute(DATA_CONFX);\r\nlet dataMain = xsloader.script().getAttribute(DATA_MAIN) || xsloader.script().getAttribute(DATA_MAINX);\r\nlet dataConfType = xsloader.script().getAttribute(DATA_CONF_TYPE);\r\nif(dataConfType !== \"json\" && dataConfType != \"js\") {\r\n\tdataConfType = \"auto\";\r\n}\r\n\r\nlet initFun = () => {\r\n\tfunction getMainPath(config) {\r\n\t\tlet mainPath = config.main.getPath.call(config, dataMain);\r\n\t\tlet path = location.pathname;\r\n\r\n\t\tlet index = path.lastIndexOf(\"/\");\r\n\t\tlet name = path.substring(index + 1);\r\n\t\tif(name === \"\") {\r\n\t\t\tname = \"index\";\r\n\t\t}\r\n\t\tif(xsloader.endsWith(name, \".html\")) {\r\n\t\t\tname = name.substring(0, name.length - 5);\r\n\t\t}\r\n\t\tif(!mainPath) {\r\n\t\t\tmainPath = \"./main/{name}.js\";\r\n\t\t}\r\n\t\tmainPath = mainPath.replace(\"{name}\", name);\r\n\t\treturn mainPath;\r\n\t}\r\n\r\n\tfunction extendConfig(config) {\r\n\t\tconfig = xsloader.extendDeep({\r\n\t\t\tproperties: {},\r\n\t\t\tmain: {\r\n\t\t\t\tgetPath() {\r\n\t\t\t\t\treturn dataMain || \"./main/{name}.js\";\r\n\t\t\t\t},\r\n\t\t\t\tname: \"main\",\r\n\t\t\t\tlocalConfigVar: \"lconfig\",\r\n\t\t\t\tglobalConfigVar: \"gconfig\",\r\n\t\t\t\tbefore(name) {\r\n\t\t\t\t\tconsole.log(\"before:\" + name);\r\n\t\t\t\t},\r\n\t\t\t\tafter(name) {\r\n\t\t\t\t\tconsole.log(\"after:\" + name);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tservice: {\r\n\t\t\t\thasGlobal: false,\r\n\t\t\t\tresUrls: []\r\n\t\t\t},\r\n\t\t\tchooseLoader(localConfig) { //返回一个configName；当此函数为service全局配置的函数时，localConfig为应用的配置对象;本地配置调用时，localConfig为null。\r\n\t\t\t\treturn \"default\";\r\n\t\t\t},\r\n\t\t\tloader: {\r\n\t\t\t\t\"default\": {\r\n\t\t\t\t\tautoUrlArgs: true\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}, config);\r\n\r\n\t\treturn config;\r\n\t}\r\n\r\n\tfunction loadServiceConfig(tag, url, callback, isLocal) {\r\n\t\thttp({\r\n\t\t\turl: url,\r\n\t\t\tmethod: \"get\",\r\n\t\t\ttimeout: 20000,\r\n\t\t\thandleType: \"text\",\r\n\t\t\tok(confText) {\r\n\r\n\t\t\t\tlet conf;\r\n\t\t\t\tif(dataConfType == \"js\") {\r\n\t\t\t\t\tconf = xsloader.xsEval(confText);\r\n\t\t\t\t} else if(dataConfType == \"json\") {\r\n\t\t\t\t\tconf = xsloader.xsParseJson(confText);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif(xsloader.startsWith(url, location.protocol + \"//\" + location.host + \"/\")) {\r\n\t\t\t\t\t\t//同域则默认用脚本解析\r\n\t\t\t\t\t\tconf = xsloader.xsEval(confText);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tconf = xsloader.xsParseJson(confText);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconf = extendConfig(conf);\r\n\t\t\t\tif(conf.beforeDealProperties) {\r\n\t\t\t\t\tconf.beforeDealProperties();\r\n\t\t\t\t}\r\n\t\t\t\tconf = xsloader.dealProperties(conf, conf.properties); //参数处理\r\n\r\n\t\t\t\tif(isLocal && conf.service.hasGlobal) {\r\n\t\t\t\t\tloadServiceConfig(\"global servie\", conf.service.confUrl,\r\n\t\t\t\t\t\tfunction(globalConfig) {\r\n\t\t\t\t\t\t\tlet localConfig = conf;\r\n\t\t\t\t\t\t\tglobal[globalConfig.main && globalConfig.main.localConfigVar || localConfig.main.localConfigVar] = localConfig;\r\n\t\t\t\t\t\t\tglobal[globalConfig.main && globalConfig.main.globalConfigVar || localConfig.main.globalConfigVar] = globalConfig;\r\n\r\n\t\t\t\t\t\t\tlet mainName, mainPath, loaderName;\r\n\r\n\t\t\t\t\t\t\tloaderName = globalConfig.chooseLoader.call(globalConfig, localConfig);\r\n\t\t\t\t\t\t\tlet conf;\r\n\t\t\t\t\t\t\tlet loader;\r\n\t\t\t\t\t\t\tif(loaderName != null) {\r\n\t\t\t\t\t\t\t\tmainName = globalConfig.main.name;\r\n\t\t\t\t\t\t\t\tmainPath = utils.getPathWithRelative(location.href, getMainPath(globalConfig));\r\n\t\t\t\t\t\t\t\tloader = globalConfig.loader[loaderName];\r\n\t\t\t\t\t\t\t\tconf = globalConfig;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tif(!loader) {\r\n\t\t\t\t\t\t\t\tloaderName = localConfig.chooseLoader.call(localConfig, null);\r\n\t\t\t\t\t\t\t\tmainName = localConfig.main.name;\r\n\t\t\t\t\t\t\t\tmainPath = utils.getPathWithRelative(location.href, getMainPath(localConfig));\r\n\t\t\t\t\t\t\t\tloader = localConfig.loader[loaderName];\r\n\t\t\t\t\t\t\t\tconf = localConfig;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tif(!loader) {\r\n\t\t\t\t\t\t\t\tconsole.error(\"unknown loader:\" + loaderName + \"\");\r\n\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tinitXsloader(mainName, mainPath, loader, conf, localConfig);\r\n\r\n\t\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\tcallback(conf);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tfail(err) {\r\n\t\t\t\tconsole.error(\"load \" + tag + \" config err:url=\" + url + \",errinfo=\" + err);\r\n\t\t\t}\r\n\t\t}).done();\r\n\t}\r\n\r\n\tfunction startLoad() {\r\n\t\tloadServiceConfig(\"local\", serviceConfigUrl, function(localConfig) {\r\n\t\t\tglobal[localConfig.main.localConfigVar] = localConfig;\r\n\r\n\t\t\tlet mainName = localConfig.main.name;\r\n\r\n\t\t\tlet href = location.href;\r\n\t\t\tlet index = href.lastIndexOf(\"?\");\r\n\t\t\tif(index >= 0) {\r\n\t\t\t\thref = href.substring(0, index);\r\n\t\t\t}\r\n\r\n\t\t\tlet mainPath = getMainPath(localConfig);\r\n\r\n\t\t\tmainPath = mainPath.indexOf(\"!\") == -1 ? utils.getPathWithRelative(href, mainPath) : mainPath;\r\n\t\t\tlet loaderName = localConfig.chooseLoader.call(localConfig, null);\r\n\r\n\t\t\tlet loader = localConfig.loader[loaderName];\r\n\t\t\tif(!loader) {\r\n\t\t\t\tconsole.error(\"unknown local loader:\" + loaderName);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tinitXsloader(href, mainName, mainPath, loader, localConfig, localConfig);\r\n\t\t}, true);\r\n\t}\r\n\r\n\tfunction initXsloader(pageHref, mainName, mainPath, loader, conf, localConfig) {\r\n\t\tlet resUrls = [];\r\n\t\tconf.service.resUrl && resUrls.push(conf.service.resUrl);\r\n\t\tlocalConfig !== conf && localConfig.service.resUrl && resUrls.push(localConfig.service.resUrl);\r\n\r\n\t\tconf.service.resUrls && Array.pushAll(resUrls, conf.service.resUrls);\r\n\t\tlocalConfig !== conf && localConfig.service.resUrls && Array.pushAll(resUrls, localConfig.service.resUrls);\r\n\r\n\t\txsloader._resUrlBuilder = function(groupModule) {\r\n\t\t\tlet as = [];\r\n\t\t\tutils.each(resUrls, function(url) {\r\n\t\t\t\tas.push(xsloader.appendArgs2Url(url, \"m=\" + encodeURIComponent(groupModule)));\r\n\t\t\t});\r\n\t\t\treturn as;\r\n\t\t};\r\n\t\tloader.ignoreProperties = true;\r\n\t\tloader.defineFunction = loader.defineFunction || {};\r\n\t\tloader.depsPaths = loader.depsPaths || {};\r\n\t\tif(mainPath.indexOf(\"!\") != -1) { //插件调用\r\n\t\t\tlet theConfig = xsloader(loader);\r\n\r\n\t\t\tmainName = \"_plugin_main_\";\r\n\t\t\tlet deps = [];\r\n\t\t\tif(theConfig.deps) { //手动添加*依赖\r\n\t\t\t\tif(theConfig.deps[\"*\"]) {\r\n\t\t\t\t\tArray.pushAll(deps, theConfig.deps[\"*\"]);\r\n\t\t\t\t}\r\n\t\t\t\tif(theConfig.deps[mainName]) {\r\n\t\t\t\t\tArray.pushAll(deps, theConfig.deps[mainName]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tdeps.push(mainPath);\r\n\t\t\txsloader.define(mainName, deps, function() {\r\n\r\n\t\t\t}).then({\r\n\t\t\t\tabsUrl: pageHref\r\n\t\t\t});\r\n\t\t} else if(!xsloader.hasDefine(mainName)) {\r\n\t\t\tloader.depsPaths[mainName] = mainPath; //让其依赖*中的所有依赖\r\n\t\t\txsloader(loader);\r\n\t\t} else {\r\n\t\t\txsloader(loader);\r\n\t\t}\r\n\r\n\t\tloader.defineFunction[mainName] = function(originCallback, originThis, originArgs) {\r\n\t\t\tif(xsloader.isFunction(conf.main.before)) {\r\n\t\t\t\tconf.main.before.call(conf, mainName);\r\n\t\t\t}\r\n\t\t\tlet rt = originCallback.apply(originThis, originArgs);\r\n\r\n\t\t\tif(xsloader.isFunction(conf.main.after)) {\r\n\t\t\t\tconf.main.after.call(conf, mainName);\r\n\t\t\t}\r\n\t\t\treturn rt;\r\n\t\t};\r\n\r\n\t\txsloader.require([mainName], function(main) {}).error((err, invoker) => {\r\n\t\t\tif(invoker) {\r\n\t\t\t\tconsole.error(\"error occured:invoker.url=\", invoker.getUrl());\r\n\t\t\t}\r\n\t\t\tconsole.error(\"invoke main err:\");\r\n\t\t\tconsole.error(err);\r\n\t\t});\r\n\t}\r\n\txsloader.asyncCall(startLoad, true);\r\n};\r\n\r\nif(dataConf) {\r\n\tserviceConfigUrl = utils.getPathWithRelative(location.href, dataConf);\r\n} else if((dataConf = (xsloader.script().getAttribute(DATA_CONF2) || xsloader.script().getAttribute(DATA_CONF2X)))) {\r\n\tserviceConfigUrl = utils.getPathWithRelative(xsloader.scriptSrc(), dataConf);\r\n} else {\r\n\tinitFun = null;\r\n}\r\ninitFun && initFun();","import \"./polyfill/index.js\";\r\nimport \"./core/index.js\";\r\nimport \"./define.js\";\r\nimport \"./core/plugins/index.js\";\r\nimport \"./service.js\"; //放在最后\r\nimport utils from \"./util/index.js\";\r\nutils.loaderEnd();"],"names":["JSON","rx_one","rx_two","rx_three","rx_four","rx_escapable","rx_dangerous","gap","indent","meta","rep","g","f","n","this_value","this","valueOf","quote","string","lastIndex","test","replace","a","c","charCodeAt","toString","slice","str","key","holder","i","k","v","length","partial","mind","value","_typeof","toJSON","call","isFinite","String","Object","prototype","apply","join","push","hasOwnProperty","Date","getUTCFullYear","getUTCMonth","getUTCDate","getUTCHours","getUTCMinutes","getUTCSeconds","Boolean","Number","stringify","replacer","space","Error","parse","text","reviver","j","walk","undefined","eval","SyntaxError","window","self","global","InVar","val","get","set","newVal","old","loaderFun","xsloader","arguments","fun","ABSOLUTE_PROTOCOL_REG","ABSOLUTE_PROTOCOL_REG2","defaultJsExts","isJsFile","path","isString","indexOf","pluginIndex","substring","index","theConfig","config","jsExts","endsWith","ext","dealPathMayAbsolute","currentUrl","location","href","finalPath","absolute","rs","exec","protocol","_protocol","_host","host","getPathWithRelative","relative","isPathDir","relativeQuery","qIndex","lastIndexOf","isRelativeDir","prefix","absolute2","index2","stack","split","pop","relatives","result","appendArgs2Url","getNodeAbsolutePath","node","src","getAttribute","removeQueryHash","url","REPLACE_STRING_PROPERTIES_EXP","RegExp","ALL_TYPE_PROPERTIES_EXP","propertiesDeal","configObject","properties","replaceStringProperties","property","propKey","propValue","getObjectAttr","propertyKey","has","replaceProperties","obj","enableKeyAttr","isFunction","isArray","isObject","replaceKeyMap","x","_x","objx","__dealt__","replaceModulePrefix","deps","m","pluginParam","query","startsWith","modulePrefixCount","modulePrefix","replaceStr","len","pluginName","dep","getScriptBySubname","subname","ss","document","getElementsByTagName","script","thePageUrl","commentRegExp","cjsRequireRegExp","GraphPath","pathEdges","vertexMap","depMap","checkLoop","visited","recursionStack","paths","edges","edge","end","addEdge","begin","hasDep","name","tryAddEdge","hasLoop","strValue2Arr","each","ary","func","isSync","fromEnd","__commentReplace","match","singlePrefix","appendInnerDeps","callback","indexInArray","idCount","getAndIncIdCount","PluginError","err","invoker","isXsLoaderEnd","IE_VERSION","userAgent","navigator","isIE","isEdge","isIE11","reIE","fIEVersion","parseInt","graphPath","loaderEnd","isLoaderEnd","whichTransitionEvent","t","el","createElement","transitions","style","transitionEvent","ToProgress","opt","progress","options","id","color","bgColor","height","duration","opacityDuration","progressBar","container","setCSS","appendChild","body","setColor","backgroundColor","_isAuto","_timer","stopAuto","clearInterval","autoIncrement","time","dt","setInterval","_this","setProgress","toError","errColor","transit","width","getProgress","show","increase","toBeIncreasedProgress","decrease","toBeDecreasedProgress","finish","setTimeout","_this2","hide","parentNode","removeChild","reset","opacity","display","urls","base","loading","utils","Function","bind","console","method","thiz","e","log","error","warn","Array","elem","offset","pushAll","arr","starts","ends","_indexInArray","array","ele","compare","indexInArrayFrom","randId","suffix","getTime","Math","random","xsEval","scriptString","xsParseJson","option","extend","fnStart","fnEnd","rcomment","fnMap","fnOffset","indexStart","indexEnd","fnId","fnStr","trim","fn","xsJSON","reg","message","posStr","pos","_str","e2","xsJson2String","_toParamsMap","argsStr","decode","search","s","ret","seg","decodeURIComponent","urlArgs","hashIndex","oldParams","newParams","paramKeys","sort","params","hash","queryString2ParamsMap","ostring","it","isDate","isRegExp","queryParam","otherValue","optionUrl","substr","r","getUrl","relativeUrl","appendArgs","optionalAbsUrl","baseUrl","dealUrl","tryCall","defaultReturn","exCallback","dealProperties","target","extendDeep","_AsyncCall","useTimer","count","ctrlCallbackMap","pushTask","callbackObj","handle","next","nextCallback","lastReturn","mineCount","ctrlCallback","asyncCallQueue","shift","nextObj","Promise","resolve","then","initCtrlCallback","theAsyncCall","theAsyncCallOfTimer","asyncCall","attrNames","defaultValue","attrs","setObjectAttr","_obj","o","clone","isDeep","source","flags","copy","setTime","attr","isDOM","HTMLElement","nodeType","nodeName","onReadyFun","isGlobalReady","bindReadyQueue","BindReady","isReady","addEventListener","removeEventListener","ready","attachEvent","fun2","readyState","detachEvent","documentElement","doScroll","frameElement","readyCall","onReady","br","type","toGlobal","deprecated","justLoader","is","funs","browser","_ignoreAspect_","theDefinedMap","lastDefinObjectMap","ModuleDef","module","queue","_preModule","relyQueue","args","relyIt","isPreDependOn","modules","defaultModule","targetDef","preDependModule","_isSrc","nameOrUrl","setLastDefineObject","defineObject","getLastDefineObject","appendLoadingModuleDeps","moduleDef","mod","state","_deps","pushName","selfname","getModule","ifoneThenGet","isSrc","preDependOn","def","replaceModuleSrc","oldSrc","clearEmptyModuleBySrc","setModule","lasfDef","giveRelys","newModuleInstance","thatInvoker","relyCallback","pluginArgs","instanceModule","_invoker","_module_","initInvoker","ignoreAspect","_object","addTheAttrs","theObj","_invoker_","_modules_","isSingle","instanceType","loopObject","description","_setDepModuleObjectGen","moduleObject","genExports","_getCacheKey","getCacheKey","_willCache","cacheResult","willCache","lastSinglePluginResult","setSinglePluginResult","initInstance","justForSingle","dealInstance","hasFinished","onload","__default","onerror","last","concat","pluginMain","waitSeconds","moduleMap","absUrl","getName","Invoker","_newModule","DefineObject","appendConfigDepsAndEmbedDeps","newModule","instances","parent","parentDefine","relys","absUrlFromModule","absUrlFromDefineObject","getCallback","_dealApplyArgs","_loadCallback","reinitByDefineObject","setInstanceType","_singlePluginResult","currentDefineModuleQueue","setState","isDefault","errinfo","_callback","_state","theCallback","getDeps","require","defined_module_for_deps","refmodule","toOtherModule","otherModule","theRelys","whenNeed","loadCallback","callbackFun","moduleInstance","opId","setToAll","getModuleId","ins","mobj","_m_","printOnNotDefined","root","nodes","_printOnNotDefined","leafs","findLeaf","item","leaf","infos","genErrs","reverse","as","errModule","depMod","indexPlguin","randModuleIndex","everyRequired","everyOkCallback","errCallback","isError","dealRelative","theExports","hasCallErr","depCount","depModules","invoker_of_module","syncHandle","originDep","version","groupModule","i1","i2","i3","defaultVersion","_url","_resUrlBuilder","isInUrls","getUrls","rurl","loadModule","module2","loadScript","scriptData","defaultMod","m2Name","configDeps","d","depModule","dep_name","checkFinish","orderDep","defContextName","DATA_ATTR_MODULE","DATA_ATTR_CONTEXT","INNER_DEPS_PLUGIN","innerDepsMap","globalDefineQueue","isOpera","opera","safariVersion","toLowerCase","readyRegExp","platform","theLoaderScript","currentScript","theLoaderUrl","head","peek","lastAppendHeadDom","isSrcFromScriptLoad","lastScriptSrc","theRealDefine","_dealEmbedDeps","modName","moduleScript","isOrderDep","_getPluginParam","Handle","onError","ThisInvoker","_buildInvoker","getId","h","define","defineAsync","withAbsUrl","absUrlStr","_im","getInvoker","nullNew","parentModule","names","directDepLength","hasOrderDep","_directDepLength","odeps","unshift","applyArgs","jsFilePath","absoluteUrl","isRequire","before","depBefore","depDeps","instance","getCurrentScript","isRemoveQueryHash","b","sourceURL","stacktrace","_getCurrentScriptOrSrc","__createNode","charset","async","__removeListener","ieName","__browserLoader","moduleName","setAttribute","onScriptLoad","errListen","onScriptError","appendHeadDom","__getScriptData","evt","currentTarget","srcElement","dom","nextDom","nextSibling","insertBefore","removed","doDefine","predefine","isFirstRequire","prerequire","originDeps","argArr","theMod","timeid","customerErrCallback","isErr","isOk","enable","delay","clearTimer","clearTimeout","ifmodule","initDefine","theDefine","defines","loaded","onConfigedCallback","theContext","argsObject","_newContext","contextName","defQueue","scriptSrc","putUrlArgs","argsObj","getUrlArgs","clearUrlArgs","hasDefine","groupName","clear_module_","loader","pathname","ignoreProperties","depsPaths","defineFunction","autoUrlArgs","dealtDeps","splice","urlArg","forPrefixSuffix","aurl","encodeURIComponent","dealUrlArgs","isAutoUrlArgs","star","urlArgsArr","urlArgObj","starP","_urlArgs_prefix","_urlArgs_suffix","strfix","urlOrName","strfixObj","pushDeps","dealtDepArray","depsArray","keyName","defineHandle","originCallback","rt","defineFun","onModuleLoaded","lastDefineObject","needCallback","depModuleArgs","amd","depId","depsObj","newInvoker","arg","vars","existsMods","newName","lastM","load","engine","useImportLoad","useOnload","createStyle","curStyle","curSheet","styleSheet","sheet","createIeLoad","addImport","processIeLoad","ieCnt","importLoad","ieCurCallback","ieLoads","textContent","loadInterval","cssRules","linkLoad","link","rel","styleSheets","cssAPI","nextLoad","cssId","loadCss","cssPath","loadCsses","http","handleAs","ok","fail","done","depsStr","json","progIds","httpRequest","prop","varName","defaultVal","putProp","toObj","_method","_params","_headers","_async","_multiPart","_handleType","_timeout","timeout","okCallback","failCallback","uploadStartCallback","uploadStart","uploadProgressCallback","uploadProgress","uploadOkCallback","uploadOk","uploadErrorCallback","uploadError","uploadEndCallback","uploadEnd","_beforeOpenHook","_onOkResponseHook","_onFailResponseHook","conn","xhr","toUpperCase","headers","handleType","multiPart","timeoutTimer","formData","FormData","append","open","setRequestHeader","header","upload","onloadstart","onprogress","onloadend","isTimeout","abort","onreadystatechange","status","_doOnFailResponseHook","responseText","send","_connAfterOpenHook","_conn","progId","XMLHttpRequest","ActiveXObject","createXhr","extraErr","urlStr","methodStr","isAsync","paramsObj","headersObj","extraErrorType","_xshttp_request_","reject","instanceMap","cmd2ListenerMap","instanceBindMap","oinstanceidMap","isDebug","isXsMsgDebug","LinkedList","newNode","element","pre","headNode","lastNode","getElement","position","willRemove","pNode","currentNode","nextCurrentNode","current","insert","elementAt","eachForRemove","removeAt","find","remove","isEmpty","size","api","CommunicationUnit","cmd","connectingSource","onfailed","isActive","conndata","handleId","msgQueue","MAX_TRY","SLEEP","isConnected","connectCount","isCanceled","_onConned","_source","data","onConnectedListener","sendTop","_onMsg","msgid","onReceiveListener","postMessageBridge","sendResponse","_onResponse","_onElse","initListen","listen","msg","init","sendConn","runAfter","release","setSource","_connectWindow","winObjOrCallback","notActive","unit","listener","connected","origin","errtype","connectedCallback","receiveCallback","sender","winObj","_connectIFrame","iframe","contentWindow","osource","active","refused","instanceid","_sendData","event","oinstanceid","rdata","fromSource","originStr","listeners","Callback","isAccept","handleConn","minstanceid","handleAccept","checkSource","handleConned","handleMsg","handleResponse","handleBinded","handleApi","connectIFrame","connectParent","connectTop","top","connectOpener","opener","listenMessage","debug","postMessage","DATA_CONF","DATA_CONFX","DATA_CONF2","DATA_CONF2X","DATA_MAIN","DATA_MAINX","DATA_CONF_TYPE","serviceConfigUrl","dataConf","dataMain","dataConfType","initFun","getMainPath","mainPath","main","getPath","loadServiceConfig","tag","isLocal","confText","conf","localConfigVar","globalConfigVar","after","service","hasGlobal","resUrls","chooseLoader","localConfig","extendConfig","beforeDealProperties","confUrl","globalConfig","mainName","loaderName","initXsloader","pageHref","resUrl","originThis","originArgs"],"mappings":"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"}