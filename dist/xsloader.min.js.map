{"version":3,"file":"xsloader.min.js","sources":["../src/polyfill/json.js","../src/util/global.js","../src/core/loader.js","../src/util/urls.js","../src/util/base.js","../src/util/index.js","../src/public/global-deprecated.js","../src/public/global-base.js","../src/public/is.js","../src/public/funs.js","../src/public/browser.js","../src/public/index.js","../src/core/module-def.js","../src/core/module.js","../src/core/script.js","../src/core/index.js","../src/define.js","../src/core/plugins/inner-dep.js","../src/core/plugins/ready.js","../src/core/plugins/nodeps.js","../src/core/plugins/exists.js","../src/core/plugins/name.js","../src/core/plugins/css.js","../src/core/plugins/text.js","../src/core/plugins/window.js","../src/core/plugins/withdeps.js","../src/core/plugins/json.js","../src/core/plugins/xshttp.js","../src/core/plugins/xsrequest.js","../src/core/plugins/xsmsg.js","../src/service.js","../src/main.js"],"sourcesContent":["//https://github.com/douglascrockford/JSON-js\n//  json2.js\n//  2017-06-12\n//  Public Domain.\n//  NO WARRANTY EXPRESSED OR IMPLIED. USE AT YOUR OWN RISK.\n\n//  USE YOUR OWN COPY. IT IS EXTREMELY UNWISE TO LOAD CODE FROM SERVERS YOU DO\n//  NOT CONTROL.\nconst JSON = {};\n\nexport default JSON;\n\nlet rx_one = /^[\\],:{}\\s]*$/;\nlet rx_two = /\\\\(?:[\"\\\\\\/bfnrt]|u[0-9a-fA-F]{4})/g;\nlet rx_three = /\"[^\"\\\\\\n\\r]*\"|true|false|null|-?\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d+)?/g;\nlet rx_four = /(?:^|:|,)(?:\\s*\\[)+/g;\nlet rx_escapable = /[\\\\\"\\u0000-\\u001f\\u007f-\\u009f\\u00ad\\u0600-\\u0604\\u070f\\u17b4\\u17b5\\u200c-\\u200f\\u2028-\\u202f\\u2060-\\u206f\\ufeff\\ufff0-\\uffff]/g;\nlet rx_dangerous = /[\\u0000\\u00ad\\u0600-\\u0604\\u070f\\u17b4\\u17b5\\u200c-\\u200f\\u2028-\\u202f\\u2060-\\u206f\\ufeff\\ufff0-\\uffff]/g;\n\nfunction f(n) {\n\t// Format integers to have at least two digits.\n\treturn(n < 10) ?\n\t\t\"0\" + n :\n\t\tn;\n}\n\nfunction this_value() {\n\treturn this.valueOf();\n}\n\nif(typeof Date.prototype.toJSON !== \"function\") {\n\n\tDate.prototype.toJSON = function() {\n\t\treturn isFinite(this.valueOf()) ?\n\t\t\t(\n\t\t\t\tthis.getUTCFullYear() +\n\t\t\t\t\"-\" +\n\t\t\t\tf(this.getUTCMonth() + 1) +\n\t\t\t\t\"-\" +\n\t\t\t\tf(this.getUTCDate()) +\n\t\t\t\t\"T\" +\n\t\t\t\tf(this.getUTCHours()) +\n\t\t\t\t\":\" +\n\t\t\t\tf(this.getUTCMinutes()) +\n\t\t\t\t\":\" +\n\t\t\t\tf(this.getUTCSeconds()) +\n\t\t\t\t\"Z\"\n\t\t\t) :\n\t\t\tnull;\n\t};\n\n\tBoolean.prototype.toJSON = this_value;\n\tNumber.prototype.toJSON = this_value;\n\tString.prototype.toJSON = this_value;\n}\n\nlet gap;\nlet indent;\nlet meta;\nlet rep;\n\nfunction quote(string) {\n\n\t// If the string contains no control characters, no quote characters, and no\n\t// backslash characters, then we can safely slap some quotes around it.\n\t// Otherwise we must also replace the offending characters with safe escape\n\t// sequences.\n\n\trx_escapable.lastIndex = 0;\n\treturn rx_escapable.test(string) ?\n\t\t\"\\\"\" + string.replace(rx_escapable, function(a) {\n\t\t\tlet c = meta[a];\n\t\t\treturn typeof c === \"string\" ?\n\t\t\t\tc :\n\t\t\t\t\"\\\\u\" + (\"0000\" + a.charCodeAt(0).toString(16)).slice(-4);\n\t\t}) + \"\\\"\" :\n\t\t\"\\\"\" + string + \"\\\"\";\n}\n\nfunction str(key, holder) {\n\t// Produce a string from holder[key].\n\tlet i; // The loop counter.\n\tlet k; // The member key.\n\tlet v; // The member value.\n\tlet length;\n\tlet mind = gap;\n\tlet partial;\n\tlet value = holder[key];\n\n\t// If the value has a toJSON method, call it to obtain a replacement value.\n\tif(\n\t\tvalue &&\n\t\ttypeof value === \"object\" &&\n\t\ttypeof value.toJSON === \"function\"\n\t) {\n\t\tvalue = value.toJSON(key);\n\t}\n\n\t// If we were called with a replacer function, then call the replacer to\n\t// obtain a replacement value.\n\n\tif(typeof rep === \"function\") {\n\t\tvalue = rep.call(holder, key, value);\n\t}\n\n\t// What happens next depends on the value's type.\n\n\tswitch(typeof value) {\n\t\tcase \"string\":\n\t\t\treturn quote(value);\n\t\tcase \"number\":\n\t\t\t// JSON numbers must be finite. Encode non-finite numbers as null.\n\t\t\treturn(isFinite(value)) ?\n\t\t\t\tString(value) :\n\t\t\t\t\"null\";\n\n\t\tcase \"boolean\":\n\t\tcase \"null\":\n\t\t\t// If the value is a boolean or null, convert it to a string. Note:\n\t\t\t// typeof null does not produce \"null\". The case is included here in\n\t\t\t// the remote chance that this gets fixed someday.\n\t\t\treturn String(value);\n\n\t\t\t// If the type is \"object\", we might be dealing with an object or an array or\n\t\t\t// null.\n\t\tcase \"object\":\n\t\t\t// Due to a specification blunder in ECMAScript, typeof null is \"object\",\n\t\t\t// so watch out for that case.\n\t\t\tif(!value) {\n\t\t\t\treturn \"null\";\n\t\t\t}\n\n\t\t\t// Make an array to hold the partial results of stringifying this object value.\n\n\t\t\tgap += indent;\n\t\t\tpartial = [];\n\t\t\t// Is the value an array?\n\t\t\tif(Object.prototype.toString.apply(value) === \"[object Array]\") {\n\n\t\t\t\t// The value is an array. Stringify every element. Use null as a placeholder\n\t\t\t\t// for non-JSON values.\n\t\t\t\tlength = value.length;\n\t\t\t\tfor(i = 0; i < length; i += 1) {\n\t\t\t\t\tpartial[i] = str(i, value) || \"null\";\n\t\t\t\t}\n\t\t\t\t// Join all of the elements together, separated with commas, and wrap them in\n\t\t\t\t// brackets.\n\n\t\t\t\tv = partial.length === 0 ?\n\t\t\t\t\t\"[]\" :\n\t\t\t\t\tgap ?\n\t\t\t\t\t(\n\t\t\t\t\t\t\"[\\n\" +\n\t\t\t\t\t\tgap +\n\t\t\t\t\t\tpartial.join(\",\\n\" + gap) +\n\t\t\t\t\t\t\"\\n\" +\n\t\t\t\t\t\tmind +\n\t\t\t\t\t\t\"]\"\n\t\t\t\t\t) :\n\t\t\t\t\t\"[\" + partial.join(\",\") + \"]\";\n\t\t\t\tgap = mind;\n\t\t\t\treturn v;\n\t\t\t}\n\n\t\t\t// If the replacer is an array, use it to select the members to be stringified.\n\t\t\tif(rep && typeof rep === \"object\") {\n\t\t\t\tlength = rep.length;\n\t\t\t\tfor(i = 0; i < length; i += 1) {\n\t\t\t\t\tif(typeof rep[i] === \"string\") {\n\t\t\t\t\t\tk = rep[i];\n\t\t\t\t\t\tv = str(k, value);\n\t\t\t\t\t\tif(v) {\n\t\t\t\t\t\t\tpartial.push(quote(k) + (\n\t\t\t\t\t\t\t\t(gap) ?\n\t\t\t\t\t\t\t\t\": \" : \":\"\n\t\t\t\t\t\t\t) + v);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// Otherwise, iterate through all of the keys in the object.\n\t\t\t\tfor(k in value) {\n\t\t\t\t\tif(Object.prototype.hasOwnProperty.call(value, k)) {\n\t\t\t\t\t\tv = str(k, value);\n\t\t\t\t\t\tif(v) {\n\t\t\t\t\t\t\tpartial.push(quote(k) + (\n\t\t\t\t\t\t\t\t(gap) ?\n\t\t\t\t\t\t\t\t\": \" :\n\t\t\t\t\t\t\t\t\":\"\n\t\t\t\t\t\t\t) + v);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Join all of the member texts together, separated with commas,\n\t\t\t// and wrap them in braces.\n\n\t\t\tv = partial.length === 0 ?\n\t\t\t\t\"{}\" : gap ?\n\t\t\t\t\"{\\n\" + gap + partial.join(\",\\n\" + gap) + \"\\n\" + mind + \"}\" :\n\t\t\t\t\"{\" + partial.join(\",\") + \"}\";\n\t\t\tgap = mind;\n\t\t\treturn v;\n\t}\n}\n\n// If the JSON object does not yet have a stringify method, give it one.\nif(typeof JSON.stringify !== \"function\") {\n\tmeta = { // table of character substitutions\n\t\t\"\\b\": \"\\\\b\",\n\t\t\"\\t\": \"\\\\t\",\n\t\t\"\\n\": \"\\\\n\",\n\t\t\"\\f\": \"\\\\f\",\n\t\t\"\\r\": \"\\\\r\",\n\t\t\"\\\"\": \"\\\\\\\"\",\n\t\t\"\\\\\": \"\\\\\\\\\"\n\t};\n\tJSON.stringify = function(value, replacer, space) {\n\n\t\t// The stringify method takes a value and an optional replacer, and an optional\n\t\t// space parameter, and returns a JSON text. The replacer can be a function\n\t\t// that can replace values, or an array of strings that will select the keys.\n\t\t// A default replacer method can be provided. Use of the space parameter can\n\t\t// produce text that is more easily readable.\n\n\t\tlet i;\n\t\tgap = \"\";\n\t\tindent = \"\";\n\t\t// If the space parameter is a number, make an indent string containing that\n\t\t// many spaces.\n\t\tif(typeof space === \"number\") {\n\t\t\tfor(i = 0; i < space; i += 1) {\n\t\t\t\tindent += \" \";\n\t\t\t}\n\n\t\t\t// If the space parameter is a string, it will be used as the indent string.\n\n\t\t} else if(typeof space === \"string\") {\n\t\t\tindent = space;\n\t\t}\n\n\t\t// If there is a replacer, it must be a function or an array.\n\t\t// Otherwise, throw an error.\n\n\t\trep = replacer;\n\t\tif(replacer && typeof replacer !== \"function\" && (\n\t\t\t\ttypeof replacer !== \"object\" ||\n\t\t\t\ttypeof replacer.length !== \"number\"\n\t\t\t)) {\n\t\t\tthrow new Error(\"JSON.stringify\");\n\t\t}\n\n\t\t// Make a fake root object containing our value under the key of \"\".\n\t\t// Return the result of stringifying the value.\n\n\t\treturn str(\"\", {\n\t\t\t\"\": value\n\t\t});\n\t};\n}\n\n// If the JSON object does not yet have a parse method, give it one.\n\nif(typeof JSON.parse !== \"function\") {\n\tJSON.parse = function(text, reviver) {\n\t\t// The parse method takes a text and an optional reviver function, and returns\n\t\t// a JavaScript value if the text is a valid JSON text.\n\t\tlet j;\n\n\t\tfunction walk(holder, key) {\n\t\t\t// The walk method is used to recursively walk the resulting structure so\n\t\t\t// that modifications can be made.\n\t\t\tlet k;\n\t\t\tlet v;\n\t\t\tlet value = holder[key];\n\t\t\tif(value && typeof value === \"object\") {\n\t\t\t\tfor(k in value) {\n\t\t\t\t\tif(Object.prototype.hasOwnProperty.call(value, k)) {\n\t\t\t\t\t\tv = walk(value, k);\n\t\t\t\t\t\tif(v !== undefined) {\n\t\t\t\t\t\t\tvalue[k] = v;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tdelete value[k];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn reviver.call(holder, key, value);\n\t\t}\n\n\t\t// Parsing happens in four stages. In the first stage, we replace certain\n\t\t// Unicode characters with escape sequences. JavaScript handles many characters\n\t\t// incorrectly, either silently deleting them, or treating them as line endings.\n\t\ttext = String(text);\n\t\trx_dangerous.lastIndex = 0;\n\t\tif(rx_dangerous.test(text)) {\n\t\t\ttext = text.replace(rx_dangerous, function(a) {\n\t\t\t\treturn(\n\t\t\t\t\t\"\\\\u\" +\n\t\t\t\t\t(\"0000\" + a.charCodeAt(0).toString(16)).slice(-4)\n\t\t\t\t);\n\t\t\t});\n\t\t}\n\n\t\t// In the second stage, we run the text against regular expressions that look\n\t\t// for non-JSON patterns. We are especially concerned with \"()\" and \"new\"\n\t\t// because they can cause invocation, and \"=\" because it can cause mutation.\n\t\t// But just to be safe, we want to reject all unexpected forms.\n\n\t\t// We split the second stage into 4 regexp operations in order to work around\n\t\t// crippling inefficiencies in IE's and Safari's regexp engines. First we\n\t\t// replace the JSON backslash pairs with \"@\" (a non-JSON character). Second, we\n\t\t// replace all simple value tokens with \"]\" characters. Third, we delete all\n\t\t// open brackets that follow a colon or comma or that begin the text. Finally,\n\t\t// we look to see that the remaining characters are only whitespace or \"]\" or\n\t\t// \",\" or \":\" or \"{\" or \"}\". If that is so, then the text is safe for eval.\n\n\t\tif(\n\t\t\trx_one.test(\n\t\t\t\ttext\n\t\t\t\t.replace(rx_two, \"@\")\n\t\t\t\t.replace(rx_three, \"]\")\n\t\t\t\t.replace(rx_four, \"\")\n\t\t\t)\n\t\t) {\n\n\t\t\t// In the third stage we use the eval function to compile the text into a\n\t\t\t// JavaScript structure. The \"{\" operator is subject to a syntactic ambiguity\n\t\t\t// in JavaScript: it can begin a block or an object literal. We wrap the text\n\t\t\t// in parens to eliminate the ambiguity.\n\t\t\tj = eval(\"(\" + text + \")\");\n\t\t\t// In the optional fourth stage, we recursively walk the new structure, passing\n\t\t\t// each name/value pair to a reviver function for possible transformation.\n\n\t\t\treturn(typeof reviver === \"function\") ?\n\t\t\t\twalk({\n\t\t\t\t\t\"\": j\n\t\t\t\t}, \"\") : j;\n\t\t}\n\t\t// If the text is not JSON parseable, then a SyntaxError is thrown.\n\t\tthrow new SyntaxError(\"JSON.parse\");\n\t};\n}","let g;\nif(typeof window !== undefined) {\n\tg = window;\n} else if(typeof self !== undefined) {\n\tg = self;\n} else if(typeof global !== undefined) {\n\tg = global;\n} else {\n\tthrow new Error(\"not found global var!\");\n}\n\n/**\n * 用于包装变量，防止JSON.stringify等时输出指定变量。\n * @param {Object} val\n */\nfunction InVar(val) {\n\tthis.get = function() {\n\t\treturn val;\n\t};\n\n\tthis.set = function(newVal) {\n\t\tlet old = val;\n\t\tval = newVal;\n\t\treturn old;\n\t};\n}\ng.InVar = InVar;\n\nexport default g;","import global from '../util/global.js';\nlet loaderFun;\nlet xsloader = global.xsloader = function() {\n\treturn loaderFun.apply(this, arguments);\n};\n\nexport default {\n\tloaderFun: (fun) => {\n\t\tloaderFun = fun;\n\t}\n};","const ABSOLUTE_PROTOCOL_REG = /^(([a-zA-Z0-9_]*:\\/\\/)|(\\/)|(\\/\\/))/;\nconst ABSOLUTE_PROTOCOL_REG2 = /^([a-zA-Z0-9_]+:)\\/\\/([^/\\s]+)/;\nconst defaultJsExts = [\".js\", \".js+\", \".js++\", \".es\", \"es6\", \".jsx\", \".vue\"];\n\nimport global from './global.js';\nconst xsloader = global.xsloader;\n\nfunction isJsFile(path) {\n\tif(!xsloader.isString(path)) {\n\t\treturn false;\n\t}\n\tvar pluginIndex = path.indexOf(\"!\");\n\tif(pluginIndex > 0) {\n\t\tpath = path.substring(0, pluginIndex);\n\t}\n\tvar index = path.indexOf(\"?\");\n\tif(index > 0) {\n\t\tpath = path.substring(0, index);\n\t}\n\tindex = path.indexOf(\"#\");\n\tif(index > 0) {\n\t\tpath = path.substring(0, index);\n\t}\n\tlet theConfig = xsloader.config();\n\n\tvar jsExts = theConfig && theConfig.jsExts || defaultJsExts;\n\tfor(var i = 0; i < jsExts.length; i++) {\n\t\tif(xsloader.endsWith(path, jsExts[i])) {\n\t\t\treturn {\n\t\t\t\text: jsExts[i],\n\t\t\t\tpath: path\n\t\t\t};\n\t\t}\n\t}\n\treturn false;\n}\n\nfunction dealPathMayAbsolute(path, currentUrl) {\n\tcurrentUrl = currentUrl || location.href;\n\tlet rs = ABSOLUTE_PROTOCOL_REG.exec(path);\n\n\tlet finalPath;\n\tlet absolute;\n\tif(rs) {\n\t\tlet protocol = rs[1];\n\t\tabsolute = true;\n\n\t\trs = ABSOLUTE_PROTOCOL_REG2.exec(currentUrl);\n\t\tlet _protocol = rs && rs[1] || location.protocol;\n\t\tlet _host = rs && rs[2] || location.host;\n\n\t\tif(protocol == \"//\") {\n\t\t\tfinalPath = _protocol + \"//\" + path;\n\t\t} else if(protocol == \"/\") {\n\t\t\tfinalPath = _protocol + \"//\" + _host + path;\n\t\t} else {\n\t\t\tfinalPath = path;\n\t\t}\n\n\t} else {\n\t\tabsolute = false;\n\t\tfinalPath = path;\n\t}\n\treturn {\n\t\tabsolute: absolute,\n\t\tpath: finalPath\n\t};\n}\n\nfunction getPathWithRelative(path, relative, isPathDir) {\n\n\tlet relativeQuery = \"\";\n\tlet qIndex = path.lastIndexOf(\"?\");\n\tif(qIndex >= 0) {\n\t\tpath = path.substring(0, qIndex);\n\t} else {\n\t\tqIndex = path.lastIndexOf(\"#\");\n\t\tif(qIndex >= 0) {\n\t\t\tpath = path.substring(0, qIndex);\n\t\t}\n\t}\n\n\tqIndex = relative.lastIndexOf(\"?\");\n\tif(qIndex >= 0) {\n\t\trelativeQuery = relative.substring(qIndex);\n\t\trelative = relative.substring(0, qIndex);\n\t} else {\n\t\tqIndex = relative.lastIndexOf(\"#\");\n\t\tif(qIndex >= 0) {\n\t\t\trelativeQuery = relative.substring(qIndex);\n\t\t\trelative = relative.substring(0, qIndex);\n\t\t}\n\t}\n\n\tlet absolute = dealPathMayAbsolute(relative);\n\tif(absolute.absolute) {\n\t\treturn absolute.path + relativeQuery;\n\t}\n\n\tif(isPathDir === undefined) {\n\t\tlet index = path.lastIndexOf(\"/\");\n\t\tif(index == path.length - 1) {\n\t\t\tisPathDir = true;\n\t\t} else {\n\t\t\tif(index == -1) {\n\t\t\t\tindex = 0;\n\t\t\t} else {\n\t\t\t\tindex++;\n\t\t\t}\n\t\t\tisPathDir = path.indexOf(\".\", index) == -1;\n\t\t}\n\t}\n\n\tif(xsloader.endsWith(path, \"/\")) {\n\t\tpath = path.substring(0, path.length - 1);\n\t}\n\n\tlet isRelativeDir = false;\n\tif(relative == \".\" || xsloader.endsWith(relative, \"/\")) {\n\t\trelative = relative.substring(0, relative.length - 1);\n\t\tisRelativeDir = true;\n\t} else if(relative == \".\" || relative == \"..\" || xsloader.endsWith(\"/.\") || xsloader.endsWith(\"/..\")) {\n\t\tisRelativeDir = true;\n\t}\n\n\tlet prefix = \"\";\n\tlet index = -1;\n\tlet absolute2 = dealPathMayAbsolute(path);\n\tif(absolute2.absolute) {\n\t\tpath = absolute2.path;\n\t\tlet index2 = path.indexOf(\"//\");\n\t\tindex = path.indexOf(\"/\", index2 + 2);\n\t\tif(index == -1) {\n\t\t\tindex = path.length;\n\t\t}\n\t}\n\n\tprefix = path.substring(0, index + 1);\n\tpath = path.substring(index + 1);\n\n\tlet stack = path.split(\"/\");\n\tif(!isPathDir && stack.length > 0) {\n\t\tstack.pop();\n\t}\n\tlet relatives = relative.split(\"/\");\n\tfor(let i = 0; i < relatives.length; i++) {\n\t\tlet str = relatives[i];\n\t\tif(\"..\" == str) {\n\t\t\tif(stack.length == 0) {\n\t\t\t\tthrow new Error(\"no more upper path!\");\n\t\t\t}\n\t\t\tstack.pop();\n\t\t} else if(\".\" != str) {\n\t\t\tstack.push(str);\n\t\t}\n\t}\n\tif(stack.length == 0) {\n\t\treturn \"\";\n\t}\n\tlet result = prefix + stack.join(\"/\");\n\tif(isRelativeDir && !xsloader.endsWith(result, \"/\")) {\n\t\tresult += \"/\";\n\t}\n\tresult = xsloader.appendArgs2Url(result, relativeQuery);\n\treturn result;\n}\n\nfunction getNodeAbsolutePath(node) {\n\tlet src = node.src || node.getAttribute(\"src\");\n\treturn getPathWithRelative(location.href, src);\n}\n\n//去掉url的query参数和#参数\nfunction removeQueryHash(url) {\n\tif(url) {\n\t\tlet index = url.indexOf(\"?\");\n\t\tif(index >= 0) {\n\t\t\turl = url.substring(0, index);\n\t\t}\n\n\t\tindex = url.indexOf(\"#\");\n\t\tif(index >= 0) {\n\t\t\turl = url.substring(0, index);\n\t\t}\n\t}\n\treturn url;\n}\n\nconst REPLACE_STRING_PROPERTIES_EXP = new RegExp(\"\\\\$\\\\{([^\\\\{]+)\\\\}\");\nconst ALL_TYPE_PROPERTIES_EXP = new RegExp(\"^\\\\$\\\\[([^\\\\[\\\\]]+)\\\\]$\");\n\nfunction propertiesDeal(configObject, properties) {\n\tif(!properties) {\n\t\treturn configObject;\n\t}\n\n\tfunction replaceStringProperties(string, properties, property) {\n\t\tlet rs;\n\t\tlet str = string;\n\t\trs = ALL_TYPE_PROPERTIES_EXP.exec(str);\n\t\tif(rs) {\n\t\t\tlet propKey = rs[1];\n\t\t\tlet propValue = xsloader.getObjectAttr(properties, propKey);\n\t\t\tif(propValue === undefined) {\n\t\t\t\treturn str;\n\t\t\t} else {\n\t\t\t\treturn propValue;\n\t\t\t}\n\t\t}\n\n\t\tlet result = \"\";\n\t\twhile(true) {\n\t\t\trs = REPLACE_STRING_PROPERTIES_EXP.exec(str);\n\t\t\tif(!rs) {\n\t\t\t\tresult += str;\n\t\t\t\tbreak;\n\t\t\t} else {\n\t\t\t\tlet propKey = rs[1];\n\t\t\t\tif(property !== undefined && property.propertyKey == propKey) {\n\t\t\t\t\tthrow new Error(\"replace property error:propertyKey=\" + propKey);\n\t\t\t\t} else if(property) {\n\t\t\t\t\tproperty.has = true;\n\t\t\t\t}\n\t\t\t\tresult += str.substring(0, rs.index);\n\t\t\t\tresult += xsloader.getObjectAttr(properties, propKey);\n\t\t\t\tstr = str.substring(rs.index + rs[0].length);\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\n\t//处理属性引用\n\tfunction replaceProperties(obj, property, enableKeyAttr) {\n\t\tif(!obj) {\n\t\t\treturn obj;\n\t\t}\n\t\tif(xsloader.isFunction(obj)) {\n\t\t\treturn obj;\n\t\t} else if(xsloader.isArray(obj)) {\n\t\t\tfor(let i = 0; i < obj.length; i++) {\n\t\t\t\tobj[i] = replaceProperties(obj[i], property, enableKeyAttr);\n\t\t\t}\n\t\t} else if(xsloader.isString(obj)) {\n\t\t\tobj = replaceStringProperties(obj, properties, property);\n\t\t} else if(xsloader.isObject(obj)) {\n\t\t\tif(property) {\n\t\t\t\tproperty.has = false;\n\t\t\t}\n\t\t\tlet replaceKeyMap = {};\n\t\t\tfor(let x in obj) {\n\t\t\t\tif(property) {\n\t\t\t\t\tproperty.propertyKey = x;\n\t\t\t\t}\n\t\t\t\tobj[x] = replaceProperties(obj[x], property, enableKeyAttr);\n\t\t\t\tif(enableKeyAttr) {\n\t\t\t\t\tlet _x = replaceStringProperties(x, properties, property);\n\t\t\t\t\tif(_x !== x) {\n\t\t\t\t\t\treplaceKeyMap[x] = _x;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tfor(let x in replaceKeyMap) {\n\t\t\t\tlet objx = obj[x];\n\t\t\t\tdelete obj[x];\n\t\t\t\tobj[replaceKeyMap[x]] = objx;\n\t\t\t}\n\t\t}\n\n\t\treturn obj;\n\n\t}\n\n\tif(!properties.__dealt__) {\n\t\tlet property = {\n\t\t\thas: false\n\t\t};\n\n\t\tfor(let x in properties) {\n\t\t\tlet fun = properties[x];\n\t\t\tif(xsloader.isFunction(fun)) {\n\t\t\t\tproperties[x] = fun.call(properties);\n\t\t\t}\n\t\t}\n\t\tdo {\n\t\t\treplaceProperties(properties, property);\n\t\t} while (property.has);\n\t\tproperties.__dealt__ = true;\n\t}\n\n\treturn replaceProperties(configObject, undefined, true);\n}\n\nfunction replaceModulePrefix(config, deps) {\n\n\tif(!deps) {\n\t\treturn;\n\t}\n\n\tfor(let i = 0; i < deps.length; i++) {\n\t\tlet m = deps[i];\n\t\tlet index = m.indexOf(\"!\");\n\t\tlet pluginParam = index > 0 ? m.substring(index) : \"\";\n\t\tm = index > 0 ? m.substring(0, index) : m;\n\n\t\tindex = m.indexOf(\"?\");\n\t\tlet query = index > 0 ? m.substring(index) : \"\";\n\t\tm = index > 0 ? m.substring(0, index) : m;\n\n\t\tlet is = isJsFile(m);\n\t\tif(!is && (xsloader.startsWith(m, \".\") || dealPathMayAbsolute(m).absolute)) {\n\t\t\tdeps[i] = m + \".js\" + query + pluginParam;\n\t\t}\n\t}\n\n\tif(config.modulePrefixCount) {\n\t\t//模块地址的前缀替换\n\t\tfor(let prefix in config.modulePrefix) {\n\t\t\tlet replaceStr = config.modulePrefix[prefix].replace;\n\t\t\tlet len = prefix.length;\n\t\t\tfor(let i = 0; i < deps.length; i++) {\n\t\t\t\tlet m = deps[i];\n\t\t\t\tlet pluginIndex = m.indexOf(\"!\");\n\t\t\t\tlet pluginName = null;\n\t\t\t\tif(pluginIndex >= 0) {\n\t\t\t\t\tpluginName = m.substring(0, pluginIndex + 1);\n\t\t\t\t\tm = m.substring(pluginIndex + 1);\n\t\t\t\t}\n\t\t\t\tif(xsloader.startsWith(m, prefix)) {\n\t\t\t\t\tlet dep = replaceStr + m.substring(len);\n\t\t\t\t\tdeps[i] = pluginName ? pluginName + dep : dep;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\nfunction getScriptBySubname(subname) {\n\tlet ss = document.getElementsByTagName('script');\n\tif(subname) {\n\t\tfor(let i = 0; i < ss.length; i++) {\n\t\t\tlet script = ss[i];\n\t\t\tlet src = script.src;\n\t\t\tsrc = src.substring(src.lastIndexOf(\"/\"));\n\t\t\tif(src.indexOf(subname) >= 0) {\n\t\t\t\treturn script;\n\t\t\t}\n\t\t}\n\t} else {\n\t\treturn ss;\n\t}\n}\n\nexport default {\n\tgetPathWithRelative,\n\tgetNodeAbsolutePath,\n\tdealPathMayAbsolute,\n\tremoveQueryHash,\n\tpropertiesDeal,\n\treplaceModulePrefix,\n\tisJsFile,\n\tgetScriptBySubname,\n};","import global from './global.js';\r\nconst xsloader = global.xsloader;\r\nconst commentRegExp = /\\/\\*[\\s\\S]*?\\*\\/|([^:\"'=]|^)\\/\\/.*$/mg;\r\nconst cjsRequireRegExp = /[^.]require\\s*\\(\\s*[\"']([^'\"\\r\\n]+)[\"']\\s*\\)/g;\r\n\r\n//基于有向图进行循环依赖检测\r\nfunction GraphPath() {\r\n\tlet pathEdges = {};\r\n\tlet vertexMap = {};\r\n\tlet depMap = {};\r\n\tthis.addEdge = function(begin, end) {\r\n\t\tdepMap[begin + \"|\" + end] = true;\r\n\t\tif(!pathEdges[begin]) {\r\n\t\t\tpathEdges[begin] = [];\r\n\t\t}\r\n\t\tif(!vertexMap[begin]) {\r\n\t\t\tvertexMap[begin] = true;\r\n\t\t}\r\n\t\tif(!vertexMap[end]) {\r\n\t\t\tvertexMap[end] = true;\r\n\t\t}\r\n\t\tpathEdges[begin].push({\r\n\t\t\tbegin: begin,\r\n\t\t\tend: end\r\n\t\t});\r\n\t};\r\n\r\n\tthis.hasDep = function(name, dep) {\r\n\t\treturn depMap[name + \"|\" + dep];\r\n\t};\r\n\r\n\tthis.tryAddEdge = function(begin, end) {\r\n\t\tthis.addEdge(begin, end);\r\n\t\tlet paths = this.hasLoop();\r\n\t\tif(paths.length > 0) {\r\n\t\t\tpathEdges[begin].pop();\r\n\t\t}\r\n\t\treturn paths;\r\n\t};\r\n\r\n\tthis.hasLoop = function() {\r\n\t\tlet visited = {};\r\n\t\tlet recursionStack = {};\r\n\r\n\t\tfor(let x in vertexMap) {\r\n\t\t\tvisited[x] = false;\r\n\t\t\trecursionStack[x] = false;\r\n\t\t}\r\n\r\n\t\tlet has = false;\r\n\t\tlet paths = [];\r\n\t\tfor(let name in vertexMap) {\r\n\t\t\tpaths = [];\r\n\t\t\tif(checkLoop(name, visited, recursionStack, paths)) {\r\n\t\t\t\thas = true;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn has ? paths : [];\r\n\t};\r\n\r\n\tfunction checkLoop(v, visited, recursionStack, paths) {\r\n\t\tif(!visited[v]) {\r\n\t\t\tvisited[v] = true;\r\n\t\t\trecursionStack[v] = true;\r\n\t\t\tpaths.push(v);\r\n\r\n\t\t\tif(pathEdges[v]) {\r\n\t\t\t\tlet edges = pathEdges[v];\r\n\t\t\t\tfor(let i = 0; i < edges.length; i++) {\r\n\t\t\t\t\tlet edge = edges[i];\r\n\t\t\t\t\tif(!visited[edge.end] && checkLoop(edge.end, visited, recursionStack, paths)) {\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t} else if(recursionStack[edge.end]) {\r\n\t\t\t\t\t\tpaths.push(edge.end);\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\trecursionStack[v] = false;\r\n\t\treturn false;\r\n\t}\r\n}\r\n\r\n//使得内部的字符串变成数组\r\nfunction strValue2Arr(obj) {\r\n\tif(!obj || xsloader.isArray(obj)) {\r\n\t\treturn;\r\n\t}\r\n\tfor(let x in obj) {\r\n\t\tif(xsloader.isString(obj[x])) {\r\n\t\t\tobj[x] = [obj[x]];\r\n\t\t}\r\n\t}\r\n}\r\n\r\n/**\r\n * 同步模式下，返回false表示终止循环。\r\n * @param {Object} ary\r\n * @param {Object} func\r\n * @param {Object} isSync\r\n * @param {Object} fromEnd\r\n */\r\nfunction each(ary, func, isSync, fromEnd) {\r\n\tif(ary) {\r\n\t\tif(isSync) {\r\n\t\t\tfunction fun(index) {\r\n\t\t\t\tif(fromEnd ? index < 0 : index >= ary.length) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tlet handle = function(rs) {\r\n\t\t\t\t\tif(rs) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfun(fromEnd ? index - 1 : index + 1);\r\n\t\t\t\t};\r\n\t\t\t\tfunc(ary[index], index, ary, handle);\r\n\t\t\t}\r\n\t\t\tfun(fromEnd ? ary.length - 1 : 0);\r\n\t\t} else {\r\n\t\t\tif(fromEnd) {\r\n\t\t\t\tfor(let i = ary.length - 1; i >= 0; i--) {\r\n\t\t\t\t\tif(func(ary[i], i, ary) === false) {\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tfor(let i = 0; i < ary.length; i++) {\r\n\t\t\t\t\tif(func(ary[i], i, ary) === false) {\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t}\r\n}\r\n\r\nfunction __commentReplace(match, singlePrefix) {\r\n\treturn singlePrefix || '';\r\n}\r\n//添加内部直接require('...')的模块\r\nfunction appendInnerDeps(deps, callback) {\r\n\tif(xsloader.isFunction(callback)) {\r\n\t\tcallback\r\n\t\t\t.toString()\r\n\t\t\t.replace(commentRegExp, __commentReplace)\r\n\t\t\t.replace(cjsRequireRegExp, function(match, dep) {\r\n\t\t\t\tdeps.push(dep);\r\n\t\t\t});\r\n\t}\r\n}\r\n\r\nlet idCount = 2019;\r\n\r\nfunction getAndIncIdCount() {\r\n\treturn idCount++;\r\n}\r\n\r\nclass PluginError {\r\n\tconstructor(err, invoker) {\r\n\t\tif(err instanceof PluginError) {\r\n\t\t\tthis.err = err.err;\r\n\t\t\tthis.invoker = err.invoker;\r\n\t\t} else {\r\n\t\t\tthis.err = err;\r\n\t\t\tthis.invoker = invoker;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nlet isXsLoaderEnd = false;\r\nconst IE_VERSION = (function getIEVersion() {\r\n\tlet userAgent = navigator.userAgent; //取得浏览器的userAgent字符串  \r\n\tlet isIE = userAgent.indexOf(\"compatible\") > -1 && userAgent.indexOf(\"MSIE\") > -1; //判断是否IE<11浏览器  \r\n\tlet isEdge = userAgent.indexOf(\"Edge\") > -1 && !isIE; //判断是否IE的Edge浏览器  \r\n\tlet isIE11 = userAgent.indexOf('Trident') > -1 && userAgent.indexOf(\"rv:11.0\") > -1;\r\n\tif(isIE) {\r\n\t\tlet reIE = new RegExp(\"MSIE[\\\\s]+([0-9.]+);\").exec(userAgent);\r\n\t\tlet fIEVersion = parseInt(reIE && reIE[1] || -1);\r\n\t\treturn fIEVersion == -1 ? -1 : fIEVersion;\r\n\t} else if(isEdge) {\r\n\t\treturn 'edge'; //edge\r\n\t} else if(isIE11) {\r\n\t\treturn 11; //IE11  \r\n\t} else {\r\n\t\treturn -1; //不是ie浏览器\r\n\t}\r\n})();\r\n\r\nexport default {\r\n\tgraphPath: new GraphPath(),\r\n\tstrValue2Arr,\r\n\teach,\r\n\tappendInnerDeps,\r\n\tgetAndIncIdCount,\r\n\tPluginError,\r\n\tloaderEnd() {\r\n\t\tisXsLoaderEnd = true;\r\n\t},\r\n\tisLoaderEnd() {\r\n\t\treturn isXsLoaderEnd;\r\n\t},\r\n\tIE_VERSION,\r\n};","import urls from './urls.js';\nimport global from './global.js';\nimport base from './base.js';\n\nexport default {\n\t...urls,\n\tglobal,\n\t...base\n};","import utils from \"../util/index.js\";\r\n\r\nconst global = utils.global;\r\nconst xsloader = global.xsloader;\r\n\r\n//ie9\r\ntry {\r\n\tif(Function.prototype.bind && console && (typeof console['log'] == \"object\")) {\r\n\t\tutils.each([\"log\", \"info\", \"warn\", \"error\", \"assert\", \"dir\", \"clear\", \"profile\", \"profileEnd\"], (method) => {\r\n\t\t\tlet thiz = Function.prototype.bind;\r\n\t\t\tconsole[method] = thiz.call(console[method], console);\r\n\t\t});\r\n\t}\r\n} catch(e) {\r\n\tglobal.console = {\r\n\t\tlog: function() {},\r\n\t\terror: function() {},\r\n\t\twarn: function() {}\r\n\t};\r\n}\r\n\r\ntry {\r\n\r\n\tif(!Array.prototype.indexOf) {\r\n\t\tArray.prototype.indexOf = function(elem, offset) {\r\n\t\t\tfor(let i = offset === undefined ? 0 : offset; i < this.length; i++) {\r\n\t\t\t\tif(this[i] == elem) {\r\n\t\t\t\t\treturn i;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn -1;\r\n\t\t};\r\n\t}\r\n\r\n\tif(!Array.pushAll) {\r\n\t\tArray.pushAll = function(thiz, arr) {\r\n\t\t\tif(!xsloader.isArray(arr)) {\r\n\t\t\t\tthrow new Error(\"not array:\" + arr);\r\n\t\t\t}\r\n\t\t\tfor(let i = 0; i < arr.length; i++) {\r\n\t\t\t\tthiz.push(arr[i]);\r\n\t\t\t}\r\n\t\t\treturn thiz;\r\n\t\t};\r\n\t}\r\n} catch(e) {\r\n\tconsole.error(e);\r\n}\r\n\r\nfunction startsWith(str, starts) {\r\n\tif(!(typeof str == \"string\")) {\r\n\t\treturn false;\r\n\t}\r\n\treturn str.indexOf(starts) == 0;\r\n}\r\n\r\nfunction endsWith(str, ends) {\r\n\tif(!(typeof str == \"string\")) {\r\n\t\treturn false;\r\n\t}\r\n\tlet index = str.lastIndexOf(ends);\r\n\tif(index >= 0 && (str.length - ends.length == index)) {\r\n\t\treturn true;\r\n\t} else {\r\n\t\treturn false;\r\n\t}\r\n}\r\n\r\nfunction _indexInArray(array, ele, offset = 0, compare) {\r\n\tlet index = -1;\r\n\tif(array) {\r\n\t\tfor(let i = offset || 0; i < array.length; i++) {\r\n\t\t\tif(compare) {\r\n\t\t\t\tif(compare(array[i], ele, i, array)) {\r\n\t\t\t\t\tindex = i;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif(array[i] == ele) {\r\n\t\t\t\t\tindex = i;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t}\r\n\treturn index;\r\n}\r\n\r\nfunction indexInArray(array, ele, compare) {\r\n\treturn _indexInArray(array, ele, 0, compare);\r\n}\r\n\r\nfunction indexInArrayFrom(array, ele, offset, compare) {\r\n\treturn _indexInArray(array, ele, offset, compare);\r\n}\r\n\r\nexport default {\r\n\tstartsWith,\r\n\tendsWith,\r\n\tindexInArray,\r\n\tindexInArrayFrom\r\n};","import {\r\n\tJSON as xsJSON\r\n} from \"../polyfill/index.js\";\r\nimport utils from \"../util/index.js\";\r\n\r\nconst global = utils.global;\r\nconst xsloader = global.xsloader;\r\nconst IE_VERSION = utils.IE_VERSION;\r\n\r\nif(!String.prototype.trim) {\r\n\tString.prototype.trim = function() {\r\n\t\treturn this.replace(/^\\s\\s*/, '').replace(/\\s\\s*$/, '');\r\n\t};\r\n}\r\n\r\n//生成一个随机的id，只保证在本页面是唯一的\r\nfunction randId(suffix) {\r\n\tlet id = \"r\" + parseInt(new Date().getTime() / 1000) + \"_\" + parseInt(Math.random() * 1000) + \"_\" + utils.getAndIncIdCount();\r\n\tif(suffix !== undefined) {\r\n\t\tid += suffix;\r\n\t}\r\n\treturn id;\r\n}\r\n\r\nfunction xsEval(scriptString) {\r\n\ttry {\r\n\t\tlet rs = IE_VERSION > 0 && IE_VERSION < 9 ? eval(\"[\" + scriptString + \"][0]\") : eval(\"(\" + scriptString + \")\");\r\n\t\treturn rs;\r\n\t} catch(e) {\r\n\t\tthrow e;\r\n\t}\r\n}\r\n\r\n/**\r\n * 注意key需要用引号包裹\r\n * @param {Object} str\r\n * @param {Object} option\r\n */\r\nfunction xsParseJson(str, option) {\r\n\tif(str === \"\" || str === null || str === undefined || !xsloader.isString(str)) {\r\n\t\treturn str;\r\n\t}\r\n\r\n\toption = xsloader.extend({\r\n\t\tfnStart: \"\", //\"/*{f}*/\",\r\n\t\tfnEnd: \"\", //\"/*{f}*/\",\r\n\t\trcomment: \"\\\\/\\\\/#\\\\/\\\\/\"\r\n\t}, option);\r\n\r\n\tlet fnMap = {};\r\n\tlet fnOffset = 0;\r\n\tlet replacer = undefined;\r\n\tif(option.fnStart && option.fnEnd) {\r\n\t\twhile(true) {\r\n\t\t\tlet indexStart = str.indexOf(option.fnStart, fnOffset);\r\n\t\t\tlet indexEnd = str.indexOf(option.fnEnd, indexStart == -1 ? fnOffset : indexStart + option.fnStart.length);\r\n\t\t\tif(indexStart == -1 && indexEnd == -1) {\r\n\t\t\t\tbreak;\r\n\t\t\t} else if(indexStart == -1) {\r\n\t\t\t\tconsole.warn(\"found end:\" + option.fnEnd + \",may lack start:\" + option.fnStart);\r\n\t\t\t\tbreak;\r\n\t\t\t} else if(indexEnd == -1) {\r\n\t\t\t\tconsole.warn(\"found start:\" + option.fnStart + \",may lack end:\" + option.fnEnd);\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tlet fnId = \"_[_\" + randId() + \"_]_\";\r\n\t\t\tlet fnStr = str.substring(indexStart + option.fnStart.length, indexEnd).trim();\r\n\t\t\tif(!xsloader.startsWith(fnStr, \"function(\")) {\r\n\t\t\t\tthrow \"not a function:\" + fnStr;\r\n\t\t\t}\r\n\t\t\ttry {\r\n\t\t\t\tstr = str.substring(0, indexStart) + '\"' + fnId + '\"' + str.substring(indexEnd + option.fnEnd.length);\r\n\t\t\t\tlet fn = xsloader.xsEval(fnStr);\r\n\t\t\t\tfnMap[fnId] = fn;\r\n\t\t\t} catch(e) {\r\n\t\t\t\tconsole.error(fnStr);\r\n\t\t\t\tthrow e;\r\n\t\t\t}\r\n\t\t\tfnOffset = indexStart + fnId.length;\r\n\t\t}\r\n\t\treplacer = function(key, val) {\r\n\t\t\tif(xsloader.isString(val) && fnMap[val]) {\r\n\t\t\t\treturn fnMap[val];\r\n\t\t\t} else {\r\n\t\t\t\treturn val;\r\n\t\t\t}\r\n\t\t};\r\n\t}\r\n\r\n\tif(option.rcomment) {\r\n\t\tstr = str.replace(/(\\r\\n)|\\r/g, \"\\n\"); //统一换行符号\r\n\t\tstr = str.replace(new RegExp(option.rcomment + \"[^\\\\n]*(\\\\n|$)\", \"g\"), \"\"); //去除行注释\r\n\t}\r\n\r\n\ttry {\r\n\t\tlet jsonObj = xsJSON;\r\n\t\treturn jsonObj.parse(str, replacer);\r\n\t} catch(e) {\r\n\t\ttry {\r\n\t\t\tlet reg = new RegExp('position[\\\\s]*([0-9]+)[\\\\s]*$');\r\n\t\t\tif(e.message && reg.test(e.message)) {\r\n\t\t\t\tlet posStr = e.message.substring(e.message.lastIndexOf(\"position\") + 8);\r\n\t\t\t\tlet pos = parseInt(posStr.trim());\r\n\t\t\t\tlet _str = str.substring(pos);\r\n\t\t\t\tconsole.error(e.message + \":\" + _str.substring(0, _str.length > 100 ? 100 : _str.length));\r\n\t\t\t}\r\n\t\t} catch(e2) {\r\n\t\t\tconsole.warn(e2);\r\n\t\t}\r\n\t\tthrow e;\r\n\t}\r\n}\r\n\r\nfunction xsJson2String(obj) {\r\n\tlet jsonObj = xsJSON;\r\n\treturn jsonObj.stringify(obj);\r\n}\r\n\r\nconst getPathWithRelative = utils.getPathWithRelative;\r\n\r\nfunction _toParamsMap(argsStr, decode = true) {\r\n\tif(xsloader.isObject(argsStr)) {\r\n\t\treturn argsStr;\r\n\t}\r\n\tif(!argsStr) {\r\n\t\targsStr = location.search;\r\n\t}\r\n\r\n\tlet index = argsStr.indexOf(\"?\");\r\n\tif(index >= 0) {\r\n\t\targsStr = argsStr.substring(index + 1);\r\n\t} else {\r\n\t\tif(utils.dealPathMayAbsolute(argsStr).absolute) {\r\n\t\t\treturn {};\r\n\t\t}\r\n\t}\r\n\tindex = argsStr.lastIndexOf(\"#\");\r\n\tif(index >= 0) {\r\n\t\targsStr = argsStr.substring(0, index);\r\n\t}\r\n\r\n\tlet ret = {},\r\n\t\tseg = argsStr.split('&'),\r\n\t\ts;\r\n\tfor(let i = 0; i < seg.length; i++) {\r\n\t\tif(!seg[i]) {\r\n\t\t\tcontinue;\r\n\t\t}\r\n\t\ts = seg[i].split('=');\r\n\t\tlet name = decode ? decodeURIComponent(s[0]) : s[0];\r\n\t\tret[name] = decode ? decodeURIComponent(s[1]) : s[1];\r\n\t}\r\n\treturn ret;\r\n}\r\n\r\nfunction appendArgs2Url(url, urlArgs) {\r\n\tif(url === undefined || url === null || !urlArgs) {\r\n\t\treturn url;\r\n\t}\r\n\r\n\tlet index = url.lastIndexOf(\"?\");\r\n\tlet hashIndex = url.lastIndexOf(\"#\");\r\n\tif(hashIndex < 0) {\r\n\t\thashIndex = url.length;\r\n\t}\r\n\tlet oldParams = index < 0 ? {} : _toParamsMap(url.substring(index + 1, hashIndex), false);\r\n\tlet newParams = _toParamsMap(urlArgs, false);\r\n\tlet has = false;\r\n\tfor(let k in newParams) {\r\n\t\tif(oldParams[k] != newParams[k]) {\r\n\t\t\toldParams[k] = newParams[k];\r\n\t\t\thas = true;\r\n\t\t}\r\n\t}\r\n\tif(!has) {\r\n\t\treturn url; //参数没有变化直接返回\r\n\t}\r\n\r\n\tlet paramKeys = [];\r\n\tfor(let k in oldParams) {\r\n\t\tparamKeys.push(k);\r\n\t}\r\n\tparamKeys.sort();\r\n\r\n\tlet path = index < 0 ? url.substring(0, hashIndex) : url.substring(0, index);\r\n\tlet params = [];\r\n\r\n\tfor(let i = 0; i < paramKeys.length; i++) { //保证参数按照顺序\r\n\t\tlet k = paramKeys[i];\r\n\t\tparams.push(k + \"=\" + oldParams[k]);\r\n\t}\r\n\tparams = params.join(\"&\");\r\n\tlet hash = \"\";\r\n\tif(hashIndex >= 0 && hashIndex < url.length) {\r\n\t\thash = url.substring(hashIndex);\r\n\t}\r\n\treturn path + (params ? \"?\" + params : \"\") + (hash ? hash : \"\");\r\n\r\n}\r\n\r\nfunction queryString2ParamsMap(argsStr, decode) {\r\n\treturn _toParamsMap(argsStr, decode);\r\n}\r\n\r\nexport default {\r\n\trandId,\r\n\txsEval,\r\n\txsParseJson,\r\n\txsJson2String,\r\n\tgetPathWithRelative,\r\n\tappendArgs2Url,\r\n\tqueryString2ParamsMap,\r\n\tIE_VERSION\r\n};","const ostring = Object.prototype.toString;\n\nfunction isArray(it) {\n\treturn it && (it instanceof Array) || ostring.call(it) === '[object Array]';\n}\n\nfunction isFunction(it) {\n\treturn it && (typeof it == \"function\") || ostring.call(it) === '[object Function]';\n}\n\nfunction isObject(it) {\n\tif(it === null || it === undefined) {\n\t\treturn false;\n\t}\n\treturn(typeof it == \"object\") || ostring.call(it) === '[object Object]';\n}\n\nfunction isString(it) {\n\treturn it && (typeof it == \"string\") || ostring.call(it) === '[object String]';\n}\n\nfunction isDate(it) {\n\treturn it && (it instanceof Date) || ostring.call(it) === '[object Date]';\n}\n\nfunction isRegExp(it) {\n\treturn it && (it instanceof RegExp) || ostring.call(it) === '[object RegExp]';\n}\n\nexport default {\n\tisArray,\n\tisFunction,\n\tisObject,\n\tisString,\n\tisDate,\n\tisRegExp,\n};","import utils from \"../util/index.js\";\n\nconst global = utils.global;\nconst xsloader = global.xsloader;\n\nfunction queryParam(name, otherValue, optionUrl) {\n\tlet search;\n\tif(optionUrl) {\n\t\tlet index = optionUrl.indexOf('?');\n\t\tif(index < 0) {\n\t\t\tindex = 0;\n\t\t} else {\n\t\t\tindex += 1;\n\t\t}\n\t\tsearch = optionUrl.substr(index);\n\t} else {\n\t\tsearch = window.location.search.substr(1);\n\t}\n\n\tlet reg = new RegExp(\"(^|&)\" + name + \"=([^&]*)(&|$)\");\n\tlet r = search.match(reg);\n\tif(r != null) return decodeURIComponent(r[2]);\n\treturn otherValue !== undefined ? otherValue : null;\n}\n\nfunction getUrl(relativeUrl, appendArgs, optionalAbsUrl) {\n\tif(optionalAbsUrl && !utils.dealPathMayAbsolute(optionalAbsUrl).absolute) {\n\t\tthrow new Error(\"expected absolute url:\" + optionalAbsUrl);\n\t}\n\tif(appendArgs === undefined) {\n\t\tappendArgs = true;\n\t}\n\tlet theConfig = xsloader.config();\n\tlet thePageUrl = xsloader.pageUrl();\n\tlet url;\n\tif(relativeUrl === undefined) {\n\t\turl = thePageUrl;\n\t} else if(xsloader.startsWith(relativeUrl, \".\") || utils.dealPathMayAbsolute(relativeUrl).absolute) {\n\t\turl = utils.getPathWithRelative(optionalAbsUrl || thePageUrl, relativeUrl);\n\t} else {\n\t\turl = theConfig.baseUrl + relativeUrl;\n\t}\n\tif(appendArgs) {\n\t\tif(url == thePageUrl) {\n\t\t\turl += location.search + location.hash;\n\t\t}\n\t\treturn theConfig.dealUrl({}, url);\n\t} else {\n\t\treturn url;\n\t}\n}\n\nfunction tryCall(fun, defaultReturn, thiz, exCallback) {\n\tlet rs;\n\ttry {\n\t\tthiz = thiz === undefined ? this : thiz;\n\t\trs = fun.call(thiz);\n\t} catch(e) {\n\t\tif(xsloader.isFunction(exCallback)) {\n\t\t\texCallback(e);\n\t\t} else {\n\t\t\tconsole.warn(e);\n\t\t}\n\t}\n\tif(rs === undefined || rs === null) {\n\t\trs = defaultReturn;\n\t}\n\treturn rs;\n}\n\nfunction dealProperties(obj, properties) {\n\treturn utils.propertiesDeal(obj, properties);\n}\n\nfunction extend(target) {\n\tfor(let i = 1; i < arguments.length; i++) {\n\t\tlet obj = arguments[i];\n\t\tif(!obj) {\n\t\t\tcontinue;\n\t\t}\n\t\tfor(let x in obj) {\n\t\t\tlet value = obj[x];\n\t\t\tif(value === undefined) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\ttarget[x] = obj[x];\n\t\t}\n\t}\n\treturn target;\n}\n\nfunction extendDeep(target) {\n\tif(!target) {\n\t\treturn target;\n\t}\n\tfor(let i = 1; i < arguments.length; i++) {\n\t\tlet obj = arguments[i];\n\t\tif(!obj) {\n\t\t\tcontinue;\n\t\t}\n\n\t\tfor(let x in obj) {\n\t\t\tlet value = obj[x];\n\t\t\tif(value === undefined) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif(xsloader.isObject(value) && xsloader.isObject(target[x])) {\n\t\t\t\ttarget[x] = xsloader.extendDeep(target[x], value);\n\t\t\t} else {\n\t\t\t\ttarget[x] = obj[x];\n\t\t\t}\n\t\t}\n\t}\n\treturn target;\n}\n\nfunction _AsyncCall(useTimer) {\n\tlet thiz = this;\n\tlet count = 0;\n\tlet ctrlCallbackMap = {};\n\n\tfunction initCtrlCallback(callbackObj) {\n\t\tlet mineCount = count + \"\";\n\t\tif(!ctrlCallbackMap[mineCount]) {\n\t\t\tlet ctrlCallback = function() {\n\t\t\t\tcount++;\n\t\t\t\tlet asyncCallQueue = ctrlCallbackMap[mineCount];\n\t\t\t\tdelete ctrlCallbackMap[mineCount];\n\t\t\t\twhile(asyncCallQueue.length) {\n\t\t\t\t\tlet callbackObj = asyncCallQueue.shift();\n\t\t\t\t\tlet lastReturn = undefined;\n\t\t\t\t\ttry {\n\t\t\t\t\t\tif(callbackObj.callback) {\n\t\t\t\t\t\t\tlastReturn = callbackObj.callback.call(callbackObj.handle, callbackObj.obj, mineCount);\n\t\t\t\t\t\t}\n\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\tconsole.error(e);\n\t\t\t\t\t}\n\t\t\t\t\tlet handle;\n\t\t\t\t\twhile(callbackObj.nextCallback.length) {\n\t\t\t\t\t\tlet nextObj = callbackObj.nextCallback.shift();\n\t\t\t\t\t\tif(!handle) {\n\t\t\t\t\t\t\thandle = thiz.pushTask(nextObj.callback, lastReturn);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\thandle.next(nextObj.callback);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t\tctrlCallbackMap[mineCount] = [];\n\t\t\tif(!useTimer && global.Promise && global.Promise.resolve) {\n\t\t\t\tglobal.Promise.resolve().then(ctrlCallback);\n\t\t\t} else {\n\t\t\t\tsetTimeout(ctrlCallback, 0);\n\t\t\t}\n\t\t}\n\t\tlet queue = ctrlCallbackMap[mineCount];\n\t\tqueue.push(callbackObj);\n\t}\n\n\tthis.pushTask = function(callback, obj) {\n\t\tlet callbackObj;\n\t\tlet handle = {\n\t\t\tnext: function(nextCallback, lastReturn) {\n\t\t\t\tcallbackObj.nextCallback.push({\n\t\t\t\t\tcallback: nextCallback,\n\t\t\t\t\tlastReturn: lastReturn\n\t\t\t\t});\n\t\t\t\treturn this;\n\t\t\t}\n\t\t};\n\t\tcallbackObj = {\n\t\t\tcallback: callback,\n\t\t\tobj: obj,\n\t\t\tnextCallback: [],\n\t\t\thandle: handle\n\t\t};\n\n\t\tinitCtrlCallback(callbackObj);\n\n\t\treturn handle;\n\t};\n}\n\nconst theAsyncCall = new _AsyncCall();\nconst theAsyncCallOfTimer = new _AsyncCall(true);\n\nlet asyncCall = function(callback, useTimer) {\n\tif(useTimer) {\n\t\treturn theAsyncCallOfTimer.pushTask(callback);\n\t} else {\n\t\treturn theAsyncCall.pushTask(callback);\n\t}\n};\n\n/**\n * 得到属性\n * @param {Object} obj\n * @param {Object} attrNames \"rs\"、\"rs.total\"等\n */\nfunction getObjectAttr(obj, attrNames, defaultValue) {\n\tif(!obj || !attrNames) {\n\t\treturn undefined;\n\t}\n\tlet attrs = attrNames.split(\".\");\n\tlet rs = defaultValue;\n\tlet i = 0;\n\tfor(; i < attrs.length && obj; i++) {\n\t\tlet k = attrs[i];\n\t\tobj = obj[k];\n\t}\n\tif(i == attrs.length) {\n\t\trs = obj;\n\t}\n\n\treturn rs;\n}\n\n/**\n * 设置属性\n * @param {Object} obj\n * @param {Object} attrNames \"rs\"、\"rs.total\"等\n */\nfunction setObjectAttr(obj, attrNames, value) {\n\tlet _obj = obj;\n\tlet attrs = attrNames.split(\".\");\n\n\tfor(let i = 0; i < attrs.length; i++) {\n\t\tlet k = attrs[i];\n\n\t\tif(i == attrs.length - 1) {\n\t\t\tobj[k] = value;\n\t\t\tbreak;\n\t\t}\n\t\tlet o = obj[k];\n\t\tif(!o) {\n\t\t\to = {};\n\t\t\tobj[k] = o;\n\t\t}\n\t\tobj = o;\n\t}\n\treturn _obj;\n}\n\nfunction clone(obj, isDeep) {\n\t// Handle the 3 simple types, and null or undefined or function\n\tif(!obj || xsloader.isFunction(obj) || xsloader.isString(obj)) return obj;\n\n\tif(xsloader.isRegExp(obj)) {\n\t\treturn new RegExp(obj.source, obj.flags);\n\t}\n\n\t// Handle Date\n\tif(xsloader.isDate(obj)) {\n\t\tlet copy = new Date();\n\t\tcopy.setTime(obj.getTime());\n\t\treturn copy;\n\t}\n\t// Handle Array or Object\n\tif(xsloader.isArray(obj) || xsloader.isObject(obj)) {\n\t\tlet copy = xsloader.isArray(obj) ? [] : {};\n\t\tfor(let attr in obj) {\n\t\t\tif(obj.hasOwnProperty(attr))\n\t\t\t\tcopy[attr] = isDeep ? clone(obj[attr]) : obj[attr];\n\t\t}\n\t\treturn copy;\n\t}\n\treturn obj;\n}\n\nexport default {\n\tqueryParam,\n\tgetUrl,\n\ttryCall,\n\tdealProperties,\n\textend,\n\textendDeep,\n\tasyncCall,\n\tgetObjectAttr,\n\tsetObjectAttr,\n\tclone\n};","import utils from \"../util/index.js\";\n\nconst global = utils.global;\nconst xsloader = global.xsloader;\n\nlet isDOM = (typeof HTMLElement === 'object') ?\n\tfunction(obj) {\n\t\treturn obj && (obj instanceof HTMLElement);\n\t} :\n\tfunction(obj) {\n\t\treturn obj && typeof obj === 'object' && obj.nodeType === 1 && typeof obj.nodeName === 'string';\n\t};\n\nlet onReadyFun = (function() {\n\tlet isGlobalReady = false;\n\tlet bindReadyQueue = [];\n\n\tfunction BindReady(callback) {\n\t\tif(isGlobalReady) {\n\t\t\tcallback();\n\t\t\treturn;\n\t\t}\n\t\tlet isReady = false;\n\n\t\tfunction ready() {\n\t\t\tif(isReady) return;\n\t\t\tisReady = true;\n\t\t\tisGlobalReady = true;\n\t\t\tcallback();\n\t\t}\n\t\t// Mozilla, Opera and webkit nightlies currently support this event\n\t\tif(document.addEventListener) {\n\t\t\tlet fun;\n\t\t\tfun = function() {\n\t\t\t\tdocument.removeEventListener(\"DOMContentLoaded\", fun);\n\t\t\t\tready();\n\t\t\t};\n\t\t\tdocument.addEventListener(\"DOMContentLoaded\", fun);\n\n\t\t} else if(document.attachEvent) {\n\t\t\t// ensure firing before onload,\n\t\t\t// maybe late but safe also for iframes\n\t\t\tlet fun;\n\t\t\tfun = function() {\n\t\t\t\tif(document.readyState === \"complete\") {\n\t\t\t\t\tdocument.detachEvent(\"onreadystatechange\", fun);\n\t\t\t\t\tready();\n\t\t\t\t}\n\t\t\t};\n\t\t\tdocument.attachEvent(\"onreadystatechange\", fun);\n\t\t\t// If IE and not an iframe\n\t\t\t// continually check to see if the document is ready\n\n\t\t\tlet fun2;\n\t\t\tfun2 = function() {\n\t\t\t\tif(isReady) return;\n\t\t\t\ttry {\n\t\t\t\t\t// If IE is used, use the trick by Diego Perini\n\t\t\t\t\t// http://javascript.nwbox.com/IEContentLoaded/\n\t\t\t\t\tdocument.documentElement.doScroll(\"left\");\n\t\t\t\t} catch(error) {\n\t\t\t\t\tsetTimeout(fun2, 0);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t// and execute any waiting functions\n\t\t\t\tready();\n\t\t\t};\n\n\t\t\tif(document.documentElement.doScroll && typeof global.frameElement === \"undefined\")(fun2)();\n\t\t} else {\n\t\t\txsloader.asyncCall(null, true).next(function() {\n\t\t\t\tready();\n\t\t\t});\n\t\t}\n\t\tthis.readyCall = ready;\n\t}\n\tlet onReady = function(callback) {\n\t\tif(document.readyState === \"complete\") {\n\t\t\tisGlobalReady = true;\n\t\t}\n\t\tlet br = new BindReady(callback);\n\t\tif(!isGlobalReady) {\n\t\t\tbindReadyQueue.push(br);\n\t\t}\n\t};\n\tonReady(function() {\n\t\tisGlobalReady = true;\n\t});\n\n\tif(document.readyState === \"complete\") {\n\t\tisGlobalReady = true;\n\t} else {\n\t\tlet addEventHandle;\n\t\tif(global.addEventListener) {\n\t\t\taddEventHandle = function(type, callback) {\n\t\t\t\tglobal.addEventListener(type, callback, false);\n\t\t\t};\n\t\t} else if(global.attachEvent) {\n\t\t\taddEventHandle = function(type, callback) {\n\t\t\t\tglobal.attachEvent(\"on\" + type, callback);\n\t\t\t};\n\t\t} else {\n\t\t\taddEventHandle = function(type, callback) {\n\t\t\t\txsloader.asyncCall(null, true).next(function() {\n\t\t\t\t\tcallback();\n\t\t\t\t});\n\t\t\t};\n\t\t}\n\t\taddEventHandle(\"load\", function() {\n\t\t\tisGlobalReady = true;\n\t\t\twhile(bindReadyQueue.length) {\n\t\t\t\tbindReadyQueue.shift().readyCall();\n\t\t\t}\n\t\t});\n\t}\n\treturn onReady;\n})();\n\nexport default {\n\tisDOM,\n\tonReady: onReadyFun\n};","import utils from \"../util/index.js\";\n////////////////////\n\nimport deprecated from './global-deprecated.js';\nimport base from './global-base.js';\n//////////////////\nimport is from './is.js';\nimport funs from './funs.js';\nimport browser from './browser.js';\n\nconst global = utils.global;\nconst xsloader=global.xsloader;\n\nlet toGlobal = {\n\t...deprecated,\n\t...base\n};\nfor(let k in toGlobal) {\n\txsloader[k] = toGlobal[k];\n\tglobal[k] = toGlobal[k];\n}\n\nlet justLoader = {\n\t...is,\n\t...funs,\n\t...browser,\n\t_ignoreAspect_: {\n\n\t}\n};\nfor(let k in justLoader) {\n\txsloader[k] = justLoader[k];\n}","import utils from \"../util/index.js\";\r\nconst global = utils.global;\r\nconst theDefinedMap = {};\r\nconst lastDefinObjectMap = {};\r\n\r\nclass ModuleDef {\r\n\tsrc;\r\n\tdefaultModule; //默认模块（ define时未指定selfname的） 只能有一个\r\n\tmodules; //define的其他模块（含有selfname）\r\n\tisPreDependOn; //用于提前依赖\r\n\t_preModule;\r\n\ttargetDef; //用于提前依赖\r\n\tconstructor(src, isPreDependOn = false) {\r\n\t\tthis.src = src;\r\n\t\tthis.isPreDependOn = isPreDependOn;\r\n\t\tthis.modules = {};\r\n\t\tthis.defaultModule = null;\r\n\t\tthis.targetDef = null;\r\n\t\tif(isPreDependOn) {\r\n\t\t\tthis._preModule = {\r\n\t\t\t\trelyQueue: [],\r\n\t\t\t\tget() {\r\n\t\t\t\t\treturn this;\r\n\t\t\t\t},\r\n\t\t\t\trelyIt() {\r\n\t\t\t\t\tlet args = [];\r\n\t\t\t\t\tfor(let i = 0; i < arguments.length; i++) {\r\n\t\t\t\t\t\targs.push(arguments[i]);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.relyQueue.push(args);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t}\r\n\t}\r\n\tgiveRelys(module) {\r\n\t\tlet queue = this._preModule.relyQueue;\r\n\t\tthis._preModule = null;\r\n\t\twhile(queue.length) {\r\n\t\t\tlet args = queue.shift();\r\n\t\t\tmodule.relyIt.apply(module, args);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction _isSrc(nameOrUrl) {\r\n\tlet isSrc = /^[a-zA-Z0-9]+:\\/\\//.test(nameOrUrl);\r\n\treturn isSrc;\r\n}\r\n\r\nfunction setLastDefineObject(src, defineObject) {\r\n\tsrc = utils.removeQueryHash(src);\r\n\tlastDefinObjectMap[src] = defineObject;\r\n}\r\n\r\nfunction getLastDefineObject(src) {\r\n\tsrc = utils.removeQueryHash(src);\r\n\treturn lastDefinObjectMap[src];\r\n}\r\n\r\nfunction getModule(nameOrUrl, selfname = null) {\r\n\tnameOrUrl = utils.removeQueryHash(nameOrUrl);\r\n\tlet isSrc = _isSrc(nameOrUrl);\r\n\r\n\tlet moduleDef = theDefinedMap[nameOrUrl];\r\n\tif(moduleDef) {\r\n\t\tlet module;\r\n\t\tif(isSrc) { //如果提供地址、则获取默认模块\r\n\t\t\tif(selfname) {\r\n\t\t\t\tmodule = moduleDef.modules[selfname];\r\n\t\t\t} else {\r\n\t\t\t\tmodule = moduleDef.defaultModule;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif(moduleDef.isPreDependOn) {\r\n\t\t\t\tmodule = moduleDef._preModule;\r\n\t\t\t} else {\r\n\t\t\t\tmodule = moduleDef.modules[nameOrUrl];\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn module ? module.get() : null;\r\n\t} else {\r\n\t\treturn null;\r\n\t}\r\n}\r\n\r\n//提前依赖不存在的模块\r\nfunction preDependOn(name) {\r\n\tlet isSrc = _isSrc(name);\r\n\tif(isSrc) {\r\n\t\tthrow new Error(\"expected name,but src:\" + name);\r\n\t} else if(theDefinedMap[name]) {\r\n\t\tthrow new Error(\"already defined:\" + name);\r\n\t} else {\r\n\t\tlet def = new ModuleDef(null, !!name);\r\n\t\ttheDefinedMap[name] = def;\r\n\t}\r\n}\r\n\r\n/**\r\n * 替换模块的src，用于加载含有多个地址模块的情况（提供多个地址、直到加载成功）\r\n * @param {Object} oldSrc\r\n * @param {Object} module\r\n */\r\nfunction replaceModuleSrc(oldSrc, module) {\r\n\tlet moduleDef = theDefinedMap[oldSrc];\r\n\tif(!moduleDef) {\r\n\t\tthrow new Error(\"not found module:src=\" + oldSrc);\r\n\t} else if(theDefinedMap[module.src]) {\r\n\t\tthrow new Error(\"already exists module:src=\" + module.src);\r\n\t} else {\r\n\t\tmoduleDef.src = module.src;\r\n\t\tdelete theDefinedMap[oldSrc];\r\n\t\ttheDefinedMap[module.src] = moduleDef;\r\n\t}\r\n}\r\n\r\nfunction clearEmptyModuleBySrc(src) {\r\n\tlet moduleDef = theDefinedMap[src];\r\n\tif(moduleDef && !moduleDef.defaultModule) {\r\n\t\tif(moduleDef.defaultModule) {\r\n\t\t\tthrow new Error(\"not empty module:src=\" + src);\r\n\t\t} else {\r\n\t\t\tfor(let x in moduleDef.modules) {\r\n\t\t\t\tthrow new Error(\"not empty module:src=\" + src);\r\n\t\t\t}\r\n\t\t}\r\n\t\tdelete theDefinedMap[src];\r\n\t}\r\n}\r\n\r\n/**\r\n * 同一个模块可重复设置。\r\n * @param {Object} name 模块名字，若为空则表示模块模块。多个不同的名字可能指向同一个模块。\r\n * @param {Object} module 模块，必须含有src\r\n */\r\nfunction setModule(name, module) {\r\n\tlet src = module.src;\r\n\tif(!src) {\r\n\t\tthrow new Error(\"expected module src!\");\r\n\t}\r\n\tlet moduleDef = theDefinedMap[src];\r\n\tif(moduleDef) {\r\n\t\tif(name) {\r\n\t\t\tlet lasfDef = theDefinedMap[name];\r\n\t\t\tif(theDefinedMap[name] && lasfDef != moduleDef && !lasfDef.isPreDependOn) {\r\n\t\t\t\tthrow new Error(\"already define module:\\n\\tname=\" + name + \",current.src=\" + src + \",\\n\\tthat.src=\" + theDefinedMap[name].src);\r\n\t\t\t} else {\r\n\t\t\t\tmoduleDef.modules[name] = module;\r\n\t\t\t\ttheDefinedMap[name] = moduleDef;\r\n\t\t\t\tif(lasfDef && lasfDef.isPreDependOn) {\r\n\t\t\t\t\tlasfDef.giveRelys(module);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t//默认模块\r\n\t\t\tif(moduleDef.defaultModule && moduleDef.defaultModule != module) {\r\n\t\t\t\tthrow new Error(\"already define default module:src=\" + src);\r\n\t\t\t} else {\r\n\t\t\t\tmoduleDef.defaultModule = module;\r\n\t\t\t}\r\n\t\t}\r\n\t} else {\r\n\t\tmoduleDef = new ModuleDef(src);\r\n\t\ttheDefinedMap[src] = moduleDef;\r\n\t\tif(name) {\r\n\t\t\tmoduleDef.modules[name] = module;\r\n\t\t\tlet lasfDef = theDefinedMap[name];\r\n\t\t\tif(lasfDef && !lasfDef.isPreDependOn) {\r\n\t\t\t\tthrow new Error(\"already define module:\\n\\tname=\" + name + \",current.src=\" + src + \",\\n\\tthat.src=\" + theDefinedMap[name].src);\r\n\t\t\t} else {\r\n\t\t\t\ttheDefinedMap[name] = moduleDef;\r\n\t\t\t\tif(lasfDef && lasfDef.isPreDependOn) {\r\n\t\t\t\t\tlasfDef.giveRelys(module);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t//默认模块\r\n\t\t\tmoduleDef.defaultModule = module;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport default {\r\n\tgetModule,\r\n\tsetModule,\r\n\treplaceModuleSrc,\r\n\tclearEmptyModuleBySrc,\r\n\tpreDependOn,\r\n\tsetLastDefineObject,\r\n\tgetLastDefineObject,\r\n};","import utils from \"../util/index.js\";\r\nimport script from \"./script.js\";\r\nimport moduleDef from \"./module-def\";\r\nconst global = utils.global;\r\nconst xsloader = global.xsloader;\r\n\r\nfunction buildInvoker(obj) {\r\n\tlet invoker = obj[\"thiz\"];\r\n\tlet module = obj.module || obj;\r\n\tlet id = xsloader.randId();\r\n\tinvoker.getId = function() {\r\n\t\treturn id;\r\n\t};\r\n\tinvoker.getUrl = function(relativeUrl, appendArgs, optionalAbsUrl) {\r\n\t\tif(optionalAbsUrl && !utils.dealPathMayAbsolute(optionalAbsUrl).absolute) {\r\n\t\t\tthrow new Error(-1, \"expected absolute url:\" + optionalAbsUrl);\r\n\t\t}\r\n\t\tif(appendArgs === undefined) {\r\n\t\t\tappendArgs = true;\r\n\t\t}\r\n\t\tlet url;\r\n\t\tif(relativeUrl === undefined) {\r\n\t\t\turl = this.getAbsoluteUrl();\r\n\t\t} else if(xsloader.startsWith(relativeUrl, \".\") || utils.dealPathMayAbsolute(relativeUrl).absolute) {\r\n\t\t\turl = utils.getPathWithRelative(optionalAbsUrl || this.rurl(), relativeUrl);\r\n\t\t} else {\r\n\t\t\turl = xsloader.config().baseUrl + relativeUrl;\r\n\t\t}\r\n\t\tif(appendArgs) {\r\n\t\t\tif(url == script.thePageUrl) {\r\n\t\t\t\turl += location.search + location.hash;\r\n\t\t\t}\r\n\t\t\treturn xsloader.config().dealUrl(module, url);\r\n\t\t} else {\r\n\t\t\treturn url;\r\n\t\t}\r\n\t};\r\n\tinvoker.require = function() {\r\n\t\tlet h = xsloader.require.apply(invoker, arguments);\r\n\t\treturn h;\r\n\t};\r\n\tinvoker.define = function() {\r\n\t\tlet h = xsloader.define.apply(invoker, arguments);\r\n\t\treturn h;\r\n\t};\r\n\tinvoker.rurl = function(defineObject) {\r\n\t\treturn defineObject && defineObject.absUrl() || this.absUrl() || this.getAbsoluteUrl();\r\n\t};\r\n\tinvoker.defineAsync = function() {\r\n\t\tlet h = this.define.apply(this, arguments);\r\n\t\treturn h;\r\n\t};\r\n\tinvoker.withAbsUrl = function(absUrl) {\r\n\t\tlet moduleMap = {\r\n\t\t\tmodule: module,\r\n\t\t\tsrc: absUrl,\r\n\t\t\tabsUrl: () => absUrl,\r\n\t\t\tname: invoker.getName(),\r\n\t\t\tinvoker: invoker.invoker()\r\n\t\t};\r\n\t\tmoduleMap.thiz = new script.Invoker(moduleMap);\r\n\t\tbuildInvoker(moduleMap);\r\n\t\treturn moduleMap.thiz;\r\n\t};\r\n}\r\n\r\n//新建模块实例\r\n//relyCallback(depModuleThis)\r\nfunction newModuleInstance(module, thatInvoker, relyCallback, pluginArgs) {\r\n\tlet instanceModule = {\r\n\t\trelyCallback: relyCallback,\r\n\t\t_invoker: thatInvoker,\r\n\t\t_module_: null,\r\n\t\tinitInvoker: function() {\r\n\t\t\t//确保正确的invoker\r\n\t\t\tif(module.ignoreAspect) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tlet obj = this._object;\r\n\t\t\tlet invoker = this._invoker;\r\n\r\n\t\t\tlet addTheAttrs = (theObj) => {\r\n\t\t\t\ttheObj._invoker_ = invoker;\r\n\t\t\t\tif(theObj._module_) {\r\n\t\t\t\t\ttheObj._modules_ = theObj._modules_ || [];\r\n\t\t\t\t\ttheObj._modules_.push(theObj._module_);\r\n\t\t\t\t}\r\n\t\t\t\ttheObj._module_ = this._module_;\r\n\t\t\t\treturn theObj;\r\n\t\t\t};\r\n\r\n\t\t\tlet isSingle = module.instanceType != \"clone\";\r\n\r\n\t\t\tif(xsloader.isObject(obj)) {\r\n\t\t\t\tif(module.loopObject && !isSingle) {\r\n\t\t\t\t\tthrow new Error(\"loop dependency not support single option:\" + module.description());\r\n\t\t\t\t}\r\n\t\t\t\tthis._object = addTheAttrs(isSingle ? obj : xsloader.clone(obj));\r\n\t\t\t} else if(xsloader.isFunction(obj)) {\r\n\t\t\t\tthis._object = addTheAttrs(obj);\r\n\t\t\t}\r\n\r\n\t\t},\r\n\t\t_object: null,\r\n\t\t_setDepModuleObjectGen: function(obj) {\r\n\t\t\tthis._object = obj;\r\n\t\t\tthis.initInvoker();\r\n\t\t},\r\n\t\tmodule: module,\r\n\t\tmoduleObject: function() {\r\n\t\t\treturn this._object;\r\n\t\t},\r\n\t\tgenExports: function() {\r\n\t\t\tthis._setDepModuleObjectGen({});\r\n\t\t\treturn this._object;\r\n\t\t},\r\n\t\t_getCacheKey: function(pluginArgs) {\r\n\t\t\tif(this._object.getCacheKey) {\r\n\t\t\t\treturn this._object.getCacheKey.call(this.thiz, pluginArgs);\r\n\t\t\t}\r\n\t\t\tlet id = this._invoker.getUrl();\r\n\t\t\treturn id;\r\n\t\t},\r\n\t\t_willCache: function(pluginArgs, cacheResult) {\r\n\t\t\tif(this._object.willCache) {\r\n\t\t\t\treturn this._object.willCache.call(this.thiz, pluginArgs, cacheResult);\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t},\r\n\t\tlastSinglePluginResult: function(pluginArgs) {\r\n\t\t\tlet id = this._getCacheKey(pluginArgs);\r\n\t\t\treturn this.module.lastSinglePluginResult(id, pluginArgs);\r\n\t\t},\r\n\t\tsetSinglePluginResult: function(pluginArgs, obj) {\r\n\t\t\tlet id = this._getCacheKey(pluginArgs);\r\n\t\t\tlet willCache = this._willCache(pluginArgs, obj);\r\n\t\t\treturn this.module.setSinglePluginResult(willCache, id, pluginArgs, obj);\r\n\t\t},\r\n\t\tinit: function(justForSingle) {\r\n\t\t\tlet relyCallback = this.relyCallback;\r\n\t\t\tthis._module_ = this.module.dealInstance(this);\r\n\t\t\tthis._setDepModuleObjectGen(this.module.loopObject || this.module.moduleObject);\r\n\t\t\tif(pluginArgs !== undefined) {\r\n\t\t\t\tif(!this._object) {\r\n\t\t\t\t\tthrow new Error(\"pulgin error:\" + this.module.description());\r\n\t\t\t\t}\r\n\t\t\t\tif(this._object.isSingle === undefined) {\r\n\t\t\t\t\tthis._object.isSingle = true; //同样的参数也需要重新调用\r\n\t\t\t\t}\r\n\t\t\t\tif(justForSingle && !this._object.isSingle) {\r\n\t\t\t\t\tthrow new Error(\"just for single plugin\");\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet hasFinished = false;\r\n\t\t\t\tlet onload = (result, ignoreAspect) => {\r\n\t\t\t\t\tif(result == undefined) {\r\n\t\t\t\t\t\tresult = {\r\n\t\t\t\t\t\t\t__default: true\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t}\r\n\t\t\t\t\thasFinished = true;\r\n\t\t\t\t\tif(this._object.isSingle) {\r\n\t\t\t\t\t\tthis.setSinglePluginResult(pluginArgs, {\r\n\t\t\t\t\t\t\tresult: result,\r\n\t\t\t\t\t\t\tignoreAspect: ignoreAspect\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.module.ignoreAspect = ignoreAspect === undefined || ignoreAspect;\r\n\t\t\t\t\tthis._setDepModuleObjectGen(result);\r\n\t\t\t\t\trelyCallback(this);\r\n\t\t\t\t};\r\n\t\t\t\tlet onerror = (err) => {\r\n\t\t\t\t\thasFinished = true;\r\n\t\t\t\t\trelyCallback(this, new utils.PluginError(err || false));\r\n\t\t\t\t};\r\n\t\t\t\tlet args = [pluginArgs, onload, onerror, xsloader.config()].concat(this.module.depModules);\r\n\t\t\t\ttry {\r\n\t\t\t\t\tlet cacheResult;\r\n\t\t\t\t\tif(this._object.isSingle && (cacheResult = this.lastSinglePluginResult(pluginArgs)) !== undefined) {\r\n\t\t\t\t\t\tlet last = cacheResult;\r\n\t\t\t\t\t\tonload(last.result, last.ignoreAspect);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis._object.pluginMain.apply(this.thiz, args);\r\n\t\t\t\t\t}\r\n\t\t\t\t} catch(e) {\r\n\t\t\t\t\tconsole.warn(e);\r\n\t\t\t\t\tonerror(e);\r\n\t\t\t\t}\r\n\t\t\t\tif(!hasFinished) {\r\n\t\t\t\t\tsetTimeout(function() {\r\n\t\t\t\t\t\tif(!hasFinished) {\r\n\t\t\t\t\t\t\tconsole.warn(\"invoke plugin may failed:page=\" + location.href + \",plugin=\" + module.selfname + \"!\" + pluginArgs);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}, xsloader.config().waitSeconds * 1000);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\trelyCallback(this);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t};\r\n\r\n\tlet moduleMap = {\r\n\t\tmodule: module,\r\n\t\tsrc: module.thiz.getAbsoluteUrl(),\r\n\t\tabsUrl: () => module.thiz.absUrl(),\r\n\t\tname: module.thiz.getName(),\r\n\t\tinvoker: instanceModule._invoker\r\n\t};\r\n\tinstanceModule.thiz = new script.Invoker(moduleMap);\r\n\r\n\tbuildInvoker(instanceModule);\r\n\treturn instanceModule;\r\n}\r\n\r\nfunction _newModule(name, src, absUrl, thatInvoker, callback) {\r\n\tsrc = utils.removeQueryHash(src);\r\n\tlet defineObject = new script.DefineObject(src, null, [name, null, callback], false);\r\n\tdefineObject.thatInvoker = thatInvoker;\r\n\tdefineObject.handle = {\r\n\t\tabsUrl: absUrl\r\n\t};\r\n\treturn newModule(defineObject);\r\n}\r\n\r\n//\r\n//模块依赖来源：(另见module.js:mayAddDeps,define.js:theRealDefine)\r\n//1、define里声明的\r\n//2、define或require里直接require('...')\r\n//3、config里配置的\r\n//4、手动通过handle.before或depBefore进行修改的\r\n/*\r\n *模块的名字来源：(另见define.js:onModuleLoaded)\r\n * 1、模块url地址:一定存在\r\n * 2、模块define时提供的：可选\r\n * 3、paths或depsPaths提供的：可选，且可能为默认模块\r\n * 4、name!提供的：可选\r\n */\r\nfunction newModule(defineObject) {\r\n\r\n\tlet instances = []; //所有模块实例\r\n\tlet moduleMap = {\r\n\t\tid: utils.getAndIncIdCount(),\r\n\t\tselfname: defineObject.selfname,\r\n\t\tdescription() {\r\n\t\t\treturn \"selfname=\" + (this.selfname || \"\") + \",src=\" + this.src;\r\n\t\t},\r\n\t\tdeps: defineObject.deps || [],\r\n\t\trelys: [],\r\n\t\totherModule: undefined,\r\n\t\tdirectDefineIndex: 0, //模块直接声明的依赖开始索引\r\n\t\tignoreAspect: false,\r\n\t\tdepModules: null,\r\n\t\tsrc: defineObject.src, //绝对路径,可能等于当前页面路径\r\n\t\tabsUrl: () => defineObject.absUrl(),\r\n\t\tcallback: defineObject.callback,\r\n\t\t_loadCallback: null,\r\n\t\tmoduleObject: undefined, //依赖模块对应的对象\r\n\t\tloopObject: undefined, //循环依赖对象\r\n\t\tinvoker: defineObject.thatInvoker,\r\n\t\tinstanceType: \"single\",\r\n\t\treinitByDefineObject(defineObject) {\r\n\t\t\tthis.deps = defineObject.deps || [];\r\n\t\t\t//this.absUrl = () => defineObject.absUrl();\r\n\t\t\tthis.callback = defineObject.callback;\r\n\t\t},\r\n\t\tsetInstanceType(instanceType) {\r\n\t\t\tthis.instanceType = instanceType;\r\n\t\t},\r\n\t\t_singlePluginResult: {},\r\n\t\tlastSinglePluginResult(id, pluginArgs) {\r\n\t\t\tif(this._singlePluginResult[id]) {\r\n\t\t\t\treturn this._singlePluginResult[id][pluginArgs];\r\n\t\t\t}\r\n\t\t},\r\n\t\tsetSinglePluginResult(willCache, id, pluginArgs, obj) {\r\n\t\t\tif(willCache) {\r\n\t\t\t\tif(!this._singlePluginResult[id]) {\r\n\t\t\t\t\tthis._singlePluginResult[id] = {};\r\n\t\t\t\t}\r\n\t\t\t\tthis._singlePluginResult[id][pluginArgs] = obj;\r\n\t\t\t} else {\r\n\t\t\t\tif(this._singlePluginResult[id]) {\r\n\t\t\t\t\tdelete this._singlePluginResult[id][pluginArgs];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tfinish(args) {\r\n\t\t\tif(this.directDefineIndex != 0) {\r\n\t\t\t\tlet _directArgs = [];\r\n\t\t\t\tfor(let i = this.directDefineIndex; i < args.length; i++) {\r\n\t\t\t\t\t_directArgs.push(args[i]);\r\n\t\t\t\t}\r\n\t\t\t\targs = _directArgs;\r\n\t\t\t}\r\n\t\t\tthis.depModules = args;\r\n\t\t\tlet obj;\r\n\t\t\tif(xsloader.isFunction(this.callback)) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tscript.currentDefineModuleQueue.push(this);\r\n\t\t\t\t\tobj = this.callback.apply(this.thiz, args);\r\n\t\t\t\t\tscript.currentDefineModuleQueue.pop();\r\n\t\t\t\t} catch(e) {\r\n\t\t\t\t\tscript.currentDefineModuleQueue.pop();\r\n\t\t\t\t\tconsole.error(\"error occured,invoker.url=\", this.invoker ? this.invoker.getUrl() : \"\");\r\n\t\t\t\t\tconsole.error(e);\r\n\t\t\t\t\tthis.setState(\"error\", e);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tobj = this.callback;\r\n\t\t\t\tif(this.moduleObject !== undefined) {\r\n\t\t\t\t\tconsole.warn(\"ignore moudule:\" + moduleMap.description());\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tlet isDefault = false;\r\n\t\t\tif(obj === undefined) {\r\n\t\t\t\tisDefault = true;\r\n\t\t\t\tobj = {\r\n\t\t\t\t\t__default: true\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\tif(this.loopObject) {\r\n\t\t\t\tif(!xsloader.isObject(obj)) {\r\n\t\t\t\t\tthrow new Error(\"循环依赖的模块必须是对象：\" + this.description());\r\n\t\t\t\t}\r\n\t\t\t\tfor(let x in obj) {\r\n\t\t\t\t\tthis.loopObject[x] = obj[x];\r\n\t\t\t\t}\r\n\t\t\t\tobj = this.loopObject;\r\n\t\t\t}\r\n\t\t\t//this.moduleObject不为undefined，则使用了exports\r\n\t\t\tif(this.moduleObject === undefined ||\r\n\t\t\t\t!isDefault && obj !== undefined //如果使用了return、则优先使用\r\n\t\t\t) {\r\n\t\t\t\tthis.moduleObject = obj;\r\n\t\t\t}\r\n\t\t\tthis.setState(\"defined\");\r\n\t\t},\r\n\t\tstate: \"init\", //init,loading,loaded,defined,error,\r\n\t\terrinfo: null,\r\n\t\t_callback(fun) {\r\n\t\t\tlet thiz = this;\r\n\t\t\tlet _state = thiz.state;\r\n\t\t\tif(_state == 'defined' || thiz.loopObject) {\r\n\t\t\t\tlet theCallback = function() {\r\n\t\t\t\t\tif(fun) {\r\n\t\t\t\t\t\tlet depModule = newModuleInstance(thiz, fun.thatInvoker, fun.relyCallback, fun.pluginArgs);\r\n\t\t\t\t\t\tdepModule.init();\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t\t//已经加载了模块，仍然需要判断为其另外设置的依赖模块是否已被加载\r\n\t\t\t\tlet deps = !thiz.loopObject && xsloader.config().getDeps(thiz.selfname);\r\n\t\t\t\t//console.log(this.selfname,\":\",deps);\r\n\t\t\t\t//deps=null;\r\n\t\t\t\tif(deps && deps.length > 0) {\r\n\t\t\t\t\txsloader.require(deps, function() {\r\n\t\t\t\t\t\ttheCallback();\r\n\t\t\t\t\t}).then({\r\n\t\t\t\t\t\tdefined_module_for_deps: thiz.selfname\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttheCallback();\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn false;\r\n\t\t\t} else if(_state == \"timeout\" || _state == \"error\") {\r\n\t\t\t\tif(fun) {\r\n\t\t\t\t\tfun.relyCallback(this, this.errinfo);\r\n\t\t\t\t}\r\n\t\t\t\treturn false;\r\n\t\t\t} else {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t},\r\n\t\tsetState(_state, errinfo) {\r\n\t\t\tthis.state = _state;\r\n\t\t\tthis.errinfo = errinfo;\r\n\t\t\tif(!this._callback()) {\r\n\t\t\t\twhile(this.relys.length) {\r\n\t\t\t\t\tlet fun = this.relys.shift();\r\n\t\t\t\t\tthis._callback(fun);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tget() {\r\n\t\t\tif(this.otherModule) {\r\n\t\t\t\tthis.state = this.otherModule.state; //状态同步,保持与otherModule状态相同\r\n\t\t\t\treturn this.otherModule;\r\n\t\t\t}\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\t/**\r\n\t\t * 依赖当前模块、表示依赖otherModule模块，当前模块为别名或引用。\r\n\t\t * @param {Object} otherModule\r\n\t\t */\r\n\t\ttoOtherModule(otherModule) {\r\n\t\t\tthis.otherModule = otherModule;\r\n\t\t\tthis.get(); //状态同步\r\n\t\t\tlet theRelys = this.relys;\r\n\t\t\tthis.relys = [];\r\n\t\t\twhile(theRelys.length) {\r\n\t\t\t\tlet fun = theRelys.shift();\r\n\t\t\t\totherModule.relyIt(fun.thatInvoker, fun.relyCallback, fun.pluginArgs);\r\n\t\t\t}\r\n\t\t},\r\n\t\twhenNeed(loadCallback) {\r\n\t\t\tif(this.relys.length || this.otherModule && this.otherModule.relys.length) {\r\n\t\t\t\tloadCallback(); //已经被依赖了\r\n\t\t\t} else {\r\n\t\t\t\tthis._loadCallback = loadCallback;\r\n\t\t\t}\r\n\t\t},\r\n\t\t/**\r\n\t\t * \r\n\t\t * @param {Object} thatInvoker\r\n\t\t * @param {Object} callbackFun function(depModule,err)\r\n\t\t * @param {Object} pluginArgs\r\n\t\t */\r\n\t\trelyIt(thatInvoker, callbackFun, pluginArgs) {\r\n\t\t\tif(this.otherModule) {\r\n\t\t\t\tthis.get(); //状态同步\r\n\t\t\t\tthis.otherModule.relyIt(thatInvoker, callbackFun, pluginArgs); //传递给otherModule\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tlet fun = {\r\n\t\t\t\tthatInvoker: thatInvoker,\r\n\t\t\t\trelyCallback: callbackFun,\r\n\t\t\t\tpluginArgs: pluginArgs\r\n\t\t\t};\r\n\t\t\tif(this._callback(fun)) {\r\n\t\t\t\tthis.relys.push(fun);\r\n\t\t\t}\r\n\t\t\tif(this._loadCallback) { //将会加载此模块及其依赖的模块\r\n\t\t\t\tlet loadCallback = this._loadCallback;\r\n\t\t\t\tthis._loadCallback = null;\r\n\t\t\t\tloadCallback();\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\tmoduleMap.thiz = new script.Invoker(moduleMap);\r\n\r\n\t//返回_module_\r\n\tmoduleMap.dealInstance = function(moduleInstance) {\r\n\t\tinstances.push(moduleInstance);\r\n\t\tlet _module_ = {\r\n\t\t\topId: null,\r\n\t\t\tsetToAll(name, value, opId) {\r\n\t\t\t\tif(opId !== undefined && opId == this.opId) {\r\n\t\t\t\t\treturn; //防止循环\r\n\t\t\t\t}\r\n\t\t\t\topId = opId || getModuleId();\r\n\t\t\t\tthis.opId = opId;\r\n\r\n\t\t\t\tlet obj = {};\r\n\t\t\t\tif(xsloader.isString(name)) {\r\n\t\t\t\t\tobj[name] = value;\r\n\t\t\t\t} else if(xsloader.isObject(name)) {\r\n\t\t\t\t\tfor(let k in name) {\r\n\t\t\t\t\t\tobj[k] = name[k];\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthrow new Error(\"unknown param:\" + name);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tutils.each(instances, function(ins) {\r\n\t\t\t\t\tlet mobj = ins.moduleObject();\r\n\t\t\t\t\tfor(let k in obj) {\r\n\t\t\t\t\t\tmobj[k] = obj[k];\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(mobj._modules_) {\r\n\t\t\t\t\t\tutils.each(mobj._modules_, function(_m_) {\r\n\t\t\t\t\t\t\t_m_.setToAll(name, value, opId);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t};\r\n\r\n\t\treturn _module_;\r\n\t};\r\n\r\n\tmoduleMap.printOnNotDefined = function() {\r\n\t\tlet root = {\r\n\t\t\tnodes: []\r\n\t\t};\r\n\t\tthis._printOnNotDefined(root);\r\n\r\n\t\tlet leafs = [];\r\n\r\n\t\tfunction findLeaf(node) {\r\n\t\t\tif(node.nodes.length) {\r\n\t\t\t\tutils.each(node.nodes, function(item) {\r\n\t\t\t\t\tfindLeaf(item);\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tleafs.push(node);\r\n\t\t\t}\r\n\t\t}\r\n\t\tfindLeaf(root);\r\n\r\n\t\tfunction genErrs(node, infos) {\r\n\t\t\tinfos.push(node.err);\r\n\t\t\tif(node.parent) {\r\n\t\t\t\tgenErrs(node.parent, infos);\r\n\t\t\t}\r\n\t\t}\r\n\t\tutils.each(leafs, function(leaf) {\r\n\t\t\tlet infos = [];\r\n\t\t\tgenErrs(leaf, infos);\r\n\t\t\tinfos = infos.reverse();\r\n\t\t\tconsole.error(\"load module error stack:my page=\" + location.href);\r\n\t\t\tfor(let i = 1; i < infos.length;) {\r\n\t\t\t\tlet as = [];\r\n\t\t\t\tfor(let k = 0; k < 3 && i < infos.length; k++) {\r\n\t\t\t\t\tas.push(infos[i++]);\r\n\t\t\t\t}\r\n\t\t\t\tconsole.warn(as.join(\"\\n\\t--->\"));\r\n\t\t\t}\r\n\t\t\tlet errModule = leaf.module;\r\n\t\t\tif(leaf.module && leaf.module.state == \"defined\") {\r\n\t\t\t\terrModule = leaf.parent.module;\r\n\t\t\t}\r\n\t\t\tif(errModule) {\r\n\t\t\t\tlet as = [];\r\n\t\t\t\tfor(let i = 0; i < errModule.deps.length; i++) {\r\n\t\t\t\t\tlet dep = errModule.deps[i];\r\n\t\t\t\t\tlet index = dep.lastIndexOf(\"!\");\r\n\t\t\t\t\tif(index != -1) {\r\n\t\t\t\t\t\tdep = dep.substring(0, index);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlet depMod = moduleDef.getModule(dep);\r\n\t\t\t\t\tif(depMod) {\r\n\t\t\t\t\t\tas.push(dep + \":\" + depMod.state);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tas.push(dep + \":null\");\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tconsole.warn(\"failed module:\" + errModule.description() + \",\\n\\tdeps state infos [\" + as.join(\",\") + \"]\");\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t};\r\n\tmoduleMap._printOnNotDefined = function(parentNode) {\r\n\t\tlet node = {\r\n\t\t\terr: \"[\" + this.description() + \"].state=\" + this.state,\r\n\t\t\tmodule: this,\r\n\t\t\tparent: parentNode,\r\n\t\t\tnodes: []\r\n\t\t};\r\n\t\tparentNode.nodes.push(node);\r\n\t\tif(this.state == \"defined\") {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tutils.each(this.deps, function(dep) {\r\n\t\t\tlet indexPlguin = dep.indexOf(\"!\");\r\n\t\t\tif(indexPlguin > 0) {\r\n\t\t\t\tdep = dep.substring(0, indexPlguin);\r\n\t\t\t}\r\n\t\t\tlet mod = moduleDef.getModule(dep);\r\n\t\t\tif(mod && mod.state == \"defined\") {\r\n\t\t\t\tmod._printOnNotDefined(node);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t//只打印一个错误栈\r\n\t\t\tif(mod) {\r\n\t\t\t\tmod._printOnNotDefined(node);\r\n\t\t\t} else {\r\n\t\t\t\tnode.nodes.push({\r\n\t\t\t\t\tparent: parentNode,\r\n\t\t\t\t\tnodes: [],\r\n\t\t\t\t\terr: \"[\" + dep + \"] has not module\"\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t};\r\n\tmoduleDef.setModule(moduleMap.selfname, moduleMap);\r\n\r\n\tbuildInvoker(moduleMap);\r\n\treturn moduleMap;\r\n}\r\n\r\nlet randModuleIndex = 0;\r\n\r\nfunction getModuleId() {\r\n\treturn \"_xs_req_2019_\" + randModuleIndex++;\r\n}\r\n\r\n//everyOkCallback(depModules,module),errCallback(err,invoker)\r\nfunction everyRequired(defineObject, module, everyOkCallback, errCallback) {\r\n\tif(defineObject.isError) {\r\n\t\treturn;\r\n\t}\r\n\r\n\t//处理相对路径\r\n\tdefineObject.dealRelative(module);\r\n\r\n\tlet config = xsloader.config();\r\n\r\n\tlet isError = false,\r\n\t\thasCallErr = false,\r\n\t\ttheExports;\r\n\tlet depCount = module.deps.length;\r\n\t//module.jsScriptCount = 0;\r\n\tlet depModules = new Array(depCount);\r\n\r\n\tlet invoker_the_module = module.thiz;\r\n\r\n\tfunction checkFinish(index, dep_name, depModule, syncHandle) {\r\n\t\tdepModules[index] = depModule;\r\n\r\n\t\tif( /*(depCount == 0 || depCount - module.jsScriptCount == 0)*/ depCount <= 0 && !isError) {\r\n\t\t\teveryOkCallback(depModules, module);\r\n\t\t} else if(isError) {\r\n\t\t\tmodule.setState('error', isError);\r\n\t\t\tif(!hasCallErr) {\r\n\t\t\t\thasCallErr = true;\r\n\t\t\t\terrCallback({\r\n\t\t\t\t\terr: isError,\r\n\t\t\t\t\tindex: index,\r\n\t\t\t\t\tdep_name: dep_name\r\n\t\t\t\t}, invoker_the_module);\r\n\t\t\t}\r\n\t\t}!isError && syncHandle && syncHandle();\r\n\t}\r\n\r\n\tutils.each(module.deps, function(dep, index, ary, syncHandle) {\r\n\t\tlet originDep = dep;\r\n\t\tlet pluginArgs = undefined;\r\n\t\tlet pluginIndex = dep.indexOf(\"!\");\r\n\t\tif(pluginIndex > 0) {\r\n\t\t\tpluginArgs = dep.substring(pluginIndex + 1);\r\n\t\t\tdep = dep.substring(0, pluginIndex);\r\n\t\t}\r\n\t\tlet relyItFun = function() {\r\n\t\t\tmoduleDef.getModule(dep)\r\n\t\t\t\t.relyIt(invoker_the_module, function(depModule, err) {\r\n\t\t\t\t\tif(!err) {\r\n\t\t\t\t\t\tdepCount--;\r\n\t\t\t\t\t\tif(dep == \"exports\") {\r\n\t\t\t\t\t\t\tif(theExports) {\r\n\t\t\t\t\t\t\t\tmodule.moduleObject = theExports;\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\ttheExports = module.moduleObject = depModule.genExports();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tisError = err;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcheckFinish(index, originDep, depModule, syncHandle);\r\n\t\t\t\t}, pluginArgs);\r\n\t\t};\r\n\r\n\t\tif(!moduleDef.getModule(dep)) {\r\n\t\t\tlet isJsFile = utils.isJsFile(dep);\r\n\t\t\tdo {\r\n\r\n\t\t\t\tlet urls;\r\n\r\n\t\t\t\tif(!isJsFile && dep.indexOf(\"/\") < 0 && dep.indexOf(\":\") >= 0) {\r\n\t\t\t\t\tlet i1 = dep.indexOf(\":\");\r\n\t\t\t\t\tlet i2 = dep.indexOf(\":\", i1 + 1);\r\n\t\t\t\t\tlet i3 = i2 > 0 ? dep.indexOf(\":\", i2 + 1) : -1;\r\n\t\t\t\t\tif(i2 == -1) {\r\n\t\t\t\t\t\tisError = \"illegal module:\" + dep;\r\n\t\t\t\t\t\terrCallback(isError, invoker_the_module);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlet version;\r\n\t\t\t\t\tlet groupModule;\r\n\t\t\t\t\tif(i3 == -1) {\r\n\t\t\t\t\t\tversion = config.defaultVersion[dep];\r\n\t\t\t\t\t\tgroupModule = dep + \":\" + version;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tversion = dep.substring(i3 + 1);\r\n\t\t\t\t\t\tgroupModule = dep;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(version === undefined) {\r\n\t\t\t\t\t\tisError = \"unknown version for:\" + dep;\r\n\t\t\t\t\t\terrCallback(isError, invoker_the_module);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlet _url = xsloader._resUrlBuilder(groupModule);\r\n\t\t\t\t\turls = xsloader.isArray(_url) ? _url : [_url];\r\n\t\t\t\t} else if(config.isInUrls(dep)) {\r\n\t\t\t\t\turls = config.getUrls(dep);\r\n\t\t\t\t} else if(isJsFile) {\r\n\t\t\t\t\turls = [dep];\r\n\t\t\t\t} else {\r\n\t\t\t\t\turls = [];\r\n\t\t\t\t}\r\n\r\n\t\t\t\t//TODO errCallback是否无效??\r\n\t\t\t\tif(urls.length == 0) {\r\n\t\t\t\t\t//提前依赖模块\r\n\t\t\t\t\tmoduleDef.preDependOn(dep);\r\n\t\t\t\t\t//\t\t\t\t\tisError = \"module '\" + dep + \"' urls is empty.\";\r\n\t\t\t\t\t//\t\t\t\t\terrCallback(isError, invoker_the_module);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tutils.each(urls, function(url, index) {\r\n\t\t\t\t\t\tif(xsloader.startsWith(url, \".\") || xsloader.startsWith(url, \"/\")) {\r\n\t\t\t\t\t\t\tif(!module.thiz.rurl(defineObject)) {\r\n\t\t\t\t\t\t\t\tisError = \"script url is null:'\" + module.description();\r\n\t\t\t\t\t\t\t\terrCallback(isError, invoker_the_module);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\turl = utils.getPathWithRelative(module.thiz.rurl(defineObject), url);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tlet absolute = utils.dealPathMayAbsolute(url);\r\n\t\t\t\t\t\t\tif(absolute.absolute) {\r\n\t\t\t\t\t\t\t\turl = absolute.path;\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\turl = config.baseUrl + url;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\turls[index] = config.dealUrl(dep, url);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(!isError && urls.length) {\r\n\t\t\t\t\tlet m2Name = isJsFile ? null : dep;\r\n\t\t\t\t\tlet module2 = _newModule(m2Name, urls[0], module.absUrl, module.thiz);\r\n\t\t\t\t\tmodule2.setState(\"loading\");\r\n\r\n\t\t\t\t\t//加载模块dep:module2\r\n\t\t\t\t\tfunction loadModule(index = 0) {\r\n\t\t\t\t\t\tif(index >= urls.length) {\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tlet url = urls[index];\r\n\t\t\t\t\t\tmoduleDef.setLastDefineObject(url, defineObject);\r\n\t\t\t\t\t\tif(index > 0) {\r\n\t\t\t\t\t\t\tlet oldSrc = module2.src;\r\n\t\t\t\t\t\t\tmodule2.src = url;\r\n\t\t\t\t\t\t\tmoduleDef.replaceModuleSrc(oldSrc, module2);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tscript.loadScript(module2.selfname, url, (scriptData) => {\r\n\t\t\t\t\t\t\t//console.log(scriptData);\r\n\t\t\t\t\t\t\tif(module2.state == \"loading\") { //module2.selfname为配置名称，尝试默认模块\r\n\t\t\t\t\t\t\t\tlet defaultMod = moduleDef.getModule(module2.src);\r\n\t\t\t\t\t\t\t\tif(defaultMod && module2 != defaultMod) {\r\n\t\t\t\t\t\t\t\t\tmodule2.toOtherModule(defaultMod);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tif(module2.state == \"loading\") {\r\n\t\t\t\t\t\t\t\t//\t\t\t\t\t\t\t\tisError = \"load module err(may not define default):\" + module2.description();\r\n\t\t\t\t\t\t\t\t//\t\t\t\t\t\t\t\terrCallback(isError, invoker_the_module);\r\n\t\t\t\t\t\t\t\t//？？没有define的情况、直接完成\r\n\t\t\t\t\t\t\t\tmodule2.finish([]);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}, (err) => {\r\n\t\t\t\t\t\t\tif(index + 1 < urls.length) {\r\n\t\t\t\t\t\t\t\tloadModule(index + 1);\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tisError = err;\r\n\t\t\t\t\t\t\t\terrCallback(isError, invoker_the_module);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t\tloadModule();\r\n\t\t\t\t}\r\n\t\t\t} while (false);\r\n\t\t}\r\n\t\tif(!isError) {\r\n\t\t\trelyItFun();\r\n\t\t}\r\n\t}, defineObject.handle.orderDep);\r\n\t//TODO STRONG ????ie10及以下版本，js文件一个一个加载，从而解决缓存等造成的混乱问题\r\n}\r\n\r\nexport default {\r\n\t...moduleDef,\r\n\tnewModule,\r\n\teveryRequired,\r\n\tbuildInvoker,\r\n\tnewModuleInstance,\r\n\tgetModuleId\r\n};","import utils from \"../util/index.js\";\r\nimport moduleScript from \"./module.js\";\r\n\r\nconst global = utils.global;\r\nconst xsloader = global.xsloader;\r\n\r\nconst defContextName = \"xsloader1.1.x\";\r\nconst DATA_ATTR_MODULE = 'data-xsloader-module';\r\nconst DATA_ATTR_CONTEXT = \"data-xsloader-context\";\r\nconst INNER_DEPS_PLUGIN = \"__inner_deps__\";\r\nconst innerDepsMap = {}; //内部依赖加载插件用于保存依赖的临时map\r\nconst globalDefineQueue = []; //没有配置前的define\r\n\r\nconst isOpera = typeof opera !== 'undefined' && opera.toString() === '[object Opera]';\r\nconst safariVersion = (function() {\r\n\tlet ua = navigator.userAgent.toLowerCase();\r\n\tlet s = ua.match(/version\\/([\\d.]+).*safari/);\r\n\treturn s ? parseInt(s[1]) : -1;\r\n})();\r\n\r\nconst readyRegExp = navigator.platform === 'PLAYSTATION 3' ? /^complete$/ : /^(complete|loaded)$/;\r\nconst theLoaderScript = document.currentScript || utils.getScriptBySubname(\"xsloader.js\");\r\nconst theLoaderUrl = utils.getNodeAbsolutePath(theLoaderScript);\r\nconst thePageUrl = (function() {\r\n\tlet url = location.href;\r\n\turl = utils.removeQueryHash(url);\r\n\treturn url;\r\n})();\r\nconst head = document.head || document.getElementsByTagName('head')[0];\r\n\r\nconst currentDefineModuleQueue = []; //当前回调的模块\r\ncurrentDefineModuleQueue.peek = function() {\r\n\tif(this.length > 0) {\r\n\t\treturn this[this.length - 1];\r\n\t}\r\n};\r\n\r\nlet lastAppendHeadDom = theLoaderScript;\r\nlet isSrcFromScriptLoad; //获取脚本的src是否在load事件阶段\r\nlet lastScriptSrc = thePageUrl;\r\nlet theRealDefine;\r\nif(safariVersion > 0 && safariVersion <= 7) {\r\n\tisSrcFromScriptLoad = true;\r\n}\r\n\r\n//处理嵌套依赖\r\nfunction _dealEmbedDeps(deps) {\r\n\tfor(let i = 0; i < deps.length; i++) {\r\n\t\tlet dep = deps[i];\r\n\t\tif(xsloader.isArray(dep)) {\r\n\t\t\t//内部的模块顺序加载\r\n\t\t\tlet modName = \"inner_order_\" + moduleScript.getModuleId();\r\n\t\t\tlet isOrderDep = !(dep.length > 0 && dep[0] === false);\r\n\t\t\tif(dep.length > 0 && (dep[0] === false || dep[0] === true)) {\r\n\t\t\t\tdep = dep.slice(1);\r\n\t\t\t}\r\n\t\t\tinnerDepsMap[modName] = {\r\n\t\t\t\tdeps: dep,\r\n\t\t\t\torderDep: isOrderDep\r\n\t\t\t};\r\n\r\n\t\t\t//console.log(innerDepsMap[modName]);\r\n\t\t\tdeps[i] = INNER_DEPS_PLUGIN + \"!\" + modName;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction _getPluginParam(path) {\r\n\tlet pluginIndex = path.indexOf(\"!\");\r\n\tif(pluginIndex > 0) {\r\n\t\treturn path.substring(pluginIndex);\r\n\t} else {\r\n\t\treturn \"\";\r\n\t}\r\n}\r\n\r\n/////////////////////////////\r\n\r\nclass Invoker {\r\n\t_im;\r\n\tconstructor(moduleMap) {\r\n\t\tthis._im = new InVar(moduleMap);\r\n\t}\r\n\t/**\r\n\t * 获取绝对地址\r\n\t */\r\n\tgetAbsoluteUrl() {\r\n\t\treturn this._im.get().src;\r\n\t}\r\n\tgetName() {\r\n\t\treturn this._im.get().selfname;\r\n\t}\r\n\tinvoker() {\r\n\t\treturn this._im.get().invoker;\r\n\t}\r\n\tabsUrl() { //用于获取其他模块地址的参考路径\r\n\t\treturn this._im.get().absUrl();\r\n\t}\r\n}\r\n\r\nfunction getInvoker(thiz, nullNew = true) {\r\n\tif(thiz instanceof Invoker) {\r\n\t\treturn thiz;\r\n\t} else if(thiz instanceof DefineObject) {\r\n\t\treturn thiz.thatInvoker;\r\n\t} else if(nullNew) {\r\n\t\tlet moduleMap = {\r\n\t\t\tmodule: \"\",\r\n\t\t\tsrc: thePageUrl,\r\n\t\t\tabsUrl: () => thePageUrl,\r\n\t\t\tname: \"__root__\",\r\n\t\t\tinvoker: null\r\n\t\t};\r\n\t\tmoduleMap.thiz = new Invoker(moduleMap);\r\n\t\tmoduleScript.buildInvoker(moduleMap);\r\n\t\tmoduleMap.thiz.invoker = function() {\r\n\t\t\treturn this;\r\n\t\t};\r\n\t\treturn moduleMap.thiz;\r\n\t}\r\n}\r\n\r\nclass DefineObject {\r\n\tthiz;\r\n\tisRequire;\r\n\tsrc;\r\n\tparentDefine;\r\n\thandle;\r\n\tselfname;\r\n\tdeps;\r\n\tcallback;\r\n\tthatInvoker;\r\n\tconstructor(src, thiz, args = [], isRequire = false, willDealConfigDeps = true) {\r\n\t\tthis.src = src;\r\n\t\tthis.thiz = thiz;\r\n\t\tthis.isRequire = isRequire;\r\n\t\tthis.parentDefine = currentDefineModuleQueue.peek();\r\n\t\tthis.handle = {\r\n\t\t\tonError(err) {\r\n\t\t\t\tconsole.warn(err);\r\n\t\t\t},\r\n\t\t\tbefore(deps) {},\r\n\t\t\tdepBefore(index, dep, depDeps) {},\r\n\t\t\torderDep: false,\r\n\t\t\tabsoluteUrl: undefined, //弃用\r\n\t\t\tabsUrl: undefined,\r\n\t\t\tinstance: undefined,\r\n\t\t};\r\n\t\tthis.thatInvoker = getInvoker(thiz);\r\n\r\n\t\tlet selfname = args[0];\r\n\t\tlet deps = args[1];\r\n\t\tlet callback = args[2];\r\n\t\tif(args.length == 1) {\r\n\t\t\t//直接定义模块，且没有依赖\r\n\t\t\tcallback = selfname;\r\n\t\t\tselfname = null;\r\n\t\t\tdeps = null;\r\n\t\t} else if(typeof selfname !== 'string') {\r\n\t\t\tcallback = deps;\r\n\t\t\tdeps = selfname;\r\n\t\t\tselfname = null; //为空的、表示定义默认模块\r\n\t\t}\r\n\r\n\t\tif(deps && !xsloader.isArray(deps)) {\r\n\t\t\tcallback = deps;\r\n\t\t\tdeps = null;\r\n\t\t}\r\n\r\n\t\tif(!deps) {\r\n\t\t\tdeps = [];\r\n\t\t}\r\n\r\n\t\t//获取函数体里直接require('...')的依赖\r\n\t\t//if(!isRequire) {\r\n\t\tutils.appendInnerDeps(deps, callback);\r\n\t\t//}\r\n\r\n\t\tthis.selfname = selfname;\r\n\t\tthis.deps = deps;\r\n\t\tthis.callback = callback;\r\n\r\n\t\tif(willDealConfigDeps) {\r\n\t\t\t//处理配置依赖及嵌套依赖\r\n\t\t\tthis.dealConfigDeps();\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tdealConfigDeps() {\r\n\t\tlet src = this.src;\r\n\t\tlet selfname = this.selfname;\r\n\t\tlet deps = this.deps;\r\n\t\tlet config = xsloader.config();\r\n\t\tif(config) {\r\n\t\t\t//获取配置里配置的依赖\r\n\t\t\tlet _deps = config.getDeps(src);\r\n\t\t\tutils.each(_deps, (dep) => {\r\n\t\t\t\tdeps.push(dep);\r\n\t\t\t});\r\n\t\t\tif(selfname && selfname != src) {\r\n\t\t\t\t_deps = config.getDeps(selfname);\r\n\t\t\t\tutils.each(_deps, (dep) => {\r\n\t\t\t\t\tdeps.push(dep);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\t//前缀替换\r\n\t\t\tutils.replaceModulePrefix(config, deps);\r\n\t\t}\r\n\r\n\t\t//处理嵌套依赖\r\n\t\t_dealEmbedDeps(deps);\r\n\t}\r\n\r\n\tdealRelative(module) {\r\n\t\tlet deps = this.deps;\r\n\t\t//处理相对路径\r\n\t\tfor(let i = 0; i < deps.length; i++) {\r\n\t\t\t//console.log(module.selfname+(\"(\"+defineObject.handle.defined_module_for_deps+\")\"), \":\", deps);\r\n\t\t\tlet m = deps[i];\r\n\t\t\tlet jsFilePath = utils.isJsFile(m);\r\n\r\n\t\t\tif(module.thiz.rurl(this)) { //替换相对路径为绝对路径\r\n\t\t\t\tif(jsFilePath && xsloader.startsWith(m, \".\")) {\r\n\t\t\t\t\tm = utils.getPathWithRelative(module.thiz.rurl(this), jsFilePath.path) + _getPluginParam(m);\r\n\t\t\t\t\tdeps[i] = m;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tlet paths = utils.graphPath.tryAddEdge(this.handle.defined_module_for_deps || module.selfname, m);\r\n\t\t\tif(paths.length > 0) {\r\n\t\t\t\tlet moduleLoop = moduleScript.getModule(m); //该模块必定已经被定义过\r\n\t\t\t\tmoduleLoop.loopObject = {};\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tabsUrl() {\r\n\t\treturn this.getMineAbsUrl() || this.src; //(this.thatInvoker ? this.thatInvoker.absUrl() : null);\r\n\t}\r\n\r\n\tgetMineAbsUrl() {\r\n\t\treturn this.handle.absUrl || this.handle.absoluteUrl;\r\n\t}\r\n}\r\n\r\n////////////////////////\r\n\r\n/**\r\n * 获取当前脚本，返回对象：\r\n * src:脚本绝对地址，不含参数\r\n * node:脚本dom对象\r\n * @param {Object} isRemoveQueryHash\r\n */\r\nfunction getCurrentScript(isRemoveQueryHash = true) {\r\n\tfunction _getCurrentScriptOrSrc() { //兼容获取正在运行的js\r\n\t\t//取得正在解析的script节点\r\n\t\tif(document.currentScript !== undefined) { //firefox 4+\r\n\t\t\tlet node = document.currentScript && document.currentScript.src && document.currentScript;\r\n\t\t\tif(node) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tnode,\r\n\t\t\t\t\tsrc: node.src\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(utils.IE_VERSION > 0 && utils.IE_VERSION <= 10) {\r\n\t\t\tlet nodes = document.getElementsByTagName(\"script\"); //只在head标签中寻找\r\n\t\t\tfor(let i = 0; i < nodes.length; i++) {\r\n\t\t\t\tlet node = nodes[i];\r\n\t\t\t\tif(node.readyState === \"interactive\") {\r\n\t\t\t\t\tif(node.src) {\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\tnode,\r\n\t\t\t\t\t\t\tsrc: node.src\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\tsrc: thePageUrl\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tlet stack;\r\n\t\ttry {\r\n\t\t\tlet a = undefined;\r\n\t\t\ta.b.c(); //强制报错,以便捕获e.stack\r\n\t\t} catch(e) { //safari的错误对象只有line,sourceId,sourceURL\r\n\t\t\tstack = e.stack || e.sourceURL || e.stacktrace || '';\r\n\t\t\tif(!stack && window.opera) {\r\n\t\t\t\t//opera 9没有e.stack,但有e.Backtrace,但不能直接取得,需要对e对象转字符串进行抽取\r\n\t\t\t\tstack = (String(e).match(/of linked script \\S+/g) || []).join(\" \");\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(stack) {\r\n\t\t\t/**e.stack最后一行在所有支持的浏览器大致如下:\r\n\t\t\t *chrome23:\r\n\t\t\t * at http://113.93.50.63/data.js:4:1\r\n\t\t\t *firefox17:\r\n\t\t\t *@http://113.93.50.63/query.js:4\r\n\t\t\t *opera12:\r\n\t\t\t *@http://113.93.50.63/data.js:4\r\n\t\t\t *IE10:\r\n\t\t\t *  at Global code (http://113.93.50.63/data.js:4:1)\r\n\t\t\t */\r\n\t\t\tstack = stack.split(/[@ ]/g).pop(); //取得最后一行,最后一个空格或@之后的部分\r\n\t\t\tstack = stack[0] == \"(\" ? stack.slice(1, -1) : stack;\r\n\t\t\tlet s = stack.replace(/(:\\d+)?:\\d+$/i, \"\"); //去掉行号与或许存在的出错字符起始位置\r\n\t\t\treturn {\r\n\t\t\t\tsrc: s\r\n\t\t\t};\r\n\t\t}\r\n\t}\r\n\r\n\tlet rs = _getCurrentScriptOrSrc();\r\n\tif(!rs) {\r\n\t\trs = {\r\n\t\t\tsrc: thePageUrl\r\n\t\t};\r\n\t}\r\n\r\n\tif(utils.isLoaderEnd() && rs.src == theLoaderUrl) {\r\n\t\trs.src = thePageUrl;\r\n\t\trs.node = null;\r\n\t}\r\n\r\n\tif(!rs.node && rs.src != thePageUrl) {\r\n\t\tlet src = utils.removeQueryHash(rs.src);\r\n\t\tlet nodes = document.getElementsByTagName(\"script\"); //只在head标签中寻找\r\n\t\tfor(let i = 0; i < nodes.length; i++) {\r\n\t\t\tlet node = nodes[i];\r\n\t\t\tif(src == utils.removeQueryHash(node.src)) {\r\n\t\t\t\trs.node = node;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tif(rs.node) {\r\n\t\trs.src = utils.getNodeAbsolutePath(rs.node);\r\n\t}\r\n\tif(isRemoveQueryHash) {\r\n\t\trs.src = utils.removeQueryHash(rs.src);\r\n\t}\r\n\treturn rs;\r\n\r\n}\r\n\r\nfunction __createNode() {\r\n\tlet node = document.createElement('script');\r\n\tnode.type = 'text/javascript';\r\n\tnode.charset = 'utf-8';\r\n\tnode.async = true;\r\n\treturn node;\r\n}\r\n\r\nfunction __removeListener(node, func, name, ieName) {\r\n\tif(node.detachEvent && !isOpera) {\r\n\t\tif(ieName) {\r\n\t\t\tnode.detachEvent(ieName, func);\r\n\t\t}\r\n\t} else {\r\n\t\tnode.removeEventListener(name, func, false);\r\n\t}\r\n}\r\n\r\n/**\r\n * callbackObj.onScriptLoad\r\n * callbackObj.onScriptError\r\n *\r\n */\r\nfunction __browserLoader(moduleName, url, callbackObj) {\r\n\tlet node = __createNode();\r\n\tmoduleName && node.setAttribute(DATA_ATTR_MODULE, moduleName);\r\n\tnode.setAttribute(DATA_ATTR_CONTEXT, defContextName);\r\n\r\n\tlet useAttach = !xsloader.isFunction(node.addEventListener) && node.attachEvent &&\r\n\t\t!(node.attachEvent.toString && node.attachEvent.toString().indexOf('[native code') < 0) &&\r\n\t\t!isOpera;\r\n\r\n\tif(useAttach) {\r\n\t\tnode.attachEvent('onreadystatechange', callbackObj.onScriptLoad);\r\n\t} else {\r\n\t\tnode.addEventListener('load', callbackObj.onScriptLoad, true);\r\n\t\tlet errListen = function() {\r\n\t\t\t__removeListener(node, errListen, 'error');\r\n\t\t\tcallbackObj.onScriptError.apply(this, arguments);\r\n\t\t};\r\n\t\tcallbackObj.errListen = errListen;\r\n\t\tnode.addEventListener('error', errListen, true);\r\n\t}\r\n\tnode.src = url;\r\n\tappendHeadDom(node);\r\n}\r\n\r\nfunction __getScriptData(evt, callbackObj) {\r\n\tlet node = evt.currentTarget || evt.srcElement;\r\n\t__removeListener(node, callbackObj.onScriptLoad, 'load', 'onreadystatechange');\r\n\t__removeListener(node, callbackObj.errListen, 'error');\r\n\treturn {\r\n\t\tnode: node,\r\n\t\tname: node && node.getAttribute(DATA_ATTR_MODULE),\r\n\t\tsrc: utils.removeQueryHash(node && utils.getNodeAbsolutePath(node))\r\n\t};\r\n}\r\n\r\nfunction appendHeadDom(dom) {\r\n\tif(!xsloader.isDOM(dom)) {\r\n\t\tthrow new Error(\"expected dom object,but provided:\" + dom);\r\n\t}\r\n\tlet nextDom = lastAppendHeadDom.nextSibling;\r\n\thead.insertBefore(dom, nextDom);\r\n\t//\t\t\thead.appendChild(dom);\r\n\tlastAppendHeadDom = dom;\r\n}\r\n\r\n/////////////////////////\r\n\r\nfunction loadScript(moduleName, url, onload, onerror) {\r\n\tlet callbackObj = {};\r\n\tcallbackObj.onScriptLoad = function(evt) {\r\n\t\tif(callbackObj.removed) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(evt.type === 'load' || (readyRegExp.test((evt.currentTarget || evt.srcElement).readyState))) {\r\n\t\t\tcallbackObj.removed = true;\r\n\t\t\tlet scriptData = __getScriptData(evt, callbackObj);\r\n\t\t\tif(isSrcFromScriptLoad) {\r\n\t\t\t\tlastScriptSrc = scriptData.src; //已经不含参数\r\n\t\t\t\txsloader.asyncCall(() => {\r\n\t\t\t\t\tonload(scriptData);\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tif(utils.IE_VERSION > 0 || utils.IE_VERSION == \"edge\") { //ie下确保此事件在脚本之后执行。\r\n\t\t\t\t\txsloader.asyncCall(() => {\r\n\t\t\t\t\t\tonload(scriptData);\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\tonload(scriptData);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\tcallbackObj.onScriptError = function(evt) {\r\n\t\tif(callbackObj.removed) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tcallbackObj.removed = true;\r\n\t\tlet scriptData = __getScriptData(evt, callbackObj);\r\n\t\tonerror(scriptData);\r\n\t};\r\n\t__browserLoader(moduleName, url, callbackObj);\r\n}\r\n\r\nfunction doDefine(thiz, args, isRequire) {\r\n\tlet src = getCurrentScript().src; //已经不含参数\r\n\tlet defineObject = new DefineObject(src, thiz, args, isRequire, !isSrcFromScriptLoad);\r\n\tif(!isSrcFromScriptLoad) {\r\n\t\ttry { //防止执行其他脚本\r\n\t\t\tif(defineObject.src) {\r\n\t\t\t\tlet node = document.currentScript;\r\n\t\t\t\tif(node && node.getAttribute(\"src\") && node.getAttribute(DATA_ATTR_CONTEXT) != defContextName &&\r\n\t\t\t\t\tdefineObject.src != theLoaderUrl && defineObject.src != thePageUrl) {\r\n\t\t\t\t\tconsole.error(\"unknown js script module:\" + xsloader.xsJson2String(defineObject.src));\r\n\t\t\t\t\tconsole.error(node);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} catch(e) {\r\n\t\t\txsloader.config().error(e);\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tlet handle = {\r\n\t\tthen(option) {\r\n\t\t\tdefineObject.handle = xsloader.extend(defineObject.handle, option);\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\terror(onError) {\r\n\t\t\tdefineObject.handle.onError = onError;\r\n\t\t\treturn this;\r\n\t\t}\r\n\t};\r\n\r\n\tlet isLoaderEnd = utils.isLoaderEnd();\r\n\txsloader.asyncCall(() => {\r\n\t\tif(isSrcFromScriptLoad && isLoaderEnd) {\r\n\t\t\t//执行顺序：当前脚本define>load事件(获取lastScriptSrc)>当前位置>onload\r\n\t\t\tdefineObject.src = lastScriptSrc;\r\n\t\t\tdefineObject.dealConfigDeps();\r\n\t\t}\r\n\t\ttheRealDefine([defineObject]);\r\n\t});\r\n\treturn handle;\r\n}\r\n\r\nfunction predefine() {\r\n\tlet args = [];\r\n\tfor(let i = 0; i < arguments.length; i++) {\r\n\t\targs.push(arguments[i]);\r\n\t}\r\n\treturn doDefine(this, args, false);\r\n}\r\n\r\nfunction prerequire(deps, callback) {\r\n\r\n\tif(!xsloader.config()) { //require必须是在config之后\r\n\t\tthrow new Error(\"not config\");\r\n\t}\r\n\tlet thatInvoker = getInvoker(this, true);\r\n\tif(arguments.length == 1 && xsloader.isString(deps)) { //获取已经加载的模块\r\n\t\tlet originDeps = deps;\r\n\t\tlet pluginArgs = undefined;\r\n\t\tlet pluginIndex = deps.indexOf(\"!\");\r\n\t\tif(pluginIndex > 0) {\r\n\t\t\tpluginArgs = deps.substring(pluginIndex + 1);\r\n\t\t\tdeps = deps.substring(0, pluginIndex);\r\n\t\t\tif(pluginArgs) {\r\n\t\t\t\tlet argArr = [pluginArgs];\r\n\t\t\t\tutils.replaceModulePrefix(xsloader.config(), argArr); //前缀替换\r\n\t\t\t\tpluginArgs = argArr[0];\r\n\t\t\t}\r\n\t\t}\r\n\t\tlet module = moduleScript.getModule(deps);\r\n\t\tif(!module) {\r\n\t\t\tdeps = thatInvoker.getUrl(deps, false);\r\n\t\t\tmodule = moduleScript.getModule(deps);\r\n\t\t}\r\n\t\tif(!module) {\r\n\t\t\tthrow new Error(\"the module '\" + originDeps + \"' is not load!\");\r\n\t\t} else if(module.state != \"defined\") {\r\n\t\t\tthrow new Error(\"the module '\" + originDeps + \"' is not defined:\" + module.state);\r\n\t\t}\r\n\t\tlet theMod;\r\n\t\tmoduleScript.newModuleInstance(module, thatInvoker, (depModule) => {\r\n\t\t\ttheMod = depModule.moduleObject();\r\n\t\t}, pluginArgs).init(true);\r\n\t\tif(theMod === undefined) {\r\n\t\t\tthrow Error(\"the module '\" + originDeps + \"' is not load!\");\r\n\t\t}\r\n\t\treturn theMod;\r\n\t}\r\n\r\n\tlet selfname = xsloader.randId(\"_require\");\r\n\tif(xsloader.isFunction(deps)) {\r\n\t\tcallback = deps;\r\n\t\tdeps = [];\r\n\t}\r\n\tutils.appendInnerDeps(deps, callback);\r\n\tlet timeid;\r\n\tlet handle = doDefine(this, [selfname, deps, function() {\r\n\t\tif(timeid !== undefined) {\r\n\t\t\tclearTimeout(timeid);\r\n\t\t\ttimeid = undefined;\r\n\t\t}\r\n\t\tif(xsloader.isFunction(callback)) {\r\n\t\t\tcallback.apply(this, arguments);\r\n\t\t}\r\n\t}], true);\r\n\tlet customerErrCallback;\r\n\tlet isErr;\r\n\r\n\thandle.error(function(err, invoker) {\r\n\t\tisErr = err;\r\n\t\tif(timeid !== undefined) {\r\n\t\t\tclearTimeout(timeid);\r\n\t\t\ttimeid = undefined;\r\n\t\t}\r\n\t\tif(customerErrCallback) {\r\n\t\t\tcustomerErrCallback(err, invoker);\r\n\t\t} else {\r\n\t\t\tconsole.warn(\"invoker.url:\" + invoker.getUrl());\r\n\t\t\tconsole.warn(err);\r\n\t\t}\r\n\t});\r\n\thandle.error = function(errCallback) {\r\n\t\tcustomerErrCallback = errCallback;\r\n\t\treturn this;\r\n\t};\r\n\r\n\tlet checkResultFun = function() {\r\n\t\ttimeid = undefined;\r\n\t\tlet ifmodule = moduleScript.getModule(selfname);\r\n\t\tif((!ifmodule || ifmodule.state != 'defined') && !isErr) {\r\n\t\t\tlet module = ifmodule;\r\n\t\t\tif(module) {\r\n\t\t\t\tutils.each(module.deps, function(dep) {\r\n\t\t\t\t\tlet mod = moduleScript.getModule(dep);\r\n\t\t\t\t\tif(mod && mod.printOnNotDefined) {\r\n\t\t\t\t\t\tmod.printOnNotDefined();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\tconsole.error(\"require timeout:[\" + (deps ? deps.join(\",\") : \"\") + \"]\");\r\n\t\t}\r\n\t};\r\n\ttimeid = setTimeout(checkResultFun, xsloader.config().waitSeconds * 1000);\r\n\treturn handle;\r\n}\r\n\r\n//对于safari7-:在脚本加载事件中可获得正确的脚本地址\r\n\r\nconst initDefine = function(theDefine) {\r\n\ttheRealDefine = (defines, loaded) => {\r\n\t\tif(!xsloader.config()) { //还没有配置\r\n\t\t\tglobalDefineQueue.push(defines);\r\n\t\t} else {\r\n\t\t\ttheDefine(defines, loaded);\r\n\t\t}\r\n\t};\r\n\treturn {\r\n\t\tpredefine,\r\n\t\tprerequire,\r\n\t};\r\n};\r\n\r\nconst onConfigedCallback = function() {\r\n\twhile(globalDefineQueue.length) {\r\n\t\tlet defines = globalDefineQueue.shift();\r\n\t\ttheRealDefine(defines);\r\n\t}\r\n};\r\n\r\nexport default {\r\n\tdefContextName,\r\n\ttheLoaderScript,\r\n\ttheLoaderUrl,\r\n\tthePageUrl,\r\n\tappendHeadDom,\r\n\tinitDefine,\r\n\tInvoker,\r\n\tDefineObject,\r\n\tloadScript,\r\n\tcurrentDefineModuleQueue,\r\n\tonConfigedCallback,\r\n\tINNER_DEPS_PLUGIN,\r\n\tinnerDepsMap,\r\n};","import loader from './loader.js';\r\nimport \"../public/index.js\";\r\nimport utils from \"../util/index.js\";\r\n\r\nconst global = utils.global;\r\nconst xsloader = global.xsloader;\r\n\r\nimport script from \"./script.js\";\r\nimport moduleScript from \"./module.js\";\r\n\r\nlet theContext;\r\nlet theConfig;\r\nlet argsObject = {};\r\n\r\nxsloader.config = function() {\r\n\treturn theConfig;\r\n};\r\nxsloader.script = function() {\r\n\treturn script.theLoaderScript;\r\n};\r\nxsloader.scriptSrc = function() {\r\n\treturn script.theLoaderUrl;\r\n};\r\n\r\nxsloader.putUrlArgs = function(argsObj) {\r\n\targsObject = xsloader.extend(argsObject, argsObj);\r\n};\r\n\r\nxsloader.getUrlArgs = function() {\r\n\tlet obj = xsloader.extend({}, argsObject);\r\n\treturn obj;\r\n};\r\n\r\nxsloader.clearUrlArgs = function() {\r\n\targsObject = {};\r\n};\r\n\r\nxsloader.appendHeadDom=script.appendHeadDom;\r\n\r\nxsloader.hasDefine = function(name) {\r\n\tlet has = false;\r\n\tlet module = moduleScript.getModule(name);\r\n\tif(!module || module.state == \"init\") {\r\n\r\n\t} else {\r\n\t\thas = true;\r\n\t}\r\n\treturn has;\r\n};\r\n\r\n//用于把\"group:project:version\"转换成url地址,返回一个String或包含多个url地址的数组\r\nxsloader._resUrlBuilder = function(groupName) {\r\n\tthrow new Error('resUrlBuilder not found!');\r\n};\r\n\r\nxsloader.clear_module_ = function() {\r\n\tlet modules = arguments;\r\n\tfor(let i = 0; i < modules.length; i++) {\r\n\t\tif(modules[i]) {\r\n\t\t\tdelete modules[i]._module_;\r\n\t\t\tdelete modules[i]._modules_;\r\n\t\t}\r\n\t}\r\n};\r\n\r\nfunction _newContext() {\r\n\tlet context = {\r\n\t\tcontextName: script.contextName,\r\n\t\tdefQueue: []\r\n\t};\r\n\treturn context;\r\n}\r\n\r\nloader.loaderFun((option) => {\r\n\tif(theContext) {\r\n\t\tthrow new Error(\"already configed!\");\r\n\t}\r\n\toption = xsloader.extend({\r\n\t\tbaseUrl: utils.getPathWithRelative(location.pathname, \"./\", xsloader.endsWith(location.pathname, \"/\")),\r\n\t\turlArgs: {},\r\n\t\tignoreProperties: false,\r\n\t\tpaths: {},\r\n\t\tdepsPaths: {},\r\n\t\tdeps: {},\r\n\t\tjsExts: undefined,\r\n\t\tproperties: {},\r\n\t\tmodulePrefix: {},\r\n\t\tdefineFunction: {},\r\n\t\tmodulePrefixCount: 0,\r\n\t\twaitSeconds: 10,\r\n\t\tautoUrlArgs() {\r\n\t\t\treturn false;\r\n\t\t},\r\n\t\tinstance: \"single\",\r\n\t\tdealtDeps: {},\r\n\t\tdealProperties(obj) {\r\n\t\t\treturn utils.propertiesDeal(obj, option.properties);\r\n\t\t},\r\n\t\tisInUrls(m) {\r\n\t\t\treturn !!this.getUrls(m);\r\n\t\t},\r\n\t\tgetUrls(m) {\r\n\t\t\treturn this.paths[m] || this.depsPaths[m];\r\n\t\t},\r\n\t\tgetDeps(m) {\r\n\t\t\tlet as = this.dealtDeps[m] || [];\r\n\t\t\tlet deps = [];\r\n\t\t\tlet hasOrderDep = undefined;\r\n\r\n\t\t\tif(as.length > 0 && (as[0] === true || as[0] === false)) {\r\n\t\t\t\tif(as[0]) {\r\n\t\t\t\t\tdeps = [\r\n\t\t\t\t\t\t[]\r\n\t\t\t\t\t];\r\n\t\t\t\t\thasOrderDep = true;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tas.splice(0, 1);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tfor(let i = 0; i < as.length; i++) {\r\n\t\t\t\tif(hasOrderDep === true) {\r\n\t\t\t\t\tdeps[0].push(as[i]);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tdeps.push(as[i]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn deps;\r\n\t\t},\r\n\t\tdealUrl(module, url) {\r\n\t\t\tlet urlArg;\r\n\t\t\tlet nameOrUrl;\r\n\t\t\tif(this.autoUrlArgs()) {\r\n\t\t\t\turlArg = \"_t=\" + new Date().getTime();\r\n\t\t\t} else if(xsloader.isString(module)) {\r\n\t\t\t\turlArg = this.urlArgs[module];\r\n\t\t\t\tif(urlArg) {\r\n\t\t\t\t\tnameOrUrl = module;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tnameOrUrl = module;\r\n\t\t\t\t\turlArg = this.forPrefixSuffix(module);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(!urlArg) {\r\n\t\t\t\t\tnameOrUrl = \"*\";\r\n\t\t\t\t\turlArg = this.urlArgs[\"*\"];\r\n\t\t\t\t}\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\turlArg = this.urlArgs[url];\r\n\t\t\t\tif(urlArg) {\r\n\t\t\t\t\tnameOrUrl = url;\r\n\t\t\t\t} else {\r\n\t\t\t\t\turlArg = this.forPrefixSuffix(url);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(!urlArg) {\r\n\t\t\t\t\tnameOrUrl = module.selfname;\r\n\t\t\t\t\turlArg = this.urlArgs[nameOrUrl];\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(!urlArg) {\r\n\t\t\t\t\tnameOrUrl = module.aurl;\r\n\t\t\t\t\turlArg = this.forPrefixSuffix(nameOrUrl);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(!urlArg) {\r\n\t\t\t\t\tnameOrUrl = \"*\";\r\n\t\t\t\t\turlArg = this.urlArgs[\"*\"];\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\t\t\tif(xsloader.isFunction(urlArg)) {\r\n\t\t\t\turlArg = urlArg.call(this, nameOrUrl);\r\n\t\t\t}\r\n\t\t\tfor(let k in argsObject) { //加入全局的参数\r\n\t\t\t\turlArg += \"&\" + k + \"=\" + encodeURIComponent(argsObject[k]);\r\n\t\t\t}\r\n\t\t\treturn xsloader.appendArgs2Url(url, urlArg);\r\n\t\t},\r\n\t\tdealUrlArgs(url) {\r\n\t\t\turl = utils.getPathWithRelative(location.href, url);\r\n\t\t\treturn this.dealUrl(url, url);\r\n\t\t},\r\n\t\tdefaultVersion: {}\r\n\t}, option);\r\n\r\n\tif(!xsloader.endsWith(option.baseUrl, \"/\")) {\r\n\t\toption.baseUrl += \"/\";\r\n\t}\r\n\toption.baseUrl = utils.getPathWithRelative(location.href, option.baseUrl);\r\n\r\n\tif(!option.ignoreProperties) {\r\n\t\toption = option.dealProperties(option);\r\n\t}\r\n\r\n\tutils.strValue2Arr(option.paths);\r\n\tutils.strValue2Arr(option.depsPaths);\r\n\tutils.strValue2Arr(option.deps);\r\n\r\n\tif(!xsloader.isFunction(option.autoUrlArgs)) {\r\n\t\tlet isAutoUrlArgs = option.autoUrlArgs;\r\n\t\toption.autoUrlArgs = function() {\r\n\t\t\treturn isAutoUrlArgs;\r\n\t\t};\r\n\t}\r\n\r\n\tlet modulePrefixCount = 0;\r\n\tfor(let prefix in option.modulePrefix) {\r\n\t\tif(xsloader.startsWith(prefix, \".\") || xsloader.startsWith(prefix, \"/\")) {\r\n\t\t\tthrow new Error(\"modulePrefix can not start with '.' or '/'(\" + prefix + \")\");\r\n\t\t}\r\n\t\tmodulePrefixCount++;\r\n\t}\r\n\toption.modulePrefixCount = modulePrefixCount;\r\n\tif(modulePrefixCount > 0) {\r\n\t\t//替换urlArgs中地址前缀\r\n\t\tlet star = option.urlArgs[\"*\"];\r\n\t\tdelete option.urlArgs[\"*\"];\r\n\r\n\t\tlet urlArgsArr = [];\r\n\t\tfor(let k in option.urlArgs) {\r\n\t\t\tlet url = k;\r\n\t\t\tif(utils.isJsFile(url)) { //处理相对\r\n\t\t\t\tif(xsloader.startsWith(url, \".\") || xsloader.startsWith(url, \"/\") && !xsloader.startsWith(url, \"//\")) {\r\n\t\t\t\t\turl = utils.getPathWithRelative(script.theLoaderUrl, url);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tlet absolute = utils.dealPathMayAbsolute(url);\r\n\t\t\t\t\tif(absolute.absolute) {\r\n\t\t\t\t\t\turl = absolute.path;\r\n\t\t\t\t\t} else if(!xsloader.startsWith(url, \"*]\")) { //排除*]；单*[可以有前缀\r\n\t\t\t\t\t\turl = option.baseUrl + url;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\t\t\turlArgsArr.push({\r\n\t\t\t\turl: url,\r\n\t\t\t\targs: option.urlArgs[k]\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tfor(let prefix in option.modulePrefix) {\r\n\t\t\tlet replaceStr = option.modulePrefix[prefix].replace;\r\n\t\t\tfor(let i = 0; i < urlArgsArr.length; i++) {\r\n\t\t\t\tlet urlArgObj = urlArgsArr[i];\r\n\t\t\t\tlet starP = \"\";\r\n\t\t\t\tif(xsloader.startsWith(urlArgObj.url, \"*[\")) {\r\n\t\t\t\t\tstarP = \"*[\";\r\n\t\t\t\t\turlArgObj.url = urlArgObj.url.substring(2);\r\n\t\t\t\t}\r\n\t\t\t\tif(xsloader.startsWith(urlArgObj.url, prefix)) {\r\n\t\t\t\t\turlArgObj.url = replaceStr + urlArgObj.url.substring(prefix.length);\r\n\t\t\t\t}\r\n\t\t\t\tstarP && (urlArgObj.url = starP + urlArgObj.url);\r\n\t\t\t}\r\n\t\t}\r\n\t\toption.urlArgs = {};\r\n\t\toption.urlArgs[\"*\"] = star;\r\n\t\tfor(let i = 0; i < urlArgsArr.length; i++) {\r\n\t\t\tlet urlArgObj = urlArgsArr[i];\r\n\t\t\toption.urlArgs[urlArgObj.url] = urlArgObj.args;\r\n\t\t}\r\n\t}\r\n\r\n\t//预处理urlArgs中的*[与*]\r\n\tlet _urlArgs_prefix = [];\r\n\tlet _urlArgs_suffix = [];\r\n\toption._urlArgs_prefix = _urlArgs_prefix;\r\n\toption._urlArgs_suffix = _urlArgs_suffix;\r\n\r\n\tfor(let k in option.urlArgs) {\r\n\t\tlet url = k;\r\n\t\tif(xsloader.startsWith(url, \"*[\")) {\r\n\t\t\tlet strfix = url.substring(2);\r\n\t\t\tif(xsloader.startsWith(strfix, \".\") || xsloader.startsWith(strfix, \"/\") && !xsloader.startsWith(strfix, \"//\")) {\r\n\t\t\t\tstrfix = utils.getPathWithRelative(script.theLoaderUrl, strfix);\r\n\t\t\t} else {\r\n\t\t\t\tlet absolute = utils.dealPathMayAbsolute(strfix);\r\n\t\t\t\tif(absolute.absolute) {\r\n\t\t\t\t\tstrfix = absolute.path;\r\n\t\t\t\t} else {\r\n\t\t\t\t\turl = option.baseUrl + url;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t_urlArgs_prefix.push({\r\n\t\t\t\tstrfix: strfix,\r\n\t\t\t\tvalue: option.urlArgs[k]\r\n\t\t\t});\r\n\t\t\tdelete option.urlArgs[k];\r\n\t\t} else if(xsloader.startsWith(url, \"*]\")) {\r\n\t\t\t_urlArgs_suffix.push({\r\n\t\t\t\tstrfix: url.substring(2),\r\n\t\t\t\tvalue: option.urlArgs[k]\r\n\t\t\t});\r\n\t\t\tdelete option.urlArgs[k];\r\n\t\t}\r\n\t}\r\n\r\n\toption.forPrefixSuffix = function(urlOrName) {\r\n\t\t//前缀判断\r\n\t\tfor(let i = 0; i < _urlArgs_prefix.length; i++) {\r\n\t\t\tlet strfixObj = _urlArgs_prefix[i];\r\n\t\t\tif(xsloader.startsWith(urlOrName, strfixObj.strfix)) {\r\n\t\t\t\tlet value;\r\n\t\t\t\tif(xsloader.isFunction(strfixObj.value)) {\r\n\t\t\t\t\tvalue = strfixObj.value.call(this, urlOrName);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvalue = strfixObj.value;\r\n\t\t\t\t}\r\n\t\t\t\treturn value;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//后缀判断\r\n\t\tfor(let i = 0; i < _urlArgs_suffix.length; i++) {\r\n\t\t\tlet strfixObj = _urlArgs_suffix[i];\r\n\t\t\tif(xsloader.endsWith(urlOrName, strfixObj.strfix)) {\r\n\t\t\t\tlet value;\r\n\t\t\t\tif(xsloader.isFunction(strfixObj.value)) {\r\n\t\t\t\t\tvalue = strfixObj.value.call(this, urlOrName);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvalue = strfixObj.value;\r\n\t\t\t\t}\r\n\t\t\t\treturn value;\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tfor(let name in option.paths) {\r\n\t\tutils.replaceModulePrefix(option, option.paths[name]); //前缀替换\r\n\t}\r\n\tfor(let name in option.depsPaths) {\r\n\t\tutils.replaceModulePrefix(option, option.depsPaths[name]); //前缀替换\r\n\t}\r\n\r\n\t//处理依赖\r\n\tlet dealtDeps = option.dealtDeps;\r\n\r\n\tlet pushDeps = (dealtDepArray, depsArray) => {\r\n\t\tutils.each(depsArray, (dep) => {\r\n\t\t\tdealtDepArray.push(dep);\r\n\t\t});\r\n\t};\r\n\r\n\tfor(let keyName in option.deps) {\r\n\t\tlet paths = keyName.split('::');\r\n\t\tlet depsArray = option.deps[keyName];\r\n\t\tutils.each(paths, (path) => {\r\n\t\t\tif(path == '*') {\r\n\t\t\t\tfor(let m in option.depsPaths) {\r\n\t\t\t\t\tlet dealtDepArray = dealtDeps[m] = dealtDeps[m] || [];\r\n\t\t\t\t\tpushDeps(dealtDepArray, depsArray);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tlet dealtDepArray = (dealtDeps[path] = dealtDeps[path] || []);\r\n\t\t\t\tpushDeps(dealtDepArray, depsArray);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\ttheConfig = option;\r\n\ttheContext = _newContext();\r\n\tscript.onConfigedCallback(); //完成配置回调\r\n\treturn theConfig;\r\n});","import utils from \"./util/index.js\";\r\nimport script from \"./core/script.js\";\r\nimport moduleScript from \"./core/module.js\";\r\n\r\nconst global = utils.global;\r\nconst xsloader = global.xsloader;\r\n\r\nconst defineHandle = script.initDefine(function theRealDefine(defines, loaded = () => {}) {\r\n\tutils.each(defines, (defineObject) => {\r\n\t\tif(xsloader.isFunction(defineObject.callback)) {\r\n\t\t\tlet originCallback = defineObject.callback;\r\n\t\t\tdefineObject.callback = function() {\r\n\t\t\t\tlet config = xsloader.config();\r\n\t\t\t\tlet rt;\r\n\r\n\t\t\t\tlet defineFun;\r\n\t\t\t\tutils.each(defineObject.names, (name) => {\r\n\t\t\t\t\tlet fun = config.defineFunction[name];\r\n\t\t\t\t\tif(xsloader.isFunction(fun)) {\r\n\t\t\t\t\t\tdefineFun = fun;\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\tif(defineFun) {\r\n\t\t\t\t\tlet args = [];\r\n\t\t\t\t\tfor(let i = 0; i < arguments.length; i++) {\r\n\t\t\t\t\t\targs.push(arguments[i]);\r\n\t\t\t\t\t}\r\n\t\t\t\t\trt = defineFun.apply(this, [originCallback, this, args]);\r\n\t\t\t\t} else {\r\n\t\t\t\t\trt = originCallback.apply(this, arguments);\r\n\t\t\t\t}\r\n\r\n\t\t\t\toriginCallback = null;\r\n\t\t\t\treturn rt;\r\n\t\t\t};\r\n\t\t\tdefineObject.callback.originCallback = originCallback;\r\n\t\t}\r\n\t\tonModuleLoaded(defineObject, moduleScript.getLastDefineObject(defineObject.src));\r\n\t\tloaded();\r\n\t});\r\n});\r\n\r\n/**\r\n * 当前模块脚本已经完成加载、但其依赖的模块可能需要加载。\r\n * 当前模块：src、selfname已经确定。\r\n * 若当前模块依赖为0、则可以直接finish；若当前模块存在其他依赖、则设置回调，等待被其他地方依赖时再触发。\r\n * @param {Object} defineObject 当前模块\r\n * @param {Object} lastDefineObject 第一次加载当前模块的模块\r\n */\r\nfunction onModuleLoaded(defineObject, lastDefineObject) {\r\n\r\n\t//先根据src获取模块\r\n\tlet ifmodule = moduleScript.getModule(defineObject.src, defineObject.selfname);\r\n\tif(ifmodule) {\r\n\t\tif(ifmodule.state == \"loading\") {\r\n\t\t\tifmodule.reinitByDefineObject(defineObject);\r\n\t\t}\r\n\t} else {\r\n\t\tifmodule = moduleScript.newModule(defineObject);\r\n\t}\r\n\r\n\tlet names = []; //[defineObject.src];\r\n\tif(defineObject.selfname && defineObject.selfname != defineObject.src) {\r\n\t\tnames.push(defineObject.selfname);\r\n\t}\r\n\r\n\tif(ifmodule.selfname && ifmodule.selfname != defineObject.selfname && ifmodule.selfname != defineObject.src) {\r\n\t\t//此处的名字可能由配置指定\r\n\t\tnames.push(ifmodule.selfname);\r\n\t}\r\n\tdefineObject.names = names; //一个模块的所有名字，包括src\r\n\tutils.each(names, (name) => {\r\n\t\tmoduleScript.setModule(name, ifmodule);\r\n\t\tif(xsloader._ignoreAspect_[name]) {\r\n\t\t\tifmodule.ignoreAspect = true;\r\n\t\t}\r\n\t});\r\n\r\n\tlet module = ifmodule;\r\n\r\n\tif(defineObject.handle.before) {\r\n\t\tdefineObject.handle.before(module.deps);\r\n\t}\r\n\tif(lastDefineObject && lastDefineObject.handle.depBefore) {\r\n\t\tlastDefineObject.handle.depBefore(lastDefineObject.index, module.selfname, module.deps, 2);\r\n\t}\r\n\r\n\tmodule.setState(\"loaded\");\r\n\tmodule.setInstanceType(defineObject.handle.instance || xsloader.config().instance);\r\n\r\n\tif(module.deps.length == 0) {\r\n\t\tmodule.finish([]); //递归结束\r\n\t} else {\r\n\t\t//在其他模块依赖此模块时进行加载\r\n\t\tlet needCallback = function() {\r\n\t\t\tmoduleScript.everyRequired(defineObject, module, (depModules) => {\r\n\t\t\t\tlet args = [];\r\n\t\t\t\tlet depModuleArgs = [];\r\n\t\t\t\tutils.each(depModules, (depModule) => {\r\n\t\t\t\t\tdepModuleArgs.push(depModule);\r\n\t\t\t\t\targs.push(depModule && depModule.moduleObject());\r\n\t\t\t\t});\r\n\t\t\t\targs.push(depModuleArgs);\r\n\t\t\t\tmodule.finish(args);\r\n\t\t\t}, (err, invoker) => {\r\n\t\t\t\tdefineObject.handle.onError(err, invoker);\r\n\t\t\t});\r\n\t\t};\r\n\r\n\t\tif(defineObject.isRequire) {\r\n\t\t\tneedCallback();\r\n\t\t} else {\r\n\t\t\tmodule.whenNeed(needCallback);\r\n\t\t}\r\n\t}\r\n\r\n}\r\n\r\n//定义模块\r\nconst define = function() {\r\n\treturn defineHandle.predefine.apply(this, arguments);\r\n};\r\n\r\nconst require = function() {\r\n\treturn defineHandle.prerequire.apply(this, arguments);\r\n};\r\n\r\nrequire.has = function() {\r\n\tvar args = arguments;\r\n\tif(args.length == 0) {\r\n\t\treturn false;\r\n\t}\r\n\tfor(var i = 0; i < args.length; i++) {\r\n\t\tvar module = moduleScript.getModule(args[i]);\r\n\t\tif(!module || module.state != \"defined\") {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\treturn true;\r\n};\r\n\r\nxsloader.define = define;\r\nxsloader.defineAsync = define;\r\nxsloader.require = require;\r\nglobal.define = define;\r\nglobal.require = require;\r\n\r\ndefine.amd = true;\r\ndefine(\"exports\", function() {});","import script from \"../script.js\";\r\nimport utils from \"../../util/index.js\";\r\nconst global = utils.global;\r\nconst xsloader = global.xsloader;\r\n\r\n//内部依赖加载插件\r\n\r\nxsloader.define(script.INNER_DEPS_PLUGIN, {\r\n\tpluginMain(depId, onload, onerror, config) {\r\n\t\tlet depsObj = script.innerDepsMap[depId];\r\n\t\tlet deps = depsObj.deps;\r\n\t\t//delete innerDepsMap[depId];\r\n\t\tthis.invoker().require(deps, function() {\r\n\t\t\tlet args = [];\r\n\t\t\tfor(let k = 0; k < arguments.length; k++) {\r\n\t\t\t\targs.push(arguments[k]);\r\n\t\t\t}\r\n\t\t\tonload(args);\r\n\t\t}).then({\r\n\t\t\torderDep: depsObj.orderDep,\r\n\t\t\terror(err, invoker) {\r\n\t\t\t\tonerror(new utils.PluginError(err, invoker));\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\tgetCacheKey(depId) {\r\n\t\treturn depId;\r\n\t}\r\n});","import utils from \"../../util/index.js\";\nconst global = utils.global;\nconst xsloader = global.xsloader;\n\nxsloader.define(\"ready\", {\n\tpluginMain(depId, onload, onerror, config) {\n\t\txsloader.onReady(function() {\n\t\t\tonload();\n\t\t});\n\t}\n});","import utils from \"../../util/index.js\";\nconst global = utils.global;\nconst xsloader = global.xsloader;\n\nxsloader.define(\"nodeps\", {\n\tisSingle: true,\n\tpluginMain(arg, onload, onerror, config) {\n\t\tthis.invoker().require([arg], function(mod, depModuleArgs) {\n\t\t\tonload(mod);\n\t\t}).then({\n\t\t\tdepBefore(index, dep, depDeps) {\n\t\t\t\tdepDeps.splice(0, depDeps.length);\n\t\t\t}\n\t\t}).error(function(e) {\n\t\t\tonerror(e);\n\t\t});\n\t}\n});","import moduleScript from \"../module.js\";\nimport utils from \"../../util/index.js\";\nconst global = utils.global;\nconst xsloader = global.xsloader;\n\nxsloader.define(\"exists\", {\n\tisSingle: true,\n\tpluginMain(arg, onload, onerror, config) {\n\t\tlet vars = arg.split(\"|\");\n\t\tfor(let i = 0; i < vars.length; i++) {\n\t\t\tvars[i] = vars[i].trim();\n\t\t}\n\t\tif(vars.length == 0) {\n\t\t\tonerror(\"args error for exists!\");\n\t\t} else {\n\t\t\tlet moduleName = vars[0];\n\t\t\tlet module = moduleScript.getModule(moduleName);\n\t\t\tif(module) {\n\t\t\t\tthis.invoker().require([moduleName], function(mod, depModuleArgs) {\n\t\t\t\t\tonload(mod);\n\t\t\t\t}).error(function(e) {\n\t\t\t\t\tonerror(e);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tlet obj = undefined;\n\t\t\t\tfor(let i = 1; i < vars.length; i++) {\n\t\t\t\t\tif(window[vars[i]]) {\n\t\t\t\t\t\tobj = window[vars[i]];\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif(obj === undefined) {\n\t\t\t\t\tonerror(\"not found:\" + arg);\n\t\t\t\t} else {\n\t\t\t\t\tonload(obj);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n});","import moduleScript from \"../module.js\";\nimport utils from \"../../util/index.js\";\nconst global = utils.global;\nconst xsloader = global.xsloader;\n\n/**\n * 格式:name!moduleName=>>modulePath\n */\n\nxsloader.define(\"name\", {\n\tisSingle: true,\n\tpluginMain(arg, onload, onerror, config) {\n\t\tlet index = arg.indexOf(\"=>>\");\n\t\tif(index == -1) {\n\t\t\tonerror(\"expected:=>>\");\n\t\t\treturn;\n\t\t}\n\t\tlet moduleName = arg.substring(0, index);\n\t\tmoduleName = moduleName.replace(/，/g, ',');\n\t\tlet names = moduleName.split(\",\");\n\t\tlet dep = arg.substring(index + 3);\n\t\tthis.invoker().require([dep], function(mod, depModuleArgs) {\n\t\t\tlet existsMods = [];\n\t\t\tfor(let i = 0; i < names.length; i++) {\n\t\t\t\tlet newName = names[i];\n\t\t\t\tlet lastM = moduleScript.getModule(newName);\n\t\t\t\tif(lastM && lastM.state != \"init\") {\n\t\t\t\t\texistsMods.push(newName);\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tlet module = depModuleArgs[0].module;\n\t\t\t\tif(lastM) {\n\t\t\t\t\tlastM.toOtherModule(module);\n\t\t\t\t} else {\n\t\t\t\t\tmoduleScript.setModule(newName, module);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif(existsMods.length) {\n\t\t\t\tconsole.warn(\"already exists:\", existsMods.join(','));\n\t\t\t}\n\t\t\tonload(mod);\n\t\t}).error(function(e) {\n\t\t\tonerror(e);\n\t\t});\n\t}\n});","import utils from \"../../util/index.js\";\nconst global = utils.global;\nconst xsloader = global.xsloader;\n\n/*\n * Require-CSS RequireJS css! loader plugin\n * 0.1.8\n * Guy Bedford 2014\n * MIT\n */\nxsloader.define(\"css\", function() {\n\tif(typeof window == 'undefined')\n\t\treturn {\n\t\t\tload: function(n, r, load) {\n\t\t\t\tload();\n\t\t\t}\n\t\t};\n\tlet engine = window.navigator.userAgent.match(/Trident\\/([^ ;]*)|AppleWebKit\\/([^ ;]*)|Opera\\/([^ ;]*)|rv\\:([^ ;]*)(.*?)Gecko\\/([^ ;]*)|MSIE\\s([^ ;]*)|AndroidWebKit\\/([^ ;]*)/) || 0;\n\tlet useImportLoad = false;\n\tlet useOnload = true;\n\tif(engine[1] || engine[7])\n\t\tuseImportLoad = parseInt(engine[1]) < 6 || parseInt(engine[7]) <= 9;\n\telse if(engine[2] || engine[8] || 'WebkitAppearance' in document.documentElement.style)\n\t\tuseOnload = false;\n\telse if(engine[4])\n\t\tuseImportLoad = parseInt(engine[4]) < 18;\n\tlet cssAPI = {};\n\tlet curStyle, curSheet;\n\tlet createStyle = function() {\n\t\tcurStyle = document.createElement('style');\n\t\txsloader.appendHeadDom(curStyle);\n\t\tcurSheet = curStyle.styleSheet || curStyle.sheet;\n\t};\n\tlet ieCnt = 0;\n\tlet ieLoads = [];\n\tlet ieCurCallback;\n\tlet createIeLoad = function(url) {\n\t\tcurSheet.addImport(url);\n\t\tcurStyle.onload = function() {\n\t\t\tprocessIeLoad();\n\t\t};\n\n\t\tieCnt++;\n\t\tif(ieCnt == 31) {\n\t\t\tcreateStyle();\n\t\t\tieCnt = 0;\n\t\t}\n\t};\n\tlet processIeLoad = function() {\n\t\tieCurCallback();\n\t\tlet nextLoad = ieLoads.shift();\n\t\tif(!nextLoad) {\n\t\t\tieCurCallback = null;\n\t\t\treturn;\n\t\t}\n\t\tieCurCallback = nextLoad[1];\n\t\tcreateIeLoad(nextLoad[0]);\n\t};\n\tlet importLoad = function(url, callback) {\n\t\tcallback = callback || function() {};\n\t\tif(!curSheet || !curSheet.addImport)\n\t\t\tcreateStyle();\n\n\t\tif(curSheet && curSheet.addImport) {\n\t\t\tif(ieCurCallback) {\n\t\t\t\tieLoads.push([url, callback]);\n\t\t\t} else {\n\t\t\t\tcreateIeLoad(url);\n\t\t\t\tieCurCallback = callback;\n\t\t\t}\n\t\t} else {\n\t\t\tcurStyle.textContent = '@import \"' + url + '\";';\n\t\t\tlet loadInterval = setInterval(function() {\n\t\t\t\ttry {\n\t\t\t\t\tcurStyle.sheet.cssRules;\n\t\t\t\t\tclearInterval(loadInterval);\n\t\t\t\t\tcallback();\n\t\t\t\t} catch(e) {\n\t\t\t\t\tconsole.warn(e);\n\t\t\t\t}\n\t\t\t}, 10);\n\t\t}\n\t};\n\tlet linkLoad = function(url, callback) {\n\t\tcallback = callback || function() {};\n\t\tlet link = document.createElement('link');\n\t\tlink.type = 'text/css';\n\t\tlink.rel = 'stylesheet';\n\t\tif(useOnload)\n\t\t\tlink.onload = function() {\n\t\t\t\tlink.onload = function() {};\n\t\t\t\tsetTimeout(callback, 7);\n\t\t\t};\n\t\telse {\n\t\t\tlet loadInterval = setInterval(function() {\n\t\t\t\tfor(let i = 0; i < document.styleSheets.length; i++) {\n\t\t\t\t\tlet sheet = document.styleSheets[i];\n\t\t\t\t\tif(sheet.href == link.href) {\n\t\t\t\t\t\tclearInterval(loadInterval);\n\t\t\t\t\t\treturn callback();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}, 10);\n\t\t}\n\t\tlink.href = url;\n\t\txsloader.appendHeadDom(link);\n\t};\n\tcssAPI.pluginMain = function(cssId, onload, onerror, config) {\n\t\t//\t\t\tif(cssId.indexOf(\".css\") != cssId.length - 4) {\n\t\t//\t\t\t\tcssId += \".css\";\n\t\t//\t\t\t}\n\t\t(useImportLoad ? importLoad : linkLoad)(this.invoker().getUrl(cssId, true), onload);\n\t};\n\tcssAPI.getCacheKey = function(cssId) {\n\t\t//\t\t\tif(cssId.indexOf(\".css\") != cssId.length - 4) {\n\t\t//\t\t\t\tcssId += \".css\";\n\t\t//\t\t\t}\n\t\tlet invoker = this.invoker();\n\t\treturn invoker ? invoker.getUrl(cssId, true) : cssId;\n\t};\n\tcssAPI.loadCss = function(cssPath, callback) {\n\t\t(useImportLoad ? importLoad : linkLoad)(xsloader.getUrl(cssPath), callback);\n\t};\n\n\tcssAPI.loadCsses = function() {\n\t\tlet args = arguments;\n\t\tfor(let i = 0; i < args.length; i++) {\n\t\t\t(useImportLoad ? importLoad : linkLoad)(xsloader.getUrl(args[i]), null);\n\t\t}\n\t};\n\treturn cssAPI;\n});","import utils from \"../../util/index.js\";\nconst global = utils.global;\nconst xsloader = global.xsloader;\n\nxsloader.define(\"text\", [\"xshttp\"], {\n\tisSingle: true,\n\tpluginMain(name, onload, onerror, config, http) {\n\t\tlet url = this.invoker().getUrl(name, true);\n\t\thttp().url(url)\n\t\t\t.handleAs(\"text\")\n\t\t\t.ok(function(text) {\n\t\t\t\tonload(text);\n\t\t\t})\n\t\t\t.fail(function(err) {\n\t\t\t\tonerror(err);\n\t\t\t})\n\t\t\t.done();\n\t}\n});","import utils from \"../../util/index.js\";\nconst global = utils.global;\nconst xsloader = global.xsloader;\n/**\n * 格式：window!varNameInWindow=>>modulePath\n */\n//window插件,用于添加模块到window对象中\nxsloader.define(\"window\", {\n\tisSingle: true,\n\tpluginMain: function(arg, onload, onerror, config, http) {\n\t\tlet index = arg.indexOf(\"=>>\");\n\t\tif(index == -1) {\n\t\t\tonerror(\"expected:=>>\");\n\t\t\treturn;\n\t\t}\n\t\tlet moduleName = arg.substring(0, index);\n\t\tlet dep = arg.substring(index + 3);\n\t\tthis.invoker().require([dep], function(mod, depModuleArgs) {\n\t\t\twindow[moduleName] = mod;\n\t\t\tonload(mod);\n\t\t});\n\t}\n});","import utils from \"../../util/index.js\";\nconst global = utils.global;\nconst xsloader = global.xsloader;\n/**\n * 格式:withdeps!modulePath=>>[deps]\n */\nxsloader.define(\"withdeps\", {\n\tpluginMain(arg, onload, onerror, config) {\n\t\tlet index = arg.indexOf(\"=>>\");\n\t\tif(index == -1) {\n\t\t\tonerror(\"expected:=>>\");\n\t\t\treturn;\n\t\t}\n\t\tlet moduleName = arg.substring(0, index);\n\t\tlet depsStr = arg.substring(index + 3);\n\t\tlet deps;\n\t\ttry {\n\t\t\tdeps = xsloader.xsParseJson(depsStr);\n\t\t\tif(!xsloader.isArray(deps)) {\n\t\t\t\tonerror(\"deps is not Array:\" + depsStr);\n\t\t\t\treturn;\n\t\t\t}\n\t\t} catch(e) {\n\t\t\tonerror(\"deps error:\" + depsStr);\n\t\t\treturn;\n\t\t}\n\t\tthis.invoker().require([\n\t\t\t[false].concat(deps), moduleName\n\t\t], function(_deps, mod, depModuleArgs) {\n\t\t\tonload(mod);\n\t\t}).then({\n\t\t\torderDep: true\n\t\t});\n\t}\n});","import utils from \"../../util/index.js\";\nconst global = utils.global;\nconst xsloader = global.xsloader;\n\n/**\n * 加载json对象\n */\nxsloader.define(\"json\", [\"xshttp\"], {\n\tisSingle: true,\n\tpluginMain(name, onload, onerror, config, http) {\n\t\tlet url = this.invoker().getUrl(name, true);\n\t\thttp().url(url)\n\t\t\t.handleAs(\"json\")\n\t\t\t.ok(function(json) {\n\t\t\t\tonload(json);\n\t\t\t})\n\t\t\t.fail(function(err) {\n\t\t\t\tonerror(err);\n\t\t\t})\n\t\t\t.done();\n\t}\n});","import utils from \"../../util/index.js\";\nconst global = utils.global;\nconst xsloader = global.xsloader;\n\nlet progIds = ['Msxml2.XMLHTTP', 'Microsoft.XMLHTTP', 'Msxml2.XMLHTTP.4.0'];\n/**\n * option._beforeOpenHook\n * option._onOkResponseHook\n * option._onFailResponseHook\n * \n * @param {Object} option\n */\nfunction httpRequest(option) {\n\tif(!option) {\n\t\toption = {};\n\t}\n\n\tfunction prop(obj, varName, defaultVal) {\n\t\tif(obj[varName] === undefined) {\n\t\t\treturn defaultVal;\n\t\t} else {\n\t\t\treturn obj[varName];\n\t\t}\n\t}\n\n\tfunction putProp(obj, varName, toObj) {\n\t\tif(obj[varName]) {\n\t\t\tfor(let x in obj[varName]) {\n\t\t\t\tlet value = obj[varName][x];\n\t\t\t\tif(value === null || value === undefined) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\ttoObj[x] = value;\n\t\t\t}\n\t\t}\n\t}\n\tlet _url = prop(option, \"url\", \"\"),\n\t\t_method = prop(option, \"method\", \"GET\"),\n\t\t_params = {},\n\t\t_headers = {\n\t\t\t\"X-Requested-With\": \"XMLHttpRequest\"\n\t\t},\n\t\t_async = prop(option, \"async\", true),\n\t\t_multiPart = prop(option, \"multiPart\", false),\n\t\t_handleType = prop(option, \"handleType\", \"json\");\n\tlet _timeout = option.timeout;\n\tputProp(option, \"params\", _params);\n\tputProp(option, \"headers\", _headers);\n\n\tlet okCallback = option.ok;\n\tlet failCallback = option.fail;\n\tlet uploadStartCallback = option.uploadStart;\n\tlet uploadProgressCallback = option.uploadProgress;\n\tlet uploadOkCallback = option.uploadOk;\n\tlet uploadErrorCallback = option.uploadError;\n\tlet uploadEndCallback = option.uploadEnd;\n\n\tlet _beforeOpenHook = option._beforeOpenHook || httpRequest._beforeOpenHook;\n\tlet _onOkResponseHook = option._onOkResponseHook || httpRequest._onOkResponseHook;\n\tlet _onFailResponseHook = option._onFailResponseHook || httpRequest._onFailResponseHook;\n\n\tfunction createXhr() {\n\t\tlet xhr, i, progId;\n\t\tif(typeof XMLHttpRequest !== \"undefined\") {\n\t\t\treturn new XMLHttpRequest();\n\t\t} else if(typeof ActiveXObject !== \"undefined\") {\n\t\t\tfor(i = 0; i < 3; i += 1) {\n\t\t\t\tprogId = progIds[i];\n\t\t\t\ttry {\n\t\t\t\t\txhr = new ActiveXObject(progId);\n\t\t\t\t} catch(e) {\n\t\t\t\t\tconsole.warn(e);\n\t\t\t\t}\n\n\t\t\t\tif(xhr) {\n\t\t\t\t\tprogIds = [progId];\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn xhr;\n\t}\n\n\tfunction conn() {\n\t\t_conn(createXhr());\n\t}\n\n\tfunction _conn(xhr) {\n\t\tlet option = {\n\t\t\turl: _url,\n\t\t\tmethod: _method.toUpperCase(),\n\t\t\tparams: _params,\n\t\t\theaders: _headers,\n\t\t\thandleType: _handleType,\n\t\t\tasync: _async,\n\t\t\tmultiPart: _multiPart,\n\t\t\ttimeout: _timeout\n\t\t};\n\t\t_beforeOpenHook(option, function() {\n\t\t\t_connAfterOpenHook(option, xhr);\n\t\t}, xhr);\n\t}\n\n\tfunction _doOnFailResponseHook(option, xhr, err, extraErr) {\n\t\t_onFailResponseHook(option, function(result) {\n\t\t\tif(result !== false && result !== undefined) {\n\t\t\t\tif(typeof okCallback == \"function\") {\n\t\t\t\t\tokCallback(result, xhr);\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t} else if(typeof failCallback == \"function\") {\n\t\t\t\tfailCallback(err);\n\t\t\t} else {\n\t\t\t\tconsole.error(err);\n\t\t\t}\n\t\t}, xhr, extraErr);\n\t}\n\n\tfunction _connAfterOpenHook(option, xhr) {\n\t\tlet body;\n\t\tif(option.multiPart) {\n\t\t\tlet formData = new FormData();\n\t\t\tfor(let x in option.params) {\n\t\t\t\tlet value = option.params[x];\n\t\t\t\tif(xsloader.isArray(value)) {\n\t\t\t\t\tformData.append(x, xsloader.xsJson2String(value));\n\t\t\t\t} else {\n\t\t\t\t\tformData.append(x, value);\n\t\t\t\t}\n\n\t\t\t}\n\t\t\tbody = formData;\n\t\t} else {\n\t\t\tbody = \"\";\n\t\t\tfor(let x in option.params) {\n\t\t\t\tlet value = option.params[x];\n\t\t\t\tif(value === null || value === undefined) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tif(typeof value == \"object\") {\n\t\t\t\t\tvalue = xsloader.xsJson2String(value);\n\t\t\t\t}\n\t\t\t\tbody += \"&\" + encodeURIComponent(x) + \"=\" + encodeURIComponent(value);\n\t\t\t}\n\t\t\tif(!(option.method == \"POST\" || option.method == \"PUT\")) {\n\t\t\t\tif(option.url.lastIndexOf(\"?\") < 0 && body.length > 0) {\n\t\t\t\t\toption.url += \"?\";\n\t\t\t\t}\n\t\t\t\toption.url += body;\n\t\t\t\toption.url = option.url.replace(\"?&\", \"?\");\n\t\t\t\tbody = null;\n\t\t\t}\n\t\t}\n\n\t\txhr.open(option.method, option.url, option.async);\n\t\tif((option.method == \"POST\" || option.method == \"PUT\") && !option.multiPart && !option.headers.hasOwnProperty(\"Content-Type\")) {\n\n\t\t\txhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded;charset=utf-8');\n\t\t}\n\t\tfor(let header in option.headers) {\n\t\t\txhr.setRequestHeader(header, option.headers[header]);\n\t\t}\n\n\t\tif(typeof uploadStartCallback == \"function\") {\n\t\t\txhr.upload.onloadstart = uploadStartCallback;\n\t\t}\n\n\t\tif(typeof uploadProgressCallback == \"function\") {\n\t\t\txhr.upload.onprogress = uploadProgressCallback;\n\t\t}\n\n\t\tif(typeof uploadOkCallback == \"function\") {\n\t\t\txhr.upload.onload = uploadOkCallback;\n\t\t}\n\n\t\tif(typeof uploadErrorCallback == \"function\") {\n\t\t\txhr.upload.onerror = uploadErrorCallback;\n\t\t}\n\n\t\tif(typeof uploadEndCallback == \"function\") {\n\t\t\txhr.upload.onloadend = uploadEndCallback;\n\t\t}\n\n\t\tlet timeoutTimer;\n\t\tlet isTimeout = false;\n\t\tif(option.timeout) {\n\t\t\ttimeoutTimer = setTimeout(function() {\n\t\t\t\tisTimeout = true;\n\t\t\t\txhr.abort();\n\t\t\t\tclearTimeout(timeoutTimer);\n\t\t\t}, option.timeout);\n\t\t}\n\n\t\txhr.onreadystatechange = function(evt) {\n\t\t\tlet status, err;\n\t\t\tif(xhr.readyState === 4) {\n\t\t\t\tstatus = xhr.status || 0;\n\t\t\t\tif(status > 399 && status < 600 || !status) {\n\t\t\t\t\tlet err = new Error(option.url + ' HTTP status: ' + status);\n\t\t\t\t\terr.xhr = xhr;\n\t\t\t\t\t_doOnFailResponseHook(option, xhr, err);\n\t\t\t\t} else {\n\t\t\t\t\tlet result;\n\t\t\t\t\tif(option.handleType === \"json\") {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tresult = xsloader.xsParseJson(xhr.responseText);\n\t\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\t\t_doOnFailResponseHook(option, xhr, new Error(\"parse-json-error:\" + e), \"parse-json-error\");\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if(option.handleType === \"text\") {\n\t\t\t\t\t\tresult = xhr.responseText;\n\t\t\t\t\t}\n\t\t\t\t\t_onOkResponseHook(result, option, function(result) {\n\t\t\t\t\t\tif(typeof okCallback == \"function\") {\n\t\t\t\t\t\t\tokCallback(result, xhr);\n\t\t\t\t\t\t}\n\t\t\t\t\t}, xhr);\n\t\t\t\t}\n\n\t\t\t} else {\n\t\t\t\tif(timeoutTimer && isTimeout) {\n\t\t\t\t\tlet err = new Error(option.url + ' timeout status: ' + status);\n\t\t\t\t\terr.xhr = xhr;\n\t\t\t\t\t_doOnFailResponseHook(option, xhr, err);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\txhr.send(body);\n\t}\n\n\tlet requestObj = {\n\t\tmultiPart(multiPart) {\n\t\t\t_multiPart = multiPart;\n\t\t\treturn this;\n\t\t},\n\t\tuploadStart(uploadStart) {\n\t\t\tuploadStartCallback = uploadStart;\n\t\t\treturn this;\n\t\t},\n\t\tuploadProgress(uploadProgress) {\n\t\t\tuploadProgressCallback = uploadProgress;\n\t\t\treturn this;\n\t\t},\n\t\tuploadOk(callback) {\n\t\t\tuploadOkCallback = callback;\n\t\t\treturn this;\n\t\t},\n\t\tuploadError(callback) {\n\t\t\tuploadErrorCallback = callback;\n\t\t\treturn this;\n\t\t},\n\t\tuploadEnd(uploadEnd) {\n\t\t\tuploadEndCallback = uploadEnd;\n\t\t\treturn this;\n\t\t},\n\t\turl(urlStr) {\n\t\t\t_url = urlStr;\n\t\t\treturn this;\n\t\t},\n\t\tmethod(methodStr) {\n\t\t\t_method = methodStr;\n\t\t\treturn this;\n\t\t},\n\t\ttimeout(timeout) {\n\t\t\t_timeout = timeout;\n\t\t\treturn this;\n\t\t},\n\t\tasync(isAsync) {\n\t\t\t_async = isAsync;\n\t\t\treturn this;\n\t\t},\n\t\tparams(paramsObj) {\n\t\t\tif(paramsObj) {\n\t\t\t\tfor(let x in paramsObj) {\n\t\t\t\t\tlet value = paramsObj[x];\n\t\t\t\t\tif(value === null || value === undefined) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\t_params[x] = value;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn this;\n\t\t},\n\t\theaders(headersObj) {\n\t\t\tif(headersObj) {\n\t\t\t\tfor(let x in headersObj) {\n\t\t\t\t\t_headers[x] = headersObj[x];\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn this;\n\t\t},\n\t\thandleType(_handleType) {\n\t\t\treturn this.handleAs(_handleType);\n\t\t},\n\t\thandleAs(handleType) {\n\t\t\tif(handleType !== \"json\" && handleType !== \"text\") {\n\t\t\t\tthrow \"unknown handleType:\" + handleType;\n\t\t\t}\n\t\t\t_handleType = handleType;\n\t\t\treturn this;\n\t\t},\n\t\tok(callback) {\n\t\t\tokCallback = callback;\n\t\t\treturn this;\n\t\t},\n\t\tfail(callback) {\n\t\t\tfailCallback = callback;\n\t\t\treturn this;\n\t\t},\n\t\t_beforeOpenHook(callback) {\n\t\t\t_beforeOpenHook = callback;\n\t\t\treturn this;\n\t\t},\n\t\t_onOkResponseHook(callback) {\n\t\t\t_onOkResponseHook = callback;\n\t\t\treturn this;\n\t\t},\n\t\t_onFailResponseHook(callback) {\n\t\t\t_onFailResponseHook = callback;\n\t\t\treturn this;\n\t\t},\n\t\tdone() {\n\t\t\ttry {\n\t\t\t\tconn();\n\t\t\t} catch(e) {\n\t\t\t\tif(typeof failCallback == \"function\") {\n\t\t\t\t\tfailCallback(e);\n\t\t\t\t} else {\n\t\t\t\t\tconsole.error(e);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\treturn requestObj;\n}\n/**\n */\nhttpRequest._beforeOpenHook = function(option, callback, xhr) {\n\tcallback();\n};\n\n/**\n * function(result,option,xhr,callback),callback(result)的result为最终的结果\n */\nhttpRequest._onOkResponseHook = function(result, option, callback, xhr) {\n\tcallback(result);\n};\n/**\n * function(option,xhr,callback,extraErrorType),callback(result)的result为false则不会处理后面的,如果为非undefined则作为成功的结果。\n * extraErrorType==\"parse-json-error\"表示转换成json时出错\n */\nhttpRequest._onFailResponseHook = function(option, callback, xhr, extraErrorType) {\n\tcallback(undefined);\n};\n\nwindow._xshttp_request_ = httpRequest;\n\nxsloader.define(\"xshttp\", [], function() {\n\treturn httpRequest;\n});","import utils from \"../../util/index.js\";\nconst global = utils.global;\nconst xsloader = global.xsloader;\n\nxsloader.define(\"xsrequest\", [\"xshttp\"], function(http) {\n\t/**\n\t * 参数列表:\n\t * callback:function(rs)\n\t * async:始终为true\n\t * 其他参数同xshttp\n\t * 不断返回then(function()).then,当返回false时取消调用后面的回调。\n\t * @param {Object} option\n\t */\n\tlet xsRequest = function(option) {\n\t\toption = xsloader.extend({\n\t\t\tparams: undefined,\n\t\t\theaders: undefined,\n\t\t\tmethod: undefined,\n\t\t\turl: undefined,\n\t\t\tcallback: undefined\n\t\t}, option);\n\t\tlet isResponsed = false;\n\t\tlet callbacksQueue = [function(rs) {\n\t\t\treturn rs;\n\t\t}];\n\t\tif(option.callback) {\n\t\t\tcallbacksQueue.push(option.callback);\n\t\t}\n\t\tcallbacksQueue.callback = function(rs) {\n\t\t\tisResponsed = true;\n\t\t\tfor(let i = 0; i < this.length; i++) {\n\t\t\t\tlet callback = this[i];\n\t\t\t\trs = callback(rs);\n\t\t\t\tif(rs === false) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\toption.ok = function(rs) {\n\t\t\tcallbacksQueue.callback(rs);\n\t\t};\n\t\toption.fail = function(err) {\n\t\t\tcallbacksQueue.callback({\n\t\t\t\tcode: -1,\n\t\t\t\tdesc: err\n\t\t\t});\n\t\t};\n\t\toption.async = true;\n\n\t\tfunction newHandle() {\n\t\t\tlet handle = {\n\t\t\t\tthen: function(callback) {\n\t\t\t\t\tif(isResponsed) {\n\t\t\t\t\t\tthrow new Error(\"already responsed!\");\n\t\t\t\t\t}\n\t\t\t\t\tcallbacksQueue.push(callback);\n\t\t\t\t\treturn newHandle();\n\t\t\t\t}\n\t\t\t};\n\t\t\treturn handle;\n\t\t}\n\t\thttp(option).done();\n\t\treturn newHandle();\n\t};\n\n\treturn xsRequest;\n});","import utils from \"../../util/index.js\";\nconst global = utils.global;\nconst xsloader = global.xsloader;\n\ntry {\n\tlet isXsMsgDebug = false;\n\tlet api = {};\n\n\tfunction isDebug(type) {\n\t\treturn isXsMsgDebug;\n\t}\n\n\tapi.linkedList = function() {\n\t\treturn new LinkedList();\n\t};\n\n\tfunction LinkedList() {\n\t\tfunction newNode(element) {\n\t\t\tlet node = {\n\t\t\t\telement: element,\n\t\t\t\tnext: null,\n\t\t\t\tpre: null\n\t\t\t};\n\t\t\treturn node;\n\t\t}\n\t\tlet length = 0;\n\t\tlet headNode = newNode(),\n\t\t\tlastNode = headNode;\n\n\t\t/**\n\t\t * 在链表末尾添加元素\n\t\t */\n\t\tthis.append = function(element) {\n\t\t\tlet current = newNode(element);\n\n\t\t\tlastNode.next = current;\n\t\t\tcurrent.pre = lastNode;\n\t\t\tlastNode = current;\n\t\t\tlength++;\n\t\t};\n\n\t\t//在链表的任意位置插入元素\n\t\tthis.insert = function(position, element) {\n\t\t\tif(position >= 0 && position <= length) {\n\n\t\t\t\tlet node = newNode(element);\n\t\t\t\tlet pNode = headNode;\n\t\t\t\twhile(position--) {\n\t\t\t\t\tpNode = pNode.next;\n\t\t\t\t}\n\n\t\t\t\tif(pNode.next) {\n\t\t\t\t\tpNode.next.pre = node;\n\t\t\t\t\tnode.next = pNode.next;\n\t\t\t\t}\n\t\t\t\tpNode.next = node;\n\t\t\t\tnode.pre = pNode;\n\t\t\t\tlength++;\n\t\t\t\treturn true;\n\t\t\t} else {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t};\n\n\t\tthis.elementAt = function(position) {\n\t\t\treturn getElement(position);\n\t\t};\n\n\t\tfunction getElement(position, willRemove) {\n\t\t\tif(position >= 0 && position < length) {\n\n\t\t\t\tlet pNode = headNode;\n\t\t\t\twhile(position--) {\n\t\t\t\t\tpNode = pNode.next;\n\t\t\t\t}\n\n\t\t\t\tif(pNode.next) {\n\t\t\t\t\tlet currentNode = pNode.next;\n\t\t\t\t\tif(willRemove) {\n\t\t\t\t\t\tlet nextCurrentNode = currentNode.next;\n\t\t\t\t\t\tif(nextCurrentNode) {\n\t\t\t\t\t\t\tnextCurrentNode.pre = pNode;\n\t\t\t\t\t\t\tpNode.next = nextCurrentNode;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tpNode.next = null;\n\t\t\t\t\t\t\tlastNode = pNode;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tlength--;\n\t\t\t\t\t}\n\t\t\t\t\treturn currentNode.element;\n\t\t\t\t} else {\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * @param callback function 返回true表示移除\n\t\t */\n\t\tthis.eachForRemove = function(callback) {\n\t\t\tlet pNode = headNode.next;\n\t\t\twhile(pNode) {\n\t\t\t\tlet currentNode = pNode;\n\t\t\t\tif(callback(currentNode)) {\n\t\t\t\t\tlet nextCurrentNode = currentNode.next;\n\t\t\t\t\tif(nextCurrentNode) {\n\t\t\t\t\t\tnextCurrentNode.pre = pNode;\n\t\t\t\t\t\tpNode.next = nextCurrentNode;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tpNode.next = null;\n\t\t\t\t\t\tlastNode = pNode;\n\t\t\t\t\t}\n\t\t\t\t\tlength--;\n\t\t\t\t\tpNode = nextCurrentNode;\n\t\t\t\t} else {\n\t\t\t\t\tpNode = pNode.next;\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\t//从链表中移除元素\n\t\tthis.removeAt = function(position) {\n\t\t\treturn getElement(position, true);\n\t\t};\n\n\t\t/**\n\t\t * 移除并获取第一个元素\n\t\t * @param callback function(elem,index)\n\t\t */\n\t\tthis.pop = function(callback) {\n\t\t\treturn this.removeAt(0);\n\t\t};\n\n\t\t/**\n\t\t * 返回元素在链表中的位置\n\t\t * @param element object|function(elem)\n\t\t */\n\t\tthis.indexOf = function(element) {\n\t\t\tlet pNode = headNode.next;\n\t\t\tlet index = 0;\n\t\t\twhile(pNode) {\n\t\t\t\tif(typeof element == \"function\") {\n\t\t\t\t\tif(element(pNode.element)) {\n\t\t\t\t\t\treturn index;\n\t\t\t\t\t}\n\t\t\t\t} else if(pNode.element === element) {\n\t\t\t\t\treturn index;\n\t\t\t\t}\n\t\t\t\tindex++;\n\t\t\t\tpNode = pNode.next;\n\t\t\t}\n\t\t\treturn -1;\n\t\t};\n\n\t\tthis.find = function(element) {\n\t\t\tlet index = this.indexOf(element);\n\t\t\treturn index >= 0 ? this.elementAt(index) : undefined;\n\t\t};\n\n\t\t//移除某个元素\n\t\tthis.remove = function(element) {\n\t\t\tlet index = this.indexOf(element);\n\t\t\treturn this.removeAt(index);\n\t\t};\n\n\t\t//判断链表是否为空\n\n\t\tthis.isEmpty = function() {\n\t\t\treturn length === 0;\n\t\t};\n\n\t\t//返回链表的长度\n\t\tthis.size = function() {\n\t\t\treturn length;\n\t\t};\n\n\t}\n\n\tif(window.addEventListener) {\n\t\tlet postMessageBridge = (function() {\n\t\t\tlet handle = {};\n\n\t\t\tlet instanceMap = {}; //id:listener\n\t\t\tlet cmd2ListenerMap = {}; //cmd:[]\n\t\t\tlet instanceBindMap = {}; //instanceid:true\n\t\t\tlet oinstanceidMap = {}; //已经被绑定的oinstanceid:instanceid\n\n\t\t\t//isActive为false表示监听者\n\t\t\thandle.listen = function(cmd, conndata, connectingSource, source, isActive, _onConned, _onMsg, _onResponse, _onElse) {\n\n\t\t\t\tlet listener = {\n\t\t\t\t\tcmd: cmd,\n\t\t\t\t\t_onConned: _onConned,\n\t\t\t\t\t_onMsg: _onMsg,\n\t\t\t\t\t_onResponse: _onResponse,\n\t\t\t\t\t_onElse: _onElse,\n\t\t\t\t\tconndata: conndata,\n\t\t\t\t\tosource: source,\n\t\t\t\t\tactive: isActive,\n\t\t\t\t\tconnectingSource: connectingSource,\n\t\t\t\t\tid: xsloader.randId(),\n\t\t\t\t\trefused: {}\n\t\t\t\t};\n\n\t\t\t\tif(!cmd2ListenerMap[cmd]) {\n\t\t\t\t\tcmd2ListenerMap[cmd] = [];\n\t\t\t\t}\n\t\t\t\tcmd2ListenerMap[cmd].push(listener);\n\n\t\t\t\tlet instanceid = listener.id;\n\t\t\t\tinstanceMap[instanceid] = listener;\n\t\t\t\treturn instanceid;\n\t\t\t};\n\n\t\t\thandle.remove = function(instanceid) {\n\t\t\t\t//TODO !!!!!!!\n\t\t\t\t/*let listener = listeners[id];\n\t\t\t\tdelete listeners[id];\n\t\t\t\tif(listener.active) {\n\t\t\t\t\tfor(let x in activeListenerMyIds) {\n\t\t\t\t\t\tlet as = activeListenerMyIds[x];\n\t\t\t\t\t\tlet found = false;\n\t\t\t\t\t\tfor(let k = 0; k < as.length; k++) {\n\t\t\t\t\t\t\tif(as[k] == id) {\n\t\t\t\t\t\t\t\tas.splice(k, 1);\n\t\t\t\t\t\t\t\tfound = true;\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif(found) {\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}*/\n\t\t\t};\n\n\t\t\thandle.send = function(data, instanceid, msgid) {\n\t\t\t\tlet listener = instanceMap[instanceid];\n\t\t\t\t_sendData(\"msg\", listener.cmd, listener.osource, data, instanceid, msgid);\n\t\t\t};\n\n\t\t\thandle.sendConn = function(instanceid) {\n\t\t\t\tlet listener = instanceMap[instanceid];\n\t\t\t\t_sendData(\"conn\", listener.cmd, listener.osource, listener.conndata, instanceid);\n\t\t\t};\n\n\t\t\thandle.sendResponse = function(data, instanceid) {\n\t\t\t\tlet listener = instanceMap[instanceid];\n\t\t\t\t_sendData(\"response\", listener.cmd, listener.osource, data, instanceid);\n\t\t\t};\n\n\t\t\tfunction handleConn(cmd, fromSource, originStr, data, oinstanceid) {\n\t\t\t\tif(oinstanceidMap[oinstanceid]) {\n\t\t\t\t\t//console.warn(\"already bind:\" + cmd);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tlet listeners = cmd2ListenerMap[cmd];\n\t\t\t\tif(!listeners) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tfunction Callback(instanceid) {\n\n\t\t\t\t\treturn function(isAccept, msg) {\n\t\t\t\t\t\tif(!isAccept) {\n\t\t\t\t\t\t\tlet listener = instanceMap[instanceid];\n\t\t\t\t\t\t\tlistener.refused[oinstanceid] = true;\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif(oinstanceidMap[oinstanceid]) {\n\t\t\t\t\t\t\tconsole.warn(\"already bind other:\" + cmd + \",my page:\" + location.href);\n\t\t\t\t\t\t} else if(instanceBindMap[instanceid]) {\n\t\t\t\t\t\t\tconsole.warn(\"already self bind:\" + cmd + \",my page:\" + location.href);\n\t\t\t\t\t\t\t_sendData(\"binded\", cmd, fromSource, oinstanceid);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\toinstanceidMap[oinstanceid] = instanceid;\n\t\t\t\t\t\t\tinstanceBindMap[instanceid] = true;\n\t\t\t\t\t\t\tlet listener = instanceMap[instanceid];\n\t\t\t\t\t\t\tlistener.osource = fromSource;\n\t\t\t\t\t\t\tlistener.origin = originStr;\n\t\t\t\t\t\t\t_sendData(\"accept\", cmd, fromSource, listener.conndata, instanceid, oinstanceid);\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\n\t\t\t\t}\n\n\t\t\t\tfor(let i = 0; i < listeners.length; i++) {\n\t\t\t\t\tlet listener = listeners[i];\n\t\t\t\t\tif(!listener.refused[oinstanceid]) {\n\t\t\t\t\t\tlistener.connectingSource(fromSource, originStr, data, Callback(listener.id));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction handleAccept(cmd, fromSource, originStr, data, oinstanceid, minstanceid) {\n\t\t\t\tlet listeners = cmd2ListenerMap[cmd];\n\t\t\t\tif(!listeners) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tfunction Callback(instanceid) {\n\n\t\t\t\t\treturn function(isAccept, msg) {\n\t\t\t\t\t\tif(!isAccept) {\n\t\t\t\t\t\t\tlet listener = instanceMap[instanceid];\n\t\t\t\t\t\t\tlistener.refused[oinstanceid] = true;\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif(oinstanceidMap[oinstanceid]) {\n\t\t\t\t\t\t\tconsole.warn(\"already bind:\" + cmd + \",my page:\" + location.href);\n\t\t\t\t\t\t} else if(instanceBindMap[instanceid]) {\n\t\t\t\t\t\t\tconsole.warn(\"already self bind:\" + cmd + \",my page:\" + location.href);\n\t\t\t\t\t\t\t_sendData(\"binded\", cmd, fromSource, oinstanceid);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\toinstanceidMap[oinstanceid] = instanceid;\n\t\t\t\t\t\t\tinstanceBindMap[instanceid] = true;\n\n\t\t\t\t\t\t\tlet listener = instanceMap[instanceid];\n\t\t\t\t\t\t\tlistener.osource = fromSource;\n\t\t\t\t\t\t\tlistener.origin = originStr;\n\t\t\t\t\t\t\t_sendData(\"conned\", cmd, fromSource, listener.conndata, instanceid);\n\t\t\t\t\t\t\tlistener._onConned(fromSource, data);\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\n\t\t\t\t}\n\n\t\t\t\tfor(let i = 0; i < listeners.length; i++) {\n\t\t\t\t\tlet listener = listeners[i];\n\t\t\t\t\tif(listener.id == minstanceid && !listener.refused[oinstanceid]) { //当前为主动发起连接的页面\n\t\t\t\t\t\tlistener.connectingSource(fromSource, originStr, data, Callback(listener.id));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction handleBinded(cmd, fromSource, originStr, minstanceid) {\n\t\t\t\tlet listener = instanceMap[minstanceid];\n\t\t\t\tlistener._onElse(\"binded\");\n\t\t\t}\n\n\t\t\tfunction checkSource(listener, fromSource, originStr) {\n\t\t\t\tif(listener.osource != fromSource && listener.origin != originStr) {\n\t\t\t\t\tconsole.warn(\"expected:\" + listener.origin + \",but:\" + originStr);\n\t\t\t\t\tthrow new Error(\"source changed!\");\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction handleConned(cmd, fromSource, originStr, data, oinstanceid) {\n\t\t\t\tlet instanceid = oinstanceidMap[oinstanceid];\n\t\t\t\tlet listener = instanceMap[instanceid];\n\t\t\t\tcheckSource(listener, fromSource, originStr);\n\n\t\t\t\tlistener._onConned(listener.osource, data);\n\t\t\t}\n\n\t\t\tfunction handleMsg(cmd, fromSource, originStr, data, oinstanceid, msgid) {\n\t\t\t\tlet instanceid = oinstanceidMap[oinstanceid];\n\t\t\t\tlet listener = instanceMap[instanceid];\n\t\t\t\tcheckSource(listener, fromSource, originStr);\n\n\t\t\t\tlistener._onMsg(data, msgid);\n\t\t\t}\n\n\t\t\tfunction handleResponse(cmd, fromSource, originStr, data, oinstanceid) {\n\t\t\t\tlet instanceid = oinstanceidMap[oinstanceid];\n\t\t\t\tlet listener = instanceMap[instanceid];\n\t\t\t\tcheckSource(listener, fromSource, originStr);\n\n\t\t\t\tlistener._onResponse(data);\n\t\t\t}\n\n\t\t\tfunction _sendData(type, cmd, source, data, instanceid, msgid) {\n\t\t\t\tlet msg = {\n\t\t\t\t\ttype: type,\n\t\t\t\t\tdata: data,\n\t\t\t\t\tcmd: cmd,\n\t\t\t\t\tid: instanceid,\n\t\t\t\t\tmsgid: msgid\n\t\t\t\t};\n\n\t\t\t\tif(isDebug(\"postMessageBridge\")) {\n\t\t\t\t\tconsole.log(\"send from:\" + location.href);\n\t\t\t\t\tconsole.log(msg);\n\t\t\t\t}\n\t\t\t\tsource.postMessage(xsloader.xsJson2String(msg), \"*\");\n\t\t\t}\n\n\t\t\twindow.addEventListener('message', function(event) {\n\t\t\t\tif(isDebug(\"postMessageBridge\")) {\n\t\t\t\t\tconsole.log(\"receive from:\" + event.origin + \",my page:\" + location.href);\n\t\t\t\t\tconsole.log(event.data);\n\t\t\t\t}\n\t\t\t\tlet data;\n\t\t\t\ttry {\n\t\t\t\t\tdata = xsloader.xsParseJson(event.data);\n\t\t\t\t} catch(e) {\n\t\t\t\t\tconsole.warn(e);\n\t\t\t\t}\n\t\t\t\tif(!data || !(data.cmd && data.type)) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tlet cmd = data.cmd;\n\t\t\t\tlet oinstanceid = data.id;\n\t\t\t\tlet rdata = data.data;\n\t\t\t\tlet type = data.type;\n\t\t\t\tlet msgid = data.msgid;\n\n\t\t\t\tif(type == \"conn\") {\n\t\t\t\t\thandleConn(cmd, event.source, event.origin, rdata, oinstanceid);\n\t\t\t\t} else if(type == \"accept\") {\n\t\t\t\t\thandleAccept(cmd, event.source, event.origin, rdata, oinstanceid, msgid);\n\t\t\t\t} else if(type == \"conned\") {\n\t\t\t\t\thandleConned(cmd, event.source, event.origin, rdata, oinstanceid);\n\t\t\t\t} else if(type == \"msg\") {\n\t\t\t\t\thandleMsg(cmd, event.source, event.origin, rdata, oinstanceid, msgid);\n\t\t\t\t} else if(type == \"response\") {\n\t\t\t\t\thandleResponse(cmd, event.source, event.origin, rdata, oinstanceid);\n\t\t\t\t} else if(type == \"binded\") {\n\t\t\t\t\thandleBinded(cmd, event.source, event.origin, rdata);\n\t\t\t\t}\n\n\t\t\t});\n\n\t\t\thandle.runAfter = function(time, callback) {\n\t\t\t\tsetTimeout(callback, time);\n\t\t\t};\n\n\t\t\treturn handle;\n\t\t})();\n\n\t\tfunction CommunicationUnit(cmd, source, connectingSource, onfailed, isActive, conndata) {\n\t\t\tlet msgQueue = new LinkedList();\n\n\t\t\tlet MAX_TRY = 100,\n\t\t\t\tSLEEP = 500;\n\t\t\tlet isConnected = false,\n\t\t\t\tconnectCount = 0;\n\t\t\tlet isCanceled = false;\n\n\t\t\tlet thiz = this;\n\t\t\tlet handleId;\n\n\t\t\tthis.onConnectedListener = null;\n\t\t\tthis.onReceiveListener = null;\n\t\t\tthis.send = function(data) {\n\t\t\t\tlet msg = {\n\t\t\t\t\tid: xsloader.randId(),\n\t\t\t\t\tdata: data\n\t\t\t\t};\n\t\t\t\tmsgQueue.append(msg);\n\t\t\t\tsendTop();\n\t\t\t};\n\n\t\t\tthis.send.release = function() {\n\t\t\t\tpostMessageBridge.remove(handleId);\n\t\t\t};\n\n\t\t\tfunction _onConned(_source, data) {\n\t\t\t\tthiz.onConnectedListener.call(thiz, data);\n\t\t\t\tisConnected = true;\n\t\t\t\tsendTop();\n\t\t\t}\n\n\t\t\tfunction _onMsg(data, msgid) {\n\t\t\t\ttry {\n\t\t\t\t\tthiz.onReceiveListener.call(thiz, data);\n\t\t\t\t} catch(e) {\n\t\t\t\t\tconsole.warn(e);\n\t\t\t\t}\n\t\t\t\tpostMessageBridge.sendResponse({ //回应已经收到\n\t\t\t\t\tid: msgid\n\t\t\t\t}, handleId);\n\t\t\t}\n\n\t\t\tfunction _onResponse(data) {\n\t\t\t\tmsgQueue.remove(function(elem) {\n\t\t\t\t\treturn elem.id = data.id;\n\t\t\t\t});\n\t\t\t\tsendTop();\n\t\t\t}\n\n\t\t\tfunction _onElse(type) {\n\t\t\t\tif(type == \"binded\") {\n\t\t\t\t\tisCanceled = true;\n\t\t\t\t\tconsole.error(\"connect failed,that page already binded:\" + cmd + \",my page:\" + location.href);\n\t\t\t\t\tonfailed(\"canceled\");\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction initListen() {\n\t\t\t\thandleId = postMessageBridge.listen(cmd, conndata, connectingSource, source, isActive, _onConned, _onMsg, _onResponse, _onElse);\n\t\t\t}\n\n\t\t\tfunction sendTop() {\n\t\t\t\tif(isConnected) {\n\t\t\t\t\tlet msg;\n\t\t\t\t\twhile((msg = msgQueue.pop())) {\n\t\t\t\t\t\tpostMessageBridge.send(msg.data, handleId, msg.id);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction init() {\n\t\t\t\tif(isConnected || connectCount > MAX_TRY || isCanceled) {\n\t\t\t\t\tif(!isConnected && !isCanceled) {\n\t\t\t\t\t\tonfailed(\"timeout\");\n\t\t\t\t\t}\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tpostMessageBridge.sendConn(handleId);\n\t\t\t\tconnectCount++;\n\t\t\t\tpostMessageBridge.runAfter(SLEEP, init);\n\t\t\t}\n\t\t\tif(source) {\n\t\t\t\tinitListen();\n\t\t\t\tinit();\n\t\t\t} else if(!isActive) {\n\t\t\t\tinitListen();\n\t\t\t}\n\n\t\t\tthis.setSource = function(_source) {\n\t\t\t\tsource = _source;\n\t\t\t\tif(source) {\n\t\t\t\t\tinitListen();\n\t\t\t\t\tinit();\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\n\t\tlet handleApi = api;\n\n\t\t/**\n\t\t * \n\t\t * @param {Object} winObjOrCallback\n\t\t * @param {Object} option\n\t\t * @param {Object} notActive\n\t\t */\n\t\tfunction _connectWindow(winObjOrCallback, option, notActive) {\n\t\t\toption = xsloader.extendDeep({\n\t\t\t\tcmd: \"default-cmd\",\n\t\t\t\tlistener: null,\n\t\t\t\tconnected: null,\n\t\t\t\tconndata: null,\n\t\t\t\tconnectingSource: function(source, origin, conndata, callback) {\n\t\t\t\t\tlet mine = location.protocol + \"//\" + location.host;\n\t\t\t\t\tcallback(mine == origin, \"default\");\n\t\t\t\t},\n\t\t\t\tonfailed: function(errtype) {\n\t\t\t\t\tif(errtype == \"timeout\") {\n\t\t\t\t\t\tconsole.warn(\"connect may timeout:cmd=\" + option.cmd + \",my page=\" + location.href);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}, option);\n\n\t\t\tlet cmd = option.cmd;\n\t\t\tlet connectedCallback = option.connected;\n\t\t\tlet receiveCallback = option.listener;\n\t\t\tlet conndata = option.conndata;\n\t\t\tlet onfailed = option.onfailed;\n\n\t\t\tlet isActive = !notActive;\n\t\t\tlet connectingSource = option.connectingSource;\n\n\t\t\tlet unit;\n\t\t\tif(typeof winObjOrCallback == \"function\") {\n\t\t\t\tunit = new CommunicationUnit(cmd, null, connectingSource, onfailed, isActive, conndata);\n\t\t\t} else {\n\t\t\t\tunit = new CommunicationUnit(cmd, winObjOrCallback, connectingSource, onfailed, isActive, conndata);\n\t\t\t}\n\n\t\t\tconnectedCallback = connectedCallback || function(sender, conndata) {\n\t\t\t\tconsole.log((isActive ? \"active\" : \"\") + \" connected:\" + cmd);\n\t\t\t};\n\t\t\tif(connectedCallback) {\n\t\t\t\tunit.onConnectedListener = function(conndata) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tconnectedCallback(this.send, conndata);\n\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\tconsole.error(e);\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t}\n\t\t\tif(receiveCallback) {\n\t\t\t\tunit.onReceiveListener = function(data) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\treceiveCallback(data, this.send);\n\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\tconsole.error(e);\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t}\n\t\t\tif(typeof winObjOrCallback == \"function\") {\n\t\t\t\twinObjOrCallback(function(winObj) {\n\t\t\t\t\tunit.setSource(winObj);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn unit.send;\n\t\t}\n\n\t\tfunction _connectIFrame(iframe, option) {\n\t\t\tlet winObj;\n\t\t\tif(typeof iframe == \"string\") {\n\t\t\t\t//iframe = ddocument.querySelector(iframe);\n\t\t\t\twinObj = function(callback) {\n\t\t\t\t\tiframe.onload = function() {\n\t\t\t\t\t\tcallback(this.contentWindow);\n\t\t\t\t\t};\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\twinObj = iframe.contentWindow;\n\t\t\t}\n\t\t\treturn _connectWindow(winObj, option);\n\n\t\t}\n\n\t\t/**\n\t\t * 用于连接iframe.\n\t\t * @param {Object} iframe iframe或selector\n\t\t * @param {Object} option\n\t\t * @return 返回sender\n\t\t */\n\t\thandleApi.connectIFrame = function(iframe, option) {\n\t\t\treturn _connectIFrame(iframe, option);\n\t\t};\n\n\t\t/**\n\t\t * 用于连接父页面.\n\t\t * @param {Object} option\n\t\t * @return 返回sender\n\t\t */\n\t\thandleApi.connectParent = function(option) {\n\t\t\treturn _connectWindow(window.parent, option);\n\t\t};\n\n\t\t/**\n\t\t * 用于连接顶层页面.\n\t\t * @param {Object} option\n\t\t * @return 返回sender\n\t\t */\n\t\thandleApi.connectTop = function(option) {\n\t\t\treturn _connectWindow(window.top, option);\n\t\t};\n\n\t\t/**\n\t\t * 用于连接打开者.\n\t\t * @param {Object} option\n\t\t * @return 返回sender\n\t\t */\n\t\thandleApi.connectOpener = function(option) {\n\t\t\treturn _connectWindow(window.opener, option);\n\t\t};\n\n\t\t/**\n\t\t * 用于监听其他页面发送消息.\n\t\t * @param {Object} option\n\t\t * @return 返回一个sender\n\t\t */\n\t\thandleApi.listenMessage = function(option) {\n\t\t\treturn _connectWindow(null, option, true);\n\t\t};\n\n\t\thandleApi.debug = function(isDebug) {\n\t\t\tisXsMsgDebug = isDebug;\n\t\t};\n\n\t\t/**\n\t\t * *******************\n\t\t * option参数\n\t\t *********************\n\t\t * option.cmd:\n\t\t * option.connectingSource:function(source,origin,conndata,callback(isAccept,msg))默认只选择同源\n\t\t * option.listener: function(data,sender)\n\t\t * option.connected:function(sender,conndata)\n\t\t * option.onfailed:function(errtype):errtype,timeout,canceled\n\t\t * option.conndata:\n\t\t **************\n\t\t * 回调的extra参数\n\t\t **************\n\t\t * originStr:对方页面的地址\n\t\t */\n\t\txsloader.define(\"xsmsg\", handleApi); //TODO STRONG xsmsg\n\t}\n\n\txsloader.define(\"XsLinkedList\", function() {\n\t\treturn LinkedList;\n\t});\n} catch(e) {\n\tconsole.error(e);\n}","// 静态资源服务\nimport utils from \"./util/index.js\";\n\nconst global = utils.global;\nconst xsloader = global.xsloader;\n\nconst http = global._xshttp_request_;\nconst DATA_CONF = \"data-conf\",\n\tDATA_CONFX = \"data-xsloader-conf\";\nconst DATA_CONF2 = \"data-conf2\",\n\tDATA_CONF2X = \"data-xsloader-conf2\";\nconst DATA_MAIN = \"data-main\",\n\tDATA_MAINX = \"data-xsloader-main\";\nconst DATA_CONF_TYPE = \"data-conf-type\";\n\nlet serviceConfigUrl;\nlet dataConf = xsloader.script().getAttribute(DATA_CONF) || xsloader.script().getAttribute(DATA_CONFX);\nlet dataMain = xsloader.script().getAttribute(DATA_MAIN) || xsloader.script().getAttribute(DATA_MAINX);\nlet dataConfType = xsloader.script().getAttribute(DATA_CONF_TYPE);\nif(dataConfType !== \"json\" && dataConfType != \"js\") {\n\tdataConfType = \"auto\";\n}\n\nlet initFun = () => {\n\tfunction getMainPath(config) {\n\t\tlet mainPath = config.main.getPath.call(config, dataMain);\n\t\tlet path = location.pathname;\n\n\t\tlet index = path.lastIndexOf(\"/\");\n\t\tlet name = path.substring(index + 1);\n\t\tif(name === \"\") {\n\t\t\tname = \"index\";\n\t\t}\n\t\tif(xsloader.endsWith(name, \".html\")) {\n\t\t\tname = name.substring(0, name.length - 5);\n\t\t}\n\t\tif(!mainPath) {\n\t\t\tmainPath = \"./main/{name}.js\";\n\t\t}\n\t\tmainPath = mainPath.replace(\"{name}\", name);\n\t\treturn mainPath;\n\t}\n\n\tfunction extendConfig(config) {\n\t\tconfig = xsloader.extendDeep({\n\t\t\tproperties: {},\n\t\t\tmain: {\n\t\t\t\tgetPath() {\n\t\t\t\t\treturn dataMain || \"./main/{name}.js\";\n\t\t\t\t},\n\t\t\t\tname: \"main\",\n\t\t\t\tlocalConfigVar: \"lconfig\",\n\t\t\t\tglobalConfigVar: \"gconfig\",\n\t\t\t\tbefore(name) {\n\t\t\t\t\tconsole.log(\"before:\" + name);\n\t\t\t\t},\n\t\t\t\tafter(name) {\n\t\t\t\t\tconsole.log(\"after:\" + name);\n\t\t\t\t}\n\t\t\t},\n\t\t\tservice: {\n\t\t\t\thasGlobal: false,\n\t\t\t\tresUrls: []\n\t\t\t},\n\t\t\tchooseLoader(localConfig) { //返回一个configName；当此函数为service全局配置的函数时，localConfig为应用的配置对象;本地配置调用时，localConfig为null。\n\t\t\t\treturn \"default\";\n\t\t\t},\n\t\t\tloader: {\n\t\t\t\t\"default\": {\n\t\t\t\t\tautoUrlArgs: true\n\t\t\t\t}\n\t\t\t}\n\t\t}, config);\n\n\t\treturn config;\n\t}\n\n\tfunction loadServiceConfig(tag, url, callback, isLocal) {\n\t\thttp({\n\t\t\turl: url,\n\t\t\tmethod: \"get\",\n\t\t\ttimeout: 20000,\n\t\t\thandleType: \"text\",\n\t\t\tok(confText) {\n\n\t\t\t\tlet conf;\n\t\t\t\tif(dataConfType == \"js\") {\n\t\t\t\t\tconf = xsloader.xsEval(confText);\n\t\t\t\t} else if(dataConfType == \"json\") {\n\t\t\t\t\tconf = xsloader.xsParseJson(confText);\n\t\t\t\t} else {\n\t\t\t\t\tif(xsloader.startsWith(url, location.protocol + \"//\" + location.host + \"/\")) {\n\t\t\t\t\t\t//同域则默认用脚本解析\n\t\t\t\t\t\tconf = xsloader.xsEval(confText);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconf = xsloader.xsParseJson(confText);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconf = extendConfig(conf);\n\t\t\t\tif(conf.beforeDealProperties) {\n\t\t\t\t\tconf.beforeDealProperties();\n\t\t\t\t}\n\t\t\t\tconf = xsloader.dealProperties(conf, conf.properties); //参数处理\n\n\t\t\t\tif(isLocal && conf.service.hasGlobal) {\n\t\t\t\t\tloadServiceConfig(\"global servie\", conf.service.confUrl,\n\t\t\t\t\t\tfunction(globalConfig) {\n\t\t\t\t\t\t\tlet localConfig = conf;\n\t\t\t\t\t\t\tglobal[globalConfig.main && globalConfig.main.localConfigVar || localConfig.main.localConfigVar] = localConfig;\n\t\t\t\t\t\t\tglobal[globalConfig.main && globalConfig.main.globalConfigVar || localConfig.main.globalConfigVar] = globalConfig;\n\n\t\t\t\t\t\t\tlet mainName, mainPath, loaderName;\n\n\t\t\t\t\t\t\tloaderName = globalConfig.chooseLoader.call(globalConfig, localConfig);\n\t\t\t\t\t\t\tlet conf;\n\t\t\t\t\t\t\tlet loader;\n\t\t\t\t\t\t\tif(loaderName != null) {\n\t\t\t\t\t\t\t\tmainName = globalConfig.main.name;\n\t\t\t\t\t\t\t\tmainPath = utils.getPathWithRelative(location.href, getMainPath(globalConfig));\n\t\t\t\t\t\t\t\tloader = globalConfig.loader[loaderName];\n\t\t\t\t\t\t\t\tconf = globalConfig;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif(!loader) {\n\t\t\t\t\t\t\t\tloaderName = localConfig.chooseLoader.call(localConfig, null);\n\t\t\t\t\t\t\t\tmainName = localConfig.main.name;\n\t\t\t\t\t\t\t\tmainPath = utils.getPathWithRelative(location.href, getMainPath(localConfig));\n\t\t\t\t\t\t\t\tloader = localConfig.loader[loaderName];\n\t\t\t\t\t\t\t\tconf = localConfig;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif(!loader) {\n\t\t\t\t\t\t\t\tconsole.error(\"unknown loader:\" + loaderName + \"\");\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tinitXsloader(mainName, mainPath, loader, conf, localConfig);\n\n\t\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tcallback(conf);\n\t\t\t\t}\n\t\t\t},\n\t\t\tfail(err) {\n\t\t\t\tconsole.error(\"load \" + tag + \" config err:url=\" + url + \",errinfo=\" + err);\n\t\t\t}\n\t\t}).done();\n\t}\n\n\tfunction startLoad() {\n\t\tloadServiceConfig(\"local\", serviceConfigUrl, function(localConfig) {\n\t\t\tglobal[localConfig.main.localConfigVar] = localConfig;\n\n\t\t\tlet mainName = localConfig.main.name;\n\n\t\t\tlet href = location.href;\n\t\t\tlet index = href.lastIndexOf(\"?\");\n\t\t\tif(index >= 0) {\n\t\t\t\thref = href.substring(0, index);\n\t\t\t}\n\n\t\t\tlet mainPath = getMainPath(localConfig);\n\n\t\t\tmainPath = mainPath.indexOf(\"!\") == -1 ? utils.getPathWithRelative(href, mainPath) : mainPath;\n\t\t\tlet loaderName = localConfig.chooseLoader.call(localConfig, null);\n\n\t\t\tlet loader = localConfig.loader[loaderName];\n\t\t\tif(!loader) {\n\t\t\t\tconsole.error(\"unknown local loader:\" + loaderName);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tinitXsloader(href, mainName, mainPath, loader, localConfig, localConfig);\n\t\t}, true);\n\t}\n\n\tfunction initXsloader(pageHref, mainName, mainPath, loader, conf, localConfig) {\n\t\tlet resUrls = [];\n\t\tconf.service.resUrl && resUrls.push(conf.service.resUrl);\n\t\tlocalConfig !== conf && localConfig.service.resUrl && resUrls.push(localConfig.service.resUrl);\n\n\t\tconf.service.resUrls && Array.pushAll(resUrls, conf.service.resUrls);\n\t\tlocalConfig !== conf && localConfig.service.resUrls && Array.pushAll(resUrls, localConfig.service.resUrls);\n\n\t\txsloader._resUrlBuilder = function(groupModule) {\n\t\t\tlet as = [];\n\t\t\tutils.each(resUrls, function(url) {\n\t\t\t\tas.push(xsloader.appendArgs2Url(url, \"m=\" + encodeURIComponent(groupModule)));\n\t\t\t});\n\t\t\treturn as;\n\t\t};\n\t\tloader.ignoreProperties = true;\n\t\tloader.defineFunction = loader.defineFunction || {};\n\t\tloader.depsPaths = loader.depsPaths || {};\n\t\tif(mainPath.indexOf(\"!\") != -1) { //插件调用\n\t\t\tlet theConfig = xsloader(loader);\n\n\t\t\tmainName = \"_plugin_main_\";\n\t\t\tlet deps = [];\n\t\t\tif(theConfig.deps) { //手动添加*依赖\n\t\t\t\tif(theConfig.deps[\"*\"]) {\n\t\t\t\t\tArray.pushAll(deps, theConfig.deps[\"*\"]);\n\t\t\t\t}\n\t\t\t\tif(theConfig.deps[mainName]) {\n\t\t\t\t\tArray.pushAll(deps, theConfig.deps[mainName]);\n\t\t\t\t}\n\t\t\t}\n\t\t\tdeps.push(mainPath);\n\t\t\txsloader.defineAsync(mainName, deps, function() {\n\n\t\t\t}).then({\n\t\t\t\tabsUrl: pageHref\n\t\t\t});\n\t\t} else if(!xsloader.hasDefine(mainName)) {\n\t\t\tloader.depsPaths[mainName] = mainPath; //让其依赖*中的所有依赖\n\t\t\txsloader(loader);\n\t\t} else {\n\t\t\txsloader(loader);\n\t\t}\n\n\t\tloader.defineFunction[mainName] = function(originCallback, originThis, originArgs) {\n\t\t\tif(xsloader.isFunction(conf.main.before)) {\n\t\t\t\tconf.main.before.call(conf, mainName);\n\t\t\t}\n\t\t\tlet rt = originCallback.apply(originThis, originArgs);\n\n\t\t\tif(xsloader.isFunction(conf.main.after)) {\n\t\t\t\tconf.main.after.call(conf, mainName);\n\t\t\t}\n\t\t\treturn rt;\n\t\t};\n\n\t\txsloader.require([mainName], function(main) {}).then({\n\t\t\tonError: function(err, invoker) {\n\t\t\t\tif(invoker) {\n\t\t\t\t\tconsole.error(\"error occured:invoker.url=\", invoker.getUrl());\n\t\t\t\t}\n\t\t\t\tconsole.error(\"invoke main err:\" + err);\n\t\t\t}\n\t\t});\n\t}\n\txsloader.asyncCall(startLoad, true);\n};\n\nif(dataConf) {\n\tserviceConfigUrl = utils.getPathWithRelative(location.href, dataConf);\n} else if((dataConf = (xsloader.script().getAttribute(DATA_CONF2) || xsloader.script().getAttribute(DATA_CONF2X)))) {\n\tserviceConfigUrl = utils.getPathWithRelative(xsloader.scriptSrc(), dataConf);\n} else {\n\tinitFun = null;\n}\ninitFun && initFun();","import \"./polyfill/index.js\";\r\nimport \"./core/index.js\";\r\nimport \"./define.js\";\r\nimport \"./core/plugins/index.js\";\r\nimport \"./service.js\"; //放在最后\r\nimport utils from \"./util/index.js\";\r\nutils.loaderEnd();"],"names":["JSON","rx_one","rx_two","rx_three","rx_four","rx_escapable","rx_dangerous","gap","indent","meta","rep","g","f","n","this_value","this","valueOf","quote","string","lastIndex","test","replace","a","c","charCodeAt","toString","slice","str","key","holder","i","k","v","length","partial","mind","value","_typeof","toJSON","call","isFinite","String","Object","prototype","apply","join","push","hasOwnProperty","Date","getUTCFullYear","getUTCMonth","getUTCDate","getUTCHours","getUTCMinutes","getUTCSeconds","Boolean","Number","stringify","replacer","space","Error","parse","text","reviver","j","walk","undefined","eval","SyntaxError","window","self","global","InVar","val","get","set","newVal","old","loaderFun","xsloader","arguments","fun","ABSOLUTE_PROTOCOL_REG","ABSOLUTE_PROTOCOL_REG2","defaultJsExts","isJsFile","path","isString","pluginIndex","indexOf","substring","index","theConfig","config","jsExts","endsWith","ext","dealPathMayAbsolute","currentUrl","location","href","finalPath","absolute","rs","exec","protocol","_protocol","_host","host","getPathWithRelative","relative","isPathDir","relativeQuery","qIndex","lastIndexOf","isRelativeDir","prefix","absolute2","index2","stack","split","pop","relatives","result","appendArgs2Url","getNodeAbsolutePath","node","src","getAttribute","removeQueryHash","url","REPLACE_STRING_PROPERTIES_EXP","RegExp","ALL_TYPE_PROPERTIES_EXP","propertiesDeal","configObject","properties","replaceStringProperties","property","propKey","propValue","getObjectAttr","propertyKey","has","replaceProperties","obj","enableKeyAttr","isFunction","isArray","isObject","replaceKeyMap","x","_x","objx","__dealt__","replaceModulePrefix","deps","m","pluginParam","query","startsWith","modulePrefixCount","modulePrefix","replaceStr","len","pluginName","dep","getScriptBySubname","subname","ss","document","getElementsByTagName","script","commentRegExp","cjsRequireRegExp","GraphPath","pathEdges","vertexMap","depMap","checkLoop","visited","recursionStack","paths","edges","edge","end","addEdge","begin","hasDep","name","tryAddEdge","hasLoop","strValue2Arr","each","ary","func","isSync","fromEnd","__commentReplace","match","singlePrefix","appendInnerDeps","callback","idCount","getAndIncIdCount","PluginError","err","invoker","isXsLoaderEnd","IE_VERSION","userAgent","navigator","isIE","isEdge","isIE11","reIE","fIEVersion","parseInt","graphPath","loaderEnd","isLoaderEnd","urls","base","utils","Function","bind","console","method","thiz","e","log","error","warn","Array","elem","offset","pushAll","arr","starts","ends","_indexInArray","array","ele","compare","indexInArray","indexInArrayFrom","randId","suffix","id","getTime","Math","random","xsEval","scriptString","xsParseJson","option","extend","fnStart","fnEnd","rcomment","fnMap","fnOffset","indexStart","indexEnd","fnId","fnStr","trim","fn","xsJSON","reg","message","posStr","pos","_str","e2","xsJson2String","_toParamsMap","argsStr","decode","search","s","ret","seg","decodeURIComponent","urlArgs","hashIndex","oldParams","newParams","paramKeys","sort","params","hash","queryString2ParamsMap","ostring","it","isDate","isRegExp","queryParam","otherValue","optionUrl","substr","r","getUrl","relativeUrl","appendArgs","optionalAbsUrl","thePageUrl","pageUrl","baseUrl","dealUrl","tryCall","defaultReturn","exCallback","dealProperties","target","extendDeep","_AsyncCall","useTimer","count","ctrlCallbackMap","pushTask","callbackObj","handle","next","nextCallback","lastReturn","mineCount","ctrlCallback","asyncCallQueue","shift","nextObj","Promise","resolve","then","setTimeout","initCtrlCallback","theAsyncCall","theAsyncCallOfTimer","asyncCall","attrNames","defaultValue","attrs","setObjectAttr","_obj","o","clone","isDeep","source","flags","copy","setTime","attr","isDOM","HTMLElement","nodeType","nodeName","onReadyFun","isGlobalReady","bindReadyQueue","BindReady","isReady","addEventListener","removeEventListener","ready","attachEvent","fun2","readyState","detachEvent","documentElement","doScroll","frameElement","readyCall","onReady","br","type","toGlobal","deprecated","justLoader","is","funs","browser","_ignoreAspect_","theDefinedMap","lastDefinObjectMap","ModuleDef","module","queue","_preModule","relyQueue","args","relyIt","isPreDependOn","modules","defaultModule","targetDef","_isSrc","nameOrUrl","setLastDefineObject","defineObject","getLastDefineObject","getModule","selfname","isSrc","moduleDef","preDependOn","def","replaceModuleSrc","oldSrc","clearEmptyModuleBySrc","setModule","lasfDef","giveRelys","buildInvoker","getId","getAbsoluteUrl","rurl","require","define","absUrl","defineAsync","withAbsUrl","moduleMap","getName","Invoker","newModuleInstance","thatInvoker","relyCallback","pluginArgs","instanceModule","_invoker","_module_","initInvoker","ignoreAspect","_object","addTheAttrs","theObj","_invoker_","_modules_","_this","isSingle","instanceType","loopObject","description","_setDepModuleObjectGen","moduleObject","genExports","_getCacheKey","getCacheKey","_willCache","cacheResult","willCache","lastSinglePluginResult","setSinglePluginResult","init","justForSingle","dealInstance","hasFinished","onload","__default","_this2","onerror","concat","depModules","last","pluginMain","waitSeconds","_newModule","DefineObject","newModule","instances","relys","otherModule","directDefineIndex","_loadCallback","reinitByDefineObject","setInstanceType","_singlePluginResult","finish","_directArgs","currentDefineModuleQueue","setState","isDefault","state","errinfo","_callback","_state","theCallback","getDeps","defined_module_for_deps","toOtherModule","theRelys","whenNeed","loadCallback","callbackFun","moduleInstance","opId","setToAll","getModuleId","ins","mobj","_m_","printOnNotDefined","root","nodes","_printOnNotDefined","leafs","findLeaf","item","leaf","infos","genErrs","parent","reverse","as","errModule","depMod","parentNode","indexPlguin","mod","randModuleIndex","everyRequired","everyOkCallback","errCallback","isError","dealRelative","theExports","hasCallErr","depCount","invoker_the_module","syncHandle","originDep","version","groupModule","i1","i2","i3","defaultVersion","_url","_resUrlBuilder","isInUrls","getUrls","module2","loadModule","loadScript","scriptData","defaultMod","depModule","dep_name","checkFinish","orderDep","defContextName","DATA_ATTR_MODULE","DATA_ATTR_CONTEXT","INNER_DEPS_PLUGIN","innerDepsMap","globalDefineQueue","isOpera","opera","safariVersion","toLowerCase","readyRegExp","platform","theLoaderScript","currentScript","theLoaderUrl","head","peek","lastAppendHeadDom","isSrcFromScriptLoad","lastScriptSrc","theRealDefine","_dealEmbedDeps","modName","moduleScript","isOrderDep","_getPluginParam","_im","getInvoker","nullNew","_deps","jsFilePath","getMineAbsUrl","absoluteUrl","isRequire","willDealConfigDeps","parentDefine","onError","before","depBefore","depDeps","instance","dealConfigDeps","getCurrentScript","isRemoveQueryHash","b","sourceURL","stacktrace","_getCurrentScriptOrSrc","__createNode","createElement","charset","async","__removeListener","ieName","__browserLoader","moduleName","setAttribute","onScriptLoad","errListen","onScriptError","appendHeadDom","__getScriptData","evt","currentTarget","srcElement","dom","nextDom","nextSibling","insertBefore","removed","doDefine","predefine","prerequire","originDeps","argArr","theMod","timeid","customerErrCallback","isErr","clearTimeout","ifmodule","initDefine","theDefine","defines","loaded","onConfigedCallback","theContext","argsObject","_newContext","contextName","defQueue","scriptSrc","putUrlArgs","argsObj","getUrlArgs","clearUrlArgs","hasDefine","groupName","clear_module_","loader","pathname","ignoreProperties","depsPaths","defineFunction","autoUrlArgs","dealtDeps","hasOrderDep","splice","urlArg","forPrefixSuffix","aurl","encodeURIComponent","dealUrlArgs","isAutoUrlArgs","star","urlArgsArr","urlArgObj","starP","_urlArgs_prefix","_urlArgs_suffix","strfix","urlOrName","strfixObj","pushDeps","dealtDepArray","depsArray","keyName","defineHandle","originCallback","rt","defineFun","names","onModuleLoaded","lastDefineObject","needCallback","depModuleArgs","amd","depId","depsObj","arg","vars","existsMods","newName","lastM","load","engine","useImportLoad","useOnload","style","createStyle","curStyle","curSheet","styleSheet","sheet","createIeLoad","addImport","processIeLoad","ieCnt","importLoad","ieCurCallback","ieLoads","textContent","loadInterval","setInterval","cssRules","clearInterval","linkLoad","link","rel","styleSheets","cssAPI","nextLoad","cssId","loadCss","cssPath","loadCsses","http","handleAs","ok","fail","done","depsStr","json","progIds","httpRequest","prop","varName","defaultVal","putProp","toObj","_method","_params","_headers","_async","_multiPart","_handleType","_timeout","timeout","okCallback","failCallback","uploadStartCallback","uploadStart","uploadProgressCallback","uploadProgress","uploadOkCallback","uploadOk","uploadErrorCallback","uploadError","uploadEndCallback","uploadEnd","_beforeOpenHook","_onOkResponseHook","_onFailResponseHook","conn","xhr","toUpperCase","headers","handleType","multiPart","body","timeoutTimer","formData","FormData","append","open","setRequestHeader","header","upload","onloadstart","onprogress","onloadend","isTimeout","abort","onreadystatechange","status","_doOnFailResponseHook","responseText","send","_connAfterOpenHook","_conn","progId","XMLHttpRequest","ActiveXObject","createXhr","extraErr","urlStr","methodStr","isAsync","paramsObj","headersObj","extraErrorType","_xshttp_request_","isResponsed","callbacksQueue","code","desc","newHandle","instanceMap","cmd2ListenerMap","instanceBindMap","oinstanceidMap","isDebug","isXsMsgDebug","LinkedList","newNode","element","pre","headNode","lastNode","getElement","position","willRemove","pNode","currentNode","nextCurrentNode","current","insert","elementAt","eachForRemove","removeAt","find","remove","isEmpty","size","api","CommunicationUnit","cmd","connectingSource","onfailed","isActive","conndata","handleId","msgQueue","MAX_TRY","SLEEP","isConnected","connectCount","isCanceled","_onConned","_source","data","onConnectedListener","sendTop","_onMsg","msgid","onReceiveListener","postMessageBridge","sendResponse","_onResponse","_onElse","initListen","listen","msg","sendConn","runAfter","release","setSource","_connectWindow","winObjOrCallback","notActive","unit","listener","connected","origin","errtype","connectedCallback","receiveCallback","sender","winObj","_connectIFrame","iframe","contentWindow","osource","active","refused","instanceid","_sendData","event","oinstanceid","rdata","fromSource","originStr","listeners","Callback","isAccept","handleConn","minstanceid","handleAccept","checkSource","handleConned","handleMsg","handleResponse","handleBinded","time","handleApi","connectIFrame","connectParent","connectTop","top","connectOpener","opener","listenMessage","debug","postMessage","DATA_CONF","DATA_CONFX","DATA_CONF2","DATA_CONF2X","DATA_MAIN","DATA_MAINX","DATA_CONF_TYPE","serviceConfigUrl","dataConf","dataMain","dataConfType","initFun","getMainPath","mainPath","main","getPath","loadServiceConfig","tag","isLocal","confText","conf","localConfigVar","globalConfigVar","after","service","hasGlobal","resUrls","chooseLoader","localConfig","extendConfig","beforeDealProperties","confUrl","globalConfig","mainName","loaderName","initXsloader","pageHref","resUrl","originThis","originArgs"],"mappings":"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"}