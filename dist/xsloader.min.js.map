{"version":3,"file":"xsloader.min.js","sources":["../src/util/global.js","../src/core/loader.js","../src/util/urls.js","../src/util/base.js","../src/util/index.js","../src/public/global-deprecated.js","../src/polyfill/json.js","../src/public/global-base.js","../src/public/is.js","../src/public/funs.js","../src/public/browser.js","../src/public/index.js","../src/core/module-def.js","../src/core/module.js","../src/core/script.js","../src/core/index.js","../src/define.js","../src/core/plugins/inner-dep.js","../src/core/plugins/ready.js","../src/core/plugins/nodeps.js","../src/core/plugins/exists.js","../src/core/plugins/name.js","../src/core/plugins/css.js","../src/core/plugins/text.js","../src/core/plugins/window.js","../src/core/plugins/withdeps.js","../src/core/plugins/json.js","../src/core/plugins/xshttp.js","../src/core/plugins/xsrequest.js","../src/core/plugins/xsmsg.js","../src/service.js"],"sourcesContent":["let g;\nif(typeof window !== undefined) {\n\tg = window;\n} else if(typeof self !== undefined) {\n\tg = self;\n} else if(typeof global !== undefined) {\n\tg = global;\n} else {\n\tthrow new Error(\"not found global var!\");\n}\n\n/**\n * 用于包装变量，防止JSON.stringify等时输出指定变量。\n * @param {Object} val\n */\nfunction InVar(val) {\n\tthis.get = function() {\n\t\treturn val;\n\t};\n\n\tthis.set = function(newVal) {\n\t\tlet old = val;\n\t\tval = newVal;\n\t\treturn old;\n\t};\n}\ng.InVar = InVar;\n\nexport default g;","import global from '../util/global.js';\nlet loaderFun;\nlet xsloader = global.xsloader = function() {\n\treturn loaderFun.apply(this, arguments);\n};\n\nexport default {\n\tloaderFun: (fun) => {\n\t\tloaderFun = fun;\n\t}\n};","const ABSOLUTE_PROTOCOL_REG = /^(([a-zA-Z0-9_]*:\\/\\/)|(\\/)|(\\/\\/))/;\nconst ABSOLUTE_PROTOCOL_REG2 = /^([a-zA-Z0-9_]+:)\\/\\/([^/\\s]+)/;\nconst defaultJsExts = [\".js\", \".js+\", \".js++\", \".es\", \"es6\", \".jsx\", \".vue\"];\n\nimport global from './global.js';\nconst xsloader = global.xsloader;\n\nfunction isJsFile(path) {\n\tif(!xsloader.isString(path)) {\n\t\treturn false;\n\t}\n\tvar pluginIndex = path.indexOf(\"!\");\n\tif(pluginIndex > 0) {\n\t\tpath = path.substring(0, pluginIndex);\n\t}\n\tvar index = path.indexOf(\"?\");\n\tif(index > 0) {\n\t\tpath = path.substring(0, index);\n\t}\n\tindex = path.indexOf(\"#\");\n\tif(index > 0) {\n\t\tpath = path.substring(0, index);\n\t}\n\tlet theConfig = xsloader.config();\n\n\tvar jsExts = theConfig && theConfig.jsExts || defaultJsExts;\n\tfor(var i = 0; i < jsExts.length; i++) {\n\t\tif(xsloader.endsWith(path, jsExts[i])) {\n\t\t\treturn {\n\t\t\t\text: jsExts[i],\n\t\t\t\tpath: path\n\t\t\t};\n\t\t}\n\t}\n\treturn false;\n}\n\nfunction dealPathMayAbsolute(path, currentUrl) {\n\tcurrentUrl = currentUrl || location.href;\n\tlet rs = ABSOLUTE_PROTOCOL_REG.exec(path);\n\n\tlet finalPath;\n\tlet absolute;\n\tif(rs) {\n\t\tlet protocol = rs[1];\n\t\tabsolute = true;\n\n\t\trs = ABSOLUTE_PROTOCOL_REG2.exec(currentUrl);\n\t\tlet _protocol = rs && rs[1] || location.protocol;\n\t\tlet _host = rs && rs[2] || location.host;\n\n\t\tif(protocol == \"//\") {\n\t\t\tfinalPath = _protocol + \"//\" + path;\n\t\t} else if(protocol == \"/\") {\n\t\t\tfinalPath = _protocol + \"//\" + _host + path;\n\t\t} else {\n\t\t\tfinalPath = path;\n\t\t}\n\n\t} else {\n\t\tabsolute = false;\n\t\tfinalPath = path;\n\t}\n\treturn {\n\t\tabsolute: absolute,\n\t\tpath: finalPath\n\t};\n}\n\nfunction getPathWithRelative(path, relative, isPathDir) {\n\n\tlet relativeQuery = \"\";\n\tlet qIndex = path.lastIndexOf(\"?\");\n\tif(qIndex >= 0) {\n\t\tpath = path.substring(0, qIndex);\n\t} else {\n\t\tqIndex = path.lastIndexOf(\"#\");\n\t\tif(qIndex >= 0) {\n\t\t\tpath = path.substring(0, qIndex);\n\t\t}\n\t}\n\n\tqIndex = relative.lastIndexOf(\"?\");\n\tif(qIndex >= 0) {\n\t\trelativeQuery = relative.substring(qIndex);\n\t\trelative = relative.substring(0, qIndex);\n\t} else {\n\t\tqIndex = relative.lastIndexOf(\"#\");\n\t\tif(qIndex >= 0) {\n\t\t\trelativeQuery = relative.substring(qIndex);\n\t\t\trelative = relative.substring(0, qIndex);\n\t\t}\n\t}\n\n\tlet absolute = dealPathMayAbsolute(relative);\n\tif(absolute.absolute) {\n\t\treturn absolute.path + relativeQuery;\n\t}\n\n\tif(isPathDir === undefined) {\n\t\tlet index = path.lastIndexOf(\"/\");\n\t\tif(index == path.length - 1) {\n\t\t\tisPathDir = true;\n\t\t} else {\n\t\t\tif(index == -1) {\n\t\t\t\tindex = 0;\n\t\t\t} else {\n\t\t\t\tindex++;\n\t\t\t}\n\t\t\tisPathDir = path.indexOf(\".\", index) == -1;\n\t\t}\n\t}\n\n\tif(xsloader.endsWith(path, \"/\")) {\n\t\tpath = path.substring(0, path.length - 1);\n\t}\n\n\tlet isRelativeDir = false;\n\tif(relative == \".\" || xsloader.endsWith(relative, \"/\")) {\n\t\trelative = relative.substring(0, relative.length - 1);\n\t\tisRelativeDir = true;\n\t} else if(relative == \".\" || relative == \"..\" || xsloader.endsWith(\"/.\") || xsloader.endsWith(\"/..\")) {\n\t\tisRelativeDir = true;\n\t}\n\n\tlet prefix = \"\";\n\tlet index = -1;\n\tlet absolute2 = dealPathMayAbsolute(path);\n\tif(absolute2.absolute) {\n\t\tpath = absolute2.path;\n\t\tlet index2 = path.indexOf(\"//\");\n\t\tindex = path.indexOf(\"/\", index2 + 2);\n\t\tif(index == -1) {\n\t\t\tindex = path.length;\n\t\t}\n\t}\n\n\tprefix = path.substring(0, index + 1);\n\tpath = path.substring(index + 1);\n\n\tlet stack = path.split(\"/\");\n\tif(!isPathDir && stack.length > 0) {\n\t\tstack.pop();\n\t}\n\tlet relatives = relative.split(\"/\");\n\tfor(let i = 0; i < relatives.length; i++) {\n\t\tlet str = relatives[i];\n\t\tif(\"..\" == str) {\n\t\t\tif(stack.length == 0) {\n\t\t\t\tthrow new Error(\"no more upper path!\");\n\t\t\t}\n\t\t\tstack.pop();\n\t\t} else if(\".\" != str) {\n\t\t\tstack.push(str);\n\t\t}\n\t}\n\tif(stack.length == 0) {\n\t\treturn \"\";\n\t}\n\tlet result = prefix + stack.join(\"/\");\n\tif(isRelativeDir && !xsloader.endsWith(result, \"/\")) {\n\t\tresult += \"/\";\n\t}\n\tresult = xsloader.appendArgs2Url(result, relativeQuery);\n\treturn result;\n}\n\nfunction getNodeAbsolutePath(node) {\n\tlet src = node.src || node.getAttribute(\"src\");\n\treturn getPathWithRelative(location.href, src);\n}\n\n//去掉url的query参数和#参数\nfunction removeQueryHash(url) {\n\tif(url) {\n\t\tlet index = url.indexOf(\"?\");\n\t\tif(index >= 0) {\n\t\t\turl = url.substring(0, index);\n\t\t}\n\n\t\tindex = url.indexOf(\"#\");\n\t\tif(index >= 0) {\n\t\t\turl = url.substring(0, index);\n\t\t}\n\t}\n\treturn url;\n}\n\nconst REPLACE_STRING_PROPERTIES_EXP = new RegExp(\"\\\\$\\\\{([^\\\\{]+)\\\\}\");\nconst ALL_TYPE_PROPERTIES_EXP = new RegExp(\"^\\\\$\\\\[([^\\\\[\\\\]]+)\\\\]$\");\n\nfunction propertiesDeal(configObject, properties) {\n\tif(!properties) {\n\t\treturn configObject;\n\t}\n\n\tfunction replaceStringProperties(string, properties, property) {\n\t\tlet rs;\n\t\tlet str = string;\n\t\trs = ALL_TYPE_PROPERTIES_EXP.exec(str);\n\t\tif(rs) {\n\t\t\tlet propKey = rs[1];\n\t\t\tlet propValue = xsloader.getObjectAttr(properties, propKey);\n\t\t\tif(propValue === undefined) {\n\t\t\t\treturn str;\n\t\t\t} else {\n\t\t\t\treturn propValue;\n\t\t\t}\n\t\t}\n\n\t\tlet result = \"\";\n\t\twhile(true) {\n\t\t\trs = REPLACE_STRING_PROPERTIES_EXP.exec(str);\n\t\t\tif(!rs) {\n\t\t\t\tresult += str;\n\t\t\t\tbreak;\n\t\t\t} else {\n\t\t\t\tlet propKey = rs[1];\n\t\t\t\tif(property !== undefined && property.propertyKey == propKey) {\n\t\t\t\t\tthrow new Error(\"replace property error:propertyKey=\" + propKey);\n\t\t\t\t} else if(property) {\n\t\t\t\t\tproperty.has = true;\n\t\t\t\t}\n\t\t\t\tresult += str.substring(0, rs.index);\n\t\t\t\tresult += xsloader.getObjectAttr(properties, propKey);\n\t\t\t\tstr = str.substring(rs.index + rs[0].length);\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\n\t//处理属性引用\n\tfunction replaceProperties(obj, property, enableKeyAttr) {\n\t\tif(!obj) {\n\t\t\treturn obj;\n\t\t}\n\t\tif(xsloader.isFunction(obj)) {\n\t\t\treturn obj;\n\t\t} else if(xsloader.isArray(obj)) {\n\t\t\tfor(let i = 0; i < obj.length; i++) {\n\t\t\t\tobj[i] = replaceProperties(obj[i], property, enableKeyAttr);\n\t\t\t}\n\t\t} else if(xsloader.isString(obj)) {\n\t\t\tobj = replaceStringProperties(obj, properties, property);\n\t\t} else if(xsloader.isObject(obj)) {\n\t\t\tif(property) {\n\t\t\t\tproperty.has = false;\n\t\t\t}\n\t\t\tlet replaceKeyMap = {};\n\t\t\tfor(let x in obj) {\n\t\t\t\tif(property) {\n\t\t\t\t\tproperty.propertyKey = x;\n\t\t\t\t}\n\t\t\t\tobj[x] = replaceProperties(obj[x], property, enableKeyAttr);\n\t\t\t\tif(enableKeyAttr) {\n\t\t\t\t\tlet _x = replaceStringProperties(x, properties, property);\n\t\t\t\t\tif(_x !== x) {\n\t\t\t\t\t\treplaceKeyMap[x] = _x;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tfor(let x in replaceKeyMap) {\n\t\t\t\tlet objx = obj[x];\n\t\t\t\tdelete obj[x];\n\t\t\t\tobj[replaceKeyMap[x]] = objx;\n\t\t\t}\n\t\t}\n\n\t\treturn obj;\n\n\t}\n\n\tif(!properties.__dealt__) {\n\t\tlet property = {\n\t\t\thas: false\n\t\t};\n\n\t\tfor(let x in properties) {\n\t\t\tlet fun = properties[x];\n\t\t\tif(xsloader.isFunction(fun)) {\n\t\t\t\tproperties[x] = fun.call(properties);\n\t\t\t}\n\t\t}\n\t\tdo {\n\t\t\treplaceProperties(properties, property);\n\t\t} while (property.has);\n\t\tproperties.__dealt__ = true;\n\t}\n\n\treturn replaceProperties(configObject, undefined, true);\n}\n\nfunction replaceModulePrefix(config, deps) {\n\n\tif(!deps) {\n\t\treturn;\n\t}\n\n\tfor(let i = 0; i < deps.length; i++) {\n\t\tlet m = deps[i];\n\t\tlet index = m.indexOf(\"!\");\n\t\tlet pluginParam = index > 0 ? m.substring(index) : \"\";\n\t\tm = index > 0 ? m.substring(0, index) : m;\n\n\t\tindex = m.indexOf(\"?\");\n\t\tlet query = index > 0 ? m.substring(index) : \"\";\n\t\tm = index > 0 ? m.substring(0, index) : m;\n\n\t\tlet is = isJsFile(m);\n\t\tif(!is && (xsloader.startsWith(m, \".\") || dealPathMayAbsolute(m).absolute)) {\n\t\t\tdeps[i] = m + \".js\" + query + pluginParam;\n\t\t}\n\t}\n\n\tif(config.modulePrefixCount) {\n\t\t//模块地址的前缀替换\n\t\tfor(let prefix in config.modulePrefix) {\n\t\t\tlet replaceStr = config.modulePrefix[prefix].replace;\n\t\t\tlet len = prefix.length;\n\t\t\tfor(let i = 0; i < deps.length; i++) {\n\t\t\t\tlet m = deps[i];\n\t\t\t\tlet pluginIndex = m.indexOf(\"!\");\n\t\t\t\tlet pluginName = null;\n\t\t\t\tif(pluginIndex >= 0) {\n\t\t\t\t\tpluginName = m.substring(0, pluginIndex + 1);\n\t\t\t\t\tm = m.substring(pluginIndex + 1);\n\t\t\t\t}\n\t\t\t\tif(xsloader.startsWith(m, prefix)) {\n\t\t\t\t\tlet dep = replaceStr + m.substring(len);\n\t\t\t\t\tdeps[i] = pluginName ? pluginName + dep : dep;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\nfunction getScriptBySubname(subname) {\n\tlet ss = document.getElementsByTagName('script');\n\tif(subname) {\n\t\tfor(let i = 0; i < ss.length; i++) {\n\t\t\tlet script = ss[i];\n\t\t\tlet src = script.src;\n\t\t\tsrc = src.substring(src.lastIndexOf(\"/\"));\n\t\t\tif(src.indexOf(subname) >= 0) {\n\t\t\t\treturn script;\n\t\t\t}\n\t\t}\n\t} else {\n\t\treturn ss;\n\t}\n}\n\nexport default {\n\tgetPathWithRelative,\n\tgetNodeAbsolutePath,\n\tdealPathMayAbsolute,\n\tremoveQueryHash,\n\tpropertiesDeal,\n\treplaceModulePrefix,\n\tisJsFile,\n\tgetScriptBySubname,\n};","import global from './global.js';\nconst xsloader = global.xsloader;\nconst commentRegExp = /\\/\\*[\\s\\S]*?\\*\\/|([^:\"'=]|^)\\/\\/.*$/mg;\nconst cjsRequireRegExp = /[^.]require\\s*\\(\\s*[\"']([^'\"\\r\\n]+)[\"']\\s*\\)/g;\n\n//基于有向图进行循环依赖检测\nfunction GraphPath() {\n\tlet pathEdges = {};\n\tlet vertexMap = {};\n\tlet depMap = {};\n\tthis.addEdge = function(begin, end) {\n\t\tdepMap[begin + \"|\" + end] = true;\n\t\tif(!pathEdges[begin]) {\n\t\t\tpathEdges[begin] = [];\n\t\t}\n\t\tif(!vertexMap[begin]) {\n\t\t\tvertexMap[begin] = true;\n\t\t}\n\t\tif(!vertexMap[end]) {\n\t\t\tvertexMap[end] = true;\n\t\t}\n\t\tpathEdges[begin].push({\n\t\t\tbegin: begin,\n\t\t\tend: end\n\t\t});\n\t};\n\n\tthis.hasDep = function(name, dep) {\n\t\treturn depMap[name + \"|\" + dep];\n\t};\n\n\tthis.tryAddEdge = function(begin, end) {\n\t\tthis.addEdge(begin, end);\n\t\tlet paths = this.hasLoop();\n\t\tif(paths.length > 0) {\n\t\t\tpathEdges[begin].pop();\n\t\t}\n\t\treturn paths;\n\t};\n\n\tthis.hasLoop = function() {\n\t\tlet visited = {};\n\t\tlet recursionStack = {};\n\n\t\tfor(let x in vertexMap) {\n\t\t\tvisited[x] = false;\n\t\t\trecursionStack[x] = false;\n\t\t}\n\n\t\tlet has = false;\n\t\tlet paths = [];\n\t\tfor(let name in vertexMap) {\n\t\t\tpaths = [];\n\t\t\tif(checkLoop(name, visited, recursionStack, paths)) {\n\t\t\t\thas = true;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\treturn has ? paths : [];\n\t};\n\n\tfunction checkLoop(v, visited, recursionStack, paths) {\n\t\tif(!visited[v]) {\n\t\t\tvisited[v] = true;\n\t\t\trecursionStack[v] = true;\n\t\t\tpaths.push(v);\n\n\t\t\tif(pathEdges[v]) {\n\t\t\t\tlet edges = pathEdges[v];\n\t\t\t\tfor(let i = 0; i < edges.length; i++) {\n\t\t\t\t\tlet edge = edges[i];\n\t\t\t\t\tif(!visited[edge.end] && checkLoop(edge.end, visited, recursionStack, paths)) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t} else if(recursionStack[edge.end]) {\n\t\t\t\t\t\tpaths.push(edge.end);\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\trecursionStack[v] = false;\n\t\treturn false;\n\t}\n}\n\n//使得内部的字符串变成数组\nfunction strValue2Arr(obj) {\n\tif(!obj || xsloader.isArray(obj)) {\n\t\treturn;\n\t}\n\tfor(let x in obj) {\n\t\tif(xsloader.isString(obj[x])) {\n\t\t\tobj[x] = [obj[x]];\n\t\t}\n\t}\n}\n\n/**\n * 同步模式下，返回false表示终止循环。\n * @param {Object} ary\n * @param {Object} func\n * @param {Object} isSync\n * @param {Object} fromEnd\n */\nfunction each(ary, func, isSync, fromEnd) {\n\tif(ary) {\n\t\tif(isSync) {\n\t\t\tfunction fun(index) {\n\t\t\t\tif(fromEnd ? index < 0 : index >= ary.length) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tlet handle = function(rs) {\n\t\t\t\t\tif(rs) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tfun(fromEnd ? index - 1 : index + 1);\n\t\t\t\t};\n\t\t\t\tfunc(ary[index], index, ary, handle);\n\t\t\t}\n\t\t\tfun(fromEnd ? ary.length - 1 : 0);\n\t\t} else {\n\t\t\tif(fromEnd) {\n\t\t\t\tfor(let i = ary.length - 1; i >= 0; i--) {\n\t\t\t\t\tif(func(ary[i], i, ary) === false) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tfor(let i = 0; i < ary.length; i++) {\n\t\t\t\t\tif(func(ary[i], i, ary) === false) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t}\n}\n\nfunction __commentReplace(match, singlePrefix) {\n\treturn singlePrefix || '';\n}\n//添加内部直接require('...')的模块\nfunction appendInnerDeps(deps, callback) {\n\tif(xsloader.isFunction(callback)) {\n\t\tcallback\n\t\t\t.toString()\n\t\t\t.replace(commentRegExp, __commentReplace)\n\t\t\t.replace(cjsRequireRegExp, function(match, dep) {\n\t\t\t\tdeps.push(dep);\n\t\t\t});\n\t}\n}\n\nlet idCount = 2019;\n\nfunction getAndIncIdCount() {\n\treturn idCount++;\n}\n\nclass PluginError {\n\tconstructor(err) {\n\t\tthis.err = err;\n\t}\n}\n\nexport default {\n\tgraphPath: new GraphPath(),\n\tstrValue2Arr,\n\teach,\n\tappendInnerDeps,\n\tgetAndIncIdCount,\n\tPluginError\n};","import urls from './urls.js';\nimport global from './global.js';\nimport base from './base.js';\n\nexport default {\n\t...urls,\n\tglobal,\n\t...base\n};","import utils from \"../util/index.js\";\n\nconst global = utils.global;\nconst xsloader = global.xsloader;\n\n//ie9\ntry {\n\tif(Function.prototype.bind && console && (typeof console['log'] == \"object\")) {\n\t\tutils.each([\"log\", \"info\", \"warn\", \"error\", \"assert\", \"dir\", \"clear\", \"profile\", \"profileEnd\"], (method) => {\n\t\t\tvar thiz = Function.prototype.bind;\n\t\t\tconsole[method] = thiz.call(console[method], console);\n\t\t});\n\t}\n} catch(e) {\n\tglobal.console = {\n\t\tlog: function() {},\n\t\terror: function() {},\n\t\twarn: function() {}\n\t};\n}\n\ntry {\n\n\tif(!Array.prototype.indexOf) {\n\t\tArray.prototype.indexOf = function(elem, offset) {\n\t\t\tfor(let i = offset === undefined ? 0 : offset; i < this.length; i++) {\n\t\t\t\tif(this[i] == elem) {\n\t\t\t\t\treturn i;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn -1;\n\t\t};\n\t}\n\n\tif(!Array.pushAll) {\n\t\tArray.pushAll = function(thiz, arr) {\n\t\t\tif(!xsloader.isArray(arr)) {\n\t\t\t\tthrow new Error(\"not array:\" + arr);\n\t\t\t}\n\t\t\tfor(let i = 0; i < arr.length; i++) {\n\t\t\t\tthiz.push(arr[i]);\n\t\t\t}\n\t\t\treturn thiz;\n\t\t};\n\t}\n} catch(e) {\n\tconsole.error(e);\n}\n\nfunction startsWith(str, starts) {\n\tif(!(typeof str == \"string\")) {\n\t\treturn false;\n\t}\n\treturn str.indexOf(starts) == 0;\n}\n\nfunction endsWith(str, ends) {\n\tif(!(typeof str == \"string\")) {\n\t\treturn false;\n\t}\n\tlet index = str.lastIndexOf(ends);\n\tif(index >= 0 && (str.length - ends.length == index)) {\n\t\treturn true;\n\t} else {\n\t\treturn false;\n\t}\n}\n\nfunction _indexInArray(array, ele, offset = 0, compare) {\n\tlet index = -1;\n\tif(array) {\n\t\tfor(let i = offset || 0; i < array.length; i++) {\n\t\t\tif(compare) {\n\t\t\t\tif(compare(array[i], ele, i, array)) {\n\t\t\t\t\tindex = i;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif(array[i] == ele) {\n\t\t\t\t\tindex = i;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t}\n\t}\n\treturn index;\n}\n\nfunction indexInArray(array, ele, compare) {\n\treturn _indexInArray(array, ele, 0, compare);\n}\n\nfunction indexInArrayFrom(array, ele, offset, compare) {\n\treturn _indexInArray(array, ele, offset, compare);\n}\n\nexport default {\n\tstartsWith,\n\tendsWith,\n\tindexInArray,\n\tindexInArrayFrom\n};","//https://github.com/douglascrockford/JSON-js\n//  json2.js\n//  2017-06-12\n//  Public Domain.\n//  NO WARRANTY EXPRESSED OR IMPLIED. USE AT YOUR OWN RISK.\n\n//  USE YOUR OWN COPY. IT IS EXTREMELY UNWISE TO LOAD CODE FROM SERVERS YOU DO\n//  NOT CONTROL.\nconst JSON = {};\n\nexport default JSON;\n\nlet rx_one = /^[\\],:{}\\s]*$/;\nlet rx_two = /\\\\(?:[\"\\\\\\/bfnrt]|u[0-9a-fA-F]{4})/g;\nlet rx_three = /\"[^\"\\\\\\n\\r]*\"|true|false|null|-?\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d+)?/g;\nlet rx_four = /(?:^|:|,)(?:\\s*\\[)+/g;\nlet rx_escapable = /[\\\\\"\\u0000-\\u001f\\u007f-\\u009f\\u00ad\\u0600-\\u0604\\u070f\\u17b4\\u17b5\\u200c-\\u200f\\u2028-\\u202f\\u2060-\\u206f\\ufeff\\ufff0-\\uffff]/g;\nlet rx_dangerous = /[\\u0000\\u00ad\\u0600-\\u0604\\u070f\\u17b4\\u17b5\\u200c-\\u200f\\u2028-\\u202f\\u2060-\\u206f\\ufeff\\ufff0-\\uffff]/g;\n\nfunction f(n) {\n\t// Format integers to have at least two digits.\n\treturn(n < 10) ?\n\t\t\"0\" + n :\n\t\tn;\n}\n\nfunction this_value() {\n\treturn this.valueOf();\n}\n\nif(typeof Date.prototype.toJSON !== \"function\") {\n\n\tDate.prototype.toJSON = function() {\n\t\treturn isFinite(this.valueOf()) ?\n\t\t\t(\n\t\t\t\tthis.getUTCFullYear() +\n\t\t\t\t\"-\" +\n\t\t\t\tf(this.getUTCMonth() + 1) +\n\t\t\t\t\"-\" +\n\t\t\t\tf(this.getUTCDate()) +\n\t\t\t\t\"T\" +\n\t\t\t\tf(this.getUTCHours()) +\n\t\t\t\t\":\" +\n\t\t\t\tf(this.getUTCMinutes()) +\n\t\t\t\t\":\" +\n\t\t\t\tf(this.getUTCSeconds()) +\n\t\t\t\t\"Z\"\n\t\t\t) :\n\t\t\tnull;\n\t};\n\n\tBoolean.prototype.toJSON = this_value;\n\tNumber.prototype.toJSON = this_value;\n\tString.prototype.toJSON = this_value;\n}\n\nlet gap;\nlet indent;\nlet meta;\nlet rep;\n\nfunction quote(string) {\n\n\t// If the string contains no control characters, no quote characters, and no\n\t// backslash characters, then we can safely slap some quotes around it.\n\t// Otherwise we must also replace the offending characters with safe escape\n\t// sequences.\n\n\trx_escapable.lastIndex = 0;\n\treturn rx_escapable.test(string) ?\n\t\t\"\\\"\" + string.replace(rx_escapable, function(a) {\n\t\t\tlet c = meta[a];\n\t\t\treturn typeof c === \"string\" ?\n\t\t\t\tc :\n\t\t\t\t\"\\\\u\" + (\"0000\" + a.charCodeAt(0).toString(16)).slice(-4);\n\t\t}) + \"\\\"\" :\n\t\t\"\\\"\" + string + \"\\\"\";\n}\n\nfunction str(key, holder) {\n\t// Produce a string from holder[key].\n\tlet i; // The loop counter.\n\tlet k; // The member key.\n\tlet v; // The member value.\n\tlet length;\n\tlet mind = gap;\n\tlet partial;\n\tlet value = holder[key];\n\n\t// If the value has a toJSON method, call it to obtain a replacement value.\n\tif(\n\t\tvalue &&\n\t\ttypeof value === \"object\" &&\n\t\ttypeof value.toJSON === \"function\"\n\t) {\n\t\tvalue = value.toJSON(key);\n\t}\n\n\t// If we were called with a replacer function, then call the replacer to\n\t// obtain a replacement value.\n\n\tif(typeof rep === \"function\") {\n\t\tvalue = rep.call(holder, key, value);\n\t}\n\n\t// What happens next depends on the value's type.\n\n\tswitch(typeof value) {\n\t\tcase \"string\":\n\t\t\treturn quote(value);\n\t\tcase \"number\":\n\t\t\t// JSON numbers must be finite. Encode non-finite numbers as null.\n\t\t\treturn(isFinite(value)) ?\n\t\t\t\tString(value) :\n\t\t\t\t\"null\";\n\n\t\tcase \"boolean\":\n\t\tcase \"null\":\n\t\t\t// If the value is a boolean or null, convert it to a string. Note:\n\t\t\t// typeof null does not produce \"null\". The case is included here in\n\t\t\t// the remote chance that this gets fixed someday.\n\t\t\treturn String(value);\n\n\t\t\t// If the type is \"object\", we might be dealing with an object or an array or\n\t\t\t// null.\n\t\tcase \"object\":\n\t\t\t// Due to a specification blunder in ECMAScript, typeof null is \"object\",\n\t\t\t// so watch out for that case.\n\t\t\tif(!value) {\n\t\t\t\treturn \"null\";\n\t\t\t}\n\n\t\t\t// Make an array to hold the partial results of stringifying this object value.\n\n\t\t\tgap += indent;\n\t\t\tpartial = [];\n\t\t\t// Is the value an array?\n\t\t\tif(Object.prototype.toString.apply(value) === \"[object Array]\") {\n\n\t\t\t\t// The value is an array. Stringify every element. Use null as a placeholder\n\t\t\t\t// for non-JSON values.\n\t\t\t\tlength = value.length;\n\t\t\t\tfor(i = 0; i < length; i += 1) {\n\t\t\t\t\tpartial[i] = str(i, value) || \"null\";\n\t\t\t\t}\n\t\t\t\t// Join all of the elements together, separated with commas, and wrap them in\n\t\t\t\t// brackets.\n\n\t\t\t\tv = partial.length === 0 ?\n\t\t\t\t\t\"[]\" :\n\t\t\t\t\tgap ?\n\t\t\t\t\t(\n\t\t\t\t\t\t\"[\\n\" +\n\t\t\t\t\t\tgap +\n\t\t\t\t\t\tpartial.join(\",\\n\" + gap) +\n\t\t\t\t\t\t\"\\n\" +\n\t\t\t\t\t\tmind +\n\t\t\t\t\t\t\"]\"\n\t\t\t\t\t) :\n\t\t\t\t\t\"[\" + partial.join(\",\") + \"]\";\n\t\t\t\tgap = mind;\n\t\t\t\treturn v;\n\t\t\t}\n\n\t\t\t// If the replacer is an array, use it to select the members to be stringified.\n\t\t\tif(rep && typeof rep === \"object\") {\n\t\t\t\tlength = rep.length;\n\t\t\t\tfor(i = 0; i < length; i += 1) {\n\t\t\t\t\tif(typeof rep[i] === \"string\") {\n\t\t\t\t\t\tk = rep[i];\n\t\t\t\t\t\tv = str(k, value);\n\t\t\t\t\t\tif(v) {\n\t\t\t\t\t\t\tpartial.push(quote(k) + (\n\t\t\t\t\t\t\t\t(gap) ?\n\t\t\t\t\t\t\t\t\": \" : \":\"\n\t\t\t\t\t\t\t) + v);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// Otherwise, iterate through all of the keys in the object.\n\t\t\t\tfor(k in value) {\n\t\t\t\t\tif(Object.prototype.hasOwnProperty.call(value, k)) {\n\t\t\t\t\t\tv = str(k, value);\n\t\t\t\t\t\tif(v) {\n\t\t\t\t\t\t\tpartial.push(quote(k) + (\n\t\t\t\t\t\t\t\t(gap) ?\n\t\t\t\t\t\t\t\t\": \" :\n\t\t\t\t\t\t\t\t\":\"\n\t\t\t\t\t\t\t) + v);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Join all of the member texts together, separated with commas,\n\t\t\t// and wrap them in braces.\n\n\t\t\tv = partial.length === 0 ?\n\t\t\t\t\"{}\" : gap ?\n\t\t\t\t\"{\\n\" + gap + partial.join(\",\\n\" + gap) + \"\\n\" + mind + \"}\" :\n\t\t\t\t\"{\" + partial.join(\",\") + \"}\";\n\t\t\tgap = mind;\n\t\t\treturn v;\n\t}\n}\n\n// If the JSON object does not yet have a stringify method, give it one.\nif(typeof JSON.stringify !== \"function\") {\n\tmeta = { // table of character substitutions\n\t\t\"\\b\": \"\\\\b\",\n\t\t\"\\t\": \"\\\\t\",\n\t\t\"\\n\": \"\\\\n\",\n\t\t\"\\f\": \"\\\\f\",\n\t\t\"\\r\": \"\\\\r\",\n\t\t\"\\\"\": \"\\\\\\\"\",\n\t\t\"\\\\\": \"\\\\\\\\\"\n\t};\n\tJSON.stringify = function(value, replacer, space) {\n\n\t\t// The stringify method takes a value and an optional replacer, and an optional\n\t\t// space parameter, and returns a JSON text. The replacer can be a function\n\t\t// that can replace values, or an array of strings that will select the keys.\n\t\t// A default replacer method can be provided. Use of the space parameter can\n\t\t// produce text that is more easily readable.\n\n\t\tlet i;\n\t\tgap = \"\";\n\t\tindent = \"\";\n\t\t// If the space parameter is a number, make an indent string containing that\n\t\t// many spaces.\n\t\tif(typeof space === \"number\") {\n\t\t\tfor(i = 0; i < space; i += 1) {\n\t\t\t\tindent += \" \";\n\t\t\t}\n\n\t\t\t// If the space parameter is a string, it will be used as the indent string.\n\n\t\t} else if(typeof space === \"string\") {\n\t\t\tindent = space;\n\t\t}\n\n\t\t// If there is a replacer, it must be a function or an array.\n\t\t// Otherwise, throw an error.\n\n\t\trep = replacer;\n\t\tif(replacer && typeof replacer !== \"function\" && (\n\t\t\t\ttypeof replacer !== \"object\" ||\n\t\t\t\ttypeof replacer.length !== \"number\"\n\t\t\t)) {\n\t\t\tthrow new Error(\"JSON.stringify\");\n\t\t}\n\n\t\t// Make a fake root object containing our value under the key of \"\".\n\t\t// Return the result of stringifying the value.\n\n\t\treturn str(\"\", {\n\t\t\t\"\": value\n\t\t});\n\t};\n}\n\n// If the JSON object does not yet have a parse method, give it one.\n\nif(typeof JSON.parse !== \"function\") {\n\tJSON.parse = function(text, reviver) {\n\t\t// The parse method takes a text and an optional reviver function, and returns\n\t\t// a JavaScript value if the text is a valid JSON text.\n\t\tlet j;\n\n\t\tfunction walk(holder, key) {\n\t\t\t// The walk method is used to recursively walk the resulting structure so\n\t\t\t// that modifications can be made.\n\t\t\tlet k;\n\t\t\tlet v;\n\t\t\tlet value = holder[key];\n\t\t\tif(value && typeof value === \"object\") {\n\t\t\t\tfor(k in value) {\n\t\t\t\t\tif(Object.prototype.hasOwnProperty.call(value, k)) {\n\t\t\t\t\t\tv = walk(value, k);\n\t\t\t\t\t\tif(v !== undefined) {\n\t\t\t\t\t\t\tvalue[k] = v;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tdelete value[k];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn reviver.call(holder, key, value);\n\t\t}\n\n\t\t// Parsing happens in four stages. In the first stage, we replace certain\n\t\t// Unicode characters with escape sequences. JavaScript handles many characters\n\t\t// incorrectly, either silently deleting them, or treating them as line endings.\n\t\ttext = String(text);\n\t\trx_dangerous.lastIndex = 0;\n\t\tif(rx_dangerous.test(text)) {\n\t\t\ttext = text.replace(rx_dangerous, function(a) {\n\t\t\t\treturn(\n\t\t\t\t\t\"\\\\u\" +\n\t\t\t\t\t(\"0000\" + a.charCodeAt(0).toString(16)).slice(-4)\n\t\t\t\t);\n\t\t\t});\n\t\t}\n\n\t\t// In the second stage, we run the text against regular expressions that look\n\t\t// for non-JSON patterns. We are especially concerned with \"()\" and \"new\"\n\t\t// because they can cause invocation, and \"=\" because it can cause mutation.\n\t\t// But just to be safe, we want to reject all unexpected forms.\n\n\t\t// We split the second stage into 4 regexp operations in order to work around\n\t\t// crippling inefficiencies in IE's and Safari's regexp engines. First we\n\t\t// replace the JSON backslash pairs with \"@\" (a non-JSON character). Second, we\n\t\t// replace all simple value tokens with \"]\" characters. Third, we delete all\n\t\t// open brackets that follow a colon or comma or that begin the text. Finally,\n\t\t// we look to see that the remaining characters are only whitespace or \"]\" or\n\t\t// \",\" or \":\" or \"{\" or \"}\". If that is so, then the text is safe for eval.\n\n\t\tif(\n\t\t\trx_one.test(\n\t\t\t\ttext\n\t\t\t\t.replace(rx_two, \"@\")\n\t\t\t\t.replace(rx_three, \"]\")\n\t\t\t\t.replace(rx_four, \"\")\n\t\t\t)\n\t\t) {\n\n\t\t\t// In the third stage we use the eval function to compile the text into a\n\t\t\t// JavaScript structure. The \"{\" operator is subject to a syntactic ambiguity\n\t\t\t// in JavaScript: it can begin a block or an object literal. We wrap the text\n\t\t\t// in parens to eliminate the ambiguity.\n\t\t\tj = eval(\"(\" + text + \")\");\n\t\t\t// In the optional fourth stage, we recursively walk the new structure, passing\n\t\t\t// each name/value pair to a reviver function for possible transformation.\n\n\t\t\treturn(typeof reviver === \"function\") ?\n\t\t\t\twalk({\n\t\t\t\t\t\"\": j\n\t\t\t\t}, \"\") : j;\n\t\t}\n\t\t// If the text is not JSON parseable, then a SyntaxError is thrown.\n\t\tthrow new SyntaxError(\"JSON.parse\");\n\t};\n}","import {\n\tJSON as xsJSON\n} from \"../polyfill/index.js\";\nimport utils from \"../util/index.js\";\n\nconst global = utils.global;\nconst xsloader = global.xsloader;\n\nif(!String.prototype.trim) {\n\tString.prototype.trim = function() {\n\t\treturn this.replace(/^\\s\\s*/, '').replace(/\\s\\s*$/, '');\n\t};\n}\n\n//生成一个随机的id，只保证在本页面是唯一的\nfunction randId(suffix) {\n\tlet id = \"r\" + parseInt(new Date().getTime() / 1000) + \"_\" + parseInt(Math.random() * 1000) + \"_\" + utils.getAndIncIdCount();\n\tif(suffix !== undefined) {\n\t\tid += suffix;\n\t}\n\treturn id;\n}\n\nfunction xsEval(scriptString) {\n\ttry {\n\t\tlet rs = xsloader.IE_VERSION > 0 && xsloader.IE_VERSION < 9 ? eval(\"[\" + scriptString + \"][0]\") : eval(\"(\" + scriptString + \")\");\n\t\treturn rs;\n\t} catch(e) {\n\t\tthrow e;\n\t}\n}\n\n/**\n * 注意key需要用引号包裹\n * @param {Object} str\n * @param {Object} option\n */\nfunction xsParseJson(str, option) {\n\tif(str === \"\" || str === null || str === undefined || !xsloader.isString(str)) {\n\t\treturn str;\n\t}\n\n\toption = xsloader.extend({\n\t\tfnStart: \"\", //\"/*{f}*/\",\n\t\tfnEnd: \"\", //\"/*{f}*/\",\n\t\trcomment: \"\\\\/\\\\/#\\\\/\\\\/\"\n\t}, option);\n\n\tlet fnMap = {};\n\tlet fnOffset = 0;\n\tlet replacer = undefined;\n\tif(option.fnStart && option.fnEnd) {\n\t\twhile(true) {\n\t\t\tlet indexStart = str.indexOf(option.fnStart, fnOffset);\n\t\t\tlet indexEnd = str.indexOf(option.fnEnd, indexStart == -1 ? fnOffset : indexStart + option.fnStart.length);\n\t\t\tif(indexStart == -1 && indexEnd == -1) {\n\t\t\t\tbreak;\n\t\t\t} else if(indexStart == -1) {\n\t\t\t\tconsole.warn(\"found end:\" + option.fnEnd + \",may lack start:\" + option.fnStart);\n\t\t\t\tbreak;\n\t\t\t} else if(indexEnd == -1) {\n\t\t\t\tconsole.warn(\"found start:\" + option.fnStart + \",may lack end:\" + option.fnEnd);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tlet fnId = \"_[_\" + randId() + \"_]_\";\n\t\t\tlet fnStr = str.substring(indexStart + option.fnStart.length, indexEnd).trim();\n\t\t\tif(!xsloader.startsWith(fnStr, \"function(\")) {\n\t\t\t\tthrow \"not a function:\" + fnStr;\n\t\t\t}\n\t\t\ttry {\n\t\t\t\tstr = str.substring(0, indexStart) + '\"' + fnId + '\"' + str.substring(indexEnd + option.fnEnd.length);\n\t\t\t\tlet fn = xsloader.xsEval(fnStr);\n\t\t\t\tfnMap[fnId] = fn;\n\t\t\t} catch(e) {\n\t\t\t\tconsole.error(fnStr);\n\t\t\t\tthrow e;\n\t\t\t}\n\t\t\tfnOffset = indexStart + fnId.length;\n\t\t}\n\t\treplacer = function(key, val) {\n\t\t\tif(xsloader.isString(val) && fnMap[val]) {\n\t\t\t\treturn fnMap[val];\n\t\t\t} else {\n\t\t\t\treturn val;\n\t\t\t}\n\t\t};\n\t}\n\n\tif(option.rcomment) {\n\t\tstr = str.replace(/(\\r\\n)|\\r/g, \"\\n\"); //统一换行符号\n\t\tstr = str.replace(new RegExp(option.rcomment + \"[^\\\\n]*(\\\\n|$)\", \"g\"), \"\"); //去除行注释\n\t}\n\n\ttry {\n\t\tlet jsonObj = xsJSON;\n\t\treturn jsonObj.parse(str, replacer);\n\t} catch(e) {\n\t\ttry {\n\t\t\tlet reg = new RegExp('position[\\\\s]*([0-9]+)[\\\\s]*$');\n\t\t\tif(e.message && reg.test(e.message)) {\n\t\t\t\tlet posStr = e.message.substring(e.message.lastIndexOf(\"position\") + 8);\n\t\t\t\tlet pos = parseInt(posStr.trim());\n\t\t\t\tlet _str = str.substring(pos);\n\t\t\t\tconsole.error(e.message + \":\" + _str.substring(0, _str.length > 100 ? 100 : _str.length));\n\t\t\t}\n\t\t} catch(e2) {\n\t\t\tconsole.warn(e2);\n\t\t}\n\t\tthrow e;\n\t}\n}\n\nfunction xsJson2String(obj) {\n\tlet jsonObj = xsJSON;\n\treturn jsonObj.stringify(obj);\n}\n\nconst getPathWithRelative = utils.getPathWithRelative;\n\nfunction _toParamsMap(argsStr, decode = true) {\n\tif(xsloader.isObject(argsStr)) {\n\t\treturn argsStr;\n\t}\n\tif(!argsStr) {\n\t\targsStr = location.search;\n\t}\n\n\tlet index = argsStr.indexOf(\"?\");\n\tif(index >= 0) {\n\t\targsStr = argsStr.substring(index + 1);\n\t} else {\n\t\tif(utils.dealPathMayAbsolute(argsStr).absolute) {\n\t\t\treturn {};\n\t\t}\n\t}\n\tindex = argsStr.lastIndexOf(\"#\");\n\tif(index >= 0) {\n\t\targsStr = argsStr.substring(0, index);\n\t}\n\n\tlet ret = {},\n\t\tseg = argsStr.split('&'),\n\t\ts;\n\tfor(let i = 0; i < seg.length; i++) {\n\t\tif(!seg[i]) {\n\t\t\tcontinue;\n\t\t}\n\t\ts = seg[i].split('=');\n\t\tlet name = decode ? decodeURIComponent(s[0]) : s[0];\n\t\tret[name] = decode ? decodeURIComponent(s[1]) : s[1];\n\t}\n\treturn ret;\n}\n\nfunction appendArgs2Url(url, urlArgs) {\n\tif(url === undefined || url === null || !urlArgs) {\n\t\treturn url;\n\t}\n\n\tlet index = url.lastIndexOf(\"?\");\n\tlet hashIndex = url.lastIndexOf(\"#\");\n\tif(hashIndex < 0) {\n\t\thashIndex = url.length;\n\t}\n\tlet oldParams = index < 0 ? {} : _toParamsMap(url.substring(index + 1, hashIndex), false);\n\tlet newParams = _toParamsMap(urlArgs, false);\n\tlet has = false;\n\tfor(let k in newParams) {\n\t\tif(oldParams[k] != newParams[k]) {\n\t\t\toldParams[k] = newParams[k];\n\t\t\thas = true;\n\t\t}\n\t}\n\tif(!has) {\n\t\treturn url; //参数没有变化直接返回\n\t}\n\n\tlet paramKeys = [];\n\tfor(let k in oldParams) {\n\t\tparamKeys.push(k);\n\t}\n\tparamKeys.sort();\n\n\tlet path = index < 0 ? url.substring(0, hashIndex) : url.substring(0, index);\n\tlet params = [];\n\n\tfor(let i = 0; i < paramKeys.length; i++) { //保证参数按照顺序\n\t\tlet k = paramKeys[i];\n\t\tparams.push(k + \"=\" + oldParams[k]);\n\t}\n\tparams = params.join(\"&\");\n\tlet hash = \"\";\n\tif(hashIndex >= 0 && hashIndex < url.length) {\n\t\thash = url.substring(hashIndex);\n\t}\n\treturn path + (params ? \"?\" + params : \"\") + (hash ? hash : \"\");\n\n}\n\nfunction queryString2ParamsMap(argsStr, decode) {\n\treturn _toParamsMap(argsStr, decode);\n}\n\nexport default {\n\trandId,\n\txsEval,\n\txsParseJson,\n\txsJson2String,\n\tgetPathWithRelative,\n\tappendArgs2Url,\n\tqueryString2ParamsMap\n};","const ostring = Object.prototype.toString;\n\nfunction isArray(it) {\n\treturn it && (it instanceof Array) || ostring.call(it) === '[object Array]';\n}\n\nfunction isFunction(it) {\n\treturn it && (typeof it == \"function\") || ostring.call(it) === '[object Function]';\n}\n\nfunction isObject(it) {\n\tif(it === null || it === undefined) {\n\t\treturn false;\n\t}\n\treturn(typeof it == \"object\") || ostring.call(it) === '[object Object]';\n}\n\nfunction isString(it) {\n\treturn it && (typeof it == \"string\") || ostring.call(it) === '[object String]';\n}\n\nfunction isDate(it) {\n\treturn it && (it instanceof Date) || ostring.call(it) === '[object Date]';\n}\n\nfunction isRegExp(it) {\n\treturn it && (it instanceof RegExp) || ostring.call(it) === '[object RegExp]';\n}\n\nexport default {\n\tisArray,\n\tisFunction,\n\tisObject,\n\tisString,\n\tisDate,\n\tisRegExp,\n};","import utils from \"../util/index.js\";\n\nconst global = utils.global;\nconst xsloader = global.xsloader;\n\nfunction queryParam(name, otherValue, optionUrl) {\n\tlet search;\n\tif(optionUrl) {\n\t\tlet index = optionUrl.indexOf('?');\n\t\tif(index < 0) {\n\t\t\tindex = 0;\n\t\t} else {\n\t\t\tindex += 1;\n\t\t}\n\t\tsearch = optionUrl.substr(index);\n\t} else {\n\t\tsearch = window.location.search.substr(1);\n\t}\n\n\tlet reg = new RegExp(\"(^|&)\" + name + \"=([^&]*)(&|$)\");\n\tlet r = search.match(reg);\n\tif(r != null) return decodeURIComponent(r[2]);\n\treturn otherValue !== undefined ? otherValue : null;\n}\n\nfunction getUrl(relativeUrl, appendArgs, optionalAbsUrl) {\n\tif(optionalAbsUrl && !utils.dealPathMayAbsolute(optionalAbsUrl).absolute) {\n\t\tthrow new Error(\"expected absolute url:\" + optionalAbsUrl);\n\t}\n\tif(appendArgs === undefined) {\n\t\tappendArgs = true;\n\t}\n\tlet theConfig = xsloader.config();\n\tlet thePageUrl = xsloader.pageUrl();\n\tlet url;\n\tif(relativeUrl === undefined) {\n\t\turl = thePageUrl;\n\t} else if(xsloader.startsWith(relativeUrl, \".\") || utils.dealPathMayAbsolute(relativeUrl).absolute) {\n\t\turl = utils.getPathWithRelative(optionalAbsUrl || thePageUrl, relativeUrl);\n\t} else {\n\t\turl = theConfig.baseUrl + relativeUrl;\n\t}\n\tif(appendArgs) {\n\t\tif(url == thePageUrl) {\n\t\t\turl += location.search + location.hash;\n\t\t}\n\t\treturn theConfig.dealUrl({}, url);\n\t} else {\n\t\treturn url;\n\t}\n}\n\nfunction tryCall(fun, defaultReturn, thiz, exCallback) {\n\tlet rs;\n\ttry {\n\t\tthiz = thiz === undefined ? this : thiz;\n\t\trs = fun.call(thiz);\n\t} catch(e) {\n\t\tif(xsloader.isFunction(exCallback)) {\n\t\t\texCallback(e);\n\t\t} else {\n\t\t\tconsole.warn(e);\n\t\t}\n\t}\n\tif(rs === undefined || rs === null) {\n\t\trs = defaultReturn;\n\t}\n\treturn rs;\n}\n\nfunction dealProperties(obj, properties) {\n\treturn utils.propertiesDeal(obj, properties);\n}\n\nfunction extend(target) {\n\tfor(let i = 1; i < arguments.length; i++) {\n\t\tlet obj = arguments[i];\n\t\tif(!obj) {\n\t\t\tcontinue;\n\t\t}\n\t\tfor(let x in obj) {\n\t\t\tlet value = obj[x];\n\t\t\tif(value === undefined) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\ttarget[x] = obj[x];\n\t\t}\n\t}\n\treturn target;\n}\n\nfunction extendDeep(target) {\n\tif(!target) {\n\t\treturn target;\n\t}\n\tfor(let i = 1; i < arguments.length; i++) {\n\t\tlet obj = arguments[i];\n\t\tif(!obj) {\n\t\t\tcontinue;\n\t\t}\n\n\t\tfor(let x in obj) {\n\t\t\tlet value = obj[x];\n\t\t\tif(value === undefined) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif(xsloader.isObject(value) && xsloader.isObject(target[x])) {\n\t\t\t\ttarget[x] = xsloader.extendDeep(target[x], value);\n\t\t\t} else {\n\t\t\t\ttarget[x] = obj[x];\n\t\t\t}\n\t\t}\n\t}\n\treturn target;\n}\n\nfunction _AsyncCall(useTimer) {\n\tlet thiz = this;\n\tlet count = 0;\n\tlet ctrlCallbackMap = {};\n\n\tfunction initCtrlCallback(callbackObj) {\n\t\tlet mineCount = count + \"\";\n\t\tif(!ctrlCallbackMap[mineCount]) {\n\t\t\tlet ctrlCallback = function() {\n\t\t\t\tcount++;\n\t\t\t\tlet asyncCallQueue = ctrlCallbackMap[mineCount];\n\t\t\t\tdelete ctrlCallbackMap[mineCount];\n\t\t\t\twhile(asyncCallQueue.length) {\n\t\t\t\t\tlet callbackObj = asyncCallQueue.shift();\n\t\t\t\t\tlet lastReturn = undefined;\n\t\t\t\t\ttry {\n\t\t\t\t\t\tif(callbackObj.callback) {\n\t\t\t\t\t\t\tlastReturn = callbackObj.callback.call(callbackObj.handle, callbackObj.obj, mineCount);\n\t\t\t\t\t\t}\n\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\tconsole.error(e);\n\t\t\t\t\t}\n\t\t\t\t\tlet handle;\n\t\t\t\t\twhile(callbackObj.nextCallback.length) {\n\t\t\t\t\t\tlet nextObj = callbackObj.nextCallback.shift();\n\t\t\t\t\t\tif(!handle) {\n\t\t\t\t\t\t\thandle = thiz.pushTask(nextObj.callback, lastReturn);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\thandle.next(nextObj.callback);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t\tctrlCallbackMap[mineCount] = [];\n\t\t\tif(!useTimer && global.Promise && global.Promise.resolve) {\n\t\t\t\tglobal.Promise.resolve().then(ctrlCallback);\n\t\t\t} else {\n\t\t\t\tsetTimeout(ctrlCallback, 0);\n\t\t\t}\n\t\t}\n\t\tlet queue = ctrlCallbackMap[mineCount];\n\t\tqueue.push(callbackObj);\n\t}\n\n\tthis.pushTask = function(callback, obj) {\n\t\tlet callbackObj;\n\t\tlet handle = {\n\t\t\tnext: function(nextCallback, lastReturn) {\n\t\t\t\tcallbackObj.nextCallback.push({\n\t\t\t\t\tcallback: nextCallback,\n\t\t\t\t\tlastReturn: lastReturn\n\t\t\t\t});\n\t\t\t\treturn this;\n\t\t\t}\n\t\t};\n\t\tcallbackObj = {\n\t\t\tcallback: callback,\n\t\t\tobj: obj,\n\t\t\tnextCallback: [],\n\t\t\thandle: handle\n\t\t};\n\n\t\tinitCtrlCallback(callbackObj);\n\n\t\treturn handle;\n\t};\n}\n\nconst theAsyncCall = new _AsyncCall();\nconst theAsyncCallOfTimer = new _AsyncCall(true);\n\nlet asyncCall = function(callback, useTimer) {\n\tif(useTimer) {\n\t\treturn theAsyncCallOfTimer.pushTask(callback);\n\t} else {\n\t\treturn theAsyncCall.pushTask(callback);\n\t}\n};\n\n/**\n * 得到属性\n * @param {Object} obj\n * @param {Object} attrNames \"rs\"、\"rs.total\"等\n */\nfunction getObjectAttr(obj, attrNames, defaultValue) {\n\tif(!obj || !attrNames) {\n\t\treturn undefined;\n\t}\n\tlet attrs = attrNames.split(\".\");\n\tlet rs = defaultValue;\n\tlet i = 0;\n\tfor(; i < attrs.length && obj; i++) {\n\t\tlet k = attrs[i];\n\t\tobj = obj[k];\n\t}\n\tif(i == attrs.length) {\n\t\trs = obj;\n\t}\n\n\treturn rs;\n}\n\n/**\n * 设置属性\n * @param {Object} obj\n * @param {Object} attrNames \"rs\"、\"rs.total\"等\n */\nfunction setObjectAttr(obj, attrNames, value) {\n\tlet _obj = obj;\n\tlet attrs = attrNames.split(\".\");\n\n\tfor(let i = 0; i < attrs.length; i++) {\n\t\tlet k = attrs[i];\n\n\t\tif(i == attrs.length - 1) {\n\t\t\tobj[k] = value;\n\t\t\tbreak;\n\t\t}\n\t\tlet o = obj[k];\n\t\tif(!o) {\n\t\t\to = {};\n\t\t\tobj[k] = o;\n\t\t}\n\t\tobj = o;\n\t}\n\treturn _obj;\n}\n\nfunction clone(obj, isDeep) {\n\t// Handle the 3 simple types, and null or undefined or function\n\tif(!obj || xsloader.isFunction(obj) || xsloader.isString(obj)) return obj;\n\n\tif(xsloader.isRegExp(obj)) {\n\t\treturn new RegExp(obj.source, obj.flags);\n\t}\n\n\t// Handle Date\n\tif(xsloader.isDate(obj)) {\n\t\tlet copy = new Date();\n\t\tcopy.setTime(obj.getTime());\n\t\treturn copy;\n\t}\n\t// Handle Array or Object\n\tif(xsloader.isArray(obj) || xsloader.isObject(obj)) {\n\t\tlet copy = xsloader.isArray(obj) ? [] : {};\n\t\tfor(let attr in obj) {\n\t\t\tif(obj.hasOwnProperty(attr))\n\t\t\t\tcopy[attr] = isDeep ? clone(obj[attr]) : obj[attr];\n\t\t}\n\t\treturn copy;\n\t}\n\treturn obj;\n}\n\nexport default {\n\tqueryParam,\n\tgetUrl,\n\ttryCall,\n\tdealProperties,\n\textend,\n\textendDeep,\n\tasyncCall,\n\tgetObjectAttr,\n\tsetObjectAttr,\n\tclone\n};","import utils from \"../util/index.js\";\n\nconst global = utils.global;\nconst xsloader = global.xsloader;\n\nlet isDOM = (typeof HTMLElement === 'object') ?\n\tfunction(obj) {\n\t\treturn obj && (obj instanceof HTMLElement);\n\t} :\n\tfunction(obj) {\n\t\treturn obj && typeof obj === 'object' && obj.nodeType === 1 && typeof obj.nodeName === 'string';\n\t};\n\nlet onReadyFun = (function() {\n\tlet isGlobalReady = false;\n\tlet bindReadyQueue = [];\n\n\tfunction BindReady(callback) {\n\t\tif(isGlobalReady) {\n\t\t\tcallback();\n\t\t\treturn;\n\t\t}\n\t\tlet isReady = false;\n\n\t\tfunction ready() {\n\t\t\tif(isReady) return;\n\t\t\tisReady = true;\n\t\t\tisGlobalReady = true;\n\t\t\tcallback();\n\t\t}\n\t\t// Mozilla, Opera and webkit nightlies currently support this event\n\t\tif(document.addEventListener) {\n\t\t\tlet fun;\n\t\t\tfun = function() {\n\t\t\t\tdocument.removeEventListener(\"DOMContentLoaded\", fun);\n\t\t\t\tready();\n\t\t\t};\n\t\t\tdocument.addEventListener(\"DOMContentLoaded\", fun);\n\n\t\t} else if(document.attachEvent) {\n\t\t\t// ensure firing before onload,\n\t\t\t// maybe late but safe also for iframes\n\t\t\tlet fun;\n\t\t\tfun = function() {\n\t\t\t\tif(document.readyState === \"complete\") {\n\t\t\t\t\tdocument.detachEvent(\"onreadystatechange\", fun);\n\t\t\t\t\tready();\n\t\t\t\t}\n\t\t\t};\n\t\t\tdocument.attachEvent(\"onreadystatechange\", fun);\n\t\t\t// If IE and not an iframe\n\t\t\t// continually check to see if the document is ready\n\n\t\t\tlet fun2;\n\t\t\tfun2 = function() {\n\t\t\t\tif(isReady) return;\n\t\t\t\ttry {\n\t\t\t\t\t// If IE is used, use the trick by Diego Perini\n\t\t\t\t\t// http://javascript.nwbox.com/IEContentLoaded/\n\t\t\t\t\tdocument.documentElement.doScroll(\"left\");\n\t\t\t\t} catch(error) {\n\t\t\t\t\tsetTimeout(fun2, 0);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t// and execute any waiting functions\n\t\t\t\tready();\n\t\t\t};\n\n\t\t\tif(document.documentElement.doScroll && typeof global.frameElement === \"undefined\")(fun2)();\n\t\t} else {\n\t\t\txsloader.asyncCall(null, true).next(function() {\n\t\t\t\tready();\n\t\t\t});\n\t\t}\n\t\tthis.readyCall = ready;\n\t}\n\tlet onReady = function(callback) {\n\t\tif(document.readyState === \"complete\") {\n\t\t\tisGlobalReady = true;\n\t\t}\n\t\tlet br = new BindReady(callback);\n\t\tif(!isGlobalReady) {\n\t\t\tbindReadyQueue.push(br);\n\t\t}\n\t};\n\tonReady(function() {\n\t\tisGlobalReady = true;\n\t});\n\n\tif(document.readyState === \"complete\") {\n\t\tisGlobalReady = true;\n\t} else {\n\t\tlet addEventHandle;\n\t\tif(global.addEventListener) {\n\t\t\taddEventHandle = function(type, callback) {\n\t\t\t\tglobal.addEventListener(type, callback, false);\n\t\t\t};\n\t\t} else if(global.attachEvent) {\n\t\t\taddEventHandle = function(type, callback) {\n\t\t\t\tglobal.attachEvent(\"on\" + type, callback);\n\t\t\t};\n\t\t} else {\n\t\t\taddEventHandle = function(type, callback) {\n\t\t\t\txsloader.asyncCall(null, true).next(function() {\n\t\t\t\t\tcallback();\n\t\t\t\t});\n\t\t\t};\n\t\t}\n\t\taddEventHandle(\"load\", function() {\n\t\t\tisGlobalReady = true;\n\t\t\twhile(bindReadyQueue.length) {\n\t\t\t\tbindReadyQueue.shift().readyCall();\n\t\t\t}\n\t\t});\n\t}\n\treturn onReady;\n})();\n\nexport default {\n\tisDOM,\n\tonReady: onReadyFun\n};","import utils from \"../util/index.js\";\n////////////////////\n\nimport deprecated from './global-deprecated.js';\nimport base from './global-base.js';\n//////////////////\nimport is from './is.js';\nimport funs from './funs.js';\nimport browser from './browser.js';\n\nconst global = utils.global;\nconst xsloader=global.xsloader;\n\nlet toGlobal = {\n\t...deprecated,\n\t...base\n};\nfor(let k in toGlobal) {\n\txsloader[k] = toGlobal[k];\n\tglobal[k] = toGlobal[k];\n}\n\nlet justLoader = {\n\t...is,\n\t...funs,\n\t...browser,\n\t_ignoreAspect_: {\n\n\t}\n};\nfor(let k in justLoader) {\n\txsloader[k] = justLoader[k];\n}","import utils from \"../util/index.js\";\nconst global = utils.global;\nconst theDefinedMap = {};\n\nclass ModuleDef {\n\tsrc;\n\tdefaultModule; //默认模块（ define时未指定selfname的） 只能有一个\n\tmodules; //define的其他模块（含有selfname）\n\tconstructor(src) {\n\t\tthis.src = src;\n\t\tthis.modules = {};\n\t\tthis.defaultModule = null;\n\t}\n}\n\nfunction getModule(nameOrUrl) {\n\tnameOrUrl = utils.removeQueryHash(nameOrUrl);\n\tlet isSrc = /^[a-zA-Z0-9]+:\\/\\//.test(nameOrUrl);\n\n\tlet moduleDef = theDefinedMap[nameOrUrl];\n\tif(moduleDef) {\n\t\tlet module;\n\t\tif(isSrc) { //如果提供地址、则获取默认模块\n\t\t\tmodule = moduleDef.defaultModule;\n\t\t} else {\n\t\t\tmodule = moduleDef.modules[nameOrUrl];\n\t\t}\n\t\treturn module ? module.get() : null;\n\t} else {\n\t\treturn null;\n\t}\n}\n\n/**\n * 替换模块的src，用于加载含有多个地址模块的情况（提供多个地址、直到加载成功）\n * @param {Object} oldSrc\n * @param {Object} module\n */\nfunction replaceModuleSrc(oldSrc, module) {\n\tlet moduleDef = theDefinedMap[oldSrc];\n\tif(!moduleDef) {\n\t\tthrow new Error(\"not found module:src=\" + oldSrc);\n\t} else if(theDefinedMap[module.src]) {\n\t\tthrow new Error(\"already exists module:src=\" + module.src);\n\t} else {\n\t\tmoduleDef.src = module.src;\n\t\tdelete theDefinedMap[oldSrc];\n\t\ttheDefinedMap[module.src] = moduleDef;\n\t}\n}\n\nfunction clearEmptyModuleBySrc(src) {\n\tlet moduleDef = theDefinedMap[src];\n\tif(moduleDef && !moduleDef.defaultModule) {\n\t\tif(moduleDef.defaultModule) {\n\t\t\tthrow new Error(\"not empty module:src=\" + src);\n\t\t} else {\n\t\t\tfor(let x in moduleDef.modules) {\n\t\t\t\tthrow new Error(\"not empty module:src=\" + src);\n\t\t\t}\n\t\t}\n\t\tdelete theDefinedMap[src];\n\t}\n}\n\n/**\n * 同一个模块可重复设置。\n * @param {Object} name 模块名字，若为空则表示模块模块。多个不同的名字可能指向同一个模块。\n * @param {Object} module 模块，必须含有src\n */\nfunction setModule(name, module) {\n\tlet src = module.src;\n\tif(!src) {\n\t\tthrow new Error(\"expected module src!\");\n\t}\n\tlet moduleDef = theDefinedMap[src];\n\tif(moduleDef) {\n\t\tif(name) {\n\t\t\tif(theDefinedMap[name] && theDefinedMap[name] != moduleDef) {\n\t\t\t\tthrow new Error(\"already define module:\\n\\tname=\" + name + \",current.src=\" + src + \",\\n\\tthat.src=\" + theDefinedMap[name].src);\n\t\t\t} else {\n\t\t\t\tmoduleDef.modules[name] = module;\n\t\t\t\ttheDefinedMap[name] = moduleDef;\n\t\t\t}\n\t\t} else {\n\t\t\t//默认模块\n\t\t\tif(moduleDef.defaultModule && moduleDef.defaultModule != module) {\n\t\t\t\tthrow new Error(\"already define default module:src=\" + src);\n\t\t\t} else {\n\t\t\t\tmoduleDef.defaultModule = module;\n\t\t\t}\n\t\t}\n\t} else {\n\t\tmoduleDef = new ModuleDef(src);\n\t\ttheDefinedMap[src] = moduleDef;\n\t\tif(name) {\n\t\t\tmoduleDef.modules[name] = module;\n\t\t\tif(theDefinedMap[name]) {\n\t\t\t\tthrow new Error(\"already define module:\\n\\tname=\" + name + \",current.src=\" + src + \",\\n\\tthat.src=\" + theDefinedMap[name].src);\n\t\t\t} else {\n\t\t\t\ttheDefinedMap[name] = moduleDef;\n\t\t\t}\n\t\t} else {\n\t\t\t//默认模块\n\t\t\tmoduleDef.defaultModule = module;\n\t\t}\n\t}\n}\n\nexport default {\n\tgetModule,\n\tsetModule,\n\treplaceModuleSrc,\n\tclearEmptyModuleBySrc\n};","import utils from \"../util/index.js\";\nimport script from \"./script.js\";\nimport moduleDef from \"./module-def\";\nconst global = utils.global;\nconst xsloader = global.xsloader;\nconst INNER_DEPS_PLUGIN = \"__inner_deps__\";\nconst innerDepsMap = {}; //内部依赖加载插件用于保存依赖的临时map\n\nfunction buildInvoker(obj) {\n\tlet invoker = obj[\"thiz\"];\n\tlet module = obj.module || obj;\n\tlet id = xsloader.randId();\n\tinvoker.getId = function() {\n\t\treturn id;\n\t};\n\tinvoker.getUrl = function(relativeUrl, appendArgs, optionalAbsUrl) {\n\t\tif(optionalAbsUrl && !utils.dealPathMayAbsolute(optionalAbsUrl).absolute) {\n\t\t\tthrow new Error(-1, \"expected absolute url:\" + optionalAbsUrl);\n\t\t}\n\t\tif(appendArgs === undefined) {\n\t\t\tappendArgs = true;\n\t\t}\n\t\tlet url;\n\t\tif(relativeUrl === undefined) {\n\t\t\turl = this.getAbsoluteUrl();\n\t\t} else if(xsloader.startsWith(relativeUrl, \".\") || utils.dealPathMayAbsolute(relativeUrl).absolute) {\n\t\t\turl = utils.getPathWithRelative(optionalAbsUrl || this.rurl(), relativeUrl);\n\t\t} else {\n\t\t\turl = xsloader.config().baseUrl + relativeUrl;\n\t\t}\n\t\tif(appendArgs) {\n\t\t\tif(url == script.thePageUrl) {\n\t\t\t\turl += location.search + location.hash;\n\t\t\t}\n\t\t\treturn xsloader.config().dealUrl(module, url);\n\t\t} else {\n\t\t\treturn url;\n\t\t}\n\t};\n\tinvoker.require = function() {\n\t\tlet h = xsloader.require.apply(invoker, arguments);\n\t\treturn h;\n\t};\n\tinvoker.define = function() {\n\t\tlet h = xsloader.define.apply(invoker, arguments);\n\t\treturn h;\n\t};\n\tinvoker.rurl = function(defineObject) {\n\t\treturn defineObject && defineObject.absUrl || this.absUrl() || this.getAbsoluteUrl();\n\t};\n\tinvoker.defineAsync = function() {\n\t\tlet h = this.define.apply(this, arguments);\n\t\treturn h;\n\t};\n\tinvoker.withAbsUrl = function(absUrl) {\n\t\tlet moduleMap = {\n\t\t\tmodule: module,\n\t\t\tsrc: absUrl,\n\t\t\tabsUrl: absUrl,\n\t\t\tname: invoker.getName(),\n\t\t\tinvoker: invoker.invoker()\n\t\t};\n\t\tmoduleMap.thiz = new script.Invoker(moduleMap);\n\t\tbuildInvoker(moduleMap);\n\t\treturn moduleMap.thiz;\n\t};\n}\n\n//新建模块实例\n//relyCallback(depModuleThis)\nfunction newModuleInstance(module, thatInvoker, relyCallback, pluginArgs) {\n\tlet instanceModule = {\n\t\trelyCallback: relyCallback,\n\t\t_invoker: thatInvoker,\n\t\t_module_: null,\n\t\tinitInvoker: function() {\n\t\t\t//确保正确的invoker\n\t\t\tif(module.ignoreAspect) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tlet obj = this._object;\n\t\t\tlet invoker = this._invoker;\n\n\t\t\tlet addTheAttrs = (theObj) => {\n\t\t\t\ttheObj._invoker_ = invoker;\n\t\t\t\tif(theObj._module_) {\n\t\t\t\t\ttheObj._modules_ = theObj._modules_ || [];\n\t\t\t\t\ttheObj._modules_.push(theObj._module_);\n\t\t\t\t}\n\t\t\t\ttheObj._module_ = this._module_;\n\t\t\t\treturn theObj;\n\t\t\t};\n\n\t\t\tlet isSingle = module.instanceType != \"clone\";\n\n\t\t\tif(xsloader.isObject(obj)) {\n\t\t\t\tif(module.loopObject && !isSingle) {\n\t\t\t\t\tthrow new Error(\"loop dependency not support single option:\" + module.description());\n\t\t\t\t}\n\t\t\t\tthis._object = addTheAttrs(isSingle ? obj : xsloader.clone(obj));\n\t\t\t} else if(xsloader.isFunction(obj)) {\n\t\t\t\tthis._object = addTheAttrs(obj);\n\t\t\t}\n\n\t\t},\n\t\t_object: null,\n\t\t_setDepModuleObjectGen: function(obj) {\n\t\t\tthis._object = obj;\n\t\t\tthis.initInvoker();\n\t\t},\n\t\tmodule: module,\n\t\tmoduleObject: function() {\n\t\t\treturn this._object;\n\t\t},\n\t\tgenExports: function() {\n\t\t\tthis._setDepModuleObjectGen({});\n\t\t\treturn this._object;\n\t\t},\n\t\t_getCacheKey: function(pluginArgs) {\n\t\t\tif(this._object.getCacheKey) {\n\t\t\t\treturn this._object.getCacheKey.call(this.thiz, pluginArgs);\n\t\t\t}\n\t\t\tlet id = this._invoker.getUrl();\n\t\t\treturn id;\n\t\t},\n\t\t_willCache: function(pluginArgs, cacheResult) {\n\t\t\tif(this._object.willCache) {\n\t\t\t\treturn this._object.willCache.call(this.thiz, pluginArgs, cacheResult);\n\t\t\t}\n\t\t\treturn true;\n\t\t},\n\t\tlastSinglePluginResult: function(pluginArgs) {\n\t\t\tlet id = this._getCacheKey(pluginArgs);\n\t\t\treturn this.module.lastSinglePluginResult(id, pluginArgs);\n\t\t},\n\t\tsetSinglePluginResult: function(pluginArgs, obj) {\n\t\t\tlet id = this._getCacheKey(pluginArgs);\n\t\t\tlet willCache = this._willCache(pluginArgs, obj);\n\t\t\treturn this.module.setSinglePluginResult(willCache, id, pluginArgs, obj);\n\t\t},\n\t\tinit: function(justForSingle) {\n\t\t\tlet relyCallback = this.relyCallback;\n\t\t\tthis._module_ = this.module.dealInstance(this);\n\t\t\tthis._setDepModuleObjectGen(this.module.loopObject || this.module.moduleObject);\n\t\t\tif(pluginArgs !== undefined) {\n\t\t\t\tif(!this._object) {\n\t\t\t\t\tthrow new Error(\"pulgin error:\" + this.module.description());\n\t\t\t\t}\n\t\t\t\tif(this._object.isSingle === undefined) {\n\t\t\t\t\tthis._object.isSingle = true; //同样的参数也需要重新调用\n\t\t\t\t}\n\t\t\t\tif(justForSingle && !this._object.isSingle) {\n\t\t\t\t\tthrow new Error(\"just for single plugin\");\n\t\t\t\t}\n\n\t\t\t\tlet hasFinished = false;\n\t\t\t\tlet onload = (result, ignoreAspect) => {\n\t\t\t\t\tif(result == undefined) {\n\t\t\t\t\t\tresult = {\n\t\t\t\t\t\t\t__default: true\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t\thasFinished = true;\n\t\t\t\t\tif(this._object.isSingle) {\n\t\t\t\t\t\tthis.setSinglePluginResult(pluginArgs, {\n\t\t\t\t\t\t\tresult: result,\n\t\t\t\t\t\t\tignoreAspect: ignoreAspect\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tthis.module.ignoreAspect = ignoreAspect === undefined || ignoreAspect;\n\t\t\t\t\tthis._setDepModuleObjectGen(result);\n\t\t\t\t\trelyCallback(this);\n\t\t\t\t};\n\t\t\t\tlet onerror = (err) => {\n\t\t\t\t\thasFinished = true;\n\t\t\t\t\trelyCallback(this, new xsloader.PluginError(err || false));\n\t\t\t\t};\n\t\t\t\tlet args = [pluginArgs, onload, onerror, xsloader.config()].concat(this.module.depModules);\n\t\t\t\ttry {\n\t\t\t\t\tlet cacheResult;\n\t\t\t\t\tif(this._object.isSingle && (cacheResult = this.lastSinglePluginResult(pluginArgs)) !== undefined) {\n\t\t\t\t\t\tlet last = cacheResult;\n\t\t\t\t\t\tonload(last.result, last.ignoreAspect);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis._object.pluginMain.apply(this.thiz, args);\n\t\t\t\t\t}\n\t\t\t\t} catch(e) {\n\t\t\t\t\tconsole.warn(e);\n\t\t\t\t\tonerror(e);\n\t\t\t\t}\n\t\t\t\tif(!hasFinished) {\n\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\tif(!hasFinished) {\n\t\t\t\t\t\t\tconsole.warn(\"invoke plugin may failed:page=\" + location.href + \",plugin=\" + module.selfname + \"!\" + pluginArgs);\n\t\t\t\t\t\t}\n\t\t\t\t\t}, xsloader.config().waitSeconds * 1000);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\trelyCallback(this);\n\t\t\t}\n\t\t},\n\n\t};\n\n\tlet moduleMap = {\n\t\tmodule: module,\n\t\tsrc: module.thiz.getAbsoluteUrl(),\n\t\tabsUrl: module.thiz.absUrl(),\n\t\tname: module.thiz.getName(),\n\t\tinvoker: instanceModule._invoker\n\t};\n\tinstanceModule.thiz = new script.Invoker(moduleMap);\n\n\tbuildInvoker(instanceModule);\n\treturn instanceModule;\n}\n\nfunction _newModule(name, src, absUrl, thatInvoker, callback) {\n\tsrc = utils.removeQueryHash(src);\n\tlet defineObject = new script.DefineObject(src, null, [name, null, callback], false);\n\tdefineObject.thatInvoker = thatInvoker;\n\tdefineObject.handle = {\n\t\tabsUrl: absUrl\n\t};\n\treturn newModule(defineObject);\n}\n\n//\n//模块依赖来源：(另见module.js:mayAddDeps,define.js:theRealDefine)\n//1、define里声明的\n//2、define或require里直接require('...')\n//3、config里配置的\n//4、手动通过handle.before或depBefore进行修改的\n/*\n *模块的名字来源：(另见define.js:onModuleLoaded)\n * 1、模块url地址:一定存在\n * 2、模块define时提供的：可选\n * 3、paths或depsPaths提供的：可选，且可能为默认模块\n * 4、name!提供的：可选\n */\nfunction newModule(defineObject) {\n\n\tlet instances = []; //所有模块实例\n\tlet moduleMap = {\n\t\tid: utils.getAndIncIdCount(),\n\t\tselfname: defineObject.selfname,\n\t\tdescription() {\n\t\t\treturn \"selfname=\" + (this.selfname || \"\") + \",src=\" + this.src;\n\t\t},\n\t\tdeps: defineObject.deps || [],\n\t\trelys: [],\n\t\totherModule: undefined,\n\t\tdirectDefineIndex: 0, //模块直接声明的依赖开始索引\n\t\tignoreAspect: false,\n\t\tdepModules: null,\n\t\tsrc: defineObject.src, //绝对路径,可能等于当前页面路径\n\t\tabsUrl: defineObject.getMineAbsUrl(),\n\t\tcallback: defineObject.callback,\n\t\t_loadCallback: null,\n\t\tmoduleObject: undefined, //依赖模块对应的对象\n\t\tloopObject: undefined, //循环依赖对象\n\t\tinvoker: defineObject.thatInvoker,\n\t\tinstanceType: \"single\",\n\t\tsetInstanceType(instanceType) {\n\t\t\tthis.instanceType = instanceType;\n\t\t},\n\t\t_singlePluginResult: {},\n\t\tlastSinglePluginResult(id, pluginArgs) {\n\t\t\tif(this._singlePluginResult[id]) {\n\t\t\t\treturn this._singlePluginResult[id][pluginArgs];\n\t\t\t}\n\t\t},\n\t\tsetSinglePluginResult(willCache, id, pluginArgs, obj) {\n\t\t\tif(willCache) {\n\t\t\t\tif(!this._singlePluginResult[id]) {\n\t\t\t\t\tthis._singlePluginResult[id] = {};\n\t\t\t\t}\n\t\t\t\tthis._singlePluginResult[id][pluginArgs] = obj;\n\t\t\t} else {\n\t\t\t\tif(this._singlePluginResult[id]) {\n\t\t\t\t\tdelete this._singlePluginResult[id][pluginArgs];\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tfinish(args) {\n\t\t\tif(this.directDefineIndex != 0) {\n\t\t\t\tlet _directArgs = [];\n\t\t\t\tfor(let i = this.directDefineIndex; i < args.length; i++) {\n\t\t\t\t\t_directArgs.push(args[i]);\n\t\t\t\t}\n\t\t\t\targs = _directArgs;\n\t\t\t}\n\t\t\tthis.depModules = args;\n\t\t\tlet obj;\n\t\t\tif(xsloader.isFunction(this.callback)) {\n\t\t\t\ttry {\n\t\t\t\t\tscript.currentDefineModuleQueue.push(this);\n\t\t\t\t\tobj = this.callback.apply(this.thiz, args);\n\t\t\t\t\tscript.currentDefineModuleQueue.pop();\n\t\t\t\t} catch(e) {\n\t\t\t\t\tscript.currentDefineModuleQueue.pop();\n\t\t\t\t\tconsole.error(\"error occured,invoker.url=\", this.invoker ? this.invoker.getUrl() : \"\");\n\t\t\t\t\tconsole.error(e);\n\t\t\t\t\tthis.setState(\"error\", e);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tobj = this.callback;\n\t\t\t\tif(this.moduleObject !== undefined) {\n\t\t\t\t\tconsole.log(\"ignore moudule:\" + moduleMap.description());\n\t\t\t\t}\n\t\t\t}\n\t\t\tlet isDefault = false;\n\t\t\tif(obj === undefined) {\n\t\t\t\tisDefault = true;\n\t\t\t\tobj = {\n\t\t\t\t\t__default: true\n\t\t\t\t};\n\t\t\t}\n\t\t\tif(this.loopObject) {\n\t\t\t\tif(!xsloader.isObject(obj)) {\n\t\t\t\t\tthrow new Error(\"循环依赖的模块必须是对象：\" + this.description());\n\t\t\t\t}\n\t\t\t\tfor(let x in obj) {\n\t\t\t\t\tthis.loopObject[x] = obj[x];\n\t\t\t\t}\n\t\t\t\tobj = this.loopObject;\n\t\t\t}\n\t\t\t//this.moduleObject不为undefined，则使用了exports\n\t\t\tif(this.moduleObject === undefined ||\n\t\t\t\t!isDefault && obj !== undefined //如果使用了return、则优先使用\n\t\t\t) {\n\t\t\t\tthis.moduleObject = obj;\n\t\t\t}\n\t\t\tthis.setState(\"defined\");\n\t\t},\n\t\tstate: \"init\", //init,loading,loaded,defined,error,\n\t\terrinfo: null,\n\t\t_callback(fun) {\n\t\t\tlet thiz = this;\n\t\t\tlet _state = thiz.state;\n\t\t\tif(_state == 'defined' || thiz.loopObject) {\n\t\t\t\tlet theCallback = function() {\n\t\t\t\t\tif(fun) {\n\t\t\t\t\t\tlet depModule = newModuleInstance(thiz, fun.thatInvoker, fun.relyCallback, fun.pluginArgs);\n\t\t\t\t\t\tdepModule.init();\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\t//已经加载了模块，仍然需要判断为其另外设置的依赖模块是否已被加载\n\t\t\t\tlet deps = !thiz.loopObject && xsloader.config().getDeps(thiz.selfname);\n\t\t\t\t//console.log(this.selfname,\":\",deps);\n\t\t\t\t//deps=null;\n\t\t\t\tif(deps && deps.length > 0) {\n\t\t\t\t\txsloader.require(deps, function() {\n\t\t\t\t\t\ttheCallback();\n\t\t\t\t\t}).then({\n\t\t\t\t\t\tdefined_module_for_deps: thiz.selfname\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\ttheCallback();\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t} else if(_state == \"timeout\" || _state == \"error\") {\n\t\t\t\tif(fun) {\n\t\t\t\t\tfun.relyCallback(this, this.errinfo);\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t} else {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t},\n\t\tsetState(_state, errinfo) {\n\t\t\tthis.state = _state;\n\t\t\tthis.errinfo = errinfo;\n\t\t\tif(!this._callback()) {\n\t\t\t\twhile(this.relys.length) {\n\t\t\t\t\tlet fun = this.relys.shift();\n\t\t\t\t\tthis._callback(fun);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tget() {\n\t\t\tif(this.otherModule) {\n\t\t\t\tthis.state = this.otherModule.state; //状态同步,保持与otherModule状态相同\n\t\t\t\treturn this.otherModule;\n\t\t\t}\n\t\t\treturn this;\n\t\t},\n\t\t/**\n\t\t * 依赖当前模块、表示依赖otherModule模块，当前模块为别名或引用。\n\t\t * @param {Object} otherModule\n\t\t */\n\t\ttoOtherModule(otherModule) {\n\t\t\tthis.otherModule = otherModule;\n\t\t\tthis.get(); //状态同步\n\t\t\tlet theRelys = this.relys;\n\t\t\tthis.relys = [];\n\t\t\twhile(theRelys.length) {\n\t\t\t\tlet fun = theRelys.shift();\n\t\t\t\totherModule.relyIt(fun.thatInvoker, fun.relyCallback, fun.pluginArgs);\n\t\t\t}\n\t\t},\n\t\twhenNeed(loadCallback) {\n\t\t\tif(this.relys.length || this.otherModule && this.otherModule.relys.length) {\n\t\t\t\tloadCallback(); //已经被依赖了\n\t\t\t} else {\n\t\t\t\tthis._loadCallback = loadCallback;\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t * \n\t\t * @param {Object} thatInvoker\n\t\t * @param {Object} callbackFun function(depModule,err)\n\t\t * @param {Object} pluginArgs\n\t\t */\n\t\trelyIt(thatInvoker, callbackFun, pluginArgs) {\n\t\t\tif(this.otherModule) {\n\t\t\t\tthis.get(); //状态同步\n\t\t\t\tthis.otherModule.relyIt(thatInvoker, callbackFun, pluginArgs); //传递给otherModule\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tlet fun = {\n\t\t\t\tthatInvoker: thatInvoker,\n\t\t\t\trelyCallback: callbackFun,\n\t\t\t\tpluginArgs: pluginArgs\n\t\t\t};\n\t\t\tif(this._callback(fun)) {\n\t\t\t\tthis.relys.push(fun);\n\t\t\t}\n\t\t\tif(this._loadCallback) { //将会加载此模块及其依赖的模块\n\t\t\t\tlet loadCallback = this._loadCallback;\n\t\t\t\tthis._loadCallback = null;\n\t\t\t\tloadCallback();\n\t\t\t}\n\t\t}\n\t};\n\tmoduleMap.thiz = new script.Invoker(moduleMap);\n\n\t//返回_module_\n\tmoduleMap.dealInstance = function(moduleInstance) {\n\t\tinstances.push(moduleInstance);\n\t\tlet _module_ = {\n\t\t\topId: null,\n\t\t\tsetToAll(name, value, opId) {\n\t\t\t\tif(opId !== undefined && opId == this.opId) {\n\t\t\t\t\treturn; //防止循环\n\t\t\t\t}\n\t\t\t\topId = opId || _getModuleId();\n\t\t\t\tthis.opId = opId;\n\n\t\t\t\tlet obj = {};\n\t\t\t\tif(xsloader.isString(name)) {\n\t\t\t\t\tobj[name] = value;\n\t\t\t\t} else if(xsloader.isObject(name)) {\n\t\t\t\t\tfor(let k in name) {\n\t\t\t\t\t\tobj[k] = name[k];\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tthrow new Error(\"unknown param:\" + name);\n\t\t\t\t}\n\n\t\t\t\tutils.each(instances, function(ins) {\n\t\t\t\t\tlet mobj = ins.moduleObject();\n\t\t\t\t\tfor(let k in obj) {\n\t\t\t\t\t\tmobj[k] = obj[k];\n\t\t\t\t\t}\n\t\t\t\t\tif(mobj._modules_) {\n\t\t\t\t\t\tutils.each(mobj._modules_, function(_m_) {\n\t\t\t\t\t\t\t_m_.setToAll(name, value, opId);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t};\n\n\t\treturn _module_;\n\t};\n\n\t//添加到前面\n\t//提供的参数deps为define里声明的\n\tmoduleMap.mayAddDeps = function(deps) {\n\t\tlet moduleDeps = this.deps;\n\t\tutils.each(moduleDeps, function(dep) {\n\t\t\tif(xsloader.indexInArray(deps, dep) < 0) {\n\t\t\t\tdeps.push(dep);\n\t\t\t}\n\t\t}, false, true);\n\t\tthis.deps = deps;\n\t\treturn deps;\n\t};\n\tmoduleMap.printOnNotDefined = function() {\n\t\tlet root = {\n\t\t\tnodes: []\n\t\t};\n\t\tthis._printOnNotDefined(root);\n\n\t\tlet leafs = [];\n\n\t\tfunction findLeaf(node) {\n\t\t\tif(node.nodes.length) {\n\t\t\t\tutils.each(node.nodes, function(item) {\n\t\t\t\t\tfindLeaf(item);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tleafs.push(node);\n\t\t\t}\n\t\t}\n\t\tfindLeaf(root);\n\n\t\tfunction genErrs(node, infos) {\n\t\t\tinfos.push(node.err);\n\t\t\tif(node.parent) {\n\t\t\t\tgenErrs(node.parent, infos);\n\t\t\t}\n\t\t}\n\t\tutils.each(leafs, function(leaf) {\n\t\t\tlet infos = [];\n\t\t\tgenErrs(leaf, infos);\n\t\t\tinfos = infos.reverse();\n\t\t\tconsole.error(\"load module error stack:my page=\" + location.href);\n\t\t\tfor(let i = 1; i < infos.length;) {\n\t\t\t\tlet as = [];\n\t\t\t\tfor(let k = 0; k < 3 && i < infos.length; k++) {\n\t\t\t\t\tas.push(infos[i++]);\n\t\t\t\t}\n\t\t\t\tconsole.info(as.join(\"\\n\\t--->\"));\n\t\t\t}\n\t\t\tlet errModule = leaf.module;\n\t\t\tif(leaf.module && leaf.module.state == \"defined\") {\n\t\t\t\terrModule = leaf.parent.module;\n\t\t\t}\n\t\t\tif(errModule) {\n\t\t\t\tlet as = [];\n\t\t\t\tfor(let i = 0; i < errModule.deps.length; i++) {\n\t\t\t\t\tlet dep = errModule.deps[i];\n\t\t\t\t\tlet index = dep.lastIndexOf(\"!\");\n\t\t\t\t\tif(index != -1) {\n\t\t\t\t\t\tdep = dep.substring(0, index);\n\t\t\t\t\t}\n\t\t\t\t\tlet depMod = moduleDef.getModule(dep);\n\t\t\t\t\tif(depMod) {\n\t\t\t\t\t\tas.push(dep + \":\" + depMod.state);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tas.push(dep + \":null\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tconsole.info(\"failed module:\" + errModule.description() + \",\\n\\tdeps state infos [\" + as.join(\",\") + \"]\");\n\t\t\t}\n\t\t});\n\n\t};\n\tmoduleMap._printOnNotDefined = function(parentNode) {\n\t\tlet node = {\n\t\t\terr: \"[\" + this.description() + \"].state=\" + this.state,\n\t\t\tmodule: this,\n\t\t\tparent: parentNode,\n\t\t\tnodes: []\n\t\t};\n\t\tparentNode.nodes.push(node);\n\t\tif(this.state == \"defined\") {\n\t\t\treturn;\n\t\t}\n\n\t\tutils.each(this.deps, function(dep) {\n\t\t\tlet indexPlguin = dep.indexOf(\"!\");\n\t\t\tif(indexPlguin > 0) {\n\t\t\t\tdep = dep.substring(0, indexPlguin);\n\t\t\t}\n\t\t\tlet mod = moduleDef.getModule(dep);\n\t\t\tif(mod && mod.state == \"defined\") {\n\t\t\t\tmod._printOnNotDefined(node);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t//只打印一个错误栈\n\t\t\tif(mod) {\n\t\t\t\tmod._printOnNotDefined(node);\n\t\t\t} else {\n\t\t\t\tnode.nodes.push({\n\t\t\t\t\tparent: parentNode,\n\t\t\t\t\tnodes: [],\n\t\t\t\t\terr: \"[\" + dep + \"] has not module\"\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t};\n\tmoduleDef.setModule(moduleMap.selfname, moduleMap);\n\n\tbuildInvoker(moduleMap);\n\treturn moduleMap;\n}\n\nlet randModuleIndex = 0;\n\nfunction _getModuleId() {\n\treturn \"_xs_req_2019_\" + randModuleIndex++;\n}\n//处理嵌套依赖\nfunction _dealEmbedDeps(deps) {\n\tfor(let i = 0; i < deps.length; i++) {\n\t\tlet dep = deps[i];\n\t\tif(xsloader.isArray(dep)) {\n\t\t\t//内部的模块顺序加载\n\t\t\tlet modName = \"inner_order_\" + _getModuleId();\n\t\t\tlet isOrderDep = !(dep.length > 0 && dep[0] === false);\n\t\t\tif(dep.length > 0 && (dep[0] === false || dep[0] === true)) {\n\t\t\t\tdep = dep.slice(1);\n\t\t\t}\n\t\t\tinnerDepsMap[modName] = {\n\t\t\t\tdeps: dep,\n\t\t\t\torderDep: isOrderDep\n\t\t\t};\n\n\t\t\t//console.log(innerDepsMap[modName]);\n\t\t\tdeps[i] = INNER_DEPS_PLUGIN + \"!\" + modName;\n\t\t}\n\t}\n}\n\nfunction _getPluginParam(path) {\n\tlet pluginIndex = path.indexOf(\"!\");\n\tif(pluginIndex > 0) {\n\t\treturn path.substring(pluginIndex);\n\t} else {\n\t\treturn \"\";\n\t}\n}\n\n//everyOkCallback(depModules,module),errCallback(err,invoker)\nfunction everyRequired(defineObject, module, everyOkCallback, errCallback) {\n\tif(defineObject.isError) {\n\t\treturn;\n\t}\n\n\tlet config = xsloader.config();\n\tconst deps = module.deps;\n\n\tutils.replaceModulePrefix(config, deps); //前缀替换\n\t_dealEmbedDeps(deps); //处理嵌套依赖\n\n\tfor(let i = 0; i < deps.length; i++) {\n\t\t//console.log(module.selfname+(\"(\"+defineObject.handle.defined_module_for_deps+\")\"), \":\", deps);\n\t\tlet m = deps[i];\n\t\tlet jsFilePath = utils.isJsFile(m);\n\n\t\tif(module.thiz.rurl(defineObject)) { //替换相对路径为绝对路径\n\t\t\tif(jsFilePath && xsloader.startsWith(m, \".\")) {\n\t\t\t\tm = utils.getPathWithRelative(module.thiz.rurl(defineObject), jsFilePath.path) + _getPluginParam(m);\n\t\t\t\tdeps[i] = m;\n\t\t\t}\n\t\t}\n\t\tlet paths = utils.graphPath.tryAddEdge(defineObject.handle.defined_module_for_deps || module.selfname, m);\n\t\tif(paths.length > 0) {\n\t\t\tlet moduleLoop = moduleDef.getModule(m); //该模块必定已经被定义过\n\t\t\tmoduleLoop.loopObject = {};\n\t\t}\n\t}\n\n\tlet isError = false,\n\t\thasCallErr = false,\n\t\ttheExports;\n\tlet depCount = deps.length;\n\t//module.jsScriptCount = 0;\n\tlet depModules = new Array(depCount);\n\n\tlet invoker_the_module = module.thiz;\n\n\tfunction checkFinish(index, dep_name, depModule, syncHandle) {\n\t\tdepModules[index] = depModule;\n\n\t\tif( /*(depCount == 0 || depCount - module.jsScriptCount == 0)*/ depCount <= 0 && !isError) {\n\t\t\teveryOkCallback(depModules, module);\n\t\t} else if(isError) {\n\t\t\tmodule.setState('error', isError);\n\t\t\tif(!hasCallErr) {\n\t\t\t\thasCallErr = true;\n\t\t\t\terrCallback({\n\t\t\t\t\terr: isError,\n\t\t\t\t\tindex: index,\n\t\t\t\t\tdep_name: dep_name\n\t\t\t\t}, invoker_the_module);\n\t\t\t}\n\t\t}!isError && syncHandle && syncHandle();\n\t}\n\n\tutils.each(deps, function(dep, index, ary, syncHandle) {\n\t\tlet originDep = dep;\n\t\tlet pluginArgs = undefined;\n\t\tlet pluginIndex = dep.indexOf(\"!\");\n\t\tif(pluginIndex > 0) {\n\t\t\tpluginArgs = dep.substring(pluginIndex + 1);\n\t\t\tdep = dep.substring(0, pluginIndex);\n\t\t}\n\t\tlet relyItFun = function() {\n\t\t\tmoduleDef.getModule(dep).relyIt(invoker_the_module, function(depModule, err) {\n\n\t\t\t\tif(!err) {\n\t\t\t\t\tdepCount--;\n\t\t\t\t\tif(dep == \"exports\") {\n\t\t\t\t\t\tif(theExports) {\n\t\t\t\t\t\t\tmodule.moduleObject = theExports;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\ttheExports = module.moduleObject = depModule.genExports();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tisError = err;\n\t\t\t\t}\n\t\t\t\tcheckFinish(index, originDep, depModule, syncHandle);\n\t\t\t}, pluginArgs);\n\t\t};\n\n\t\tif(!moduleDef.getModule(dep)) {\n\t\t\tlet isJsFile = utils.isJsFile(dep);\n\t\t\tdo {\n\n\t\t\t\tlet urls;\n\n\t\t\t\tif(!isJsFile && dep.indexOf(\"/\") < 0 && dep.indexOf(\":\") >= 0) {\n\t\t\t\t\tlet i1 = dep.indexOf(\":\");\n\t\t\t\t\tlet i2 = dep.indexOf(\":\", i1 + 1);\n\t\t\t\t\tlet i3 = i2 > 0 ? dep.indexOf(\":\", i2 + 1) : -1;\n\t\t\t\t\tif(i2 == -1) {\n\t\t\t\t\t\tisError = \"illegal module:\" + dep;\n\t\t\t\t\t\terrCallback(isError, invoker_the_module);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tlet version;\n\t\t\t\t\tlet groupModule;\n\t\t\t\t\tif(i3 == -1) {\n\t\t\t\t\t\tversion = config.defaultVersion[dep];\n\t\t\t\t\t\tgroupModule = dep + \":\" + version;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tversion = dep.substring(i3 + 1);\n\t\t\t\t\t\tgroupModule = dep;\n\t\t\t\t\t}\n\t\t\t\t\tif(version === undefined) {\n\t\t\t\t\t\tisError = \"unknown version for:\" + dep;\n\t\t\t\t\t\terrCallback(isError, invoker_the_module);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tlet _url = xsloader._resUrlBuilder(groupModule);\n\t\t\t\t\turls = xsloader.isArray(_url) ? _url : [_url];\n\t\t\t\t} else if(config.isInUrls(dep)) {\n\t\t\t\t\turls = config.getUrls(dep);\n\t\t\t\t} else if(isJsFile) {\n\t\t\t\t\turls = [dep];\n\t\t\t\t} else {\n\t\t\t\t\turls = [];\n\t\t\t\t}\n\n\t\t\t\tif(urls.length == 0) {\n\t\t\t\t\tisError = \"module '\" + dep + \"' urls is empty.\";\n\t\t\t\t\terrCallback(isError, invoker_the_module);\n\t\t\t\t} else {\n\t\t\t\t\tutils.each(urls, function(url, index) {\n\t\t\t\t\t\tif(xsloader.startsWith(url, \".\") || xsloader.startsWith(url, \"/\")) {\n\t\t\t\t\t\t\tif(!module.thiz.rurl(defineObject)) {\n\t\t\t\t\t\t\t\tisError = \"script url is null:'\" + module.description();\n\t\t\t\t\t\t\t\terrCallback(isError, invoker_the_module);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\turl = utils.getPathWithRelative(module.thiz.rurl(defineObject), url);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tlet absolute = utils.dealPathMayAbsolute(url);\n\t\t\t\t\t\t\tif(absolute.absolute) {\n\t\t\t\t\t\t\t\turl = absolute.path;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\turl = config.baseUrl + url;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\turls[index] = config.dealUrl(dep, url);\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tif(!isError) {\n\t\t\t\t\tlet m2Name=isJsFile?null:dep;\n\t\t\t\t\tlet module2 = _newModule(m2Name, urls[0], module.absUrl, module.thiz);\n\t\t\t\t\tmodule2.setState(\"loading\");\n\n\t\t\t\t\t//加载模块dep:module2\n\t\t\t\t\tfunction loadModule(index = 0) {\n\t\t\t\t\t\tif(index >= urls.length) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tlet url = urls[index];\n\t\t\t\t\t\tif(index > 0) {\n\t\t\t\t\t\t\tlet oldSrc = module2.src;\n\t\t\t\t\t\t\tmodule2.src = url;\n\t\t\t\t\t\t\tmoduleDef.replaceModuleSrc(oldSrc, module2);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tscript.loadScript(module2.selfname, url, (scriptData) => {\n\t\t\t\t\t\t\tconsole.log(scriptData);\n\t\t\t\t\t\t\tif(module2.state == \"loading\") { //module2.selfname为配置名称，尝试默认模块\n\t\t\t\t\t\t\t\tlet defaultMod = moduleDef.getModule(module2.src);\n\t\t\t\t\t\t\t\tif(defaultMod) {\n\t\t\t\t\t\t\t\t\tmodule2.toOtherModule(defaultMod);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif(module2.state == \"loading\") {\n\t\t\t\t\t\t\t\tisError = \"load module err(may not define default):\"+module2.description();\n\t\t\t\t\t\t\t\terrCallback(isError, invoker_the_module);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}, (err) => {\n\t\t\t\t\t\t\tif(index + 1 < urls.length) {\n\t\t\t\t\t\t\t\tloadModule(index + 1);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tisError = err;\n\t\t\t\t\t\t\t\terrCallback(isError, invoker_the_module);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tloadModule();\n\t\t\t\t}\n\t\t\t} while (false);\n\t\t}\n\t\tif(!isError) {\n\t\t\trelyItFun();\n\t\t}\n\t}, defineObject.handle.orderDep);\n\t//TODO STRONG ????ie10及以下版本，js文件一个一个加载，从而解决缓存等造成的混乱问题\n}\n\nexport default {\n\t...moduleDef,\n\tnewModule,\n\teveryRequired,\n\tINNER_DEPS_PLUGIN,\n\tinnerDepsMap,\n\tbuildInvoker,\n\tnewModuleInstance\n};","import utils from \"../util/index.js\";\nimport moduleScript from \"./module.js\";\n\nconst global = utils.global;\nconst xsloader = global.xsloader;\n\nconst defContextName = \"xsloader1.1.x\";\nconst DATA_ATTR_MODULE = 'data-xsloader-module';\nconst DATA_ATTR_CONTEXT = \"data-xsloader-context\";\nconst globalDefineQueue = []; //没有配置前的define\n\nconst head = document.head || document.getElementsByTagName('head')[0];\nconst isOpera = typeof opera !== 'undefined' && opera.toString() === '[object Opera]';\nconst readyRegExp = navigator.platform === 'PLAYSTATION 3' ? /^complete$/ : /^(complete|loaded)$/;\nconst theLoaderScript = document.currentScript || utils.getScriptBySubname(\"xsloader.js\");\nconst theLoaderUrl = utils.getNodeAbsolutePath(theLoaderScript);\nconst thePageUrl = (function() {\n\tlet url = location.href;\n\turl = utils.removeQueryHash(url);\n\treturn url;\n})();\n\nconst currentDefineModuleQueue = []; //当前回调的模块\ncurrentDefineModuleQueue.peek = function() {\n\tif(this.length > 0) {\n\t\treturn this[this.length - 1];\n\t}\n};\n\nlet lastAppendHeadDom = theLoaderScript;\nlet useDefineQueue;\nlet theRealDefine;\nif(utils.safariVersion > 0 && utils.safariVersion <= 7) {\n\tuseDefineQueue = [];\n}\n/////////////////////////////\n\nclass Invoker {\n\t_im;\n\tconstructor(moduleMap) {\n\t\tthis._im = new InVar(moduleMap);\n\t}\n\t/**\n\t * 获取绝对地址\n\t */\n\tgetAbsoluteUrl() {\n\t\treturn this._im.get().src;\n\t}\n\tgetName() {\n\t\treturn this._im.get().selfname;\n\t}\n\tinvoker() {\n\t\treturn this._im.get().invoker;\n\t}\n\tabsUrl() { //用于获取其他模块地址的参考路径\n\t\treturn this._im.get().absUrl;\n\t}\n}\n\nfunction getInvoker(thiz, nullNew=true) {\n\tif(thiz instanceof Invoker) {\n\t\treturn thiz;\n\t} else if(thiz instanceof DefineObject) {\n\t\treturn thiz.thatInvoker;\n\t} else if(nullNew) {\n\t\tlet moduleMap = {\n\t\t\tmodule: \"\",\n\t\t\tsrc: thePageUrl,\n\t\t\tabsUrl: thePageUrl,\n\t\t\tname: \"__root__\",\n\t\t\tinvoker: null\n\t\t};\n\t\tmoduleMap.thiz = new Invoker(moduleMap);\n\t\tmoduleScript.buildInvoker(moduleMap);\n\t\tmoduleMap.thiz.invoker = function() {\n\t\t\treturn this;\n\t\t};\n\t\treturn moduleMap.thiz;\n\t}\n}\n\nclass DefineObject {\n\tthiz;\n\tisRequire;\n\tsrc;\n\tparentDefine;\n\thandle;\n\tselfname;\n\tdeps;\n\tcallback;\n\tthatInvoker;\n\tconstructor(src, thiz, args=[], isRequire = false) {\n\t\tthis.src = src;\n\t\tthis.thiz = thiz;\n\t\tthis.isRequire = isRequire;\n\t\tthis.parentDefine = currentDefineModuleQueue.peek();\n\t\tthis.handle = {\n\t\t\tonError(err) {},\n\t\t\tbefore(deps) {},\n\t\t\tdepBefore(index, dep, depDeps) {},\n\t\t\torderDep: false,\n\t\t\tabsoluteUrl: undefined, //弃用\n\t\t\tabsUrl: undefined,\n\t\t\tinstance: undefined,\n\t\t};\n\t\tthis.thatInvoker = getInvoker(thiz);\n\n\t\tlet selfname = args[0];\n\t\tlet deps = args[1];\n\t\tlet callback = args[2];\n\n\t\tif(typeof selfname !== 'string') {\n\t\t\tcallback = deps;\n\t\t\tdeps = selfname;\n\t\t\tselfname = null; //为空的、表示定义默认模块\n\t\t}\n\n\t\tif(!xsloader.isArray(deps)) {\n\t\t\tcallback = deps;\n\t\t\tdeps = null;\n\t\t}\n\n\t\tif(!deps) {\n\t\t\tdeps = [];\n\t\t}\n\n\t\t//获取函数体里直接require('...')的依赖\n\t\t//if(!isRequire) {\n\t\tutils.appendInnerDeps(deps, callback);\n\t\t//}\n\t\tlet config = xsloader.config();\n\t\tif(config) {\n\t\t\t//获取配置里配置的依赖\n\t\t\tlet _deps = config.getDeps(src);\n\t\t\tutils.each(_deps, (dep) => {\n\t\t\t\tdeps.push(dep);\n\t\t\t});\n\t\t\tif(selfname && selfname != src) {\n\t\t\t\t_deps = config.getDeps(selfname);\n\t\t\t\tutils.each(_deps, (dep) => {\n\t\t\t\t\tdeps.push(dep);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tthis.selfname = selfname;\n\t\tthis.deps = deps;\n\t\tthis.callback = callback;\n\t}\n\tget absUrl() {\n\t\treturn this.getMineAbsUrl() || (this.thatInvoker ? this.thatInvoker.absUrl() : null);\n\t}\n\n\tgetMineAbsUrl() {\n\t\treturn this.handle.absUrl || this.handle.absoluteUrl;\n\t}\n}\n\n////////////////////////\n\n/**\n * 获取当前脚本，返回对象：\n * src:脚本绝对地址，不含参数\n * node:脚本dom对象\n * @param {Object} isRemoveQueryHash\n */\nfunction getCurrentScript(isRemoveQueryHash = true) {\n\tfunction _getCurrentScriptOrSrc() { //兼容获取正在运行的js\n\t\t//取得正在解析的script节点\n\t\tif(document.currentScript !== undefined) { //firefox 4+\n\t\t\tlet node = document.currentScript && document.currentScript.src && document.currentScript;\n\t\t\tif(node) {\n\t\t\t\treturn {\n\t\t\t\t\tnode,\n\t\t\t\t\tsrc: node.src\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\t\tif(utils.IE_VERSION > 0 && utils.IE_VERSION <= 10) {\n\t\t\tlet nodes = document.getElementsByTagName(\"script\"); //只在head标签中寻找\n\t\t\tfor(let i = 0; i < nodes.length; i++) {\n\t\t\t\tlet node = nodes[i];\n\t\t\t\tif(node.readyState === \"interactive\") {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tnode,\n\t\t\t\t\t\tsrc: node.src\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tlet stack;\n\t\ttry {\n\t\t\tlet a = undefined;\n\t\t\ta.b.c(); //强制报错,以便捕获e.stack\n\t\t} catch(e) { //safari的错误对象只有line,sourceId,sourceURL\n\t\t\tstack = e.stack || e.sourceURL || e.stacktrace || '';\n\t\t\tif(!stack && window.opera) {\n\t\t\t\t//opera 9没有e.stack,但有e.Backtrace,但不能直接取得,需要对e对象转字符串进行抽取\n\t\t\t\tstack = (String(e).match(/of linked script \\S+/g) || []).join(\" \");\n\t\t\t}\n\t\t}\n\t\tif(stack) {\n\t\t\t/**e.stack最后一行在所有支持的浏览器大致如下:\n\t\t\t *chrome23:\n\t\t\t * at http://113.93.50.63/data.js:4:1\n\t\t\t *firefox17:\n\t\t\t *@http://113.93.50.63/query.js:4\n\t\t\t *opera12:\n\t\t\t *@http://113.93.50.63/data.js:4\n\t\t\t *IE10:\n\t\t\t *  at Global code (http://113.93.50.63/data.js:4:1)\n\t\t\t */\n\t\t\tstack = stack.split(/[@ ]/g).pop(); //取得最后一行,最后一个空格或@之后的部分\n\t\t\tstack = stack[0] == \"(\" ? stack.slice(1, -1) : stack;\n\t\t\tlet s = stack.replace(/(:\\d+)?:\\d+$/i, \"\"); //去掉行号与或许存在的出错字符起始位置\n\t\t\treturn {\n\t\t\t\tsrc: s\n\t\t\t};\n\t\t}\n\t}\n\n\tlet rs = _getCurrentScriptOrSrc();\n\tif(rs) {\n\t\tif(!rs.node) {\n\t\t\tlet src = utils.removeQueryHash(rs.src);\n\t\t\tlet nodes = document.getElementsByTagName(\"script\"); //只在head标签中寻找\n\t\t\tfor(let i = 0; i < nodes.length; i++) {\n\t\t\t\tlet node = nodes[i];\n\t\t\t\tif(src == utils.removeQueryHash(node.src)) {\n\t\t\t\t\trs.node = node;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif(rs.node) {\n\t\t\trs.src = utils.getNodeAbsolutePath(rs.node);\n\t\t}\n\t\tif(isRemoveQueryHash) {\n\t\t\trs.src = utils.removeQueryHash(rs.src);\n\t\t}\n\t}\n\treturn rs;\n\n}\n\nfunction __createNode() {\n\tlet node = document.createElement('script');\n\tnode.type = 'text/javascript';\n\tnode.charset = 'utf-8';\n\tnode.async = true;\n\treturn node;\n}\n\nfunction __removeListener(node, func, name, ieName) {\n\tif(node.detachEvent && !isOpera) {\n\t\tif(ieName) {\n\t\t\tnode.detachEvent(ieName, func);\n\t\t}\n\t} else {\n\t\tnode.removeEventListener(name, func, false);\n\t}\n}\n\n/**\n * callbackObj.onScriptLoad\n * callbackObj.onScriptError\n *\n */\nfunction __browserLoader(moduleName, url, callbackObj) {\n\tlet node = __createNode();\n\tnode.setAttribute(DATA_ATTR_MODULE, moduleName);\n\tnode.setAttribute(DATA_ATTR_CONTEXT, defContextName);\n\tif(node.attachEvent &&\n\t\t!(node.attachEvent.toString && node.attachEvent.toString().indexOf('[native code') < 0) &&\n\t\t!isOpera) {\n\t\tnode.attachEvent('onreadystatechange', callbackObj.onScriptLoad);\n\t} else {\n\t\tnode.addEventListener('load', callbackObj.onScriptLoad, true);\n\t\tlet errListen = function() {\n\t\t\t__removeListener(node, errListen, 'error');\n\t\t\tcallbackObj.onScriptError.apply(this, arguments);\n\t\t};\n\t\tcallbackObj.errListen = errListen;\n\t\tnode.addEventListener('error', errListen, true);\n\t}\n\tnode.src = url;\n\tappendHeadDom(node);\n}\n\nfunction __getScriptData(evt, callbackObj) {\n\tlet node = evt.currentTarget || evt.srcElement;\n\t__removeListener(node, callbackObj.onScriptLoad, 'load', 'onreadystatechange');\n\t__removeListener(node, callbackObj.errListen, 'error');\n\treturn {\n\t\tnode: node,\n\t\tname: node && node.getAttribute(DATA_ATTR_MODULE),\n\t\tsrc: utils.removeQueryHash(node && utils.getNodeAbsolutePath(node))\n\t};\n}\n\nfunction appendHeadDom(dom) {\n\tif(!xsloader.isDOM(dom)) {\n\t\tthrow new Error(\"expected dom object,but provided:\" + dom);\n\t}\n\tlet nextDom = lastAppendHeadDom.nextSibling;\n\thead.insertBefore(dom, nextDom);\n\t//\t\t\thead.appendChild(dom);\n\tlastAppendHeadDom = dom;\n}\n\n/////////////////////////\n\nfunction loadScript(moduleName, url, onload, onerror) {\n\tlet callbackObj = {};\n\tcallbackObj.onScriptLoad = function(evt) {\n\t\tif(callbackObj.removed) {\n\t\t\treturn;\n\t\t}\n\t\tif(evt.type === 'load' || (readyRegExp.test((evt.currentTarget || evt.srcElement).readyState))) {\n\t\t\tcallbackObj.removed = true;\n\t\t\tlet scriptData = __getScriptData(evt, callbackObj);\n\t\t\tif(useDefineQueue) {\n\t\t\t\tutils.each(useDefineQueue, (defineObject) => {\n\t\t\t\t\tdefineObject.src = scriptData.src; //已经不含参数\n\t\t\t\t});\n\t\t\t\ttheRealDefine([...useDefineQueue]);\n\t\t\t}\n\t\t\tonload(scriptData);\n\t\t}\n\t};\n\tcallbackObj.onScriptError = function(evt) {\n\t\tif(callbackObj.removed) {\n\t\t\treturn;\n\t\t}\n\t\tcallbackObj.removed = true;\n\t\tlet scriptData = __getScriptData(evt, callbackObj);\n\t\tonerror(scriptData);\n\t};\n\t__browserLoader(moduleName, url, callbackObj);\n}\n\nfunction doDefine(thiz, args, isRequire) {\n\tlet src = getCurrentScript().src; //已经不含参数\n\tlet defineObject = new DefineObject(src, thiz, args, isRequire);\n\tif(!useDefineQueue) {\n\t\ttry { //防止执行其他脚本\n\t\t\tif(defineObject.src) {\n\t\t\t\tlet node = document.currentScript;\n\t\t\t\tif(node && node.getAttribute(\"src\") && node.getAttribute(DATA_ATTR_CONTEXT) != defContextName &&\n\t\t\t\t\tdefineObject.src != theLoaderUrl && defineObject.src != thePageUrl) {\n\t\t\t\t\tconsole.error(\"unknown js script module:\" + xsloader.xsJson2String(defineObject.src));\n\t\t\t\t\tconsole.error(node);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t} catch(e) {\n\t\t\txsloader.config().error(e);\n\t\t}\n\n\t}\n\n\tlet handle = {\n\t\tthen(option) {\n\t\t\tdefineObject.handle = xsloader.extend(defineObject.handle, option);\n\t\t\treturn this;\n\t\t},\n\t\terror(onError) {\n\t\t\tdefineObject.handle.onError = onError;\n\t\t\treturn this;\n\t\t}\n\t};\n\n\txsloader.asyncCall(() => {\n\t\tif(useDefineQueue) {\n\t\t\tuseDefineQueue.push(defineObject);\n\t\t} else {\n\t\t\ttheRealDefine([defineObject]);\n\t\t}\n\t});\n\txsloader.asyncCall().next(() => {\n\n\t});\n\n\treturn handle;\n}\n\nfunction predefine() {\n\tlet args = [];\n\tfor(let i = 0; i < arguments.length; i++) {\n\t\targs.push(arguments[i]);\n\t}\n\treturn doDefine(this, args, false);\n}\n\nfunction prerequire(deps, callback) {\n\n\tif(!xsloader.config()) { //require必须是在config之后\n\t\tthrow new Error(\"not config\");\n\t}\n\tlet thatInvoker = getInvoker(this, true);\n\tif(arguments.length == 1 && xsloader.isString(deps)) { //获取已经加载的模块\n\t\tlet originDeps = deps;\n\t\tlet pluginArgs = undefined;\n\t\tlet pluginIndex = deps.indexOf(\"!\");\n\t\tif(pluginIndex > 0) {\n\t\t\tpluginArgs = deps.substring(pluginIndex + 1);\n\t\t\tdeps = deps.substring(0, pluginIndex);\n\t\t\tif(pluginArgs) {\n\t\t\t\tlet argArr = [pluginArgs];\n\t\t\t\tutils.replaceModulePrefix(xsloader.config(), argArr); //前缀替换\n\t\t\t\tpluginArgs = argArr[0];\n\t\t\t}\n\t\t}\n\t\tlet module = moduleScript.getModule(deps);\n\t\tif(!module) {\n\t\t\tdeps = thatInvoker.getUrl(deps, false);\n\t\t\tmodule = moduleScript.getModule(deps);\n\t\t}\n\t\tif(!module) {\n\t\t\tthrow new Error(\"the module '\" + originDeps + \"' is not load!\");\n\t\t} else if(module.state != \"defined\") {\n\t\t\tthrow new Error(\"the module '\" + originDeps + \"' is not defined:\" + module.state);\n\t\t}\n\t\tlet theMod;\n\t\tmoduleScript.newModuleInstance(module, thatInvoker, (depModule) => {\n\t\t\ttheMod = depModule.moduleObject();\n\t\t}, pluginArgs).init(true);\n\t\tif(theMod === undefined) {\n\t\t\tthrow Error(\"the module '\" + originDeps + \"' is not load!\");\n\t\t}\n\t\treturn theMod;\n\t}\n\n\tlet selfname = xsloader.randId(\"_require\");\n\tif(xsloader.isFunction(deps)) {\n\t\tcallback = deps;\n\t\tdeps = [];\n\t}\n\tutils.appendInnerDeps(deps, callback);\n\tlet timeid;\n\tlet handle = doDefine(this, [selfname, deps, function() {\n\t\tif(timeid !== undefined) {\n\t\t\tclearTimeout(timeid);\n\t\t}\n\t\tif(xsloader.isFunction(callback)) {\n\t\t\tcallback.apply(this, arguments);\n\t\t}\n\t}], true);\n\t//TODO handle.isError处理与抛出异常处理\n\tlet checkResultFun = function() {\n\t\tlet ifmodule = moduleScript.getModule(selfname);\n\t\tif((!ifmodule || ifmodule.state != 'defined') && !handle.isError) {\n\t\t\tlet module = ifmodule;\n\t\t\tif(module) {\n\t\t\t\tutils.each(module.deps, function(dep) {\n\t\t\t\t\tlet mod = moduleScript.getModule(dep);\n\t\t\t\t\tmod && mod.printOnNotDefined();\n\t\t\t\t});\n\t\t\t}\n\t\t\tconsole.error(\"require timeout:[\" + (deps ? deps.join(\",\") : \"\") + \"]\");\n\t\t}\n\t};\n\ttimeid = setTimeout(checkResultFun, xsloader.config().waitSeconds * 1000);\n\treturn handle;\n}\n\n//对于safari7-:在脚本加载事件中可获得正确的脚本地址\n\nconst initDefine = function(theDefine) {\n\ttheRealDefine = (defines) => {\n\t\tif(!xsloader.config()) { //还没有配置\n\t\t\tglobalDefineQueue.push(defines);\n\t\t} else {\n\t\t\ttheDefine(defines);\n\t\t}\n\t};\n\treturn {\n\t\tpredefine,\n\t\tprerequire,\n\t};\n};\n\nconst onConfigedCallback = function() {\n\twhile(globalDefineQueue.length) {\n\t\tlet defines = globalDefineQueue.shift();\n\t\ttheRealDefine(defines);\n\t}\n};\n\nexport default {\n\tdefContextName,\n\ttheLoaderScript,\n\ttheLoaderUrl,\n\tthePageUrl,\n\tappendHeadDom,\n\tinitDefine,\n\tInvoker,\n\tDefineObject,\n\tloadScript,\n\tcurrentDefineModuleQueue,\n\tonConfigedCallback\n};","import loader from './loader.js';\nimport \"../public/index.js\";\nimport utils from \"../util/index.js\";\n\nconst global = utils.global;\nconst xsloader = global.xsloader;\n\nimport script from \"./script.js\";\nimport moduleScript from \"./module.js\";\n\nlet theContext;\nlet theConfig;\nlet argsObject = {};\n\nxsloader.config = function() {\n\treturn theConfig;\n};\nxsloader.script = function() {\n\treturn script.theLoaderScript;\n};\nxsloader.scriptSrc = function() {\n\treturn script.theLoaderUrl;\n};\n\nxsloader.putUrlArgs = function(argsObj) {\n\targsObject = xsloader.extend(argsObject, argsObj);\n};\n\nxsloader.getUrlArgs = function() {\n\tlet obj = xsloader.extend({}, argsObject);\n\treturn obj;\n};\n\nxsloader.clearUrlArgs = function() {\n\targsObject = {};\n};\n\nxsloader.hasDefine = function(name) {\n\tlet has = false;\n\tlet module = moduleScript.getModule(name);\n\tif(!module || module.state == \"init\") {\n\n\t} else {\n\t\thas = true;\n\t}\n\treturn has;\n};\n\n//用于把\"group:project:version\"转换成url地址,返回一个String或包含多个url地址的数组\nxsloader._resUrlBuilder = function(groupName) {\n\tthrow new Error('resUrlBuilder not found!');\n};\n\nxsloader.clear_module_ = function() {\n\tlet modules = arguments;\n\tfor(let i = 0; i < modules.length; i++) {\n\t\tif(modules[i]) {\n\t\t\tdelete modules[i]._module_;\n\t\t\tdelete modules[i]._modules_;\n\t\t}\n\t}\n};\n\nfunction _newContext() {\n\tlet context = {\n\t\tcontextName: script.contextName,\n\t\tdefQueue: []\n\t};\n\treturn context;\n}\n\nloader.loaderFun((option) => {\n\tif(theContext) {\n\t\tthrow new Error(\"already configed!\");\n\t}\n\toption = xsloader.extend({\n\t\tbaseUrl: utils.getPathWithRelative(location.pathname, \"./\", xsloader.endsWith(location.pathname, \"/\")),\n\t\turlArgs: {},\n\t\tignoreProperties: false,\n\t\tpaths: {},\n\t\tdepsPaths: {},\n\t\tdeps: {},\n\t\tjsExts: undefined,\n\t\tproperties: {},\n\t\tmodulePrefix: {},\n\t\tdefineFunction: {},\n\t\tmodulePrefixCount: 0,\n\t\twaitSeconds: 10,\n\t\tautoUrlArgs() {\n\t\t\treturn false;\n\t\t},\n\t\tinstance: \"single\",\n\t\tdealtDeps: {},\n\t\tdealProperties(obj) {\n\t\t\treturn utils.propertiesDeal(obj, option.properties);\n\t\t},\n\t\tisInUrls(m) {\n\t\t\treturn !!this.getUrls(m);\n\t\t},\n\t\tgetUrls(m) {\n\t\t\treturn this.paths[m] || this.depsPaths[m];\n\t\t},\n\t\tgetDeps(m) {\n\t\t\tlet as = this.dealtDeps[m] || [];\n\t\t\tlet deps = [];\n\t\t\tlet hasOrderDep = undefined;\n\n\t\t\tif(as.length > 0 && (as[0] === true || as[0] === false)) {\n\t\t\t\tif(as[0]) {\n\t\t\t\t\tdeps = [\n\t\t\t\t\t\t[]\n\t\t\t\t\t];\n\t\t\t\t\thasOrderDep = true;\n\t\t\t\t} else {\n\t\t\t\t\tas.splice(0, 1);\n\t\t\t\t}\n\t\t\t}\n\t\t\tfor(let i = 0; i < as.length; i++) {\n\t\t\t\tif(hasOrderDep === true) {\n\t\t\t\t\tdeps[0].push(as[i]);\n\t\t\t\t} else {\n\t\t\t\t\tdeps.push(as[i]);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn deps;\n\t\t},\n\t\tdealUrl(module, url) {\n\t\t\tlet urlArg;\n\t\t\tlet nameOrUrl;\n\t\t\tif(this.autoUrlArgs()) {\n\t\t\t\turlArg = \"_t=\" + new Date().getTime();\n\t\t\t} else if(xsloader.isString(module)) {\n\t\t\t\turlArg = this.urlArgs[module];\n\t\t\t\tif(urlArg) {\n\t\t\t\t\tnameOrUrl = module;\n\t\t\t\t} else {\n\t\t\t\t\tnameOrUrl = module;\n\t\t\t\t\turlArg = this.forPrefixSuffix(module);\n\t\t\t\t}\n\n\t\t\t\tif(!urlArg) {\n\t\t\t\t\tnameOrUrl = \"*\";\n\t\t\t\t\turlArg = this.urlArgs[\"*\"];\n\t\t\t\t}\n\n\t\t\t} else {\n\n\t\t\t\turlArg = this.urlArgs[url];\n\t\t\t\tif(urlArg) {\n\t\t\t\t\tnameOrUrl = url;\n\t\t\t\t} else {\n\t\t\t\t\turlArg = this.forPrefixSuffix(url);\n\t\t\t\t}\n\n\t\t\t\tif(!urlArg) {\n\t\t\t\t\tnameOrUrl = module.selfname;\n\t\t\t\t\turlArg = this.urlArgs[nameOrUrl];\n\t\t\t\t}\n\n\t\t\t\tif(!urlArg) {\n\t\t\t\t\tnameOrUrl = module.aurl;\n\t\t\t\t\turlArg = this.forPrefixSuffix(nameOrUrl);\n\t\t\t\t}\n\n\t\t\t\tif(!urlArg) {\n\t\t\t\t\tnameOrUrl = \"*\";\n\t\t\t\t\turlArg = this.urlArgs[\"*\"];\n\t\t\t\t}\n\n\t\t\t}\n\t\t\tif(xsloader.isFunction(urlArg)) {\n\t\t\t\turlArg = urlArg.call(this, nameOrUrl);\n\t\t\t}\n\t\t\tfor(let k in argsObject) { //加入全局的参数\n\t\t\t\turlArg += \"&\" + k + \"=\" + encodeURIComponent(argsObject[k]);\n\t\t\t}\n\t\t\treturn xsloader.appendArgs2Url(url, urlArg);\n\t\t},\n\t\tdealUrlArgs(url) {\n\t\t\turl = utils.getPathWithRelative(location.href, url);\n\t\t\treturn this.dealUrl(url, url);\n\t\t},\n\t\tdefaultVersion: {}\n\t}, option);\n\n\tif(!xsloader.endsWith(option.baseUrl, \"/\")) {\n\t\toption.baseUrl += \"/\";\n\t}\n\toption.baseUrl = utils.getPathWithRelative(location.href, option.baseUrl);\n\n\tif(!option.ignoreProperties) {\n\t\toption = option.dealProperties(option);\n\t}\n\n\tutils.strValue2Arr(option.paths);\n\tutils.strValue2Arr(option.depsPaths);\n\tutils.strValue2Arr(option.deps);\n\n\tif(!xsloader.isFunction(option.autoUrlArgs)) {\n\t\tlet isAutoUrlArgs = option.autoUrlArgs;\n\t\toption.autoUrlArgs = function() {\n\t\t\treturn isAutoUrlArgs;\n\t\t};\n\t}\n\n\tlet modulePrefixCount = 0;\n\tfor(let prefix in option.modulePrefix) {\n\t\tif(xsloader.startsWith(prefix, \".\") || xsloader.startsWith(prefix, \"/\")) {\n\t\t\tthrow new Error(\"modulePrefix can not start with '.' or '/'(\" + prefix + \")\");\n\t\t}\n\t\tmodulePrefixCount++;\n\t}\n\toption.modulePrefixCount = modulePrefixCount;\n\tif(modulePrefixCount > 0) {\n\t\t//替换urlArgs中地址前缀\n\t\tlet star = option.urlArgs[\"*\"];\n\t\tdelete option.urlArgs[\"*\"];\n\n\t\tlet urlArgsArr = [];\n\t\tfor(let k in option.urlArgs) {\n\t\t\tlet url = k;\n\t\t\tif(utils.isJsFile(url)) { //处理相对\n\t\t\t\tif(xsloader.startsWith(url, \".\") || xsloader.startsWith(url, \"/\") && !xsloader.startsWith(url, \"//\")) {\n\t\t\t\t\turl = utils.getPathWithRelative(script.theLoaderUrl, url);\n\t\t\t\t} else {\n\t\t\t\t\tlet absolute = utils.dealPathMayAbsolute(url);\n\t\t\t\t\tif(absolute.absolute) {\n\t\t\t\t\t\turl = absolute.path;\n\t\t\t\t\t} else if(!xsloader.startsWith(url, \"*]\")) { //排除*]；单*[可以有前缀\n\t\t\t\t\t\turl = option.baseUrl + url;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t}\n\t\t\turlArgsArr.push({\n\t\t\t\turl: url,\n\t\t\t\targs: option.urlArgs[k]\n\t\t\t});\n\t\t}\n\n\t\tfor(let prefix in option.modulePrefix) {\n\t\t\tlet replaceStr = option.modulePrefix[prefix].replace;\n\t\t\tfor(let i = 0; i < urlArgsArr.length; i++) {\n\t\t\t\tlet urlArgObj = urlArgsArr[i];\n\t\t\t\tlet starP = \"\";\n\t\t\t\tif(xsloader.startsWith(urlArgObj.url, \"*[\")) {\n\t\t\t\t\tstarP = \"*[\";\n\t\t\t\t\turlArgObj.url = urlArgObj.url.substring(2);\n\t\t\t\t}\n\t\t\t\tif(xsloader.startsWith(urlArgObj.url, prefix)) {\n\t\t\t\t\turlArgObj.url = replaceStr + urlArgObj.url.substring(prefix.length);\n\t\t\t\t}\n\t\t\t\tstarP && (urlArgObj.url = starP + urlArgObj.url);\n\t\t\t}\n\t\t}\n\t\toption.urlArgs = {};\n\t\toption.urlArgs[\"*\"] = star;\n\t\tfor(let i = 0; i < urlArgsArr.length; i++) {\n\t\t\tlet urlArgObj = urlArgsArr[i];\n\t\t\toption.urlArgs[urlArgObj.url] = urlArgObj.args;\n\t\t}\n\t}\n\n\t//预处理urlArgs中的*[与*]\n\tlet _urlArgs_prefix = [];\n\tlet _urlArgs_suffix = [];\n\toption._urlArgs_prefix = _urlArgs_prefix;\n\toption._urlArgs_suffix = _urlArgs_suffix;\n\n\tfor(let k in option.urlArgs) {\n\t\tlet url = k;\n\t\tif(xsloader.startsWith(url, \"*[\")) {\n\t\t\tlet strfix = url.substring(2);\n\t\t\tif(xsloader.startsWith(strfix, \".\") || xsloader.startsWith(strfix, \"/\") && !xsloader.startsWith(strfix, \"//\")) {\n\t\t\t\tstrfix = utils.getPathWithRelative(script.theLoaderUrl, strfix);\n\t\t\t} else {\n\t\t\t\tlet absolute = utils.dealPathMayAbsolute(strfix);\n\t\t\t\tif(absolute.absolute) {\n\t\t\t\t\tstrfix = absolute.path;\n\t\t\t\t} else {\n\t\t\t\t\turl = option.baseUrl + url;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t_urlArgs_prefix.push({\n\t\t\t\tstrfix: strfix,\n\t\t\t\tvalue: option.urlArgs[k]\n\t\t\t});\n\t\t\tdelete option.urlArgs[k];\n\t\t} else if(xsloader.startsWith(url, \"*]\")) {\n\t\t\t_urlArgs_suffix.push({\n\t\t\t\tstrfix: url.substring(2),\n\t\t\t\tvalue: option.urlArgs[k]\n\t\t\t});\n\t\t\tdelete option.urlArgs[k];\n\t\t}\n\t}\n\n\toption.forPrefixSuffix = function(urlOrName) {\n\t\t//前缀判断\n\t\tfor(let i = 0; i < _urlArgs_prefix.length; i++) {\n\t\t\tlet strfixObj = _urlArgs_prefix[i];\n\t\t\tif(xsloader.startsWith(urlOrName, strfixObj.strfix)) {\n\t\t\t\tlet value;\n\t\t\t\tif(xsloader.isFunction(strfixObj.value)) {\n\t\t\t\t\tvalue = strfixObj.value.call(this, urlOrName);\n\t\t\t\t} else {\n\t\t\t\t\tvalue = strfixObj.value;\n\t\t\t\t}\n\t\t\t\treturn value;\n\t\t\t}\n\t\t}\n\n\t\t//后缀判断\n\t\tfor(let i = 0; i < _urlArgs_suffix.length; i++) {\n\t\t\tlet strfixObj = _urlArgs_suffix[i];\n\t\t\tif(xsloader.endsWith(urlOrName, strfixObj.strfix)) {\n\t\t\t\tlet value;\n\t\t\t\tif(xsloader.isFunction(strfixObj.value)) {\n\t\t\t\t\tvalue = strfixObj.value.call(this, urlOrName);\n\t\t\t\t} else {\n\t\t\t\t\tvalue = strfixObj.value;\n\t\t\t\t}\n\t\t\t\treturn value;\n\t\t\t}\n\t\t}\n\t};\n\n\tfor(let name in option.paths) {\n\t\tutils.replaceModulePrefix(option, option.paths[name]); //前缀替换\n\t}\n\tfor(let name in option.depsPaths) {\n\t\tutils.replaceModulePrefix(option, option.depsPaths[name]); //前缀替换\n\t}\n\n\t//处理依赖\n\tlet dealtDeps = option.dealtDeps;\n\n\tlet pushDeps = (dealtDepArray, depsArray) => {\n\t\tutils.each(depsArray, (dep) => {\n\t\t\tdealtDepArray.push(dep);\n\t\t});\n\t};\n\n\tfor(let keyName in option.deps) {\n\t\tlet paths = keyName.split('::');\n\t\tlet depsArray = option.deps[keyName];\n\t\tutils.each(paths, (path) => {\n\t\t\tif(path == '*') {\n\t\t\t\tfor(let m in option.depsPaths) {\n\t\t\t\t\tlet dealtDepArray = dealtDeps[m] = dealtDeps[m] || [];\n\t\t\t\t\tpushDeps(dealtDepArray, depsArray);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tlet dealtDepArray = (dealtDeps[path] = dealtDeps[path] || []);\n\t\t\t\tpushDeps(dealtDepArray, depsArray);\n\t\t\t}\n\t\t});\n\t}\n\n\ttheConfig = option;\n\ttheContext = _newContext();\n\tscript.onConfigedCallback(); //完成配置回调\n\treturn theConfig;\n});","import utils from \"./util/index.js\";\nimport script from \"./core/script.js\";\nimport moduleScript from \"./core/module.js\";\n\nconst global = utils.global;\nconst xsloader = global.xsloader;\n\nconst defineHandle = script.initDefine(function theRealDefine(defines) {\n\tutils.each(defines, (defineObject) => {\n\t\tif(xsloader.isFunction(defineObject.callback)) {\n\t\t\tlet originCallback = defineObject.callback;\n\t\t\tdefineObject.callback = function() {\n\t\t\t\tlet config = xsloader.config();\n\t\t\t\tlet rt;\n\n\t\t\t\tlet defineFun;\n\t\t\t\tutils.each(defineObject.names, (name) => {\n\t\t\t\t\tlet fun = config.defineFunction[name];\n\t\t\t\t\tif(xsloader.isFunction(fun)) {\n\t\t\t\t\t\tdefineFun = fun;\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tif(defineFun) {\n\t\t\t\t\tlet args = [];\n\t\t\t\t\tfor(let i = 0; i < arguments.length; i++) {\n\t\t\t\t\t\targs.push(arguments[i]);\n\t\t\t\t\t}\n\t\t\t\t\trt = defineFun.apply(this, [originCallback, this, args]);\n\t\t\t\t} else {\n\t\t\t\t\trt = originCallback.apply(this, arguments);\n\t\t\t\t}\n\n\t\t\t\toriginCallback = null;\n\t\t\t\treturn rt;\n\t\t\t};\n\t\t\tdefineObject.callback.originCallback = originCallback;\n\t\t}\n\t\tonModuleLoaded(defineObject);\n\n\t});\n});\n\n/**\n * 当前模块脚本已经完成加载、但其依赖的模块可能需要加载。\n * 当前模块：src、selfname已经确定。\n * 若当前模块依赖为0、则可以直接finish；若当前模块存在其他依赖、则设置回调，等待被其他地方依赖时再触发。\n * @param {Object} defineObject 当前模块\n * @param {Object} lastDefineObject 第一次加载当前模块的模块\n */\nfunction onModuleLoaded(defineObject, lastDefineObject) {\n\n\t//先根据src获取模块\n\tlet ifmodule = moduleScript.getModule(defineObject.src);\n\tif(ifmodule) {\n\t\t/*if(ifmodule.state != 'loading' && ifmodule.state != 'init') {\n\t\t\t//正常\n\t\t} else if(ifmodule.state == \"defined\") {\n\t\t\tthrow new Error(\"already define:\" + ifmodule.description());\n\t\t} else {\n\t\t\tthrow new Error(\"already define failed:\" + ifmodule.description());\n\t\t}*/\n\n\t} else {\n\t\tifmodule = moduleScript.newModule(defineObject);\n\t}\n\n\tlet names = [defineObject.src];\n\tif(defineObject.selfname && defineObject.selfname != defineObject.src) {\n\t\tnames.push(defineObject.selfname);\n\t}\n\n\tif(ifmodule.selfname && ifmodule.selfname != defineObject.selfname && ifmodule.selfname != defineObject.src) {\n\t\t//此处的名字可能由配置指定\n\t\tnames.push(ifmodule.selfname);\n\t}\n\tdefineObject.names = names; //一个模块的所有名字，包括src\n\tutils.each(names, (name) => {\n\t\tmoduleScript.setModule(name, ifmodule);\n\t\tif(xsloader._ignoreAspect_[name]) {\n\t\t\tifmodule.ignoreAspect = true;\n\t\t}\n\t});\n\n\t/*if(ifmodule.selfname != ifmodule.src) {\n\t\t//此处的名字可能由配置指定\n\t\tlet moduleSelf = moduleScript.getModule(ifmodule.selfname);\n\t\tif(moduleSelf) { //让配置的名字也最终指向src的\n\t\t\tif(moduleSelf != ifmodule) {\n\t\t\t\tif(moduleSelf.state == \"init\") {\n\t\t\t\t\tmoduleScript.setModule(ifmodule.selfname, module);\n\t\t\t\t\tmoduleSelf.toOtherModule(module);\n\t\t\t\t} else {\n\t\t\t\t\tthrow Error(\"already define:\" + ifmodule.description());\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tmoduleScript.setModule(ifmodule.selfname, module);\n\t\t}\n\t}\n\n\tif(defineObject.selfname != defineObject.src && defineObject.selfname != ifmodule.selfname) {\n\t\t//此处的名字一定是define时指定\n\t\tlet moduleSelf = moduleScript.getModule(defineObject.selfname);\n\t\tif(moduleSelf) { //让define的名字也最终指向src的\n\t\t\tif(moduleSelf != ifmodule) {\n\t\t\t\tif(moduleSelf.state == \"init\") {\n\t\t\t\t\tmoduleScript.setModule(ifmodule.selfname, module);\n\t\t\t\t\tmoduleSelf.toOtherModule(module);\n\t\t\t\t} else {\n\t\t\t\t\tthrow Error(\"already define:\" + ifmodule.description());\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tmoduleScript.setModule(ifmodule.selfname, module);\n\t\t}\n\t}*/\n\n\tlet module = ifmodule;\n\t//defineObject里的deps最初是直接声明的依赖,应该出现在最前面\n\tmodule.mayAddDeps(defineObject.deps);\n\n\tif(defineObject.handle.before) {\n\t\tdefineObject.handle.before(module.deps);\n\t}\n\tif(lastDefineObject && lastDefineObject.handle.depBefore) {\n\t\tlastDefineObject.handle.depBefore(lastDefineObject.index, module.selfname, module.deps, 2);\n\t}\n\n\tmodule.setState(\"loaded\");\n\tmodule.setInstanceType(defineObject.handle.instance || xsloader.config().instance);\n\n\tif(module.deps.length == 0) {\n\t\tmodule.finish([]); //递归结束\n\t} else {\n\t\t//在其他模块依赖此模块时进行加载\n\t\tlet needCallback = function() {\n\t\t\tmoduleScript.everyRequired(defineObject, module, (depModules) => {\n\t\t\t\tlet args = [];\n\t\t\t\tlet depModuleArgs = [];\n\t\t\t\tutils.each(depModules, (depModule) => {\n\t\t\t\t\tdepModuleArgs.push(depModule);\n\t\t\t\t\targs.push(depModule && depModule.moduleObject());\n\t\t\t\t});\n\t\t\t\targs.push(depModuleArgs);\n\t\t\t\tmodule.finish(args);\n\t\t\t}, (err, invoker) => {\n\t\t\t\tdefineObject.handle.onError(err, invoker);\n\t\t\t});\n\t\t};\n\n\t\tif(defineObject.isRequire) {\n\t\t\tneedCallback();\n\t\t} else {\n\t\t\tmodule.whenNeed(needCallback);\n\t\t}\n\t}\n\n}\n\n//定义模块\nconst define = function() {\n\treturn defineHandle.predefine.apply(this, arguments);\n};\n\nconst require = function() {\n\treturn defineHandle.prerequire.apply(this, arguments);\n};\n\nxsloader.define = define;\nxsloader.defineAsync = define;\nxsloader.require = require;\nglobal.define = define;\nglobal.require = require;\n\ndefine.amd = true;\ndefine(\"exports\", function() {});","import moduleScript from \"../module.js\";\nimport utils from \"../../util/index.js\";\nconst global = utils.global;\nconst xsloader = global.xsloader;\n\n//内部依赖加载插件\n\nxsloader.define(moduleScript.INNER_DEPS_PLUGIN, {\n\tpluginMain(depId, onload, onerror, config) {\n\t\tlet depsObj = moduleScript.innerDepsMap[depId];\n\t\tlet deps = depsObj.deps;\n\t\t//delete innerDepsMap[depId];\n\t\tthis.invoker().require(deps, function() {\n\t\t\tlet args = [];\n\t\t\tfor(let k = 0; k < arguments.length; k++) {\n\t\t\t\targs.push(arguments[k]);\n\t\t\t}\n\t\t\tonload(args);\n\t\t}).then({\n\t\t\torderDep: depsObj.orderDep\n\t\t});\n\t},\n\tgetCacheKey(depId) {\n\t\treturn depId;\n\t}\n});","import utils from \"../../util/index.js\";\nconst global = utils.global;\nconst xsloader = global.xsloader;\n\nxsloader.define(\"ready\", {\n\tpluginMain(depId, onload, onerror, config) {\n\t\txsloader.onReady(function() {\n\t\t\tonload();\n\t\t});\n\t}\n});","import utils from \"../../util/index.js\";\nconst global = utils.global;\nconst xsloader = global.xsloader;\n\nxsloader.define(\"nodeps\", {\n\tisSingle: true,\n\tpluginMain(arg, onload, onerror, config) {\n\t\tthis.invoker().require([arg], function(mod, depModuleArgs) {\n\t\t\tonload(mod);\n\t\t}).then({\n\t\t\tdepBefore(index, dep, depDeps) {\n\t\t\t\tdepDeps.splice(0, depDeps.length);\n\t\t\t}\n\t\t}).error(function(e) {\n\t\t\tonerror(e);\n\t\t});\n\t}\n});","import moduleScript from \"../module.js\";\nimport utils from \"../../util/index.js\";\nconst global = utils.global;\nconst xsloader = global.xsloader;\n\nxsloader.define(\"exists\", {\n\tisSingle: true,\n\tpluginMain(arg, onload, onerror, config) {\n\t\tlet vars = arg.split(\"|\");\n\t\tfor(let i = 0; i < vars.length; i++) {\n\t\t\tvars[i] = vars[i].trim();\n\t\t}\n\t\tif(vars.length == 0) {\n\t\t\tonerror(\"args error for exists!\");\n\t\t} else {\n\t\t\tlet moduleName = vars[0];\n\t\t\tlet module = moduleScript.getModule(moduleName);\n\t\t\tif(module) {\n\t\t\t\tthis.invoker().require([moduleName], function(mod, depModuleArgs) {\n\t\t\t\t\tonload(mod);\n\t\t\t\t}).error(function(e) {\n\t\t\t\t\tonerror(e);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tlet obj = undefined;\n\t\t\t\tfor(let i = 1; i < vars.length; i++) {\n\t\t\t\t\tif(window[vars[i]]) {\n\t\t\t\t\t\tobj = window[vars[i]];\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif(obj === undefined) {\n\t\t\t\t\tonerror(\"not found:\" + arg);\n\t\t\t\t} else {\n\t\t\t\t\tonload(obj);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n});","import moduleScript from \"../module.js\";\nimport utils from \"../../util/index.js\";\nconst global = utils.global;\nconst xsloader = global.xsloader;\n\n/**\n * 格式:name!moduleName=>>modulePath\n */\n\nxsloader.define(\"name\", {\n\tisSingle: true,\n\tpluginMain(arg, onload, onerror, config) {\n\t\tlet index = arg.indexOf(\"=>>\");\n\t\tif(index == -1) {\n\t\t\tonerror(\"expected:=>>\");\n\t\t\treturn;\n\t\t}\n\t\tlet moduleName = arg.substring(0, index);\n\t\tmoduleName = moduleName.replace(/，/g, ',');\n\t\tlet names = moduleName.split(\",\");\n\t\tlet dep = arg.substring(index + 3);\n\t\tthis.invoker().require([dep], function(mod, depModuleArgs) {\n\t\t\tlet existsMods = [];\n\t\t\tfor(let i = 0; i < names.length; i++) {\n\t\t\t\tlet newName = names[i];\n\t\t\t\tlet lastM = moduleScript.getModule(newName);\n\t\t\t\tif(lastM && lastM.state != \"init\") {\n\t\t\t\t\texistsMods.push(newName);\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tlet module = depModuleArgs[0].module;\n\t\t\t\tif(lastM) {\n\t\t\t\t\tlastM.toOtherModule(module);\n\t\t\t\t} else {\n\t\t\t\t\tmoduleScript.setModule(newName, module);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif(existsMods.length) {\n\t\t\t\tconsole.warn(\"already exists:\", existsMods.join(','));\n\t\t\t}\n\t\t\tonload(mod);\n\t\t}).error(function(e) {\n\t\t\tonerror(e);\n\t\t});\n\t}\n});","import utils from \"../../util/index.js\";\nconst global = utils.global;\nconst xsloader = global.xsloader;\n\n/*\n * Require-CSS RequireJS css! loader plugin\n * 0.1.8\n * Guy Bedford 2014\n * MIT\n */\nxsloader.define(\"css\", function() {\n\tif(typeof window == 'undefined')\n\t\treturn {\n\t\t\tload: function(n, r, load) {\n\t\t\t\tload();\n\t\t\t}\n\t\t};\n\tlet engine = window.navigator.userAgent.match(/Trident\\/([^ ;]*)|AppleWebKit\\/([^ ;]*)|Opera\\/([^ ;]*)|rv\\:([^ ;]*)(.*?)Gecko\\/([^ ;]*)|MSIE\\s([^ ;]*)|AndroidWebKit\\/([^ ;]*)/) || 0;\n\tlet useImportLoad = false;\n\tlet useOnload = true;\n\tif(engine[1] || engine[7])\n\t\tuseImportLoad = parseInt(engine[1]) < 6 || parseInt(engine[7]) <= 9;\n\telse if(engine[2] || engine[8] || 'WebkitAppearance' in document.documentElement.style)\n\t\tuseOnload = false;\n\telse if(engine[4])\n\t\tuseImportLoad = parseInt(engine[4]) < 18;\n\tlet cssAPI = {};\n\tlet curStyle, curSheet;\n\tlet createStyle = function() {\n\t\tcurStyle = document.createElement('style');\n\t\txsloader.appendHeadDom(curStyle);\n\t\tcurSheet = curStyle.styleSheet || curStyle.sheet;\n\t};\n\tlet ieCnt = 0;\n\tlet ieLoads = [];\n\tlet ieCurCallback;\n\tlet createIeLoad = function(url) {\n\t\tcurSheet.addImport(url);\n\t\tcurStyle.onload = function() {\n\t\t\tprocessIeLoad();\n\t\t};\n\n\t\tieCnt++;\n\t\tif(ieCnt == 31) {\n\t\t\tcreateStyle();\n\t\t\tieCnt = 0;\n\t\t}\n\t};\n\tlet processIeLoad = function() {\n\t\tieCurCallback();\n\t\tlet nextLoad = ieLoads.shift();\n\t\tif(!nextLoad) {\n\t\t\tieCurCallback = null;\n\t\t\treturn;\n\t\t}\n\t\tieCurCallback = nextLoad[1];\n\t\tcreateIeLoad(nextLoad[0]);\n\t};\n\tlet importLoad = function(url, callback) {\n\t\tcallback = callback || function() {};\n\t\tif(!curSheet || !curSheet.addImport)\n\t\t\tcreateStyle();\n\n\t\tif(curSheet && curSheet.addImport) {\n\t\t\tif(ieCurCallback) {\n\t\t\t\tieLoads.push([url, callback]);\n\t\t\t} else {\n\t\t\t\tcreateIeLoad(url);\n\t\t\t\tieCurCallback = callback;\n\t\t\t}\n\t\t} else {\n\t\t\tcurStyle.textContent = '@import \"' + url + '\";';\n\t\t\tlet loadInterval = setInterval(function() {\n\t\t\t\ttry {\n\t\t\t\t\tcurStyle.sheet.cssRules;\n\t\t\t\t\tclearInterval(loadInterval);\n\t\t\t\t\tcallback();\n\t\t\t\t} catch(e) {\n\t\t\t\t\tconsole.warn(e);\n\t\t\t\t}\n\t\t\t}, 10);\n\t\t}\n\t};\n\tlet linkLoad = function(url, callback) {\n\t\tcallback = callback || function() {};\n\t\tlet link = document.createElement('link');\n\t\tlink.type = 'text/css';\n\t\tlink.rel = 'stylesheet';\n\t\tif(useOnload)\n\t\t\tlink.onload = function() {\n\t\t\t\tlink.onload = function() {};\n\t\t\t\tsetTimeout(callback, 7);\n\t\t\t};\n\t\telse {\n\t\t\tlet loadInterval = setInterval(function() {\n\t\t\t\tfor(let i = 0; i < document.styleSheets.length; i++) {\n\t\t\t\t\tlet sheet = document.styleSheets[i];\n\t\t\t\t\tif(sheet.href == link.href) {\n\t\t\t\t\t\tclearInterval(loadInterval);\n\t\t\t\t\t\treturn callback();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}, 10);\n\t\t}\n\t\tlink.href = url;\n\t\txsloader.appendHeadDom(link);\n\t};\n\tcssAPI.pluginMain = function(cssId, onload, onerror, config) {\n\t\t//\t\t\tif(cssId.indexOf(\".css\") != cssId.length - 4) {\n\t\t//\t\t\t\tcssId += \".css\";\n\t\t//\t\t\t}\n\t\t(useImportLoad ? importLoad : linkLoad)(this.invoker().getUrl(cssId, true), onload);\n\t};\n\tcssAPI.getCacheKey = function(cssId) {\n\t\t//\t\t\tif(cssId.indexOf(\".css\") != cssId.length - 4) {\n\t\t//\t\t\t\tcssId += \".css\";\n\t\t//\t\t\t}\n\t\tlet invoker = this.invoker();\n\t\treturn invoker ? invoker.getUrl(cssId, true) : cssId;\n\t};\n\tcssAPI.loadCss = function(cssPath, callback) {\n\t\t(useImportLoad ? importLoad : linkLoad)(xsloader.getUrl(cssPath), callback);\n\t};\n\n\tcssAPI.loadCsses = function() {\n\t\tlet args = arguments;\n\t\tfor(let i = 0; i < args.length; i++) {\n\t\t\t(useImportLoad ? importLoad : linkLoad)(xsloader.getUrl(args[i]), null);\n\t\t}\n\t};\n\treturn cssAPI;\n});","import utils from \"../../util/index.js\";\nconst global = utils.global;\nconst xsloader = global.xsloader;\n\nxsloader.define(\"text\", [\"xshttp\"], {\n\tisSingle: true,\n\tpluginMain(name, onload, onerror, config, http) {\n\t\tlet url = this.invoker().getUrl(name, true);\n\t\thttp().url(url)\n\t\t\t.handleAs(\"text\")\n\t\t\t.ok(function(text) {\n\t\t\t\tonload(text);\n\t\t\t})\n\t\t\t.fail(function(err) {\n\t\t\t\tonerror(err);\n\t\t\t})\n\t\t\t.done();\n\t}\n});","import utils from \"../../util/index.js\";\nconst global = utils.global;\nconst xsloader = global.xsloader;\n/**\n * 格式：window!varNameInWindow=>>modulePath\n */\n//window插件,用于添加模块到window对象中\nxsloader.define(\"window\", {\n\tisSingle: true,\n\tpluginMain: function(arg, onload, onerror, config, http) {\n\t\tlet index = arg.indexOf(\"=>>\");\n\t\tif(index == -1) {\n\t\t\tonerror(\"expected:=>>\");\n\t\t\treturn;\n\t\t}\n\t\tlet moduleName = arg.substring(0, index);\n\t\tlet dep = arg.substring(index + 3);\n\t\tthis.invoker().require([dep], function(mod, depModuleArgs) {\n\t\t\twindow[moduleName] = mod;\n\t\t\tonload(mod);\n\t\t});\n\t}\n});","import utils from \"../../util/index.js\";\nconst global = utils.global;\nconst xsloader = global.xsloader;\n/**\n * 格式:withdeps!modulePath=>>[deps]\n */\nxsloader.define(\"withdeps\", {\n\tpluginMain(arg, onload, onerror, config) {\n\t\tlet index = arg.indexOf(\"=>>\");\n\t\tif(index == -1) {\n\t\t\tonerror(\"expected:=>>\");\n\t\t\treturn;\n\t\t}\n\t\tlet moduleName = arg.substring(0, index);\n\t\tlet depsStr = arg.substring(index + 3);\n\t\tlet deps;\n\t\ttry {\n\t\t\tdeps = xsloader.xsParseJson(depsStr);\n\t\t\tif(!xsloader.isArray(deps)) {\n\t\t\t\tonerror(\"deps is not Array:\" + depsStr);\n\t\t\t\treturn;\n\t\t\t}\n\t\t} catch(e) {\n\t\t\tonerror(\"deps error:\" + depsStr);\n\t\t\treturn;\n\t\t}\n\t\tthis.invoker().require([\n\t\t\t[false].concat(deps), moduleName\n\t\t], function(_deps, mod, depModuleArgs) {\n\t\t\tonload(mod);\n\t\t}).then({\n\t\t\torderDep: true\n\t\t});\n\t}\n});","import utils from \"../../util/index.js\";\nconst global = utils.global;\nconst xsloader = global.xsloader;\n\n/**\n * 加载json对象\n */\nxsloader.define(\"json\", [\"xshttp\"], {\n\tisSingle: true,\n\tpluginMain(name, onload, onerror, config, http) {\n\t\tlet url = this.invoker().getUrl(name, true);\n\t\thttp().url(url)\n\t\t\t.handleAs(\"json\")\n\t\t\t.ok(function(json) {\n\t\t\t\tonload(json);\n\t\t\t})\n\t\t\t.fail(function(err) {\n\t\t\t\tonerror(err);\n\t\t\t})\n\t\t\t.done();\n\t}\n});","import utils from \"../../util/index.js\";\nconst global = utils.global;\nconst xsloader = global.xsloader;\n\nlet progIds = ['Msxml2.XMLHTTP', 'Microsoft.XMLHTTP', 'Msxml2.XMLHTTP.4.0'];\n/**\n * option._beforeOpenHook\n * option._onOkResponseHook\n * option._onFailResponseHook\n * \n * @param {Object} option\n */\nfunction httpRequest(option) {\n\tif(!option) {\n\t\toption = {};\n\t}\n\n\tfunction prop(obj, varName, defaultVal) {\n\t\tif(obj[varName] === undefined) {\n\t\t\treturn defaultVal;\n\t\t} else {\n\t\t\treturn obj[varName];\n\t\t}\n\t}\n\n\tfunction putProp(obj, varName, toObj) {\n\t\tif(obj[varName]) {\n\t\t\tfor(let x in obj[varName]) {\n\t\t\t\tlet value = obj[varName][x];\n\t\t\t\tif(value === null || value === undefined) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\ttoObj[x] = value;\n\t\t\t}\n\t\t}\n\t}\n\tlet _url = prop(option, \"url\", \"\"),\n\t\t_method = prop(option, \"method\", \"GET\"),\n\t\t_params = {},\n\t\t_headers = {\n\t\t\t\"X-Requested-With\": \"XMLHttpRequest\"\n\t\t},\n\t\t_async = prop(option, \"async\", true),\n\t\t_multiPart = prop(option, \"multiPart\", false),\n\t\t_handleType = prop(option, \"handleType\", \"json\");\n\tlet _timeout = option.timeout;\n\tputProp(option, \"params\", _params);\n\tputProp(option, \"headers\", _headers);\n\n\tlet okCallback = option.ok;\n\tlet failCallback = option.fail;\n\tlet uploadStartCallback = option.uploadStart;\n\tlet uploadProgressCallback = option.uploadProgress;\n\tlet uploadOkCallback = option.uploadOk;\n\tlet uploadErrorCallback = option.uploadError;\n\tlet uploadEndCallback = option.uploadEnd;\n\n\tlet _beforeOpenHook = option._beforeOpenHook || httpRequest._beforeOpenHook;\n\tlet _onOkResponseHook = option._onOkResponseHook || httpRequest._onOkResponseHook;\n\tlet _onFailResponseHook = option._onFailResponseHook || httpRequest._onFailResponseHook;\n\n\tfunction createXhr() {\n\t\tlet xhr, i, progId;\n\t\tif(typeof XMLHttpRequest !== \"undefined\") {\n\t\t\treturn new XMLHttpRequest();\n\t\t} else if(typeof ActiveXObject !== \"undefined\") {\n\t\t\tfor(i = 0; i < 3; i += 1) {\n\t\t\t\tprogId = progIds[i];\n\t\t\t\ttry {\n\t\t\t\t\txhr = new ActiveXObject(progId);\n\t\t\t\t} catch(e) {\n\t\t\t\t\tconsole.warn(e);\n\t\t\t\t}\n\n\t\t\t\tif(xhr) {\n\t\t\t\t\tprogIds = [progId];\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn xhr;\n\t}\n\n\tfunction conn() {\n\t\t_conn(createXhr());\n\t}\n\n\tfunction _conn(xhr) {\n\t\tlet option = {\n\t\t\turl: _url,\n\t\t\tmethod: _method.toUpperCase(),\n\t\t\tparams: _params,\n\t\t\theaders: _headers,\n\t\t\thandleType: _handleType,\n\t\t\tasync: _async,\n\t\t\tmultiPart: _multiPart,\n\t\t\ttimeout: _timeout\n\t\t};\n\t\t_beforeOpenHook(option, function() {\n\t\t\t_connAfterOpenHook(option, xhr);\n\t\t}, xhr);\n\t}\n\n\tfunction _doOnFailResponseHook(option, xhr, err, extraErr) {\n\t\t_onFailResponseHook(option, function(result) {\n\t\t\tif(result !== false && result !== undefined) {\n\t\t\t\tif(typeof okCallback == \"function\") {\n\t\t\t\t\tokCallback(result, xhr);\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t} else if(typeof failCallback == \"function\") {\n\t\t\t\tfailCallback(err);\n\t\t\t} else {\n\t\t\t\tconsole.error(err);\n\t\t\t}\n\t\t}, xhr, extraErr);\n\t}\n\n\tfunction _connAfterOpenHook(option, xhr) {\n\t\tlet body;\n\t\tif(option.multiPart) {\n\t\t\tlet formData = new FormData();\n\t\t\tfor(let x in option.params) {\n\t\t\t\tlet value = option.params[x];\n\t\t\t\tif(xsloader.isArray(value)) {\n\t\t\t\t\tformData.append(x, xsloader.xsJson2String(value));\n\t\t\t\t} else {\n\t\t\t\t\tformData.append(x, value);\n\t\t\t\t}\n\n\t\t\t}\n\t\t\tbody = formData;\n\t\t} else {\n\t\t\tbody = \"\";\n\t\t\tfor(let x in option.params) {\n\t\t\t\tlet value = option.params[x];\n\t\t\t\tif(value === null || value === undefined) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tif(typeof value == \"object\") {\n\t\t\t\t\tvalue = xsloader.xsJson2String(value);\n\t\t\t\t}\n\t\t\t\tbody += \"&\" + encodeURIComponent(x) + \"=\" + encodeURIComponent(value);\n\t\t\t}\n\t\t\tif(!(option.method == \"POST\" || option.method == \"PUT\")) {\n\t\t\t\tif(option.url.lastIndexOf(\"?\") < 0 && body.length > 0) {\n\t\t\t\t\toption.url += \"?\";\n\t\t\t\t}\n\t\t\t\toption.url += body;\n\t\t\t\toption.url = option.url.replace(\"?&\", \"?\");\n\t\t\t\tbody = null;\n\t\t\t}\n\t\t}\n\n\t\txhr.open(option.method, option.url, option.async);\n\t\tif((option.method == \"POST\" || option.method == \"PUT\") && !option.multiPart && !option.headers.hasOwnProperty(\"Content-Type\")) {\n\n\t\t\txhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded;charset=utf-8');\n\t\t}\n\t\tfor(let header in option.headers) {\n\t\t\txhr.setRequestHeader(header, option.headers[header]);\n\t\t}\n\n\t\tif(typeof uploadStartCallback == \"function\") {\n\t\t\txhr.upload.onloadstart = uploadStartCallback;\n\t\t}\n\n\t\tif(typeof uploadProgressCallback == \"function\") {\n\t\t\txhr.upload.onprogress = uploadProgressCallback;\n\t\t}\n\n\t\tif(typeof uploadOkCallback == \"function\") {\n\t\t\txhr.upload.onload = uploadOkCallback;\n\t\t}\n\n\t\tif(typeof uploadErrorCallback == \"function\") {\n\t\t\txhr.upload.onerror = uploadErrorCallback;\n\t\t}\n\n\t\tif(typeof uploadEndCallback == \"function\") {\n\t\t\txhr.upload.onloadend = uploadEndCallback;\n\t\t}\n\n\t\tlet timeoutTimer;\n\t\tlet isTimeout = false;\n\t\tif(option.timeout) {\n\t\t\ttimeoutTimer = setTimeout(function() {\n\t\t\t\tisTimeout = true;\n\t\t\t\txhr.abort();\n\t\t\t\tclearTimeout(timeoutTimer);\n\t\t\t}, option.timeout);\n\t\t}\n\n\t\txhr.onreadystatechange = function(evt) {\n\t\t\tlet status, err;\n\t\t\tif(xhr.readyState === 4) {\n\t\t\t\tstatus = xhr.status || 0;\n\t\t\t\tif(status > 399 && status < 600 || !status) {\n\t\t\t\t\tlet err = new Error(option.url + ' HTTP status: ' + status);\n\t\t\t\t\terr.xhr = xhr;\n\t\t\t\t\t_doOnFailResponseHook(option, xhr, err);\n\t\t\t\t} else {\n\t\t\t\t\tlet result;\n\t\t\t\t\tif(option.handleType === \"json\") {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tresult = xsloader.xsParseJson(xhr.responseText);\n\t\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\t\t_doOnFailResponseHook(option, xhr, new Error(\"parse-json-error:\" + e), \"parse-json-error\");\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if(option.handleType === \"text\") {\n\t\t\t\t\t\tresult = xhr.responseText;\n\t\t\t\t\t}\n\t\t\t\t\t_onOkResponseHook(result, option, function(result) {\n\t\t\t\t\t\tif(typeof okCallback == \"function\") {\n\t\t\t\t\t\t\tokCallback(result, xhr);\n\t\t\t\t\t\t}\n\t\t\t\t\t}, xhr);\n\t\t\t\t}\n\n\t\t\t} else {\n\t\t\t\tif(timeoutTimer && isTimeout) {\n\t\t\t\t\tlet err = new Error(option.url + ' timeout status: ' + status);\n\t\t\t\t\terr.xhr = xhr;\n\t\t\t\t\t_doOnFailResponseHook(option, xhr, err);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\txhr.send(body);\n\t}\n\n\tlet requestObj = {\n\t\tmultiPart(multiPart) {\n\t\t\t_multiPart = multiPart;\n\t\t\treturn this;\n\t\t},\n\t\tuploadStart(uploadStart) {\n\t\t\tuploadStartCallback = uploadStart;\n\t\t\treturn this;\n\t\t},\n\t\tuploadProgress(uploadProgress) {\n\t\t\tuploadProgressCallback = uploadProgress;\n\t\t\treturn this;\n\t\t},\n\t\tuploadOk(callback) {\n\t\t\tuploadOkCallback = callback;\n\t\t\treturn this;\n\t\t},\n\t\tuploadError(callback) {\n\t\t\tuploadErrorCallback = callback;\n\t\t\treturn this;\n\t\t},\n\t\tuploadEnd(uploadEnd) {\n\t\t\tuploadEndCallback = uploadEnd;\n\t\t\treturn this;\n\t\t},\n\t\turl(urlStr) {\n\t\t\t_url = urlStr;\n\t\t\treturn this;\n\t\t},\n\t\tmethod(methodStr) {\n\t\t\t_method = methodStr;\n\t\t\treturn this;\n\t\t},\n\t\ttimeout(timeout) {\n\t\t\t_timeout = timeout;\n\t\t\treturn this;\n\t\t},\n\t\tasync(isAsync) {\n\t\t\t_async = isAsync;\n\t\t\treturn this;\n\t\t},\n\t\tparams(paramsObj) {\n\t\t\tif(paramsObj) {\n\t\t\t\tfor(let x in paramsObj) {\n\t\t\t\t\tlet value = paramsObj[x];\n\t\t\t\t\tif(value === null || value === undefined) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\t_params[x] = value;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn this;\n\t\t},\n\t\theaders(headersObj) {\n\t\t\tif(headersObj) {\n\t\t\t\tfor(let x in headersObj) {\n\t\t\t\t\t_headers[x] = headersObj[x];\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn this;\n\t\t},\n\t\thandleType(_handleType) {\n\t\t\treturn this.handleAs(_handleType);\n\t\t},\n\t\thandleAs(handleType) {\n\t\t\tif(handleType !== \"json\" && handleType !== \"text\") {\n\t\t\t\tthrow \"unknown handleType:\" + handleType;\n\t\t\t}\n\t\t\t_handleType = handleType;\n\t\t\treturn this;\n\t\t},\n\t\tok(callback) {\n\t\t\tokCallback = callback;\n\t\t\treturn this;\n\t\t},\n\t\tfail(callback) {\n\t\t\tfailCallback = callback;\n\t\t\treturn this;\n\t\t},\n\t\t_beforeOpenHook(callback) {\n\t\t\t_beforeOpenHook = callback;\n\t\t\treturn this;\n\t\t},\n\t\t_onOkResponseHook(callback) {\n\t\t\t_onOkResponseHook = callback;\n\t\t\treturn this;\n\t\t},\n\t\t_onFailResponseHook(callback) {\n\t\t\t_onFailResponseHook = callback;\n\t\t\treturn this;\n\t\t},\n\t\tdone() {\n\t\t\ttry {\n\t\t\t\tconn();\n\t\t\t} catch(e) {\n\t\t\t\tif(typeof failCallback == \"function\") {\n\t\t\t\t\tfailCallback(e);\n\t\t\t\t} else {\n\t\t\t\t\tconsole.error(e);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\treturn requestObj;\n}\n/**\n */\nhttpRequest._beforeOpenHook = function(option, callback, xhr) {\n\tcallback();\n};\n\n/**\n * function(result,option,xhr,callback),callback(result)的result为最终的结果\n */\nhttpRequest._onOkResponseHook = function(result, option, callback, xhr) {\n\tcallback(result);\n};\n/**\n * function(option,xhr,callback,extraErrorType),callback(result)的result为false则不会处理后面的,如果为非undefined则作为成功的结果。\n * extraErrorType==\"parse-json-error\"表示转换成json时出错\n */\nhttpRequest._onFailResponseHook = function(option, callback, xhr, extraErrorType) {\n\tcallback(undefined);\n};\n\nwindow._xshttp_request_ = httpRequest;\n\nxsloader.define(\"xshttp\", [], function() {\n\treturn httpRequest;\n});","import utils from \"../../util/index.js\";\nconst global = utils.global;\nconst xsloader = global.xsloader;\n\nxsloader.define(\"xsrequest\", [\"xshttp\"], function(http) {\n\t/**\n\t * 参数列表:\n\t * callback:function(rs)\n\t * async:始终为true\n\t * 其他参数同xshttp\n\t * 不断返回then(function()).then,当返回false时取消调用后面的回调。\n\t * @param {Object} option\n\t */\n\tlet xsRequest = function(option) {\n\t\toption = xsloader.extend({\n\t\t\tparams: undefined,\n\t\t\theaders: undefined,\n\t\t\tmethod: undefined,\n\t\t\turl: undefined,\n\t\t\tcallback: undefined\n\t\t}, option);\n\t\tlet isResponsed = false;\n\t\tlet callbacksQueue = [function(rs) {\n\t\t\treturn rs;\n\t\t}];\n\t\tif(option.callback) {\n\t\t\tcallbacksQueue.push(option.callback);\n\t\t}\n\t\tcallbacksQueue.callback = function(rs) {\n\t\t\tisResponsed = true;\n\t\t\tfor(let i = 0; i < this.length; i++) {\n\t\t\t\tlet callback = this[i];\n\t\t\t\trs = callback(rs);\n\t\t\t\tif(rs === false) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\toption.ok = function(rs) {\n\t\t\tcallbacksQueue.callback(rs);\n\t\t};\n\t\toption.fail = function(err) {\n\t\t\tcallbacksQueue.callback({\n\t\t\t\tcode: -1,\n\t\t\t\tdesc: err\n\t\t\t});\n\t\t};\n\t\toption.async = true;\n\n\t\tfunction newHandle() {\n\t\t\tlet handle = {\n\t\t\t\tthen: function(callback) {\n\t\t\t\t\tif(isResponsed) {\n\t\t\t\t\t\tthrow new Error(\"already responsed!\");\n\t\t\t\t\t}\n\t\t\t\t\tcallbacksQueue.push(callback);\n\t\t\t\t\treturn newHandle();\n\t\t\t\t}\n\t\t\t};\n\t\t\treturn handle;\n\t\t}\n\t\thttp(option).done();\n\t\treturn newHandle();\n\t};\n\n\treturn xsRequest;\n});","import utils from \"../../util/index.js\";\nconst global = utils.global;\nconst xsloader = global.xsloader;\n\ntry {\n\tlet isXsMsgDebug = false;\n\tlet api = {};\n\n\tfunction isDebug(type) {\n\t\treturn isXsMsgDebug;\n\t}\n\n\tapi.linkedList = function() {\n\t\treturn new LinkedList();\n\t};\n\n\tfunction LinkedList() {\n\t\tfunction newNode(element) {\n\t\t\tlet node = {\n\t\t\t\telement: element,\n\t\t\t\tnext: null,\n\t\t\t\tpre: null\n\t\t\t};\n\t\t\treturn node;\n\t\t}\n\t\tlet length = 0;\n\t\tlet headNode = newNode(),\n\t\t\tlastNode = headNode;\n\n\t\t/**\n\t\t * 在链表末尾添加元素\n\t\t */\n\t\tthis.append = function(element) {\n\t\t\tlet current = newNode(element);\n\n\t\t\tlastNode.next = current;\n\t\t\tcurrent.pre = lastNode;\n\t\t\tlastNode = current;\n\t\t\tlength++;\n\t\t};\n\n\t\t//在链表的任意位置插入元素\n\t\tthis.insert = function(position, element) {\n\t\t\tif(position >= 0 && position <= length) {\n\n\t\t\t\tlet node = newNode(element);\n\t\t\t\tlet pNode = headNode;\n\t\t\t\twhile(position--) {\n\t\t\t\t\tpNode = pNode.next;\n\t\t\t\t}\n\n\t\t\t\tif(pNode.next) {\n\t\t\t\t\tpNode.next.pre = node;\n\t\t\t\t\tnode.next = pNode.next;\n\t\t\t\t}\n\t\t\t\tpNode.next = node;\n\t\t\t\tnode.pre = pNode;\n\t\t\t\tlength++;\n\t\t\t\treturn true;\n\t\t\t} else {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t};\n\n\t\tthis.elementAt = function(position) {\n\t\t\treturn getElement(position);\n\t\t};\n\n\t\tfunction getElement(position, willRemove) {\n\t\t\tif(position >= 0 && position < length) {\n\n\t\t\t\tlet pNode = headNode;\n\t\t\t\twhile(position--) {\n\t\t\t\t\tpNode = pNode.next;\n\t\t\t\t}\n\n\t\t\t\tif(pNode.next) {\n\t\t\t\t\tlet currentNode = pNode.next;\n\t\t\t\t\tif(willRemove) {\n\t\t\t\t\t\tlet nextCurrentNode = currentNode.next;\n\t\t\t\t\t\tif(nextCurrentNode) {\n\t\t\t\t\t\t\tnextCurrentNode.pre = pNode;\n\t\t\t\t\t\t\tpNode.next = nextCurrentNode;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tpNode.next = null;\n\t\t\t\t\t\t\tlastNode = pNode;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tlength--;\n\t\t\t\t\t}\n\t\t\t\t\treturn currentNode.element;\n\t\t\t\t} else {\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * @param callback function 返回true表示移除\n\t\t */\n\t\tthis.eachForRemove = function(callback) {\n\t\t\tlet pNode = headNode.next;\n\t\t\twhile(pNode) {\n\t\t\t\tlet currentNode = pNode;\n\t\t\t\tif(callback(currentNode)) {\n\t\t\t\t\tlet nextCurrentNode = currentNode.next;\n\t\t\t\t\tif(nextCurrentNode) {\n\t\t\t\t\t\tnextCurrentNode.pre = pNode;\n\t\t\t\t\t\tpNode.next = nextCurrentNode;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tpNode.next = null;\n\t\t\t\t\t\tlastNode = pNode;\n\t\t\t\t\t}\n\t\t\t\t\tlength--;\n\t\t\t\t\tpNode = nextCurrentNode;\n\t\t\t\t} else {\n\t\t\t\t\tpNode = pNode.next;\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\t//从链表中移除元素\n\t\tthis.removeAt = function(position) {\n\t\t\treturn getElement(position, true);\n\t\t};\n\n\t\t/**\n\t\t * 移除并获取第一个元素\n\t\t * @param callback function(elem,index)\n\t\t */\n\t\tthis.pop = function(callback) {\n\t\t\treturn this.removeAt(0);\n\t\t};\n\n\t\t/**\n\t\t * 返回元素在链表中的位置\n\t\t * @param element object|function(elem)\n\t\t */\n\t\tthis.indexOf = function(element) {\n\t\t\tlet pNode = headNode.next;\n\t\t\tlet index = 0;\n\t\t\twhile(pNode) {\n\t\t\t\tif(typeof element == \"function\") {\n\t\t\t\t\tif(element(pNode.element)) {\n\t\t\t\t\t\treturn index;\n\t\t\t\t\t}\n\t\t\t\t} else if(pNode.element === element) {\n\t\t\t\t\treturn index;\n\t\t\t\t}\n\t\t\t\tindex++;\n\t\t\t\tpNode = pNode.next;\n\t\t\t}\n\t\t\treturn -1;\n\t\t};\n\n\t\tthis.find = function(element) {\n\t\t\tlet index = this.indexOf(element);\n\t\t\treturn index >= 0 ? this.elementAt(index) : undefined;\n\t\t};\n\n\t\t//移除某个元素\n\t\tthis.remove = function(element) {\n\t\t\tlet index = this.indexOf(element);\n\t\t\treturn this.removeAt(index);\n\t\t};\n\n\t\t//判断链表是否为空\n\n\t\tthis.isEmpty = function() {\n\t\t\treturn length === 0;\n\t\t};\n\n\t\t//返回链表的长度\n\t\tthis.size = function() {\n\t\t\treturn length;\n\t\t};\n\n\t}\n\n\tif(window.addEventListener) {\n\t\tlet postMessageBridge = (function() {\n\t\t\tlet handle = {};\n\n\t\t\tlet instanceMap = {}; //id:listener\n\t\t\tlet cmd2ListenerMap = {}; //cmd:[]\n\t\t\tlet instanceBindMap = {}; //instanceid:true\n\t\t\tlet oinstanceidMap = {}; //已经被绑定的oinstanceid:instanceid\n\n\t\t\t//isActive为false表示监听者\n\t\t\thandle.listen = function(cmd, conndata, connectingSource, source, isActive, _onConned, _onMsg, _onResponse, _onElse) {\n\n\t\t\t\tlet listener = {\n\t\t\t\t\tcmd: cmd,\n\t\t\t\t\t_onConned: _onConned,\n\t\t\t\t\t_onMsg: _onMsg,\n\t\t\t\t\t_onResponse: _onResponse,\n\t\t\t\t\t_onElse: _onElse,\n\t\t\t\t\tconndata: conndata,\n\t\t\t\t\tosource: source,\n\t\t\t\t\tactive: isActive,\n\t\t\t\t\tconnectingSource: connectingSource,\n\t\t\t\t\tid: xsloader.randId(),\n\t\t\t\t\trefused: {}\n\t\t\t\t};\n\n\t\t\t\tif(!cmd2ListenerMap[cmd]) {\n\t\t\t\t\tcmd2ListenerMap[cmd] = [];\n\t\t\t\t}\n\t\t\t\tcmd2ListenerMap[cmd].push(listener);\n\n\t\t\t\tlet instanceid = listener.id;\n\t\t\t\tinstanceMap[instanceid] = listener;\n\t\t\t\treturn instanceid;\n\t\t\t};\n\n\t\t\thandle.remove = function(instanceid) {\n\t\t\t\t//TODO !!!!!!!\n\t\t\t\t/*let listener = listeners[id];\n\t\t\t\tdelete listeners[id];\n\t\t\t\tif(listener.active) {\n\t\t\t\t\tfor(let x in activeListenerMyIds) {\n\t\t\t\t\t\tlet as = activeListenerMyIds[x];\n\t\t\t\t\t\tlet found = false;\n\t\t\t\t\t\tfor(let k = 0; k < as.length; k++) {\n\t\t\t\t\t\t\tif(as[k] == id) {\n\t\t\t\t\t\t\t\tas.splice(k, 1);\n\t\t\t\t\t\t\t\tfound = true;\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif(found) {\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}*/\n\t\t\t};\n\n\t\t\thandle.send = function(data, instanceid, msgid) {\n\t\t\t\tlet listener = instanceMap[instanceid];\n\t\t\t\t_sendData(\"msg\", listener.cmd, listener.osource, data, instanceid, msgid);\n\t\t\t};\n\n\t\t\thandle.sendConn = function(instanceid) {\n\t\t\t\tlet listener = instanceMap[instanceid];\n\t\t\t\t_sendData(\"conn\", listener.cmd, listener.osource, listener.conndata, instanceid);\n\t\t\t};\n\n\t\t\thandle.sendResponse = function(data, instanceid) {\n\t\t\t\tlet listener = instanceMap[instanceid];\n\t\t\t\t_sendData(\"response\", listener.cmd, listener.osource, data, instanceid);\n\t\t\t};\n\n\t\t\tfunction handleConn(cmd, fromSource, originStr, data, oinstanceid) {\n\t\t\t\tif(oinstanceidMap[oinstanceid]) {\n\t\t\t\t\t//console.warn(\"already bind:\" + cmd);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tlet listeners = cmd2ListenerMap[cmd];\n\t\t\t\tif(!listeners) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tfunction Callback(instanceid) {\n\n\t\t\t\t\treturn function(isAccept, msg) {\n\t\t\t\t\t\tif(!isAccept) {\n\t\t\t\t\t\t\tlet listener = instanceMap[instanceid];\n\t\t\t\t\t\t\tlistener.refused[oinstanceid] = true;\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif(oinstanceidMap[oinstanceid]) {\n\t\t\t\t\t\t\tconsole.warn(\"already bind other:\" + cmd + \",my page:\" + location.href);\n\t\t\t\t\t\t} else if(instanceBindMap[instanceid]) {\n\t\t\t\t\t\t\tconsole.warn(\"already self bind:\" + cmd + \",my page:\" + location.href);\n\t\t\t\t\t\t\t_sendData(\"binded\", cmd, fromSource, oinstanceid);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\toinstanceidMap[oinstanceid] = instanceid;\n\t\t\t\t\t\t\tinstanceBindMap[instanceid] = true;\n\t\t\t\t\t\t\tlet listener = instanceMap[instanceid];\n\t\t\t\t\t\t\tlistener.osource = fromSource;\n\t\t\t\t\t\t\tlistener.origin = originStr;\n\t\t\t\t\t\t\t_sendData(\"accept\", cmd, fromSource, listener.conndata, instanceid, oinstanceid);\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\n\t\t\t\t}\n\n\t\t\t\tfor(let i = 0; i < listeners.length; i++) {\n\t\t\t\t\tlet listener = listeners[i];\n\t\t\t\t\tif(!listener.refused[oinstanceid]) {\n\t\t\t\t\t\tlistener.connectingSource(fromSource, originStr, data, Callback(listener.id));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction handleAccept(cmd, fromSource, originStr, data, oinstanceid, minstanceid) {\n\t\t\t\tlet listeners = cmd2ListenerMap[cmd];\n\t\t\t\tif(!listeners) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tfunction Callback(instanceid) {\n\n\t\t\t\t\treturn function(isAccept, msg) {\n\t\t\t\t\t\tif(!isAccept) {\n\t\t\t\t\t\t\tlet listener = instanceMap[instanceid];\n\t\t\t\t\t\t\tlistener.refused[oinstanceid] = true;\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif(oinstanceidMap[oinstanceid]) {\n\t\t\t\t\t\t\tconsole.warn(\"already bind:\" + cmd + \",my page:\" + location.href);\n\t\t\t\t\t\t} else if(instanceBindMap[instanceid]) {\n\t\t\t\t\t\t\tconsole.warn(\"already self bind:\" + cmd + \",my page:\" + location.href);\n\t\t\t\t\t\t\t_sendData(\"binded\", cmd, fromSource, oinstanceid);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\toinstanceidMap[oinstanceid] = instanceid;\n\t\t\t\t\t\t\tinstanceBindMap[instanceid] = true;\n\n\t\t\t\t\t\t\tlet listener = instanceMap[instanceid];\n\t\t\t\t\t\t\tlistener.osource = fromSource;\n\t\t\t\t\t\t\tlistener.origin = originStr;\n\t\t\t\t\t\t\t_sendData(\"conned\", cmd, fromSource, listener.conndata, instanceid);\n\t\t\t\t\t\t\tlistener._onConned(fromSource, data);\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\n\t\t\t\t}\n\n\t\t\t\tfor(let i = 0; i < listeners.length; i++) {\n\t\t\t\t\tlet listener = listeners[i];\n\t\t\t\t\tif(listener.id == minstanceid && !listener.refused[oinstanceid]) { //当前为主动发起连接的页面\n\t\t\t\t\t\tlistener.connectingSource(fromSource, originStr, data, Callback(listener.id));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction handleBinded(cmd, fromSource, originStr, minstanceid) {\n\t\t\t\tlet listener = instanceMap[minstanceid];\n\t\t\t\tlistener._onElse(\"binded\");\n\t\t\t}\n\n\t\t\tfunction checkSource(listener, fromSource, originStr) {\n\t\t\t\tif(listener.osource != fromSource && listener.origin != originStr) {\n\t\t\t\t\tconsole.warn(\"expected:\" + listener.origin + \",but:\" + originStr);\n\t\t\t\t\tthrow new Error(\"source changed!\");\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction handleConned(cmd, fromSource, originStr, data, oinstanceid) {\n\t\t\t\tlet instanceid = oinstanceidMap[oinstanceid];\n\t\t\t\tlet listener = instanceMap[instanceid];\n\t\t\t\tcheckSource(listener, fromSource, originStr);\n\n\t\t\t\tlistener._onConned(listener.osource, data);\n\t\t\t}\n\n\t\t\tfunction handleMsg(cmd, fromSource, originStr, data, oinstanceid, msgid) {\n\t\t\t\tlet instanceid = oinstanceidMap[oinstanceid];\n\t\t\t\tlet listener = instanceMap[instanceid];\n\t\t\t\tcheckSource(listener, fromSource, originStr);\n\n\t\t\t\tlistener._onMsg(data, msgid);\n\t\t\t}\n\n\t\t\tfunction handleResponse(cmd, fromSource, originStr, data, oinstanceid) {\n\t\t\t\tlet instanceid = oinstanceidMap[oinstanceid];\n\t\t\t\tlet listener = instanceMap[instanceid];\n\t\t\t\tcheckSource(listener, fromSource, originStr);\n\n\t\t\t\tlistener._onResponse(data);\n\t\t\t}\n\n\t\t\tfunction _sendData(type, cmd, source, data, instanceid, msgid) {\n\t\t\t\tlet msg = {\n\t\t\t\t\ttype: type,\n\t\t\t\t\tdata: data,\n\t\t\t\t\tcmd: cmd,\n\t\t\t\t\tid: instanceid,\n\t\t\t\t\tmsgid: msgid\n\t\t\t\t};\n\n\t\t\t\tif(isDebug(\"postMessageBridge\")) {\n\t\t\t\t\tconsole.log(\"send from:\" + location.href);\n\t\t\t\t\tconsole.log(msg);\n\t\t\t\t}\n\t\t\t\tsource.postMessage(xsloader.xsJson2String(msg), \"*\");\n\t\t\t}\n\n\t\t\twindow.addEventListener('message', function(event) {\n\t\t\t\tif(isDebug(\"postMessageBridge\")) {\n\t\t\t\t\tconsole.log(\"receive from:\" + event.origin + \",my page:\" + location.href);\n\t\t\t\t\tconsole.log(event.data);\n\t\t\t\t}\n\t\t\t\tlet data;\n\t\t\t\ttry {\n\t\t\t\t\tdata = xsloader.xsParseJson(event.data);\n\t\t\t\t} catch(e) {\n\t\t\t\t\tconsole.warn(e);\n\t\t\t\t}\n\t\t\t\tif(!data || !(data.cmd && data.type)) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tlet cmd = data.cmd;\n\t\t\t\tlet oinstanceid = data.id;\n\t\t\t\tlet rdata = data.data;\n\t\t\t\tlet type = data.type;\n\t\t\t\tlet msgid = data.msgid;\n\n\t\t\t\tif(type == \"conn\") {\n\t\t\t\t\thandleConn(cmd, event.source, event.origin, rdata, oinstanceid);\n\t\t\t\t} else if(type == \"accept\") {\n\t\t\t\t\thandleAccept(cmd, event.source, event.origin, rdata, oinstanceid, msgid);\n\t\t\t\t} else if(type == \"conned\") {\n\t\t\t\t\thandleConned(cmd, event.source, event.origin, rdata, oinstanceid);\n\t\t\t\t} else if(type == \"msg\") {\n\t\t\t\t\thandleMsg(cmd, event.source, event.origin, rdata, oinstanceid, msgid);\n\t\t\t\t} else if(type == \"response\") {\n\t\t\t\t\thandleResponse(cmd, event.source, event.origin, rdata, oinstanceid);\n\t\t\t\t} else if(type == \"binded\") {\n\t\t\t\t\thandleBinded(cmd, event.source, event.origin, rdata);\n\t\t\t\t}\n\n\t\t\t});\n\n\t\t\thandle.runAfter = function(time, callback) {\n\t\t\t\tsetTimeout(callback, time);\n\t\t\t};\n\n\t\t\treturn handle;\n\t\t})();\n\n\t\tfunction CommunicationUnit(cmd, source, connectingSource, onfailed, isActive, conndata) {\n\t\t\tlet msgQueue = new LinkedList();\n\n\t\t\tlet MAX_TRY = 100,\n\t\t\t\tSLEEP = 500;\n\t\t\tlet isConnected = false,\n\t\t\t\tconnectCount = 0;\n\t\t\tlet isCanceled = false;\n\n\t\t\tlet thiz = this;\n\t\t\tlet handleId;\n\n\t\t\tthis.onConnectedListener = null;\n\t\t\tthis.onReceiveListener = null;\n\t\t\tthis.send = function(data) {\n\t\t\t\tlet msg = {\n\t\t\t\t\tid: xsloader.randId(),\n\t\t\t\t\tdata: data\n\t\t\t\t};\n\t\t\t\tmsgQueue.append(msg);\n\t\t\t\tsendTop();\n\t\t\t};\n\n\t\t\tthis.send.release = function() {\n\t\t\t\tpostMessageBridge.remove(handleId);\n\t\t\t};\n\n\t\t\tfunction _onConned(_source, data) {\n\t\t\t\tthiz.onConnectedListener.call(thiz, data);\n\t\t\t\tisConnected = true;\n\t\t\t\tsendTop();\n\t\t\t}\n\n\t\t\tfunction _onMsg(data, msgid) {\n\t\t\t\ttry {\n\t\t\t\t\tthiz.onReceiveListener.call(thiz, data);\n\t\t\t\t} catch(e) {\n\t\t\t\t\tconsole.warn(e);\n\t\t\t\t}\n\t\t\t\tpostMessageBridge.sendResponse({ //回应已经收到\n\t\t\t\t\tid: msgid\n\t\t\t\t}, handleId);\n\t\t\t}\n\n\t\t\tfunction _onResponse(data) {\n\t\t\t\tmsgQueue.remove(function(elem) {\n\t\t\t\t\treturn elem.id = data.id;\n\t\t\t\t});\n\t\t\t\tsendTop();\n\t\t\t}\n\n\t\t\tfunction _onElse(type) {\n\t\t\t\tif(type == \"binded\") {\n\t\t\t\t\tisCanceled = true;\n\t\t\t\t\tconsole.error(\"connect failed,that page already binded:\" + cmd + \",my page:\" + location.href);\n\t\t\t\t\tonfailed(\"canceled\");\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction initListen() {\n\t\t\t\thandleId = postMessageBridge.listen(cmd, conndata, connectingSource, source, isActive, _onConned, _onMsg, _onResponse, _onElse);\n\t\t\t}\n\n\t\t\tfunction sendTop() {\n\t\t\t\tif(isConnected) {\n\t\t\t\t\tlet msg;\n\t\t\t\t\twhile((msg = msgQueue.pop())) {\n\t\t\t\t\t\tpostMessageBridge.send(msg.data, handleId, msg.id);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction init() {\n\t\t\t\tif(isConnected || connectCount > MAX_TRY || isCanceled) {\n\t\t\t\t\tif(!isConnected && !isCanceled) {\n\t\t\t\t\t\tonfailed(\"timeout\");\n\t\t\t\t\t}\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tpostMessageBridge.sendConn(handleId);\n\t\t\t\tconnectCount++;\n\t\t\t\tpostMessageBridge.runAfter(SLEEP, init);\n\t\t\t}\n\t\t\tif(source) {\n\t\t\t\tinitListen();\n\t\t\t\tinit();\n\t\t\t} else if(!isActive) {\n\t\t\t\tinitListen();\n\t\t\t}\n\n\t\t\tthis.setSource = function(_source) {\n\t\t\t\tsource = _source;\n\t\t\t\tif(source) {\n\t\t\t\t\tinitListen();\n\t\t\t\t\tinit();\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\n\t\tlet handleApi = api;\n\n\t\t/**\n\t\t * \n\t\t * @param {Object} winObjOrCallback\n\t\t * @param {Object} option\n\t\t * @param {Object} notActive\n\t\t */\n\t\tfunction _connectWindow(winObjOrCallback, option, notActive) {\n\t\t\toption = xsloader.extendDeep({\n\t\t\t\tcmd: \"default-cmd\",\n\t\t\t\tlistener: null,\n\t\t\t\tconnected: null,\n\t\t\t\tconndata: null,\n\t\t\t\tconnectingSource: function(source, origin, conndata, callback) {\n\t\t\t\t\tlet mine = location.protocol + \"//\" + location.host;\n\t\t\t\t\tcallback(mine == origin, \"default\");\n\t\t\t\t},\n\t\t\t\tonfailed: function(errtype) {\n\t\t\t\t\tif(errtype == \"timeout\") {\n\t\t\t\t\t\tconsole.warn(\"connect may timeout:cmd=\" + option.cmd + \",my page=\" + location.href);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}, option);\n\n\t\t\tlet cmd = option.cmd;\n\t\t\tlet connectedCallback = option.connected;\n\t\t\tlet receiveCallback = option.listener;\n\t\t\tlet conndata = option.conndata;\n\t\t\tlet onfailed = option.onfailed;\n\n\t\t\tlet isActive = !notActive;\n\t\t\tlet connectingSource = option.connectingSource;\n\n\t\t\tlet unit;\n\t\t\tif(typeof winObjOrCallback == \"function\") {\n\t\t\t\tunit = new CommunicationUnit(cmd, null, connectingSource, onfailed, isActive, conndata);\n\t\t\t} else {\n\t\t\t\tunit = new CommunicationUnit(cmd, winObjOrCallback, connectingSource, onfailed, isActive, conndata);\n\t\t\t}\n\n\t\t\tconnectedCallback = connectedCallback || function(sender, conndata) {\n\t\t\t\tconsole.log((isActive ? \"active\" : \"\") + \" connected:\" + cmd);\n\t\t\t};\n\t\t\tif(connectedCallback) {\n\t\t\t\tunit.onConnectedListener = function(conndata) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tconnectedCallback(this.send, conndata);\n\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\tconsole.error(e);\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t}\n\t\t\tif(receiveCallback) {\n\t\t\t\tunit.onReceiveListener = function(data) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\treceiveCallback(data, this.send);\n\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\tconsole.error(e);\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t}\n\t\t\tif(typeof winObjOrCallback == \"function\") {\n\t\t\t\twinObjOrCallback(function(winObj) {\n\t\t\t\t\tunit.setSource(winObj);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn unit.send;\n\t\t}\n\n\t\tfunction _connectIFrame(iframe, option) {\n\t\t\tlet winObj;\n\t\t\tif(typeof iframe == \"string\") {\n\t\t\t\t//iframe = ddocument.querySelector(iframe);\n\t\t\t\twinObj = function(callback) {\n\t\t\t\t\tiframe.onload = function() {\n\t\t\t\t\t\tcallback(this.contentWindow);\n\t\t\t\t\t};\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\twinObj = iframe.contentWindow;\n\t\t\t}\n\t\t\treturn _connectWindow(winObj, option);\n\n\t\t}\n\n\t\t/**\n\t\t * 用于连接iframe.\n\t\t * @param {Object} iframe iframe或selector\n\t\t * @param {Object} option\n\t\t * @return 返回sender\n\t\t */\n\t\thandleApi.connectIFrame = function(iframe, option) {\n\t\t\treturn _connectIFrame(iframe, option);\n\t\t};\n\n\t\t/**\n\t\t * 用于连接父页面.\n\t\t * @param {Object} option\n\t\t * @return 返回sender\n\t\t */\n\t\thandleApi.connectParent = function(option) {\n\t\t\treturn _connectWindow(window.parent, option);\n\t\t};\n\n\t\t/**\n\t\t * 用于连接顶层页面.\n\t\t * @param {Object} option\n\t\t * @return 返回sender\n\t\t */\n\t\thandleApi.connectTop = function(option) {\n\t\t\treturn _connectWindow(window.top, option);\n\t\t};\n\n\t\t/**\n\t\t * 用于连接打开者.\n\t\t * @param {Object} option\n\t\t * @return 返回sender\n\t\t */\n\t\thandleApi.connectOpener = function(option) {\n\t\t\treturn _connectWindow(window.opener, option);\n\t\t};\n\n\t\t/**\n\t\t * 用于监听其他页面发送消息.\n\t\t * @param {Object} option\n\t\t * @return 返回一个sender\n\t\t */\n\t\thandleApi.listenMessage = function(option) {\n\t\t\treturn _connectWindow(null, option, true);\n\t\t};\n\n\t\thandleApi.debug = function(isDebug) {\n\t\t\tisXsMsgDebug = isDebug;\n\t\t};\n\n\t\t/**\n\t\t * *******************\n\t\t * option参数\n\t\t *********************\n\t\t * option.cmd:\n\t\t * option.connectingSource:function(source,origin,conndata,callback(isAccept,msg))默认只选择同源\n\t\t * option.listener: function(data,sender)\n\t\t * option.connected:function(sender,conndata)\n\t\t * option.onfailed:function(errtype):errtype,timeout,canceled\n\t\t * option.conndata:\n\t\t **************\n\t\t * 回调的extra参数\n\t\t **************\n\t\t * originStr:对方页面的地址\n\t\t */\n\t\txsloader.define(\"xsmsg\", handleApi); //TODO STRONG xsmsg\n\t}\n\n\txsloader.define(\"XsLinkedList\", function() {\n\t\treturn LinkedList;\n\t});\n} catch(e) {\n\tconsole.error(e);\n}","// 静态资源服务\nimport utils from \"./util/index.js\";\n\nconst global = utils.global;\nconst xsloader = global.xsloader;\n\nconst http = global._xshttp_request_;\nconst DATA_CONF = \"data-conf\",\n\tDATA_CONFX = \"data-xsloader-conf\";\nconst DATA_CONF2 = \"data-conf2\",\n\tDATA_CONF2X = \"data-xsloader-conf2\";\nconst DATA_MAIN = \"data-main\",\n\tDATA_MAINX = \"data-xsloader-main\";\nconst DATA_CONF_TYPE = \"data-conf-type\";\n\nlet serviceConfigUrl;\nlet dataConf = xsloader.script().getAttribute(DATA_CONF) || xsloader.script().getAttribute(DATA_CONFX);\nlet dataMain = xsloader.script().getAttribute(DATA_MAIN) || xsloader.script().getAttribute(DATA_MAINX);\nlet dataConfType = xsloader.script().getAttribute(DATA_CONF_TYPE);\nif(dataConfType !== \"json\" && dataConfType != \"js\") {\n\tdataConfType = \"auto\";\n}\n\nlet initFun = () => {\n\tfunction getMainPath(config) {\n\t\tlet mainPath = config.main.getPath.call(config, dataMain);\n\t\tlet path = location.pathname;\n\n\t\tlet index = path.lastIndexOf(\"/\");\n\t\tlet name = path.substring(index + 1);\n\t\tif(name === \"\") {\n\t\t\tname = \"index\";\n\t\t}\n\t\tif(xsloader.endsWith(name, \".html\")) {\n\t\t\tname = name.substring(0, name.length - 5);\n\t\t}\n\t\tif(!mainPath) {\n\t\t\tmainPath = \"./main/{name}.js\";\n\t\t}\n\t\tmainPath = mainPath.replace(\"{name}\", name);\n\t\treturn mainPath;\n\t}\n\n\tfunction extendConfig(config) {\n\t\tconfig = xsloader.extendDeep({\n\t\t\tproperties: {},\n\t\t\tmain: {\n\t\t\t\tgetPath() {\n\t\t\t\t\treturn dataMain || \"./main/{name}.js\";\n\t\t\t\t},\n\t\t\t\tname: \"main\",\n\t\t\t\tlocalConfigVar: \"lconfig\",\n\t\t\t\tglobalConfigVar: \"gconfig\",\n\t\t\t\tbefore(name) {\n\t\t\t\t\tconsole.log(\"before:\" + name);\n\t\t\t\t},\n\t\t\t\tafter(name) {\n\t\t\t\t\tconsole.log(\"after:\" + name);\n\t\t\t\t}\n\t\t\t},\n\t\t\tservice: {\n\t\t\t\thasGlobal: false,\n\t\t\t\tresUrls: []\n\t\t\t},\n\t\t\tchooseLoader(localConfig) { //返回一个configName；当此函数为service全局配置的函数时，localConfig为应用的配置对象;本地配置调用时，localConfig为null。\n\t\t\t\treturn \"default\";\n\t\t\t},\n\t\t\tloader: {\n\t\t\t\t\"default\": {\n\t\t\t\t\tautoUrlArgs: true\n\t\t\t\t}\n\t\t\t}\n\t\t}, config);\n\n\t\treturn config;\n\t}\n\n\tfunction loadServiceConfig(tag, url, callback, isLocal) {\n\t\thttp({\n\t\t\turl: url,\n\t\t\tmethod: \"get\",\n\t\t\ttimeout: 20000,\n\t\t\thandleType: \"text\",\n\t\t\tok(confText) {\n\n\t\t\t\tlet conf;\n\t\t\t\tif(dataConfType == \"js\") {\n\t\t\t\t\tconf = xsloader.xsEval(confText);\n\t\t\t\t} else if(dataConfType == \"json\") {\n\t\t\t\t\tconf = xsloader.xsParseJson(confText);\n\t\t\t\t} else {\n\t\t\t\t\tif(xsloader.startsWith(url, location.protocol + \"//\" + location.host + \"/\")) {\n\t\t\t\t\t\t//同域则默认用脚本解析\n\t\t\t\t\t\tconf = xsloader.xsEval(confText);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconf = xsloader.xsParseJson(confText);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconf = extendConfig(conf);\n\t\t\t\tif(conf.beforeDealProperties) {\n\t\t\t\t\tconf.beforeDealProperties();\n\t\t\t\t}\n\t\t\t\tconf = xsloader.dealProperties(conf, conf.properties); //参数处理\n\n\t\t\t\tif(isLocal && conf.service.hasGlobal) {\n\t\t\t\t\tloadServiceConfig(\"global servie\", conf.service.confUrl,\n\t\t\t\t\t\tfunction(globalConfig) {\n\t\t\t\t\t\t\tlet localConfig = conf;\n\t\t\t\t\t\t\tglobal[globalConfig.main && globalConfig.main.localConfigVar || localConfig.main.localConfigVar] = localConfig;\n\t\t\t\t\t\t\tglobal[globalConfig.main && globalConfig.main.globalConfigVar || localConfig.main.globalConfigVar] = globalConfig;\n\n\t\t\t\t\t\t\tlet mainName, mainPath, loaderName;\n\n\t\t\t\t\t\t\tloaderName = globalConfig.chooseLoader.call(globalConfig, localConfig);\n\t\t\t\t\t\t\tlet conf;\n\t\t\t\t\t\t\tlet loader;\n\t\t\t\t\t\t\tif(loaderName != null) {\n\t\t\t\t\t\t\t\tmainName = globalConfig.main.name;\n\t\t\t\t\t\t\t\tmainPath = utils.getPathWithRelative(location.href, getMainPath(globalConfig));\n\t\t\t\t\t\t\t\tloader = globalConfig.loader[loaderName];\n\t\t\t\t\t\t\t\tconf = globalConfig;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif(!loader) {\n\t\t\t\t\t\t\t\tloaderName = localConfig.chooseLoader.call(localConfig, null);\n\t\t\t\t\t\t\t\tmainName = localConfig.main.name;\n\t\t\t\t\t\t\t\tmainPath = utils.getPathWithRelative(location.href, getMainPath(localConfig));\n\t\t\t\t\t\t\t\tloader = localConfig.loader[loaderName];\n\t\t\t\t\t\t\t\tconf = localConfig;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif(!loader) {\n\t\t\t\t\t\t\t\tconsole.error(\"unknown loader:\" + loaderName + \"\");\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tinitXsloader(mainName, mainPath, loader, conf, localConfig);\n\n\t\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tcallback(conf);\n\t\t\t\t}\n\t\t\t},\n\t\t\tfail(err) {\n\t\t\t\tconsole.error(\"load \" + tag + \" config err:url=\" + url + \",errinfo=\" + err);\n\t\t\t}\n\t\t}).done();\n\t}\n\n\tfunction startLoad() {\n\t\tloadServiceConfig(\"local\", serviceConfigUrl, function(localConfig) {\n\t\t\tglobal[localConfig.main.localConfigVar] = localConfig;\n\n\t\t\tlet mainName = localConfig.main.name;\n\n\t\t\tlet href = location.href;\n\t\t\tlet index = href.lastIndexOf(\"?\");\n\t\t\tif(index >= 0) {\n\t\t\t\thref = href.substring(0, index);\n\t\t\t}\n\n\t\t\tlet mainPath = getMainPath(localConfig);\n\n\t\t\tmainPath = mainPath.indexOf(\"!\") == -1 ? utils.getPathWithRelative(href, mainPath) : mainPath;\n\t\t\tlet loaderName = localConfig.chooseLoader.call(localConfig, null);\n\n\t\t\tlet loader = localConfig.loader[loaderName];\n\t\t\tif(!loader) {\n\t\t\t\tconsole.error(\"unknown local loader:\" + loaderName);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tinitXsloader(href, mainName, mainPath, loader, localConfig, localConfig);\n\t\t}, true);\n\t}\n\n\tfunction initXsloader(pageHref, mainName, mainPath, loader, conf, localConfig) {\n\t\tlet resUrls = [];\n\t\tconf.service.resUrl && resUrls.push(conf.service.resUrl);\n\t\tlocalConfig !== conf && localConfig.service.resUrl && resUrls.push(localConfig.service.resUrl);\n\n\t\tconf.service.resUrls && Array.pushAll(resUrls, conf.service.resUrls);\n\t\tlocalConfig !== conf && localConfig.service.resUrls && Array.pushAll(resUrls, localConfig.service.resUrls);\n\n\t\txsloader._resUrlBuilder = function(groupModule) {\n\t\t\tlet as = [];\n\t\t\tutils.each(resUrls, function(url) {\n\t\t\t\tas.push(xsloader.appendArgs2Url(url, \"m=\" + encodeURIComponent(groupModule)));\n\t\t\t});\n\t\t\treturn as;\n\t\t};\n\t\tloader.ignoreProperties = true;\n\t\tloader.defineFunction = loader.defineFunction || {};\n\t\tloader.depsPaths = loader.depsPaths || {};\n\t\tif(mainPath.indexOf(\"!\") != -1) { //插件调用\n\t\t\tlet theConfig = xsloader(loader);\n\n\t\t\tmainName = \"_plugin_main_\";\n\t\t\tlet deps = [];\n\t\t\tif(theConfig.deps) { //手动添加*依赖\n\t\t\t\tif(theConfig.deps[\"*\"]) {\n\t\t\t\t\tArray.pushAll(deps, theConfig.deps[\"*\"]);\n\t\t\t\t}\n\t\t\t\tif(theConfig.deps[mainName]) {\n\t\t\t\t\tArray.pushAll(deps, theConfig.deps[mainName]);\n\t\t\t\t}\n\t\t\t}\n\t\t\tdeps.push(mainPath);\n\t\t\txsloader.defineAsync(mainName, deps, function() {\n\n\t\t\t}).then({\n\t\t\t\tabsUrl: pageHref\n\t\t\t});\n\t\t} else if(!xsloader.hasDefine(mainName)) {\n\t\t\tloader.depsPaths[mainName] = mainPath; //让其依赖*中的所有依赖\n\t\t\txsloader(loader);\n\t\t} else {\n\t\t\txsloader(loader);\n\t\t}\n\n\t\tloader.defineFunction[mainName] = function(originCallback, originThis, originArgs) {\n\t\t\tif(xsloader.isFunction(conf.main.before)) {\n\t\t\t\tconf.main.before.call(conf, mainName);\n\t\t\t}\n\t\t\tlet rt = originCallback.apply(originThis, originArgs);\n\n\t\t\tif(xsloader.isFunction(conf.main.after)) {\n\t\t\t\tconf.main.after.call(conf, mainName);\n\t\t\t}\n\t\t\treturn rt;\n\t\t};\n\n\t\txsloader.require([mainName], function(main) {}).then({\n\t\t\tonError: function(err, invoker) {\n\t\t\t\tif(invoker) {\n\t\t\t\t\tconsole.error(\"error occured:invoker.url=\", invoker.getUrl());\n\t\t\t\t}\n\t\t\t\tconsole.error(\"invoke main err:\" + err);\n\t\t\t}\n\t\t});\n\t}\n\txsloader.asyncCall(startLoad, true);\n};\n\nif(dataConf) {\n\tserviceConfigUrl = utils.getPathWithRelative(location.href, dataConf);\n} else if((dataConf = (xsloader.script().getAttribute(DATA_CONF2) || xsloader.script().getAttribute(DATA_CONF2X)))) {\n\tserviceConfigUrl = utils.getPathWithRelative(xsloader.scriptSrc(), dataConf);\n} else {\n\tinitFun = null;\n}\ninitFun && initFun();"],"names":["g","undefined","window","self","global","Error","InVar","val","get","set","newVal","old","loaderFun","xsloader","apply","this","arguments","fun","ABSOLUTE_PROTOCOL_REG","ABSOLUTE_PROTOCOL_REG2","defaultJsExts","isJsFile","path","isString","pluginIndex","indexOf","substring","index","theConfig","config","jsExts","i","length","endsWith","ext","dealPathMayAbsolute","currentUrl","location","href","finalPath","absolute","rs","exec","protocol","_protocol","_host","host","getPathWithRelative","relative","isPathDir","relativeQuery","qIndex","lastIndexOf","isRelativeDir","prefix","absolute2","index2","stack","split","pop","relatives","str","push","result","join","appendArgs2Url","getNodeAbsolutePath","node","src","getAttribute","removeQueryHash","url","REPLACE_STRING_PROPERTIES_EXP","RegExp","ALL_TYPE_PROPERTIES_EXP","propertiesDeal","configObject","properties","replaceStringProperties","string","property","propKey","propValue","getObjectAttr","propertyKey","has","replaceProperties","obj","enableKeyAttr","isFunction","isArray","isObject","replaceKeyMap","x","_x","objx","__dealt__","call","replaceModulePrefix","deps","m","pluginParam","query","startsWith","modulePrefixCount","modulePrefix","replaceStr","replace","len","pluginName","dep","getScriptBySubname","subname","ss","document","getElementsByTagName","script","commentRegExp","cjsRequireRegExp","GraphPath","pathEdges","vertexMap","depMap","checkLoop","v","visited","recursionStack","paths","edges","edge","end","addEdge","begin","hasDep","name","tryAddEdge","hasLoop","strValue2Arr","each","ary","func","isSync","fromEnd","__commentReplace","match","singlePrefix","appendInnerDeps","callback","toString","idCount","getAndIncIdCount","PluginError","err","graphPath","urls","base","utils","Function","prototype","bind","console","_typeof","method","thiz","e","log","error","warn","Array","elem","offset","pushAll","arr","starts","ends","_indexInArray","array","ele","compare","indexInArray","indexInArrayFrom","JSON","rx_one","rx_two","rx_three","rx_four","rx_escapable","rx_dangerous","gap","indent","meta","rep","f","n","this_value","valueOf","quote","lastIndex","test","a","c","charCodeAt","slice","key","holder","k","partial","mind","value","toJSON","isFinite","String","Object","hasOwnProperty","Date","getUTCFullYear","getUTCMonth","getUTCDate","getUTCHours","getUTCMinutes","getUTCSeconds","Boolean","Number","stringify","replacer","space","parse","text","reviver","j","walk","eval","SyntaxError","randId","suffix","id","parseInt","getTime","Math","random","xsEval","scriptString","IE_VERSION","xsParseJson","option","extend","fnStart","fnEnd","rcomment","fnMap","fnOffset","indexStart","indexEnd","fnId","fnStr","trim","fn","xsJSON","reg","message","posStr","pos","_str","e2","xsJson2String","_toParamsMap","argsStr","decode","search","s","ret","seg","decodeURIComponent","urlArgs","hashIndex","oldParams","newParams","paramKeys","sort","params","hash","queryString2ParamsMap","ostring","it","isDate","isRegExp","queryParam","otherValue","optionUrl","substr","r","getUrl","relativeUrl","appendArgs","optionalAbsUrl","thePageUrl","pageUrl","baseUrl","dealUrl","tryCall","defaultReturn","exCallback","dealProperties","target","extendDeep","_AsyncCall","useTimer","count","ctrlCallbackMap","pushTask","callbackObj","handle","next","nextCallback","lastReturn","mineCount","ctrlCallback","asyncCallQueue","shift","nextObj","Promise","resolve","then","setTimeout","initCtrlCallback","theAsyncCall","theAsyncCallOfTimer","asyncCall","attrNames","defaultValue","attrs","setObjectAttr","_obj","o","clone","isDeep","source","flags","copy","setTime","attr","isDOM","HTMLElement","nodeType","nodeName","onReadyFun","isGlobalReady","bindReadyQueue","BindReady","isReady","addEventListener","removeEventListener","ready","attachEvent","fun2","readyState","detachEvent","documentElement","doScroll","frameElement","readyCall","onReady","br","type","toGlobal","deprecated","justLoader","is","funs","browser","_ignoreAspect_","theDefinedMap","ModuleDef","modules","defaultModule","getModule","nameOrUrl","module","isSrc","moduleDef","replaceModuleSrc","oldSrc","clearEmptyModuleBySrc","setModule","INNER_DEPS_PLUGIN","innerDepsMap","buildInvoker","invoker","getId","getAbsoluteUrl","rurl","require","define","defineObject","absUrl","defineAsync","withAbsUrl","moduleMap","getName","Invoker","newModuleInstance","thatInvoker","relyCallback","pluginArgs","instanceModule","_invoker","_module_","initInvoker","ignoreAspect","_object","addTheAttrs","theObj","_invoker_","_modules_","_this","isSingle","instanceType","loopObject","description","_setDepModuleObjectGen","moduleObject","genExports","_getCacheKey","getCacheKey","_willCache","cacheResult","willCache","lastSinglePluginResult","setSinglePluginResult","init","justForSingle","dealInstance","hasFinished","onload","__default","_this2","onerror","args","concat","depModules","last","pluginMain","selfname","waitSeconds","_newModule","DefineObject","newModule","instances","relys","otherModule","directDefineIndex","getMineAbsUrl","_loadCallback","setInstanceType","_singlePluginResult","finish","_directArgs","currentDefineModuleQueue","setState","isDefault","state","errinfo","_callback","_state","theCallback","getDeps","defined_module_for_deps","toOtherModule","theRelys","relyIt","whenNeed","loadCallback","callbackFun","moduleInstance","opId","setToAll","_getModuleId","ins","mobj","_m_","mayAddDeps","moduleDeps","printOnNotDefined","root","nodes","_printOnNotDefined","leafs","findLeaf","item","leaf","infos","genErrs","parent","reverse","as","info","errModule","depMod","parentNode","indexPlguin","mod","randModuleIndex","_dealEmbedDeps","modName","isOrderDep","orderDep","_getPluginParam","everyRequired","everyOkCallback","errCallback","isError","jsFilePath","theExports","hasCallErr","depCount","invoker_the_module","syncHandle","originDep","version","groupModule","i1","i2","i3","defaultVersion","_url","_resUrlBuilder","isInUrls","getUrls","module2","loadModule","loadScript","scriptData","defaultMod","depModule","dep_name","checkFinish","defContextName","DATA_ATTR_MODULE","DATA_ATTR_CONTEXT","globalDefineQueue","head","isOpera","opera","readyRegExp","navigator","platform","theLoaderScript","currentScript","theLoaderUrl","peek","lastAppendHeadDom","useDefineQueue","theRealDefine","safariVersion","_im","getInvoker","nullNew","moduleScript","isRequire","parentDefine","onError","before","depBefore","depDeps","absoluteUrl","instance","_deps","getCurrentScript","isRemoveQueryHash","b","sourceURL","stacktrace","_getCurrentScriptOrSrc","__createNode","createElement","charset","async","__removeListener","ieName","__browserLoader","moduleName","setAttribute","onScriptLoad","errListen","onScriptError","appendHeadDom","__getScriptData","evt","currentTarget","srcElement","dom","nextDom","nextSibling","insertBefore","removed","doDefine","predefine","prerequire","originDeps","argArr","theMod","timeid","clearTimeout","ifmodule","initDefine","theDefine","defines","onConfigedCallback","theContext","argsObject","_newContext","contextName","defQueue","scriptSrc","putUrlArgs","argsObj","getUrlArgs","clearUrlArgs","hasDefine","groupName","clear_module_","loader","pathname","ignoreProperties","depsPaths","defineFunction","autoUrlArgs","dealtDeps","hasOrderDep","splice","urlArg","forPrefixSuffix","aurl","encodeURIComponent","dealUrlArgs","isAutoUrlArgs","star","urlArgsArr","urlArgObj","starP","_urlArgs_prefix","_urlArgs_suffix","strfix","urlOrName","strfixObj","pushDeps","dealtDepArray","depsArray","keyName","defineHandle","originCallback","rt","defineFun","names","onModuleLoaded","lastDefineObject","needCallback","depModuleArgs","amd","depId","depsObj","arg","vars","existsMods","newName","lastM","load","engine","userAgent","useImportLoad","useOnload","style","createStyle","curStyle","curSheet","styleSheet","sheet","createIeLoad","addImport","processIeLoad","ieCnt","importLoad","ieCurCallback","ieLoads","textContent","loadInterval","setInterval","cssRules","clearInterval","linkLoad","link","rel","styleSheets","cssAPI","nextLoad","cssId","loadCss","cssPath","loadCsses","http","handleAs","ok","fail","done","depsStr","json","progIds","httpRequest","prop","varName","defaultVal","putProp","toObj","_method","_params","_headers","_async","_multiPart","_handleType","_timeout","timeout","okCallback","failCallback","uploadStartCallback","uploadStart","uploadProgressCallback","uploadProgress","uploadOkCallback","uploadOk","uploadErrorCallback","uploadError","uploadEndCallback","uploadEnd","_beforeOpenHook","_onOkResponseHook","_onFailResponseHook","conn","xhr","toUpperCase","headers","handleType","multiPart","body","timeoutTimer","formData","FormData","append","open","setRequestHeader","header","upload","onloadstart","onprogress","onloadend","isTimeout","abort","onreadystatechange","status","_doOnFailResponseHook","responseText","send","_connAfterOpenHook","_conn","progId","XMLHttpRequest","ActiveXObject","createXhr","extraErr","urlStr","methodStr","isAsync","paramsObj","headersObj","extraErrorType","_xshttp_request_","isResponsed","callbacksQueue","code","desc","newHandle","instanceMap","cmd2ListenerMap","instanceBindMap","oinstanceidMap","isDebug","isXsMsgDebug","LinkedList","newNode","element","pre","headNode","lastNode","getElement","position","willRemove","pNode","currentNode","nextCurrentNode","current","insert","elementAt","eachForRemove","removeAt","find","remove","isEmpty","size","api","CommunicationUnit","cmd","connectingSource","onfailed","isActive","conndata","handleId","msgQueue","MAX_TRY","SLEEP","isConnected","connectCount","isCanceled","_onConned","_source","data","onConnectedListener","sendTop","_onMsg","msgid","onReceiveListener","postMessageBridge","sendResponse","_onResponse","_onElse","initListen","listen","msg","sendConn","runAfter","release","setSource","_connectWindow","winObjOrCallback","notActive","unit","listener","connected","origin","errtype","connectedCallback","receiveCallback","sender","winObj","_connectIFrame","iframe","contentWindow","osource","active","refused","instanceid","_sendData","event","oinstanceid","rdata","fromSource","originStr","listeners","Callback","isAccept","handleConn","minstanceid","handleAccept","checkSource","handleConned","handleMsg","handleResponse","handleBinded","time","handleApi","connectIFrame","connectParent","connectTop","top","connectOpener","opener","listenMessage","debug","postMessage","DATA_CONF","DATA_CONFX","DATA_CONF2","DATA_CONF2X","DATA_MAIN","DATA_MAINX","DATA_CONF_TYPE","serviceConfigUrl","dataConf","dataMain","dataConfType","initFun","getMainPath","mainPath","main","getPath","loadServiceConfig","tag","isLocal","confText","conf","localConfigVar","globalConfigVar","after","service","hasGlobal","resUrls","chooseLoader","localConfig","extendConfig","beforeDealProperties","confUrl","globalConfig","mainName","loaderName","initXsloader","pageHref","resUrl","originThis","originArgs"],"mappings":"6zDAAA,IAAIA,EACJ,QAAqBC,yBAAXC,2BAAAA,SACTF,EAAIE,YACE,QAAmBD,yBAATE,yBAAAA,OAChBH,EAAIG,SACE,CAAA,QAAqBF,yBAAXG,2BAAAA,eAGV,IAAIC,MAAM,yBAFhBL,EAAII,OASL,SAASE,QAAMC,QACTC,IAAM,kBACHD,QAGHE,IAAM,SAASC,OACfC,EAAMJ,SACVA,EAAMG,EACCC,GAGTX,EAAEM,MAAQA,qBAEKN,EC3BXY,WACAC,SAAWT,SAAOS,SAAW,kBACzBD,WAAUE,MAAMC,KAAMC,mBAGf,CACdJ,UAAW,SAACK,GACXL,WAAYK,ICRRC,sBAAwB,sCACxBC,uBAAyB,iCACzBC,cAAgB,CAAC,MAAO,OAAQ,QAAS,MAAO,MAAO,OAAQ,QAG/DP,WAAWT,SAAOS,SAExB,SAASQ,SAASC,OACbT,WAASU,SAASD,UACd,MAEJE,EAAcF,EAAKG,QAAQ,KACd,EAAdD,IACFF,EAAOA,EAAKI,UAAU,EAAGF,QAEtBG,EAAQL,EAAKG,QAAQ,KACd,EAARE,IACFL,EAAOA,EAAKI,UAAU,EAAGC,IAGf,GADXA,EAAQL,EAAKG,QAAQ,QAEpBH,EAAOA,EAAKI,UAAU,EAAGC,YAEtBC,EAAYf,WAASgB,SAErBC,EAASF,GAAaA,EAAUE,QAAUV,cACtCW,EAAI,EAAGA,EAAID,EAAOE,OAAQD,OAC9BlB,WAASoB,SAASX,EAAMQ,EAAOC,UAC1B,CACNG,IAAKJ,EAAOC,GACZT,KAAMA,UAIF,EAGR,SAASa,oBAAoBb,EAAMc,GAClCA,EAAaA,GAAcC,SAASC,SAGhCC,EACAC,EAHAC,EAAKvB,sBAAsBwB,KAAKpB,MAIjCmB,EAAI,KACFE,EAAWF,EAAG,GAClBD,GAAW,MAGPI,GADJH,EAAKtB,uBAAuBuB,KAAKN,KACXK,EAAG,IAAMJ,SAASM,SACpCE,EAAQJ,GAAMA,EAAG,IAAMJ,SAASS,KAGnCP,EADc,MAAZI,EACUC,EAAY,KAAOtB,EACV,KAAZqB,EACGC,EAAY,KAAOC,EAAQvB,EAE3BA,OAIbkB,GAAW,EACXD,EAAYjB,QAEN,CACNkB,SAAUA,EACVlB,KAAMiB,GAIR,SAASQ,oBAAoBzB,EAAM0B,EAAUC,OAExCC,EAAgB,GAChBC,EAAS7B,EAAK8B,YAAY,KACjB,GAAVD,EACF7B,EAAOA,EAAKI,UAAU,EAAGyB,GAGZ,IADbA,EAAS7B,EAAK8B,YAAY,QAEzB9B,EAAOA,EAAKI,UAAU,EAAGyB,IAKd,IADbA,EAASH,EAASI,YAAY,OAE7BF,EAAgBF,EAAStB,UAAUyB,GACnCH,EAAWA,EAAStB,UAAU,EAAGyB,IAGpB,IADbA,EAASH,EAASI,YAAY,QAE7BF,EAAgBF,EAAStB,UAAUyB,GACnCH,EAAWA,EAAStB,UAAU,EAAGyB,QAI/BX,EAAWL,oBAAoBa,MAChCR,EAASA,gBACJA,EAASlB,KAAO4B,UAGPjD,IAAdgD,EAAyB,KACvBtB,EAAQL,EAAK8B,YAAY,KAE5BH,EADEtB,GAASL,EAAKU,OAAS,KAGZ,GAAVL,EACFA,EAAQ,EAERA,KAEwC,GAA7BL,EAAKG,QAAQ,IAAKE,IAI7Bd,WAASoB,SAASX,EAAM,OAC1BA,EAAOA,EAAKI,UAAU,EAAGJ,EAAKU,OAAS,QAGpCqB,GAAgB,EACL,KAAZL,GAAmBnC,WAASoB,SAASe,EAAU,MACjDA,EAAWA,EAAStB,UAAU,EAAGsB,EAAShB,OAAS,GACnDqB,GAAgB,IACK,KAAZL,GAA+B,MAAZA,GAAoBnC,WAASoB,SAAS,OAASpB,WAASoB,SAAS,UAC7FoB,GAAgB,OAGbC,EACA3B,GAAS,EACT4B,EAAYpB,oBAAoBb,MACjCiC,EAAUf,SAAU,KAElBgB,GADJlC,EAAOiC,EAAUjC,MACCG,QAAQ,OAEb,IADbE,EAAQL,EAAKG,QAAQ,IAAK+B,EAAS,MAElC7B,EAAQL,EAAKU,QAIfsB,EAAShC,EAAKI,UAAU,EAAGC,EAAQ,OAG/B8B,GAFJnC,EAAOA,EAAKI,UAAUC,EAAQ,IAEb+B,MAAM,MACnBT,GAA4B,EAAfQ,EAAMzB,QACtByB,EAAME,cAEHC,EAAYZ,EAASU,MAAM,KACvB3B,EAAI,EAAGA,EAAI6B,EAAU5B,OAAQD,IAAK,KACrC8B,EAAMD,EAAU7B,MACjB,MAAQ8B,EAAK,IACI,GAAhBJ,EAAMzB,aACF,IAAI3B,MAAM,uBAEjBoD,EAAME,UACG,KAAOE,GAChBJ,EAAMK,KAAKD,MAGM,GAAhBJ,EAAMzB,aACD,OAEJ+B,EAAST,EAASG,EAAMO,KAAK,YAC9BX,IAAkBxC,WAASoB,SAAS8B,EAAQ,OAC9CA,GAAU,KAEXA,EAASlD,WAASoD,eAAeF,EAAQb,GAI1C,SAASgB,oBAAoBC,OACxBC,EAAMD,EAAKC,KAAOD,EAAKE,aAAa,cACjCtB,oBAAoBV,SAASC,KAAM8B,GAI3C,SAASE,gBAAgBC,MACrBA,EAAK,KACH5C,EAAQ4C,EAAI9C,QAAQ,KACZ,GAATE,IACF4C,EAAMA,EAAI7C,UAAU,EAAGC,IAIZ,IADZA,EAAQ4C,EAAI9C,QAAQ,QAEnB8C,EAAMA,EAAI7C,UAAU,EAAGC,WAGlB4C,EAGR,IAAMC,8BAAgC,IAAIC,OAAO,sBAC3CC,wBAA0B,IAAID,OAAO,2BAE3C,SAASE,eAAeC,EAAcC,OACjCA,SACID,WAGCE,EAAwBC,EAAQF,EAAYG,OAChDvC,EACAoB,EAAMkB,KACVtC,EAAKiC,wBAAwBhC,KAAKmB,GAC3B,KACFoB,EAAUxC,EAAG,GACbyC,EAAYrE,WAASsE,cAAcN,EAAYI,eAClChF,IAAdiF,EACKrB,EAEAqB,UAILnB,EAAS,KACD,MACXtB,EAAK+B,8BAA8B9B,KAAKmB,IAChC,CACPE,GAAUF,YAGNoB,EAAUxC,EAAG,WACDxC,IAAb+E,GAA0BA,EAASI,aAAeH,QAC9C,IAAI5E,MAAM,sCAAwC4E,GAC/CD,IACTA,EAASK,KAAM,GAEhBtB,GAAUF,EAAInC,UAAU,EAAGe,EAAGd,OAC9BoC,GAAUlD,WAASsE,cAAcN,EAAYI,GAC7CpB,EAAMA,EAAInC,UAAUe,EAAGd,MAAQc,EAAG,GAAGT,eAGhC+B,WAICuB,EAAkBC,EAAKP,EAAUQ,OACrCD,SACIA,KAEL1E,WAAS4E,WAAWF,UACfA,EACD,GAAG1E,WAAS6E,QAAQH,OACtB,IAAIxD,EAAI,EAAGA,EAAIwD,EAAIvD,OAAQD,IAC9BwD,EAAIxD,GAAKuD,EAAkBC,EAAIxD,GAAIiD,EAAUQ,QAExC,GAAG3E,WAASU,SAASgE,GAC3BA,EAAMT,EAAwBS,EAAKV,EAAYG,QACzC,GAAGnE,WAAS8E,SAASJ,GAAM,CAC9BP,IACFA,EAASK,KAAM,OAEZO,EAAgB,OAChB,IAAIC,KAAKN,KACTP,IACFA,EAASI,YAAcS,GAExBN,EAAIM,GAAKP,EAAkBC,EAAIM,GAAIb,EAAUQ,GAC1CA,EAAe,KACbM,EAAKhB,EAAwBe,EAAGhB,EAAYG,GAC7Cc,IAAOD,IACTD,EAAcC,GAAKC,OAIlB,IAAID,KAAKD,EAAe,KACvBG,EAAOR,EAAIM,UACRN,EAAIM,GACXN,EAAIK,EAAcC,IAAME,UAInBR,MAIJV,EAAWmB,UAAW,KACrBhB,EAAW,CACdK,KAAK,OAGF,IAAIQ,KAAKhB,EAAY,KACpB5D,EAAM4D,EAAWgB,GAClBhF,WAAS4E,WAAWxE,KACtB4D,EAAWgB,GAAK5E,EAAIgF,KAAKpB,SAI1BS,EAAkBT,EAAYG,GACtBA,EAASK,MAClBR,EAAWmB,WAAY,SAGjBV,EAAkBV,OAAc3E,GAAW,GAGnD,SAASiG,oBAAoBrE,EAAQsE,MAEhCA,OAIA,IAAIpE,EAAI,EAAGA,EAAIoE,EAAKnE,OAAQD,IAAK,KAChCqE,EAAID,EAAKpE,GACTJ,EAAQyE,EAAE3E,QAAQ,KAClB4E,EAAsB,EAAR1E,EAAYyE,EAAE1E,UAAUC,GAAS,GAI/C2E,EAAgB,GADpB3E,GAFAyE,EAAY,EAARzE,EAAYyE,EAAE1E,UAAU,EAAGC,GAASyE,GAE9B3E,QAAQ,MACM2E,EAAE1E,UAAUC,GAAS,GAGpCN,SAFT+E,EAAY,EAARzE,EAAYyE,EAAE1E,UAAU,EAAGC,GAASyE,KAG7BvF,WAAS0F,WAAWH,EAAG,OAAQjE,oBAAoBiE,GAAG5D,WAChE2D,EAAKpE,GAAKqE,EAAI,MAAQE,EAAQD,MAI7BxE,EAAO2E,sBAEL,IAAIlD,KAAUzB,EAAO4E,qBACpBC,EAAa7E,EAAO4E,aAAanD,GAAQqD,QACzCC,EAAMtD,EAAOtB,OACTD,EAAI,EAAGA,EAAIoE,EAAKnE,OAAQD,IAAK,KAChCqE,EAAID,EAAKpE,GACTP,EAAc4E,EAAE3E,QAAQ,KACxBoF,EAAa,QACC,GAAfrF,IACFqF,EAAaT,EAAE1E,UAAU,EAAGF,EAAc,GAC1C4E,EAAIA,EAAE1E,UAAUF,EAAc,IAE5BX,WAAS0F,WAAWH,EAAG9C,GAAS,KAC9BwD,EAAMJ,EAAaN,EAAE1E,UAAUkF,GACnCT,EAAKpE,GAAK8E,EAAaA,EAAaC,EAAMA,KAO/C,SAASC,mBAAmBC,OACvBC,EAAKC,SAASC,qBAAqB,cACpCH,SAUKC,MATH,IAAIlF,EAAI,EAAGA,EAAIkF,EAAGjF,OAAQD,IAAK,KAC9BqF,EAASH,EAAGlF,GACZqC,EAAMgD,EAAOhD,OAEU,IAD3BA,EAAMA,EAAI1C,UAAU0C,EAAIhB,YAAY,OAC7B3B,QAAQuF,UACPI,YAQI,CACdrE,oBAAAA,oBACAmB,oBAAAA,oBACA/B,oBAAAA,oBACAmC,gBAAAA,gBACAK,eAAAA,eACAuB,oBAAAA,oBACA7E,SAAAA,SACA0F,mBAAAA,oBCvWKlG,WAAWT,SAAOS,SAClBwG,cAAgB,wCAChBC,iBAAmB,gDAGzB,SAASC,gBACJC,EAAY,GACZC,EAAY,GACZC,EAAS,YAoDJC,EAAUC,EAAGC,EAASC,EAAgBC,OAC1CF,EAAQD,KACXC,EAAQD,IAAK,EACbE,EAAeF,IAAK,EACpBG,EAAMjE,KAAK8D,GAERJ,EAAUI,YACRI,EAAQR,EAAUI,GACd7F,EAAI,EAAGA,EAAIiG,EAAMhG,OAAQD,IAAK,KACjCkG,EAAOD,EAAMjG,OACb8F,EAAQI,EAAKC,MAAQP,EAAUM,EAAKC,IAAKL,EAASC,EAAgBC,UAC9D,EACD,GAAGD,EAAeG,EAAKC,YAC7BH,EAAMjE,KAAKmE,EAAKC,MACT,SAKXJ,EAAeF,IAAK,OAtEhBO,QAAU,SAASC,EAAOF,GAC9BR,EAAOU,EAAQ,IAAMF,IAAO,EACxBV,EAAUY,KACbZ,EAAUY,GAAS,IAEhBX,EAAUW,KACbX,EAAUW,IAAS,GAEhBX,EAAUS,KACbT,EAAUS,IAAO,GAElBV,EAAUY,GAAOtE,KAAK,CACrBsE,MAAOA,EACPF,IAAKA,UAIFG,OAAS,SAASC,EAAMxB,UACrBY,EAAOY,EAAO,IAAMxB,SAGvByB,WAAa,SAASH,EAAOF,QAC5BC,QAAQC,EAAOF,OAChBH,EAAQhH,KAAKyH,iBACC,EAAfT,EAAM/F,QACRwF,EAAUY,GAAOzE,MAEXoE,QAGHS,QAAU,eACVX,EAAU,GACVC,EAAiB,OAEjB,IAAIjC,KAAK4B,EACZI,EAAQhC,IAAK,EACbiC,EAAejC,IAAK,MAGjBR,GAAM,EACN0C,EAAQ,OACR,IAAIO,KAAQb,KAEZE,EAAUW,EAAMT,EAASC,EAD5BC,EAAQ,IAC4C,CACnD1C,GAAM,eAIDA,EAAM0C,EAAQ,IA4BvB,SAASU,aAAalD,MACjBA,IAAO1E,WAAS6E,QAAQH,OAGxB,IAAIM,KAAKN,EACT1E,WAASU,SAASgE,EAAIM,MACxBN,EAAIM,GAAK,CAACN,EAAIM,KAYjB,SAAS6C,KAAKC,EAAKC,EAAMC,EAAQC,MAC7BH,KACCE,EAAQ,EACV,SAAS5H,EAAIU,QACTmH,EAAUnH,EAAQ,EAAIA,GAASgH,EAAI3G,SAStC4G,EAAKD,EAAIhH,GAAQA,EAAOgH,EANX,SAASlG,GAClBA,GAGHxB,EAAI6H,EAAUnH,EAAQ,EAAIA,EAAQ,MAIpCV,CAAI6H,EAAUH,EAAI3G,OAAS,EAAI,WAE5B8G,MACE,IAAI/G,EAAI4G,EAAI3G,OAAS,EAAQ,GAALD,IACC,IAAzB6G,EAAKD,EAAI5G,GAAIA,EAAG4G,GADgB5G,cAMhC,IAAIA,EAAI,EAAGA,EAAI4G,EAAI3G,SACM,IAAzB4G,EAAKD,EAAI5G,GAAIA,EAAG4G,GADW5G,MAWnC,SAASgH,iBAAiBC,EAAOC,UACzBA,GAAgB,GAGxB,SAASC,gBAAgB/C,EAAMgD,GAC3BtI,WAAS4E,WAAW0D,IACtBA,EACEC,WACAzC,QAAQU,cAAe0B,kBACvBpC,QAAQW,iBAAkB,SAAS0B,EAAOlC,GAC1CX,EAAKrC,KAAKgD,KAKd,IAAIuC,QAAU,KAEd,SAASC,0BACDD,cAGFE,YACL,WAAYC,gCACNA,IAAMA,QAIE,CACdC,UAAW,IAAIlC,UACfkB,aAAAA,aACAC,KAAAA,KACAQ,gBAAAA,gBACAI,iBAAAA,iBACAC,YAAAA,qCCvKGG,MACHtJ,OAAAA,UACGuJ,MCLEvJ,SAASwJ,MAAMxJ,OACfS,WAAWT,SAAOS,SAGxB,IACIgJ,SAASC,UAAUC,MAAQC,SAAqC,UAAzBC,QAAOD,QAAO,MACvDJ,MAAMlB,KAAK,CAAC,MAAO,OAAQ,OAAQ,QAAS,SAAU,MAAO,QAAS,UAAW,cAAe,SAACwB,OAC5FC,EAAON,SAASC,UAAUC,KAC9BC,QAAQE,GAAUC,EAAKlE,KAAK+D,QAAQE,GAASF,WAG9C,MAAMI,GACPhK,SAAO4J,QAAU,CAChBK,IAAK,aACLC,MAAO,aACPC,KAAM,cAIR,IAEKC,MAAMV,UAAUrI,UACnB+I,MAAMV,UAAUrI,QAAU,SAASgJ,EAAMC,OACpC,IAAI3I,OAAe9B,IAAXyK,EAAuB,EAAIA,EAAQ3I,EAAIhB,KAAKiB,OAAQD,OAC5DhB,KAAKgB,IAAM0I,SACN1I,SAGD,IAINyI,MAAMG,UACTH,MAAMG,QAAU,SAASR,EAAMS,OAC1B/J,WAAS6E,QAAQkF,SACd,IAAIvK,MAAM,aAAeuK,OAE5B,IAAI7I,EAAI,EAAGA,EAAI6I,EAAI5I,OAAQD,IAC9BoI,EAAKrG,KAAK8G,EAAI7I,WAERoI,IAGR,MAAMC,GACPJ,QAAQM,MAAMF,GAGf,SAAS7D,WAAW1C,EAAKgH,SACL,iBAAPhH,GAGkB,GAAvBA,EAAIpC,QAAQoJ,GAGpB,SAAS5I,SAAS4B,EAAKiH,MACH,iBAAPjH,SACJ,MAEJlC,EAAQkC,EAAIT,YAAY0H,UAChB,GAATnJ,GAAekC,EAAI7B,OAAS8I,EAAK9I,QAAUL,EAO/C,SAASoJ,cAAcC,EAAOC,OAAiBC,yCAC1CvJ,GAAS,KACVqJ,MACE,IAAIjJ,0DAHkC,IAGpB,EAAGA,EAAIiJ,EAAMhJ,OAAQD,OACvCmJ,MACCA,EAAQF,EAAMjJ,GAAIkJ,EAAKlJ,EAAGiJ,GAAQ,CACpCrJ,EAAQI,iBAINiJ,EAAMjJ,IAAMkJ,EAAK,CACnBtJ,EAAQI,eAOLJ,EAGR,SAASwJ,aAAaH,EAAOC,EAAKC,UAC1BH,cAAcC,EAAOC,EAAK,EAAGC,GAGrC,SAASE,iBAAiBJ,EAAOC,EAAKP,EAAQQ,UACtCH,cAAcC,EAAOC,EAAKP,EAAQQ,kBAG3B,CACd3E,WAAAA,WACAtE,SAAAA,SACAkJ,aAAAA,aACAC,iBAAAA,kBC7FKC,KAAO,GAITC,OAAS,gBACTC,OAAS,sCACTC,SAAW,mEACXC,QAAU,uBACVC,aAAe,kIACfC,aAAe,2GAuCfC,IACAC,OACAC,KACAC,IAxCJ,SAASC,EAAEC,UAEHA,EAAI,GACV,IAAMA,EACNA,EAGF,SAASC,oBACDnL,KAAKoL,UAkCb,SAASC,MAAMrH,UAOd2G,aAAaW,UAAY,EAClBX,aAAaY,KAAKvH,GACxB,IAAOA,EAAO4B,QAAQ+E,aAAc,SAASa,OACxCC,EAAIV,KAAKS,SACO,iBAANC,EACbA,EACA,OAAS,OAASD,EAAEE,WAAW,GAAGrD,SAAS,KAAKsD,OAAO,KACpD,IACL,IAAO3H,EAAS,IAGlB,SAASlB,IAAI8I,EAAKC,OAEb7K,EACA8K,EACAjF,EACA5F,EAEA8K,EADAC,EAAOnB,IAEPoB,EAAQJ,EAAOD,UAIlBK,GACiB,WAAjB/C,QAAO+C,IACiB,mBAAjBA,EAAMC,SAEbD,EAAQA,EAAMC,OAAON,IAMJ,mBAARZ,MACTiB,EAAQjB,IAAI9F,KAAK2G,EAAQD,EAAKK,YAKjBA,QACR,gBACGZ,MAAMY,OACT,gBAEGE,SAASF,GACfG,OAAOH,GACP,WAEG,cACA,cAIGG,OAAOH,OAIV,aAGAA,QACI,UAKRpB,KAAOC,OACPiB,EAAU,GAEoC,mBAA3CM,OAAOtD,UAAUV,SAAStI,MAAMkM,GAA6B,KAI/DhL,EAASgL,EAAMhL,OACXD,EAAI,EAAGA,EAAIC,EAAQD,GAAK,EAC3B+K,EAAQ/K,GAAK8B,IAAI9B,EAAGiL,IAAU,cAK/BpF,EAAuB,IAAnBkF,EAAQ9K,OACX,KACA4J,IAEC,MACAA,IACAkB,EAAQ9I,KAAK,MAAQ4H,KACrB,KACAmB,EACA,IAED,IAAMD,EAAQ9I,KAAK,KAAO,IAC3B4H,IAAMmB,EACCnF,KAILmE,KAAsB,WAAf9B,QAAO8B,SAChB/J,EAAS+J,IAAI/J,OACTD,EAAI,EAAGA,EAAIC,EAAQD,GAAK,EACN,iBAAXgK,IAAIhK,KAEb6F,EAAI/D,IADJgJ,EAAId,IAAIhK,GACGiL,KAEVF,EAAQhJ,KAAKsI,MAAMS,IACjBjB,IACD,KAAO,KACJhE,YAMHiF,KAAKG,EACLI,OAAOtD,UAAUuD,eAAepH,KAAK+G,EAAOH,KAC9CjF,EAAI/D,IAAIgJ,EAAGG,KAEVF,EAAQhJ,KAAKsI,MAAMS,IACjBjB,IACD,KACA,KACGhE,UASRA,EAAuB,IAAnBkF,EAAQ9K,OACX,KAAO4J,IACP,MAAQA,IAAMkB,EAAQ9I,KAAK,MAAQ4H,KAAO,KAAOmB,EAAO,IACxD,IAAMD,EAAQ9I,KAAK,KAAO,IAC3B4H,IAAMmB,EACCnF,GA7K0B,mBAA1B0F,KAAKxD,UAAUmD,SAExBK,KAAKxD,UAAUmD,OAAS,kBAChBC,SAASnM,KAAKoL,WAEnBpL,KAAKwM,iBACL,IACAvB,EAAEjL,KAAKyM,cAAgB,GACvB,IACAxB,EAAEjL,KAAK0M,cACP,IACAzB,EAAEjL,KAAK2M,eACP,IACA1B,EAAEjL,KAAK4M,iBACP,IACA3B,EAAEjL,KAAK6M,iBACP,IAED,MAGFC,QAAQ/D,UAAUmD,OAASf,WAC3B4B,OAAOhE,UAAUmD,OAASf,WAC1BiB,OAAOrD,UAAUmD,OAASf,YA2JE,mBAAnBb,KAAK0C,YACdjC,KAAO,MACA,WACA,WACA,WACA,WACA,UACA,WACA,QAEPT,KAAK0C,UAAY,SAASf,EAAOgB,EAAUC,OAQtClM,KAEJ8J,OADAD,IAAM,GAIc,iBAAVqC,MACLlM,EAAI,EAAGA,EAAIkM,EAAOlM,GAAK,EAC1B8J,QAAU,QAKe,iBAAVoC,IAChBpC,OAASoC,OAMVlC,IAAMiC,IAC6B,mBAAbA,IACA,WAApB/D,QAAO+D,IACoB,iBAApBA,EAAShM,cAEX,IAAI3B,MAAM,yBAMVwD,IAAI,GAAI,IACVmJ,MAOkB,mBAAf3B,KAAK6C,QACd7C,KAAK6C,MAAQ,SAASC,KAAMC,aAGvBC,WAEKC,KAAK1B,EAAQD,OAGjBE,EACAjF,EACAoF,EAAQJ,EAAOD,MAChBK,GAA0B,WAAjB/C,QAAO+C,OACdH,KAAKG,EACLI,OAAOtD,UAAUuD,eAAepH,KAAK+G,EAAOH,UAErC5M,KADT2H,EAAI0G,KAAKtB,EAAOH,IAEfG,EAAMH,GAAKjF,SAEJoF,EAAMH,WAKVuB,QAAQnI,KAAK2G,EAAQD,EAAKK,MAMlCmB,KAAOhB,OAAOgB,MACdxC,aAAaU,UAAY,EACtBV,aAAaW,KAAK6B,QACpBA,KAAOA,KAAKxH,QAAQgF,aAAc,SAASY,SAEzC,OACC,OAASA,EAAEE,WAAW,GAAGrD,SAAS,KAAKsD,OAAO,MAmBjDpB,OAAOgB,KACN6B,KACCxH,QAAQ4E,OAAQ,KAChB5E,QAAQ6E,SAAU,KAClB7E,QAAQ8E,QAAS,YAQnB4C,EAAIE,KAAK,IAAMJ,KAAO,KAII,mBAAZC,QACbE,KAAK,IACAD,GACF,IAAMA,QAGL,IAAIG,YAAY,gBChVxB,IAAMpO,SAASwJ,MAAMxJ,OACfS,WAAWT,SAAOS,SASxB,SAAS4N,OAAOC,OACXC,EAAK,IAAMC,UAAS,IAAItB,MAAOuB,UAAY,KAAQ,IAAMD,SAAyB,IAAhBE,KAAKC,UAAmB,IAAMnF,MAAMN,+BAC5FrJ,IAAXyO,IACFC,GAAMD,GAEAC,EAGR,SAASK,OAAOC,sBAEVxM,GAA2B,EAAtB5B,WAASqO,YAAkBrO,WAASqO,WAAa,EAAIX,KAAK,IAAMU,aAAe,QAAUV,KAAK,IAAMU,aAAe,YACrHxM,GACN,MAAM2H,SACDA,GASR,SAAS+E,YAAYtL,EAAKuL,MACd,KAARvL,GAAAA,MAAcA,IAAsChD,WAASU,SAASsC,UACjEA,EAGRuL,EAASvO,WAASwO,OAAO,CACxBC,QAAS,GACTC,MAAO,GACPC,SAAU,iBACRJ,OAECK,EAAQ,GACRC,EAAW,EACX1B,OAAW/N,KACZmP,EAAOE,SAAWF,EAAOG,MAAO,QACtB,KACPI,EAAa9L,EAAIpC,QAAQ2N,EAAOE,QAASI,GACzCE,EAAW/L,EAAIpC,QAAQ2N,EAAOG,OAAsB,GAAfI,EAAmBD,EAAWC,EAAaP,EAAOE,QAAQtN,YACjF,GAAf2N,IAAiC,GAAbC,QAEhB,IAAkB,GAAfD,EAAkB,CAC3B3F,QAAQO,KAAK,aAAe6E,EAAOG,MAAQ,mBAAqBH,EAAOE,eAEjE,IAAgB,GAAbM,EAAgB,CACzB5F,QAAQO,KAAK,eAAiB6E,EAAOE,QAAU,iBAAmBF,EAAOG,iBAGtEM,EAAO,MAAQpB,SAAW,MAC1BqB,EAAQjM,EAAInC,UAAUiO,EAAaP,EAAOE,QAAQtN,OAAQ4N,GAAUG,WACpElP,WAAS0F,WAAWuJ,EAAO,kBACxB,kBAAoBA,MAG1BjM,EAAMA,EAAInC,UAAU,EAAGiO,GAAc,IAAME,EAAO,IAAMhM,EAAInC,UAAUkO,EAAWR,EAAOG,MAAMvN,YAC1FgO,EAAKnP,WAASmO,OAAOc,GACzBL,EAAMI,GAAQG,EACb,MAAM5F,SACPJ,QAAQM,MAAMwF,GACR1F,EAEPsF,EAAWC,EAAaE,EAAK7N,OAE9BgM,EAAW,SAASrB,EAAKpM,UACrBM,WAASU,SAAShB,IAAQkP,EAAMlP,GAC3BkP,EAAMlP,GAENA,GAKP6O,EAAOI,WAET3L,GADAA,EAAMA,EAAI8C,QAAQ,aAAc,OACtBA,QAAQ,IAAIlC,OAAO2K,EAAOI,SAAW,iBAAkB,KAAM,gBAIzDS,KACC/B,MAAMrK,EAAKmK,GACzB,MAAM5D,WAEF8F,EAAM,IAAIzL,OAAO,oCAClB2F,EAAE+F,SAAWD,EAAI5D,KAAKlC,EAAE+F,SAAU,KAChCC,EAAShG,EAAE+F,QAAQzO,UAAU0I,EAAE+F,QAAQ/M,YAAY,YAAc,GACjEiN,EAAMzB,SAASwB,EAAOL,QACtBO,EAAOzM,EAAInC,UAAU2O,GACzBrG,QAAQM,MAAMF,EAAE+F,QAAU,IAAMG,EAAK5O,UAAU,EAAiB,IAAd4O,EAAKtO,OAAe,IAAMsO,EAAKtO,UAEjF,MAAMuO,GACPvG,QAAQO,KAAKgG,SAERnG,GAIR,SAASoG,cAAcjL,UACR0K,KACClC,UAAUxI,GA1GtB4H,OAAOrD,UAAUiG,OACpB5C,OAAOrD,UAAUiG,KAAO,kBAChBhP,KAAK4F,QAAQ,SAAU,IAAIA,QAAQ,SAAU,MA2GtD,IAAM5D,sBAAsB6G,MAAM7G,oBAElC,SAAS0N,aAAaC,OAASC,gEAC3B9P,WAAS8E,SAAS+K,UACbA,MAMJ/O,GAHH+O,EADGA,GACOrO,SAASuO,QAGAnP,QAAQ,QAChB,GAATE,EACF+O,EAAUA,EAAQhP,UAAUC,EAAQ,WAEjCiI,MAAMzH,oBAAoBuO,GAASlO,eAC9B,GAIG,IADZb,EAAQ+O,EAAQtN,YAAY,QAE3BsN,EAAUA,EAAQhP,UAAU,EAAGC,YAK/BkP,EAFGC,EAAM,GACTC,EAAML,EAAQhN,MAAM,KAEb3B,EAAI,EAAGA,EAAIgP,EAAI/O,OAAQD,IAAK,IAC/BgP,EAAIhP,GAGR8O,EAAIE,EAAIhP,GAAG2B,MAAM,KAEjBoN,EADWH,EAASK,mBAAmBH,EAAE,IAAMA,EAAE,IACrCF,EAASK,mBAAmBH,EAAE,IAAMA,EAAE,UAE5CC,EAGR,SAAS7M,eAAeM,EAAK0M,MACzB1M,MAAAA,IAAsC0M,SACjC1M,MAGJ5C,EAAQ4C,EAAInB,YAAY,KACxB8N,EAAY3M,EAAInB,YAAY,KAC7B8N,EAAY,IACdA,EAAY3M,EAAIvC,YAEbmP,EAAYxP,EAAQ,EAAI,GAAK8O,aAAalM,EAAI7C,UAAUC,EAAQ,EAAGuP,IAAY,GAC/EE,EAAYX,aAAaQ,GAAS,GAClC5L,GAAM,MACN,IAAIwH,KAAKuE,EACTD,EAAUtE,IAAMuE,EAAUvE,KAC5BsE,EAAUtE,GAAKuE,EAAUvE,GACzBxH,GAAM,OAGJA,SACId,MAGJ8M,EAAY,OACZ,IAAIxE,KAAKsE,EACZE,EAAUvN,KAAK+I,GAEhBwE,EAAUC,eAENhQ,EAAOK,EAAQ,EAAI4C,EAAI7C,UAAU,EAAGwP,GAAa3M,EAAI7C,UAAU,EAAGC,GAClE4P,EAAS,GAELxP,EAAI,EAAGA,EAAIsP,EAAUrP,OAAQD,IAAK,KACrC8K,EAAIwE,EAAUtP,GAClBwP,EAAOzN,KAAK+I,EAAI,IAAMsE,EAAUtE,IAEjC0E,EAASA,EAAOvN,KAAK,SACjBwN,EAAO,UACK,GAAbN,GAAkBA,EAAY3M,EAAIvC,SACpCwP,EAAOjN,EAAI7C,UAAUwP,IAEf5P,GAAQiQ,EAAS,IAAMA,EAAS,KAAOC,GAAc,IAI7D,SAASC,sBAAsBf,EAASC,UAChCF,aAAaC,EAASC,cAGf,CACdlC,OAAAA,OACAO,OAAAA,OACAG,YAAAA,YACAqB,cAAAA,cACAzN,oBAAAA,sBACAkB,eAAAA,eACAwN,sBAAAA,uBClNKC,QAAUtE,OAAOtD,UAAUV,SAEjC,SAAS1D,QAAQiM,UACTA,GAAOA,aAAcnH,OAA+B,mBAArBkH,QAAQzL,KAAK0L,GAGpD,SAASlM,WAAWkM,UACZA,GAAoB,mBAANA,GAA0C,sBAArBD,QAAQzL,KAAK0L,GAGxD,SAAShM,SAASgM,UACdA,MAAAA,IAGiB,UAAb1H,QAAO0H,IAAwC,oBAArBD,QAAQzL,KAAK0L,IAG/C,SAASpQ,SAASoQ,UACVA,GAAoB,iBAANA,GAAwC,oBAArBD,QAAQzL,KAAK0L,GAGtD,SAASC,OAAOD,UACRA,GAAOA,aAAcrE,MAA8B,kBAArBoE,QAAQzL,KAAK0L,GAGnD,SAASE,SAASF,UACVA,GAAOA,aAAclN,QAAgC,oBAArBiN,QAAQzL,KAAK0L,UAGtC,CACdjM,QAAAA,QACAD,WAAAA,WACAE,SAAAA,SACApE,SAAAA,SACAqQ,OAAAA,OACAC,SAAAA,UCjCKzR,SAASwJ,MAAMxJ,OACfS,WAAWT,SAAOS,SAExB,SAASiR,WAAWxJ,EAAMyJ,EAAYC,OACjCpB,KACDoB,EAAW,KACTrQ,EAAQqQ,EAAUvQ,QAAQ,KAC3BE,EAAQ,EACVA,EAAQ,EAERA,GAAS,EAEViP,EAASoB,EAAUC,OAAOtQ,QAE1BiP,EAAS1Q,OAAOmC,SAASuO,OAAOqB,OAAO,OAGpC/B,EAAM,IAAIzL,OAAO,QAAU6D,EAAO,iBAClC4J,EAAItB,EAAO5H,MAAMkH,UACb,MAALgC,EAAkBlB,mBAAmBkB,EAAE,SACpBjS,IAAf8R,EAA2BA,EAAa,KAGhD,SAASI,OAAOC,EAAaC,EAAYC,MACrCA,IAAmB1I,MAAMzH,oBAAoBmQ,GAAgB9P,eACzD,IAAInC,MAAM,yBAA2BiS,QAE1BrS,IAAfoS,IACFA,GAAa,OAIV9N,EAFA3C,EAAYf,WAASgB,SACrB0Q,EAAa1R,WAAS2R,iBAGzBjO,OADkBtE,IAAhBmS,EACIG,EACG1R,WAAS0F,WAAW6L,EAAa,MAAQxI,MAAMzH,oBAAoBiQ,GAAa5P,SACnFoH,MAAM7G,oBAAoBuP,GAAkBC,EAAYH,GAExDxQ,EAAU6Q,QAAUL,EAExBC,GACC9N,GAAOgO,IACThO,GAAOlC,SAASuO,OAASvO,SAASmP,MAE5B5P,EAAU8Q,QAAQ,GAAInO,IAEtBA,EAIT,SAASoO,QAAQ1R,EAAK2R,EAAezI,EAAM0I,OACtCpQ,MAEH0H,OAAgBlK,IAATkK,EAAqBpJ,KAAOoJ,EACnC1H,EAAKxB,EAAIgF,KAAKkE,GACb,MAAMC,GACJvJ,WAAS4E,WAAWoN,GACtBA,EAAWzI,GAEXJ,QAAQO,KAAKH,UAGZ3H,MAAAA,IACFA,EAAKmQ,GAECnQ,EAGR,SAASqQ,eAAevN,EAAKV,UACrB+E,MAAMjF,eAAeY,EAAKV,GAGlC,SAASwK,OAAO0D,OACX,IAAIhR,EAAI,EAAGA,EAAIf,UAAUgB,OAAQD,IAAK,KACrCwD,EAAMvE,UAAUe,MAChBwD,MAGA,IAAIM,KAAKN,EAAK,MAEJtF,IADDsF,EAAIM,KAIhBkN,EAAOlN,GAAKN,EAAIM,YAGXkN,EAGR,SAASC,WAAWD,OACfA,SACIA,MAEJ,IAAIhR,EAAI,EAAGA,EAAIf,UAAUgB,OAAQD,IAAK,KACrCwD,EAAMvE,UAAUe,MAChBwD,MAIA,IAAIM,KAAKN,EAAK,KACbyH,EAAQzH,EAAIM,QACH5F,IAAV+M,IAGAnM,WAAS8E,SAASqH,IAAUnM,WAAS8E,SAASoN,EAAOlN,IACvDkN,EAAOlN,GAAKhF,WAASmS,WAAWD,EAAOlN,GAAImH,GAE3C+F,EAAOlN,GAAKN,EAAIM,YAIZkN,EAGR,SAASE,WAAWC,OACf/I,EAAOpJ,KACPoS,EAAQ,EACRC,EAAkB,QAyCjBC,SAAW,SAASlK,EAAU5D,OAC9B+N,EACAC,EAAS,CACZC,KAAM,SAASC,EAAcC,UAC5BJ,EAAYG,aAAa3P,KAAK,CAC7BqF,SAAUsK,EACVC,WAAYA,IAEN3S,uBA/CgBuS,OACrBK,EAAYR,EAAQ,OACpBC,EAAgBO,GAAY,KAC3BC,EAAe,WAClBT,QACIU,EAAiBT,EAAgBO,cAC9BP,EAAgBO,GACjBE,EAAe7R,QAAQ,KACxBsR,EAAcO,EAAeC,QAC7BJ,OAAazT,MAEbqT,EAAYnK,WACduK,EAAaJ,EAAYnK,SAASlD,KAAKqN,EAAYC,OAAQD,EAAY/N,IAAKoO,IAE5E,MAAMvJ,GACPJ,QAAQM,MAAMF,WAEXmJ,SACED,EAAYG,aAAazR,QAAQ,KAClC+R,EAAUT,EAAYG,aAAaK,QACnCP,EAGHA,EAAOC,KAAKO,EAAQ5K,UAFpBoK,EAASpJ,EAAKkJ,SAASU,EAAQ5K,SAAUuK,MAO7CN,EAAgBO,GAAa,IACzBT,GAAY9S,SAAO4T,SAAW5T,SAAO4T,QAAQC,QAChD7T,SAAO4T,QAAQC,UAAUC,KAAKN,GAE9BO,WAAWP,EAAc,GAGfR,EAAgBO,GACtB7P,KAAKwP,GAqBXc,CAPAd,EAAc,CACbnK,SAAUA,EACV5D,IAAKA,EACLkO,aAAc,GACdF,OAAQA,IAKFA,GAIT,IAAMc,aAAe,IAAIpB,WACnBqB,oBAAsB,IAAIrB,YAAW,GAEvCsB,UAAY,SAASpL,EAAU+J,UAC/BA,EACKoB,oBAAoBjB,SAASlK,GAE7BkL,aAAahB,SAASlK,IAS/B,SAAShE,cAAcI,EAAKiP,EAAWC,MAClClP,GAAQiP,WAGRE,EAAQF,EAAU9Q,MAAM,KACxBjB,EAAKgS,EACL1S,EAAI,EACFA,EAAI2S,EAAM1S,QAAUuD,EAAKxD,IAAK,CAEnCwD,EAAMA,EADEmP,EAAM3S,WAGZA,GAAK2S,EAAM1S,SACbS,EAAK8C,GAGC9C,GAQR,SAASkS,cAAcpP,EAAKiP,EAAWxH,WAClC4H,EAAOrP,EACPmP,EAAQF,EAAU9Q,MAAM,KAEpB3B,EAAI,EAAGA,EAAI2S,EAAM1S,OAAQD,IAAK,KACjC8K,EAAI6H,EAAM3S,MAEXA,GAAK2S,EAAM1S,OAAS,EAAG,CACzBuD,EAAIsH,GAAKG,YAGN6H,EAAItP,EAAIsH,GACRgI,IACHA,EAAI,GACJtP,EAAIsH,GAAKgI,GAEVtP,EAAMsP,SAEAD,EAGR,SAASE,MAAMvP,EAAKwP,OAEfxP,GAAO1E,WAAS4E,WAAWF,IAAQ1E,WAASU,SAASgE,GAAM,OAAOA,KAEnE1E,WAASgR,SAAStM,UACb,IAAId,OAAOc,EAAIyP,OAAQzP,EAAI0P,UAIhCpU,WAAS+Q,OAAOrM,GAAM,KACpB2P,EAAO,IAAI5H,YACf4H,EAAKC,QAAQ5P,EAAIsJ,WACVqG,KAGLrU,WAAS6E,QAAQH,IAAQ1E,WAAS8E,SAASJ,GAAM,KAC/C2P,EAAOrU,WAAS6E,QAAQH,GAAO,GAAK,OACpC,IAAI6P,KAAQ7P,EACZA,EAAI8H,eAAe+H,KACrBF,EAAKE,GAAQL,EAASD,MAAMvP,EAAI6P,IAAS7P,EAAI6P,WAExCF,SAED3P,WAGO,CACduM,WAAAA,WACAK,OAAAA,OACAQ,QAAAA,QACAG,eAAAA,eACAzD,OAAAA,OACA2D,WAAAA,WACAuB,UAAAA,UACApP,cAAAA,cACAwP,cAAAA,cACAG,MAAAA,OCtRK1U,SAASwJ,MAAMxJ,OACfS,WAAWT,SAAOS,SAEpBwU,MAAgC,gCAAhBC,gCAAAA,cACnB,SAAS/P,UACDA,GAAQA,aAAe+P,aAE/B,SAAS/P,UACDA,GAAsB,WAAf0E,QAAO1E,IAAqC,IAAjBA,EAAIgQ,UAA0C,iBAAjBhQ,EAAIiQ,UAGxEC,WAAc,eACbC,GAAgB,EAChBC,EAAiB,YAEZC,EAAUzM,MACfuM,EACFvM,aAaIlI,EAVD4U,GAAU,KASX3O,SAAS4O,iBAEX7U,EAAM,WACLiG,SAAS6O,oBAAoB,mBAAoB9U,GACjD+U,KAED9O,SAAS4O,iBAAiB,mBAAoB7U,QAExC,GAAGiG,SAAS+O,YAAa,KAG3BhV,EAWAiV,EAVJjV,EAAM,WACsB,aAAxBiG,SAASiP,aACXjP,SAASkP,YAAY,qBAAsBnV,GAC3C+U,MAGF9O,SAAS+O,YAAY,qBAAsBhV,GAK3CiV,EAAO,eACHL,OAIF3O,SAASmP,gBAAgBC,SAAS,QACjC,MAAMhM,eACP6J,WAAW+B,EAAM,GAIlBF,MAGE9O,SAASmP,gBAAgBC,eAA2C,IAAxBlW,SAAOmW,cAA8BL,SAEpFrV,WAAS0T,UAAU,MAAM,GAAMf,KAAK,WACnCwC,WAGGQ,UAAYR,WAlDRA,IACLH,IAEHH,EADAG,GAAU,EAEV1M,MAgDY,SAAVsN,EAAmBtN,GACK,aAAxBjC,SAASiP,aACXT,GAAgB,OAEbgB,EAAK,IAAId,EAAUzM,GACnBuM,GACHC,EAAe7R,KAAK4S,IAGtBD,EAAQ,WACPf,GAAgB,IAGU,aAAxBxO,SAASiP,YACXT,GAAgB,GAGbtV,SAAO0V,iBACQ,SAASa,EAAMxN,GAC/B/I,SAAO0V,iBAAiBa,EAAMxN,GAAU,IAEhC/I,SAAO6V,YACC,SAASU,EAAMxN,GAC/B/I,SAAO6V,YAAY,KAAOU,EAAMxN,IAGhB,SAASwN,EAAMxN,GAC/BtI,WAAS0T,UAAU,MAAM,GAAMf,KAAK,WACnCrK,QAIY,OAAQ,eACtBuM,GAAgB,EACVC,EAAe3T,QACpB2T,EAAe7B,QAAQ0C,qBAInBC,EAtGU,WAyGH,CACdpB,MAAAA,MACAoB,QAAShB,YC9GJrV,SAASwJ,MAAMxJ,OACfS,WAAST,SAAOS,SAElB+V,2BACAC,cACAlN,QAEJ,IAAI,IAAIkD,KAAK+J,SACZ/V,WAASgM,GAAK+J,SAAS/J,GACvBzM,SAAOyM,GAAK+J,SAAS/J,GAGtB,IAAIiK,6BACAC,MACAC,QACAC,SACHC,eAAgB,KAIjB,IAAI,IAAIrK,MAAKiK,WACZjW,WAASgM,IAAKiK,WAAWjK,IC9B1B,IAAMzM,SAASwJ,MAAMxJ,OACf+W,cAAgB,GAEhBC,UAIL,WAAYhT,uJACNA,IAAMA,OACNiT,QAAU,QACVC,cAAgB,MAIvB,SAASC,UAAUC,GAClBA,EAAY5N,MAAMtF,gBAAgBkT,OAK7BC,EAJDC,EAAQ,qBAAqBpL,KAAKkL,GAElCG,EAAYR,cAAcK,UAC3BG,IAGDF,EADEC,EACOC,EAAUL,cAEVK,EAAUN,QAAQG,IAEZC,EAAOjX,MAEhB,KAST,SAASoX,iBAAiBC,EAAQJ,OAC7BE,EAAYR,cAAcU,OAC1BF,QACG,IAAItX,MAAM,wBAA0BwX,GACpC,GAAGV,cAAcM,EAAOrT,WACxB,IAAI/D,MAAM,6BAA+BoX,EAAOrT,KAEtDuT,EAAUvT,IAAMqT,EAAOrT,WAChB+S,cAAcU,GACrBV,cAAcM,EAAOrT,KAAOuT,EAI9B,SAASG,sBAAsB1T,OAC1BuT,EAAYR,cAAc/S,MAC3BuT,IAAcA,EAAUL,cAAe,IACtCK,EAAUL,oBACN,IAAIjX,MAAM,wBAA0B+D,OAEtC,IAAIyB,KAAK8R,EAAUN,cAChB,IAAIhX,MAAM,wBAA0B+D,UAGrC+S,cAAc/S,IASvB,SAAS2T,UAAUzP,EAAMmP,OACpBrT,EAAMqT,EAAOrT,QACbA,QACG,IAAI/D,MAAM,4BAEbsX,EAAYR,cAAc/S,MAC3BuT,KACCrP,EAAM,IACL6O,cAAc7O,IAAS6O,cAAc7O,IAASqP,QAC1C,IAAItX,MAAM,kCAAoCiI,EAAO,gBAAkBlE,EAAM,iBAAmB+S,cAAc7O,GAAMlE,KAE1HuT,EAAUN,QAAQ/O,GAAQmP,EAC1BN,cAAc7O,GAAQqP,MAEjB,IAEHA,EAAUL,eAAiBK,EAAUL,eAAiBG,QAClD,IAAIpX,MAAM,qCAAuC+D,GAEvDuT,EAAUL,cAAgBG,UAI5BE,EAAY,IAAIP,UAAUhT,GAC1B+S,cAAc/S,GAAOuT,EAClBrP,EAAM,IACRqP,EAAUN,QAAQ/O,GAAQmP,EACvBN,cAAc7O,SACV,IAAIjI,MAAM,kCAAoCiI,EAAO,gBAAkBlE,EAAM,iBAAmB+S,cAAc7O,GAAMlE,KAE1H+S,cAAc7O,GAAQqP,OAIvBA,EAAUL,cAAgBG,gBAKd,CACdF,UAAAA,UACAQ,UAAAA,UACAH,iBAAAA,iBACAE,sBAAAA,uBC9GK1X,SAASwJ,MAAMxJ,OACfS,WAAWT,SAAOS,SAClBmX,kBAAoB,iBACpBC,aAAe,GAErB,SAASC,aAAa3S,OACjB4S,EAAU5S,EAAG,KACbkS,EAASlS,EAAIkS,QAAUlS,EACvBoJ,EAAK9N,WAAS4N,SAClB0J,EAAQC,MAAQ,kBACRzJ,GAERwJ,EAAQhG,OAAS,SAASC,EAAaC,EAAYC,MAC/CA,IAAmB1I,MAAMzH,oBAAoBmQ,GAAgB9P,eACzD,IAAInC,OAAO,EAAG,yBAA2BiS,OAK5C/N,cAHctE,IAAfoS,IACFA,GAAa,GAIb9N,OADkBtE,IAAhBmS,EACIrR,KAAKsX,iBACFxX,WAAS0F,WAAW6L,EAAa,MAAQxI,MAAMzH,oBAAoBiQ,GAAa5P,SACnFoH,MAAM7G,oBAAoBuP,GAAkBvR,KAAKuX,OAAQlG,GAEzDvR,WAASgB,SAAS4Q,QAAUL,EAEhCC,GACC9N,GAAO6C,OAAOmL,aAChBhO,GAAOlC,SAASuO,OAASvO,SAASmP,MAE5B3Q,WAASgB,SAAS6Q,QAAQ+E,EAAQlT,IAElCA,GAGT4T,EAAQI,QAAU,kBACT1X,WAAS0X,QAAQzX,MAAMqX,EAASnX,YAGzCmX,EAAQK,OAAS,kBACR3X,WAAS2X,OAAO1X,MAAMqX,EAASnX,YAGxCmX,EAAQG,KAAO,SAASG,UAChBA,GAAgBA,EAAaC,QAAU3X,KAAK2X,UAAY3X,KAAKsX,kBAErEF,EAAQQ,YAAc,kBACb5X,KAAKyX,OAAO1X,MAAMC,KAAMC,YAGjCmX,EAAQS,WAAa,SAASF,OACzBG,EAAY,CACfpB,OAAQA,EACRrT,IAAKsU,EACLA,OAAQA,EACRpQ,KAAM6P,EAAQW,UACdX,QAASA,EAAQA,kBAElBU,EAAU1O,KAAO,IAAI/C,OAAO2R,QAAQF,GACpCX,aAAaW,GACNA,EAAU1O,MAMnB,SAAS6O,kBAAkBvB,EAAQwB,EAAaC,EAAcC,OACzDC,EAAiB,CACpBF,aAAcA,EACdG,SAAUJ,EACVK,SAAU,KACVC,YAAa,0BAET9B,EAAO+B,kBAGNjU,EAAMxE,KAAK0Y,QACXtB,EAAUpX,KAAKsY,SAEfK,EAAc,SAACC,UAClBA,EAAOC,UAAYzB,EAChBwB,EAAOL,WACTK,EAAOE,UAAYF,EAAOE,WAAa,GACvCF,EAAOE,UAAU/V,KAAK6V,EAAOL,WAE9BK,EAAOL,SAAWQ,EAAKR,SAChBK,GAGJI,EAAkC,SAAvBtC,EAAOuC,gBAEnBnZ,WAAS8E,SAASJ,GAAM,IACvBkS,EAAOwC,aAAeF,QAClB,IAAI1Z,MAAM,6CAA+CoX,EAAOyC,oBAElET,QAAUC,EAAYK,EAAWxU,EAAM1E,WAASiU,MAAMvP,SAClD1E,WAAS4E,WAAWF,UACxBkU,QAAUC,EAAYnU,MAI7BkU,QAAS,KACTU,uBAAwB,SAAS5U,QAC3BkU,QAAUlU,OACVgU,eAEN9B,OAAQA,EACR2C,aAAc,kBACNrZ,KAAK0Y,SAEbY,WAAY,uBACNF,uBAAuB,IACrBpZ,KAAK0Y,SAEba,aAAc,SAASnB,UACnBpY,KAAK0Y,QAAQc,YACRxZ,KAAK0Y,QAAQc,YAAYtU,KAAKlF,KAAKoJ,KAAMgP,GAExCpY,KAAKsY,SAASlH,UAGxBqI,WAAY,SAASrB,EAAYsB,UAC7B1Z,KAAK0Y,QAAQiB,WACR3Z,KAAK0Y,QAAQiB,UAAUzU,KAAKlF,KAAKoJ,KAAMgP,EAAYsB,IAI5DE,uBAAwB,SAASxB,OAC5BxK,EAAK5N,KAAKuZ,aAAanB,UACpBpY,KAAK0W,OAAOkD,uBAAuBhM,EAAIwK,IAE/CyB,sBAAuB,SAASzB,EAAY5T,OACvCoJ,EAAK5N,KAAKuZ,aAAanB,GACvBuB,EAAY3Z,KAAKyZ,WAAWrB,EAAY5T,UACrCxE,KAAK0W,OAAOmD,sBAAsBF,EAAW/L,EAAIwK,EAAY5T,IAErEsV,KAAM,SAASC,cACV5B,EAAenY,KAAKmY,qBACnBI,SAAWvY,KAAK0W,OAAOsD,aAAaha,WACpCoZ,uBAAuBpZ,KAAK0W,OAAOwC,YAAclZ,KAAK0W,OAAO2C,mBAChDna,IAAfkZ,EAA0B,KACxBpY,KAAK0Y,cACF,IAAIpZ,MAAM,gBAAkBU,KAAK0W,OAAOyC,uBAElBja,IAA1Bc,KAAK0Y,QAAQM,gBACVN,QAAQM,UAAW,GAEtBe,IAAkB/Z,KAAK0Y,QAAQM,eAC3B,IAAI1Z,MAAM,8BAGb2a,GAAc,EACdC,EAAS,SAAClX,EAAQyV,GACRvZ,MAAV8D,IACFA,EAAS,CACRmX,WAAW,IAGbF,GAAc,EACXG,EAAK1B,QAAQM,UACfoB,EAAKP,sBAAsBzB,EAAY,CACtCpV,OAAQA,EACRyV,aAAcA,IAGhB2B,EAAK1D,OAAO+B,kBAAgCvZ,IAAjBuZ,GAA8BA,EACzD2B,EAAKhB,uBAAuBpW,GAC5BmV,EAAaiC,IAEVC,EAAU,SAAC5R,GACdwR,GAAc,EACd9B,EAAaiC,EAAM,IAAIta,WAAS0I,YAAYC,IAAO,KAEhD6R,EAAO,CAAClC,EAAY8B,EAAQG,EAASva,WAASgB,UAAUyZ,OAAOva,KAAK0W,OAAO8D,oBAE1Ed,KACD1Z,KAAK0Y,QAAQM,eAAwE9Z,KAA3Dwa,EAAc1Z,KAAK4Z,uBAAuBxB,IAA4B,KAC9FqC,EAAOf,EACXQ,EAAOO,EAAKzX,OAAQyX,EAAKhC,wBAEpBC,QAAQgC,WAAW3a,MAAMC,KAAKoJ,KAAMkR,GAEzC,MAAMjR,GACPJ,QAAQO,KAAKH,GACbgR,EAAQhR,GAEL4Q,GACH7G,WAAW,WACN6G,GACHhR,QAAQO,KAAK,iCAAmClI,SAASC,KAAO,WAAamV,EAAOiE,SAAW,IAAMvC,IAEpE,IAAhCtY,WAASgB,SAAS8Z,kBAGtBzC,EAAanY,QAMZ8X,EAAY,CACfpB,OAAQA,EACRrT,IAAKqT,EAAOtN,KAAKkO,iBACjBK,OAAQjB,EAAOtN,KAAKuO,SACpBpQ,KAAMmP,EAAOtN,KAAK2O,UAClBX,QAASiB,EAAeC,iBAEzBD,EAAejP,KAAO,IAAI/C,OAAO2R,QAAQF,GAEzCX,aAAakB,GACNA,EAGR,SAASwC,WAAWtT,EAAMlE,EAAKsU,EAAQO,EAAa9P,GACnD/E,EAAMwF,MAAMtF,gBAAgBF,OACxBqU,EAAe,IAAIrR,OAAOyU,aAAazX,EAAK,KAAM,CAACkE,EAAM,KAAMa,IAAW,UAC9EsP,EAAaQ,YAAcA,EAC3BR,EAAalF,OAAS,CACrBmF,OAAQA,GAEFoD,UAAUrD,GAgBlB,SAASqD,UAAUrD,OAEdsD,EAAY,GACZlD,EAAY,CACflK,GAAI/E,MAAMN,mBACVoS,SAAUjD,EAAaiD,SACvBxB,6BACQ,aAAenZ,KAAK2a,UAAY,IAAM,QAAU3a,KAAKqD,KAE7D+B,KAAMsS,EAAatS,MAAQ,GAC3B6V,MAAO,GACPC,iBAAahc,EACbic,kBAAmB,EACnB1C,cAAc,EACd+B,WAAY,KACZnX,IAAKqU,EAAarU,IAClBsU,OAAQD,EAAa0D,gBACrBhT,SAAUsP,EAAatP,SACvBiT,cAAe,KACfhC,kBAAcna,EACdga,gBAAYha,EACZkY,QAASM,EAAaQ,YACtBe,aAAc,SACdqC,yBAAgBrC,QACVA,aAAeA,GAErBsC,oBAAqB,GACrB3B,gCAAuBhM,EAAIwK,MACvBpY,KAAKub,oBAAoB3N,UACpB5N,KAAKub,oBAAoB3N,GAAIwK,IAGtCyB,+BAAsBF,EAAW/L,EAAIwK,EAAY5T,GAC7CmV,GACE3Z,KAAKub,oBAAoB3N,UACvB2N,oBAAoB3N,GAAM,SAE3B2N,oBAAoB3N,GAAIwK,GAAc5T,GAExCxE,KAAKub,oBAAoB3N,WACpB5N,KAAKub,oBAAoB3N,GAAIwK,IAIvCoD,gBAAOlB,MACuB,GAA1Bta,KAAKmb,kBAAwB,SAC3BM,EAAc,GACVza,EAAIhB,KAAKmb,kBAAmBna,EAAIsZ,EAAKrZ,OAAQD,IACpDya,EAAY1Y,KAAKuX,EAAKtZ,IAEvBsZ,EAAOmB,MAGJjX,UADCgW,WAAaF,EAEfxa,WAAS4E,WAAW1E,KAAKoI,cAE1B/B,OAAOqV,yBAAyB3Y,KAAK/C,MACrCwE,EAAMxE,KAAKoI,SAASrI,MAAMC,KAAKoJ,KAAMkR,GACrCjU,OAAOqV,yBAAyB9Y,MAC/B,MAAMyG,UACPhD,OAAOqV,yBAAyB9Y,MAChCqG,QAAQM,MAAM,6BAA8BvJ,KAAKoX,QAAUpX,KAAKoX,QAAQhG,SAAW,IACnFnI,QAAQM,MAAMF,aACTsS,SAAS,QAAStS,QAIxB7E,EAAMxE,KAAKoI,cACclJ,IAAtBc,KAAKqZ,cACPpQ,QAAQK,IAAI,kBAAoBwO,EAAUqB,mBAGxCyC,GAAY,UACL1c,IAARsF,IAEFA,EAAM,CACL2V,UAFDyB,GAAY,IAKV5b,KAAKkZ,WAAY,KACfpZ,WAAS8E,SAASJ,SACf,IAAIlF,MAAM,gBAAkBU,KAAKmZ,mBAEpC,IAAIrU,KAAKN,OACP0U,WAAWpU,GAAKN,EAAIM,GAE1BN,EAAMxE,KAAKkZ,gBAGaha,IAAtBc,KAAKqZ,eACNuC,QAAqB1c,IAARsF,UAET6U,aAAe7U,QAEhBmX,SAAS,YAEfE,MAAO,OACPC,QAAS,KACTC,mBAAU7b,OACLkJ,EAAOpJ,KACPgc,EAAS5S,EAAKyS,SACL,WAAVG,GAAuB5S,EAAK8P,WAAY,KACtC+C,EAAc,WACd/b,GACc+X,kBAAkB7O,EAAMlJ,EAAIgY,YAAahY,EAAIiY,aAAcjY,EAAIkY,YACrE0B,QAIR1U,GAAQgE,EAAK8P,YAAcpZ,WAASgB,SAASob,QAAQ9S,EAAKuR,iBAG3DvV,GAAsB,EAAdA,EAAKnE,OACfnB,WAAS0X,QAAQpS,EAAM,WACtB6W,MACE9I,KAAK,CACPgJ,wBAAyB/S,EAAKuR,WAG/BsB,KAGM,EACD,MAAa,WAAVD,GAAiC,SAAVA,IAC7B9b,GACFA,EAAIiY,aAAanY,KAAMA,KAAK8b,UAEtB,IAKTH,kBAASK,EAAQF,WACXD,MAAQG,OACRF,QAAUA,GACX9b,KAAK+b,iBACF/b,KAAKib,MAAMha,QAAQ,KACpBf,EAAMF,KAAKib,MAAMlI,aAChBgJ,UAAU7b,KAIlBT,sBACIO,KAAKkb,kBACFW,MAAQ7b,KAAKkb,YAAYW,MACvB7b,KAAKkb,aAENlb,MAMRoc,uBAAclB,QACRA,YAAcA,OACdzb,UACD4c,EAAWrc,KAAKib,eACfA,MAAQ,GACPoB,EAASpb,QAAQ,KAClBf,EAAMmc,EAAStJ,QACnBmI,EAAYoB,OAAOpc,EAAIgY,YAAahY,EAAIiY,aAAcjY,EAAIkY,cAG5DmE,kBAASC,GACLxc,KAAKib,MAAMha,QAAUjB,KAAKkb,aAAelb,KAAKkb,YAAYD,MAAMha,OAClEub,SAEKnB,cAAgBmB,GASvBF,gBAAOpE,EAAauE,EAAarE,MAC7BpY,KAAKkb,wBACFzb,gBACAyb,YAAYoB,OAAOpE,EAAauE,EAAarE,OAG/ClY,EAAM,CACTgY,YAAaA,EACbC,aAAcsE,EACdrE,WAAYA,MAEVpY,KAAK+b,UAAU7b,SACZ+a,MAAMlY,KAAK7C,GAEdF,KAAKqb,cAAe,KAClBmB,EAAexc,KAAKqb,mBACnBA,cAAgB,KACrBmB,cAIH1E,EAAU1O,KAAO,IAAI/C,OAAO2R,QAAQF,GAGpCA,EAAUkC,aAAe,SAAS0C,UACjC1B,EAAUjY,KAAK2Z,GACA,CACdC,KAAM,KACNC,kBAASrV,EAAM0E,EAAO0Q,WACTzd,IAATyd,GAAsBA,GAAQ3c,KAAK2c,MAGtCA,EAAOA,GAAQE,oBACVF,KAAOA,MAERnY,EAAM,MACP1E,WAASU,SAAS+G,GACpB/C,EAAI+C,GAAQ0E,MACN,CAAA,IAAGnM,WAAS8E,SAAS2C,SAKrB,IAAIjI,MAAM,iBAAmBiI,OAJ/B,IAAIuE,KAAKvE,EACZ/C,EAAIsH,GAAKvE,EAAKuE,GAMhBjD,MAAMlB,KAAKqT,EAAW,SAAS8B,OAC1BC,EAAOD,EAAIzD,mBACX,IAAIvN,KAAKtH,EACZuY,EAAKjR,GAAKtH,EAAIsH,GAEZiR,EAAKjE,WACPjQ,MAAMlB,KAAKoV,EAAKjE,UAAW,SAASkE,GACnCA,EAAIJ,SAASrV,EAAM0E,EAAO0Q,WAahC7E,EAAUmF,WAAa,SAAS7X,OAC3B8X,EAAald,KAAKoF,YACtByD,MAAMlB,KAAKuV,EAAY,SAASnX,GAC5BjG,WAASsK,aAAahF,EAAMW,GAAO,GACrCX,EAAKrC,KAAKgD,KAET,GAAO,QACLX,KAAOA,GAGb0S,EAAUqF,kBAAoB,eACzBC,EAAO,CACVC,MAAO,SAEHC,mBAAmBF,OAEpBG,EAAQ,aAEHC,EAASpa,GACdA,EAAKia,MAAMpc,OACb4H,MAAMlB,KAAKvE,EAAKia,MAAO,SAASI,GAC/BD,EAASC,KAGVF,EAAMxa,KAAKK,GAGboa,CAASJ,GAQTvU,MAAMlB,KAAK4V,EAAO,SAASG,OACtBC,EAAQ,aAPJC,EAAQxa,EAAMua,GACtBA,EAAM5a,KAAKK,EAAKqF,KACbrF,EAAKya,QACPD,EAAQxa,EAAKya,OAAQF,GAKtBC,CAAQF,EAAMC,GACdA,EAAQA,EAAMG,UACd7U,QAAQM,MAAM,mCAAqCjI,SAASC,UACxD,IAAIP,EAAI,EAAGA,EAAI2c,EAAM1c,QAAS,SAC7B8c,EAAK,GACDjS,EAAI,EAAGA,EAAI,GAAK9K,EAAI2c,EAAM1c,OAAQ6K,IACzCiS,EAAGhb,KAAK4a,EAAM3c,MAEfiI,QAAQ+U,KAAKD,EAAG9a,KAAK,oBAElBgb,EAAYP,EAAKhH,UAClBgH,EAAKhH,QAA+B,WAArBgH,EAAKhH,OAAOmF,QAC7BoC,EAAYP,EAAKG,OAAOnH,QAEtBuH,EAAW,SACTF,EAAK,GACD/c,EAAI,EAAGA,EAAIid,EAAU7Y,KAAKnE,OAAQD,IAAK,KAC1C+E,EAAMkY,EAAU7Y,KAAKpE,GACrBJ,EAAQmF,EAAI1D,YAAY,MACf,GAAVzB,IACFmF,EAAMA,EAAIpF,UAAU,EAAGC,QAEpBsd,EAAStH,UAAUJ,UAAUzQ,GAC9BmY,EACFH,EAAGhb,KAAKgD,EAAM,IAAMmY,EAAOrC,OAE3BkC,EAAGhb,KAAKgD,EAAM,SAGhBkD,QAAQ+U,KAAK,iBAAmBC,EAAU9E,cAAgB,0BAA4B4E,EAAG9a,KAAK,KAAO,SAKxG6U,EAAUwF,mBAAqB,SAASa,OACnC/a,EAAO,CACVqF,IAAK,IAAMzI,KAAKmZ,cAAgB,WAAanZ,KAAK6b,MAClDnF,OAAQ1W,KACR6d,OAAQM,EACRd,MAAO,IAERc,EAAWd,MAAMta,KAAKK,GACL,WAAdpD,KAAK6b,OAIRhT,MAAMlB,KAAK3H,KAAKoF,KAAM,SAASW,OAC1BqY,EAAcrY,EAAIrF,QAAQ,KACb,EAAd0d,IACFrY,EAAMA,EAAIpF,UAAU,EAAGyd,QAEpBC,EAAMzH,UAAUJ,UAAUzQ,GAC3BsY,GAAoB,WAAbA,EAAIxC,MACbwC,EAAIf,mBAAmBla,GAIrBib,EACFA,EAAIf,mBAAmBla,GAEvBA,EAAKia,MAAMta,KAAK,CACf8a,OAAQM,EACRd,MAAO,GACP5U,IAAK,IAAM1C,EAAM,wBAKrB6Q,UAAUI,UAAUc,EAAU6C,SAAU7C,GAExCX,aAAaW,GACNA,EAGR,IAAIwG,gBAAkB,EAEtB,SAASzB,qBACD,gBAAkByB,kBAG1B,SAASC,eAAenZ,OACnB,IAAIpE,EAAI,EAAGA,EAAIoE,EAAKnE,OAAQD,IAAK,KAChC+E,EAAMX,EAAKpE,MACZlB,WAAS6E,QAAQoB,GAAM,KAErByY,EAAU,eAAiB3B,eAC3B4B,IAA4B,EAAb1Y,EAAI9E,SAAyB,IAAX8E,EAAI,IACzB,EAAbA,EAAI9E,UAA0B,IAAX8E,EAAI,KAA2B,IAAXA,EAAI,MAC7CA,EAAMA,EAAI4F,MAAM,IAEjBuL,aAAasH,GAAW,CACvBpZ,KAAMW,EACN2Y,SAAUD,GAIXrZ,EAAKpE,GAAKiW,kBAAoB,IAAMuH,IAKvC,SAASG,gBAAgBpe,OACpBE,EAAcF,EAAKG,QAAQ,YACd,EAAdD,EACKF,EAAKI,UAAUF,GAEf,GAKT,SAASme,cAAclH,EAAchB,EAAQmI,EAAiBC,OAC1DpH,EAAaqH,aAIZje,EAAShB,WAASgB,SAChBsE,EAAOsR,EAAOtR,KAEpByD,MAAM1D,oBAAoBrE,EAAQsE,GAClCmZ,eAAenZ,OAEX,IAAIpE,EAAI,EAAGA,EAAIoE,EAAKnE,OAAQD,IAAK,KAEhCqE,EAAID,EAAKpE,GACTge,EAAanW,MAAMvI,SAAS+E,MAE7BqR,EAAOtN,KAAKmO,KAAKG,IAChBsH,GAAclf,WAAS0F,WAAWH,EAAG,OACvCA,EAAIwD,MAAM7G,oBAAoB0U,EAAOtN,KAAKmO,KAAKG,GAAesH,EAAWze,MAAQoe,gBAAgBtZ,GACjGD,EAAKpE,GAAKqE,GAIM,EADNwD,MAAMH,UAAUlB,WAAWkQ,EAAalF,OAAO2J,yBAA2BzF,EAAOiE,SAAUtV,GAC9FpE,OACS2V,UAAUJ,UAAUnR,GAC1B6T,WAAa,OAMzB+F,EAFGF,GAAU,EACbG,GAAa,EAEVC,EAAW/Z,EAAKnE,OAEhBuZ,EAAa,IAAI/Q,MAAM0V,GAEvBC,EAAqB1I,EAAOtN,KAoBhCP,MAAMlB,KAAKvC,EAAM,SAASW,EAAKnF,EAAOgH,EAAKyX,OACtCC,EAAYvZ,EACZqS,OAAalZ,EACbuB,EAAcsF,EAAIrF,QAAQ,KACb,EAAdD,IACF2X,EAAarS,EAAIpF,UAAUF,EAAc,GACzCsF,EAAMA,EAAIpF,UAAU,EAAGF,QAqBpBmW,UAAUJ,UAAUzQ,GAAM,KACzBzF,EAAWuI,MAAMvI,SAASyF,oBAGzB4C,aAEArI,GAAYyF,EAAIrF,QAAQ,KAAO,GAAyB,GAApBqF,EAAIrF,QAAQ,KAAW,KAS1D6e,EACAC,EATAC,EAAK1Z,EAAIrF,QAAQ,KACjBgf,EAAK3Z,EAAIrF,QAAQ,IAAK+e,EAAK,GAC3BE,EAAU,EAALD,EAAS3Z,EAAIrF,QAAQ,IAAKgf,EAAK,IAAM,MACpC,GAAPA,SAEFZ,EADAC,EAAU,kBAAoBhZ,EACTqZ,cAOrBI,GAFS,GAAPG,GACFJ,EAAUze,EAAO8e,eAAe7Z,GAClBA,EAAM,IAAMwZ,IAE1BA,EAAUxZ,EAAIpF,UAAUgf,EAAK,GACf5Z,QAEA7G,IAAZqgB,SAEFT,EADAC,EAAU,uBAAyBhZ,EACdqZ,eAGlBS,EAAO/f,WAASggB,eAAeN,GACnC7W,EAAO7I,WAAS6E,QAAQkb,GAAQA,EAAO,CAACA,QAExClX,EADS7H,EAAOif,SAASha,GAClBjF,EAAOkf,QAAQja,GACbzF,EACF,CAACyF,GAED,MAGU,GAAf4C,EAAK1H,OAEP6d,EADAC,EAAU,WAAahZ,EAAM,mBACRqZ,GAErBvW,MAAMlB,KAAKgB,EAAM,SAASnF,EAAK5C,MAC3Bd,WAAS0F,WAAWhC,EAAK,MAAQ1D,WAAS0F,WAAWhC,EAAK,KACxDkT,EAAOtN,KAAKmO,KAAKG,KACpBqH,EAAU,uBAAyBrI,EAAOyC,cAC1C2F,EAAYC,EAASK,IAEtB5b,EAAMqF,MAAM7G,oBAAoB0U,EAAOtN,KAAKmO,KAAKG,GAAelU,OAC1D,KACF/B,EAAWoH,MAAMzH,oBAAoBoC,GAExCA,EADE/B,EAASA,SACLA,EAASlB,KAETO,EAAO4Q,QAAUlO,EAGzBmF,EAAK/H,GAASE,EAAO6Q,QAAQ5L,EAAKvC,MAIhCub,EAAS,KAERkB,EAAUpF,WADHva,EAAS,KAAKyF,EACQ4C,EAAK,GAAI+N,EAAOiB,OAAQjB,EAAOtN,MAChE6W,EAAQtE,SAAS,WAGjB,SAASuE,EAAT,OAAoBtf,+BAApB,EAAA,EAA4B,OACxBA,GAAS+H,EAAK1H,aAGbuC,EAAMmF,EAAK/H,MACJ,EAARA,EAAW,KACTkW,EAASmJ,EAAQ5c,IACrB4c,EAAQ5c,IAAMG,EACdoT,UAAUC,iBAAiBC,EAAQmJ,GAEpC5Z,OAAO8Z,WAAWF,EAAQtF,SAAUnX,EAAK,SAAC4c,MACzCnX,QAAQK,IAAI8W,GACQ,WAAjBH,EAAQpE,MAAoB,KAC1BwE,EAAazJ,UAAUJ,UAAUyJ,EAAQ5c,KAC1Cgd,GACFJ,EAAQ7D,cAAciE,GAIJ,WAAjBJ,EAAQpE,QACVkD,EAAU,2CAA2CkB,EAAQ9G,cAC7D2F,EAAYC,EAASK,KAEpB,SAAC3W,GACA7H,EAAQ,EAAI+H,EAAK1H,OACnBif,EAAWtf,EAAQ,GAGnBke,EADAC,EAAUtW,EACW2W,MAIxBc,OAlGC,kBAyBA,YA2EM,GAENnB,GA1HHnI,UAAUJ,UAAUzQ,GAAKuW,OAAO8C,EAAoB,SAASkB,EAAW7X,GAEnEA,EAUHsW,EAAUtW,GATV0W,IACU,WAAPpZ,IACCkZ,EACFvI,EAAO2C,aAAe4F,EAEtBA,EAAavI,EAAO2C,aAAeiH,EAAUhH,wBAnC9B1Y,EAAO2f,EAAUD,EAAWjB,GAChD7E,EAAW5Z,GAAS0f,EAE4CnB,GAAY,IAAMJ,EACjFF,EAAgBrE,EAAY9D,GACnBqI,IACTrI,EAAOiF,SAAS,QAASoD,GACrBG,IACHA,GAAa,EACbJ,EAAY,CACXrW,IAAKsW,EACLne,MAAOA,EACP2f,SAAUA,GACRnB,MAEHL,GAAWM,GAAcA,IA0BzBmB,CAAY5f,EAAO0e,EAAWgB,EAAWjB,IACvCjH,IA8GFV,EAAalF,OAAOkM,8CAKpB9H,WACHmE,UAAAA,UACA6D,cAAAA,cACA3H,kBAAAA,kBACAC,aAAAA,aACAC,aAAAA,aACAc,kBAAAA,oBC5zBK5Y,SAASwJ,MAAMxJ,OACfS,WAAWT,SAAOS,SAElB2gB,eAAiB,gBACjBC,iBAAmB,uBACnBC,kBAAoB,wBACpBC,kBAAoB,GAEpBC,KAAO1a,SAAS0a,MAAQ1a,SAASC,qBAAqB,QAAQ,GAC9D0a,QAA2B,oBAAVC,OAA8C,mBAArBA,MAAM1Y,WAChD2Y,YAAqC,kBAAvBC,UAAUC,SAA+B,aAAe,sBACtEC,gBAAkBhb,SAASib,eAAiBvY,MAAM7C,mBAAmB,eACrEqb,aAAexY,MAAM1F,oBAAoBge,iBACzC3P,YACDhO,GAAMlC,SAASC,KACnBiC,GAAMqF,MAAMtF,gBAAgBC,KADxBA,GAKCkY,yBAA2B,GACjCA,yBAAyB4F,KAAO,cACd,EAAdthB,KAAKiB,cACAjB,KAAKA,KAAKiB,OAAS,IAI5B,IAAIsgB,kBAAoBJ,gBACpBK,eACAC,cACqB,EAAtB5Y,MAAM6Y,eAAqB7Y,MAAM6Y,eAAiB,IACpDF,eAAiB,QAIZxJ,8BAEOF,mEACN6J,IAAM,IAAIpiB,MAAMuY,wEAMd9X,KAAK2hB,IAAIliB,MAAM4D,6CAGfrD,KAAK2hB,IAAIliB,MAAMkb,kDAGf3a,KAAK2hB,IAAIliB,MAAM2X,gDAGfpX,KAAK2hB,IAAIliB,MAAMkY,gBAIxB,SAASiK,WAAWxY,OAAMyY,gEACtBzY,aAAgB4O,eACX5O,EACD,GAAGA,aAAgB0R,oBAClB1R,EAAK8O,YACN,GAAG2J,EAAS,KACd/J,EAAY,CACfpB,OAAQ,GACRrT,IAAKmO,WACLmG,OAAQnG,WACRjK,KAAM,WACN6P,QAAS,aAEVU,EAAU1O,KAAO,IAAI4O,QAAQF,GAC7BgK,aAAa3K,aAAaW,GAC1BA,EAAU1O,KAAKgO,QAAU,kBACjBpX,MAED8X,EAAU1O,UAIb0R,mCAUOzX,EAAK+F,OAAMkR,yDAAK,GAAIyH,wbAC1B1e,IAAMA,OACN+F,KAAOA,OACP2Y,UAAYA,OACZC,aAAetG,yBAAyB4F,YACxC9O,OAAS,CACbyP,iBAAQxZ,KACRyZ,gBAAO9c,KACP+c,mBAAUvhB,EAAOmF,EAAKqc,KACtB1D,UAAU,EACV2D,iBAAanjB,EACbyY,YAAQzY,EACRojB,cAAUpjB,QAENgZ,YAAc0J,WAAWxY,OAE1BuR,EAAWL,EAAK,GAChBlV,EAAOkV,EAAK,GACZlS,EAAWkS,EAAK,GAEG,iBAAbK,IACTvS,EAAWhD,EACXA,EAAOuV,EACPA,EAAW,MAGR7a,WAAS6E,QAAQS,KACpBgD,EAAWhD,EACXA,EAAO,MAIPA,EADGA,GACI,GAKRyD,MAAMV,gBAAgB/C,EAAMgD,OAExBtH,EAAShB,WAASgB,YACnBA,EAAQ,KAENyhB,EAAQzhB,EAAOob,QAAQ7Y,GAC3BwF,MAAMlB,KAAK4a,EAAO,SAACxc,GAClBX,EAAKrC,KAAKgD,KAER4U,GAAYA,GAAYtX,IAC1Bkf,EAAQzhB,EAAOob,QAAQvB,GACvB9R,MAAMlB,KAAK4a,EAAO,SAACxc,GAClBX,EAAKrC,KAAKgD,WAKR4U,SAAWA,OACXvV,KAAOA,OACPgD,SAAWA,sEAOTpI,KAAKwS,OAAOmF,QAAU3X,KAAKwS,OAAO6P,kDAJlCriB,KAAKob,kBAAoBpb,KAAKkY,YAAclY,KAAKkY,YAAYP,SAAW,eAgBjF,SAAS6K,uBAAiBC,iEAuDrB/gB,qBApD2BxC,IAA3BiH,SAASib,cAA6B,KACpChe,EAAO+C,SAASib,eAAiBjb,SAASib,cAAc/d,KAAO8C,SAASib,iBACzEhe,QACK,CACNA,KAAAA,EACAC,IAAKD,EAAKC,QAIS,EAAnBwF,MAAMsF,YAAkBtF,MAAMsF,YAAc,WAC1CkP,EAAQlX,SAASC,qBAAqB,UAClCpF,EAAI,EAAGA,EAAIqc,EAAMpc,OAAQD,IAAK,KACjCoC,EAAOia,EAAMrc,MACM,gBAApBoC,EAAKgS,iBACA,CACNhS,KAAAA,EACAC,IAAKD,EAAKC,SAKVX,YAEKxD,GACNwjB,EAAEjX,IACH,MAAMpC,KACP3G,EAAQ2G,EAAE3G,OAAS2G,EAAEsZ,WAAatZ,EAAEuZ,YAAc,KACrCzjB,OAAO4hB,QAEnBre,GAAS0J,OAAO/C,GAAGpB,MAAM,0BAA4B,IAAIhF,KAAK,SAG7DP,QAcK,CACNW,KAHDX,EAAoB,MADpBA,EAAQA,EAAMC,MAAM,SAASC,OACf,GAAYF,EAAMiJ,MAAM,GAAI,GAAKjJ,GACjCkD,QAAQ,gBAAiB,KAOhCid,MACNnhB,EAAI,KACFA,EAAG0B,aACFC,EAAMwF,MAAMtF,gBAAgB7B,EAAG2B,KAC/Bga,EAAQlX,SAASC,qBAAqB,UAClCpF,EAAI,EAAGA,EAAIqc,EAAMpc,OAAQD,IAAK,KACjCoC,EAAOia,EAAMrc,MACdqC,GAAOwF,MAAMtF,gBAAgBH,EAAKC,KAAM,CAC1C3B,EAAG0B,KAAOA,SAMV1B,EAAG0B,OACL1B,EAAG2B,IAAMwF,MAAM1F,oBAAoBzB,EAAG0B,OAEpCqf,IACF/gB,EAAG2B,IAAMwF,MAAMtF,gBAAgB7B,EAAG2B,aAG7B3B,EAIR,SAASohB,mBACJ1f,EAAO+C,SAAS4c,cAAc,iBAClC3f,EAAKwS,KAAO,kBACZxS,EAAK4f,QAAU,QACf5f,EAAK6f,OAAQ,EACN7f,EAGR,SAAS8f,iBAAiB9f,EAAMyE,EAAMN,EAAM4b,GACxC/f,EAAKiS,cAAgByL,QACpBqC,GACF/f,EAAKiS,YAAY8N,EAAQtb,GAG1BzE,EAAK4R,oBAAoBzN,EAAMM,GAAM,GASvC,SAASub,gBAAgBC,EAAY7f,EAAK+O,OACrCnP,EAAO0f,kBACX1f,EAAKkgB,aAAa5C,iBAAkB2C,GACpCjgB,EAAKkgB,aAAa3C,kBAAmBF,iBAClCrd,EAAK8R,aACL9R,EAAK8R,YAAY7M,UAAYjF,EAAK8R,YAAY7M,WAAW3H,QAAQ,gBAAkB,GACpFogB,QAEK,CACN1d,EAAK2R,iBAAiB,OAAQxC,EAAYgR,cAAc,OACpDC,EAAY,SAAZA,IACHN,iBAAiB9f,EAAMogB,EAAW,SAClCjR,EAAYkR,cAAc1jB,MAAMC,KAAMC,YAEvCsS,EAAYiR,UAAYA,EACxBpgB,EAAK2R,iBAAiB,QAASyO,GAAW,QAR1CpgB,EAAK8R,YAAY,qBAAsB3C,EAAYgR,cAUpDngB,EAAKC,IAAMG,EACXkgB,cAActgB,GAGf,SAASugB,gBAAgBC,EAAKrR,OACzBnP,EAAOwgB,EAAIC,eAAiBD,EAAIE,kBACpCZ,iBAAiB9f,EAAMmP,EAAYgR,aAAc,OAAQ,sBACzDL,iBAAiB9f,EAAMmP,EAAYiR,UAAW,SACvC,CACNpgB,KAAMA,EACNmE,KAAMnE,GAAQA,EAAKE,aAAaod,kBAChCrd,IAAKwF,MAAMtF,gBAAgBH,GAAQyF,MAAM1F,oBAAoBC,KAI/D,SAASsgB,cAAcK,OAClBjkB,WAASwU,MAAMyP,SACZ,IAAIzkB,MAAM,oCAAsCykB,OAEnDC,EAAUzC,kBAAkB0C,YAChCpD,KAAKqD,aAAaH,EAAKC,GAEvBzC,kBAAoBwC,EAKrB,SAAS5D,WAAWkD,EAAY7f,EAAK0W,EAAQG,OACxC9H,EAAc,CAClBA,aAA2B,SAASqR,OAChCrR,EAAY4R,UAGC,SAAbP,EAAIhO,MAAoBoL,YAAYzV,MAAMqY,EAAIC,eAAiBD,EAAIE,YAAY1O,aAAc,CAC/F7C,EAAY4R,SAAU,MAClB/D,EAAauD,gBAAgBC,EAAKrR,GACnCiP,iBACF3Y,MAAMlB,KAAK6Z,eAAgB,SAAC9J,GAC3BA,EAAarU,IAAM+c,EAAW/c,MAE/Boe,iCAAkBD,kBAEnBtH,EAAOkG,KAGT7N,cAA4B,SAASqR,OACjCrR,EAAY4R,SAGf5R,EAAY4R,SAAU,MAClB/D,EAAauD,gBAAgBC,EAAKrR,GACtC8H,EAAQ+F,MAETgD,gBAAgBC,EAAY7f,EAAK+O,GAGlC,SAAS6R,SAAShb,EAAMkR,EAAMyH,OACzB1e,EAAMmf,mBAAmBnf,IACzBqU,EAAe,IAAIoD,aAAazX,EAAK+F,EAAMkR,EAAMyH,OACjDP,sBAEC9J,EAAarU,IAAK,KAChBD,EAAO+C,SAASib,iBACjBhe,GAAQA,EAAKE,aAAa,QAAUF,EAAKE,aAAaqd,oBAAsBF,gBAC9E/I,EAAarU,KAAOge,cAAgB3J,EAAarU,KAAOmO,kBACxDvI,QAAQM,MAAM,4BAA8BzJ,WAAS2P,cAAciI,EAAarU,WAChF4F,QAAQM,MAAMnG,IAIf,MAAMiG,GACPvJ,WAASgB,SAASyI,MAAMF,OAKtBmJ,EAAS,CACZW,cAAK9E,UACJqJ,EAAalF,OAAS1S,WAASwO,OAAOoJ,EAAalF,OAAQnE,GACpDrO,MAERuJ,eAAM0Y,UACLvK,EAAalF,OAAOyP,QAAUA,EACvBjiB,cAITF,WAAS0T,UAAU,WACfgO,eACFA,eAAeze,KAAK2U,GAEpB+J,cAAc,CAAC/J,MAGjB5X,WAAS0T,YAAYf,KAAK,cAInBD,EAGR,SAAS6R,oBACJ/J,EAAO,GACHtZ,EAAI,EAAGA,EAAIf,UAAUgB,OAAQD,IACpCsZ,EAAKvX,KAAK9C,UAAUe,WAEdojB,SAASpkB,KAAMsa,GAAM,GAG7B,SAASgK,WAAWlf,EAAMgD,OAErBtI,WAASgB,eACN,IAAIxB,MAAM,kBAEb4Y,EAAc0J,WAAW5hB,MAAM,MACZ,GAApBC,UAAUgB,QAAenB,WAASU,SAAS4E,GAAO,KAChDmf,EAAanf,EACbgT,OAAalZ,EACbuB,EAAc2E,EAAK1E,QAAQ,QACd,EAAdD,IACF2X,EAAahT,EAAKzE,UAAUF,EAAc,GAC1C2E,EAAOA,EAAKzE,UAAU,EAAGF,GACtB2X,GAAY,KACVoM,EAAS,CAACpM,GACdvP,MAAM1D,oBAAoBrF,WAASgB,SAAU0jB,GAC7CpM,EAAaoM,EAAO,OAalBC,EAVA/N,EAASoL,aAAatL,UAAUpR,MAChCsR,IACHtR,EAAO8S,EAAY9G,OAAOhM,GAAM,GAChCsR,EAASoL,aAAatL,UAAUpR,KAE7BsR,QACG,IAAIpX,MAAM,eAAiBilB,EAAa,kBACxC,GAAmB,WAAhB7N,EAAOmF,YACV,IAAIvc,MAAM,eAAiBilB,EAAa,oBAAsB7N,EAAOmF,UAG5EiG,aAAa7J,kBAAkBvB,EAAQwB,EAAa,SAACoI,GACpDmE,EAASnE,EAAUjH,gBACjBjB,GAAY0B,MAAK,QACN5a,IAAXulB,QACInlB,MAAM,eAAiBilB,EAAa,yBAEpCE,MASJC,EANA/J,EAAW7a,WAAS4N,OAAO,YAC5B5N,WAAS4E,WAAWU,KACtBgD,EAAWhD,EACXA,EAAO,IAERyD,MAAMV,gBAAgB/C,EAAMgD,OAExBoK,EAAS4R,SAASpkB,KAAM,CAAC2a,EAAUvV,EAAM,gBAC9BlG,IAAXwlB,GACFC,aAAaD,GAEX5kB,WAAS4E,WAAW0D,IACtBA,EAASrI,MAAMC,KAAMC,cAEnB,UAeJykB,EAAStR,WAbY,eAChBwR,EAAW9C,aAAatL,UAAUmE,QACjCiK,GAA8B,WAAlBA,EAAS/I,OAAwBrJ,EAAOuM,SAAS,KAC7DrI,EAASkO,EACVlO,GACF7N,MAAMlB,KAAK+O,EAAOtR,KAAM,SAASW,OAC5BsY,EAAMyD,aAAatL,UAAUzQ,GACjCsY,GAAOA,EAAIlB,sBAGblU,QAAQM,MAAM,qBAAuBnE,EAAOA,EAAKnC,KAAK,KAAO,IAAM,OAGD,IAAhCnD,WAASgB,SAAS8Z,aAC/CpI,EAKR,IAAMqS,WAAa,SAASC,UAC3BrD,cAAgB,SAACsD,GACZjlB,WAASgB,SAGZgkB,EAAUC,GAFVnE,kBAAkB7d,KAAKgiB,IAKlB,CACNV,UAAAA,UACAC,WAAAA,aAIIU,mBAAqB,gBACpBpE,kBAAkB3f,QAAQ,KAC3B8jB,EAAUnE,kBAAkB7N,QAChC0O,cAAcsD,YAID,CACdtE,eAAAA,eACAU,gBAAAA,gBACAE,aAAAA,aACA7P,WAAAA,WACAkS,cAAAA,cACAmB,WAAAA,WACA7M,QAAAA,QACA8C,aAAAA,aACAqF,WAAAA,WACAzE,yBAAAA,yBACAsJ,mBAAAA,oBCjfK3lB,SAASwJ,MAAMxJ,OACfS,WAAWT,SAAOS,SAKpBmlB,WACApkB,UACAqkB,WAAa,GAmDjB,SAASC,oBACM,CACbC,YAAa/e,OAAO+e,YACpBC,SAAU,eApDHvkB,OAAS,kBACVD,sBAECwF,OAAS,kBACVA,OAAO8a,4BAENmE,UAAY,kBACbjf,OAAOgb,yBAGNkE,WAAa,SAASC,GAC9BN,WAAaplB,WAASwO,OAAO4W,WAAYM,eAGjCC,WAAa,kBACX3lB,WAASwO,OAAO,GAAI4W,wBAItBQ,aAAe,WACvBR,WAAa,eAGLS,UAAY,SAASpe,OACzBjD,GAAM,EACNoS,EAASoL,aAAatL,UAAUjP,UAChCmP,GAA0B,QAAhBA,EAAOmF,QAGpBvX,GAAM,GAEAA,cAICwb,eAAiB,SAAS8F,SAC5B,IAAItmB,MAAM,wCAGRumB,cAAgB,mBACpBvP,EAAUrW,UACNe,EAAI,EAAGA,EAAIsV,EAAQrV,OAAQD,IAC/BsV,EAAQtV,YACHsV,EAAQtV,GAAGuX,gBACXjC,EAAQtV,GAAG8X,YAarBgN,OAAOjmB,UAAU,SAACwO,MACd4W,iBACI,IAAI3lB,MAAM,wBAEjB+O,EAASvO,WAASwO,OAAO,CACxBoD,QAAS7I,MAAM7G,oBAAoBV,SAASykB,SAAU,KAAMjmB,WAASoB,SAASI,SAASykB,SAAU,MACjG7V,QAAS,GACT8V,kBAAkB,EAClBhf,MAAO,GACPif,UAAW,GACX7gB,KAAM,GACNrE,YAAQ7B,EACR4E,WAAY,GACZ4B,aAAc,GACdwgB,eAAgB,GAChBzgB,kBAAmB,EACnBmV,YAAa,GACbuL,8BACQ,GAER7D,SAAU,SACV8D,UAAW,GACXrU,wBAAevN,UACPqE,MAAMjF,eAAeY,EAAK6J,EAAOvK,aAEzCic,kBAAS1a,WACCrF,KAAKggB,QAAQ3a,IAEvB2a,iBAAQ3a,UACArF,KAAKgH,MAAM3B,IAAMrF,KAAKimB,UAAU5gB,IAExC6W,iBAAQ7W,OACH0Y,EAAK/d,KAAKomB,UAAU/gB,IAAM,GAC1BD,EAAO,GACPihB,OAAcnnB,EAEH,EAAZ6e,EAAG9c,UAAyB,IAAV8c,EAAG,KAAyB,IAAVA,EAAG,MACtCA,EAAG,IACL3Y,EAAO,CACN,IAEDihB,GAAc,GAEdtI,EAAGuI,OAAO,EAAG,QAGX,IAAItlB,EAAI,EAAGA,EAAI+c,EAAG9c,OAAQD,KACV,IAAhBqlB,EACFjhB,EAAK,GAAGrC,KAAKgb,EAAG/c,IAEhBoE,EAAKrC,KAAKgb,EAAG/c,WAGRoE,GAERuM,iBAAQ+E,EAAQlT,OACX+iB,EACA9P,MA6CA,IAAI3K,KA5CL9L,KAAKmmB,cACPI,EAAS,OAAQ,IAAIha,MAAOuB,WACnBhO,WAASU,SAASkW,IAC3B6P,EAASvmB,KAAKkQ,QAAQwG,IAErBD,EAAYC,GAEZD,EAAYC,EACZ6P,EAASvmB,KAAKwmB,gBAAgB9P,MAU/B6P,EAASvmB,KAAKkQ,QAAQ1M,IAErBiT,EAAYjT,EAEZ+iB,EAASvmB,KAAKwmB,gBAAgBhjB,GAG3B+iB,IACH9P,EAAYC,EAAOiE,SACnB4L,EAASvmB,KAAKkQ,QAAQuG,IAGnB8P,IACH9P,EAAYC,EAAO+P,KACnBF,EAASvmB,KAAKwmB,gBAAgB/P,KArB3B8P,IACH9P,EAAY,IACZ8P,EAASvmB,KAAKkQ,QAAQ,OA4BrBpQ,WAAS4E,WAAW6hB,KACtBA,EAASA,EAAOrhB,KAAKlF,KAAMyW,IAEfyO,WACZqB,GAAU,IAAMza,EAAI,IAAM4a,mBAAmBxB,WAAWpZ,WAElDhM,WAASoD,eAAeM,EAAK+iB,IAErCI,qBAAYnjB,UACXA,EAAMqF,MAAM7G,oBAAoBV,SAASC,KAAMiC,GACxCxD,KAAK2R,QAAQnO,EAAKA,IAE1Boc,eAAgB,IACdvR,GAECvO,WAASoB,SAASmN,EAAOqD,QAAS,OACrCrD,EAAOqD,SAAW,KAEnBrD,EAAOqD,QAAU7I,MAAM7G,oBAAoBV,SAASC,KAAM8M,EAAOqD,SAE7DrD,EAAO2X,mBACV3X,EAASA,EAAO0D,eAAe1D,IAGhCxF,MAAMnB,aAAa2G,EAAOrH,OAC1B6B,MAAMnB,aAAa2G,EAAO4X,WAC1Bpd,MAAMnB,aAAa2G,EAAOjJ,OAEtBtF,WAAS4E,WAAW2J,EAAO8X,aAAc,KACxCS,EAAgBvY,EAAO8X,YAC3B9X,EAAO8X,YAAc,kBACbS,OAILnhB,EAAoB,MACpB,IAAIlD,KAAU8L,EAAO3I,aAAc,IACnC5F,WAAS0F,WAAWjD,EAAQ,MAAQzC,WAAS0F,WAAWjD,EAAQ,WAC5D,IAAIjD,MAAM,8CAAgDiD,EAAS,KAE1EkD,OAGsB,GADvB4I,EAAO5I,kBAAoBA,GACD,KAErBohB,EAAOxY,EAAO6B,QAAQ,YACnB7B,EAAO6B,QAAQ,SAElB4W,EAAa,OACb,IAAIhb,KAAKuC,EAAO6B,QAAS,KACxB1M,EAAMsI,KACPjD,MAAMvI,SAASkD,MACd1D,WAAS0F,WAAWhC,EAAK,MAAQ1D,WAAS0F,WAAWhC,EAAK,OAAS1D,WAAS0F,WAAWhC,EAAK,MAC9FA,EAAMqF,MAAM7G,oBAAoBqE,OAAOgb,aAAc7d,OAC/C,KACF/B,EAAWoH,MAAMzH,oBAAoBoC,GACtC/B,EAASA,SACX+B,EAAM/B,EAASlB,KACLT,WAAS0F,WAAWhC,EAAK,QACnCA,EAAM6K,EAAOqD,QAAUlO,GAK1BsjB,EAAW/jB,KAAK,CACfS,IAAKA,EACL8W,KAAMjM,EAAO6B,QAAQpE,SAInB,IAAIvJ,KAAU8L,EAAO3I,qBACpBC,EAAa0I,EAAO3I,aAAanD,GAAQqD,QACrC5E,EAAI,EAAGA,EAAI8lB,EAAW7lB,OAAQD,IAAK,KACtC+lB,EAAYD,EAAW9lB,GACvBgmB,EAAQ,GACTlnB,WAAS0F,WAAWuhB,EAAUvjB,IAAK,QACrCwjB,EAAQ,KACRD,EAAUvjB,IAAMujB,EAAUvjB,IAAI7C,UAAU,IAEtCb,WAAS0F,WAAWuhB,EAAUvjB,IAAKjB,KACrCwkB,EAAUvjB,IAAMmC,EAAaohB,EAAUvjB,IAAI7C,UAAU4B,EAAOtB,SAE7D+lB,IAAUD,EAAUvjB,IAAMwjB,EAAQD,EAAUvjB,KAG9C6K,EAAO6B,QAAU,GACjB7B,EAAO6B,QAAQ,KAAO2W,MAClB,IAAI7lB,EAAI,EAAGA,EAAI8lB,EAAW7lB,OAAQD,IAAK,KACtC+lB,EAAYD,EAAW9lB,GAC3BqN,EAAO6B,QAAQ6W,EAAUvjB,KAAOujB,EAAUzM,UAKxC2M,EAAkB,GAClBC,EAAkB,OAIlB,IAAIpb,KAHRuC,EAAO4Y,gBAAkBA,EACzB5Y,EAAO6Y,gBAAkBA,EAEZ7Y,EAAO6B,QAAS,KACxB1M,EAAMsI,KACPhM,WAAS0F,WAAWhC,EAAK,MAAO,KAC9B2jB,EAAS3jB,EAAI7C,UAAU,MACxBb,WAAS0F,WAAW2hB,EAAQ,MAAQrnB,WAAS0F,WAAW2hB,EAAQ,OAASrnB,WAAS0F,WAAW2hB,EAAQ,MACvGA,EAASte,MAAM7G,oBAAoBqE,OAAOgb,aAAc8F,OAClD,KACF1lB,EAAWoH,MAAMzH,oBAAoB+lB,GACtC1lB,EAASA,SACX0lB,EAAS1lB,EAASlB,KAElBiD,EAAM6K,EAAOqD,QAAUlO,EAIzByjB,EAAgBlkB,KAAK,CACpBokB,OAAQA,EACRlb,MAAOoC,EAAO6B,QAAQpE,YAEhBuC,EAAO6B,QAAQpE,QACbhM,WAAS0F,WAAWhC,EAAK,QAClC0jB,EAAgBnkB,KAAK,CACpBokB,OAAQ3jB,EAAI7C,UAAU,GACtBsL,MAAOoC,EAAO6B,QAAQpE,YAEhBuC,EAAO6B,QAAQpE,QAkCpB,IAAIvE,KA9BR8G,EAAOmY,gBAAkB,SAASY,OAE7B,IAAIpmB,EAAI,EAAGA,EAAIimB,EAAgBhmB,OAAQD,IAAK,KAC3CqmB,EAAYJ,EAAgBjmB,MAC7BlB,WAAS0F,WAAW4hB,EAAWC,EAAUF,QAAS,QAEjDrnB,WAAS4E,WAAW2iB,EAAUpb,OACxBob,EAAUpb,MAAM/G,KAAKlF,KAAMonB,GAE3BC,EAAUpb,WAOjB,IAAIjL,EAAI,EAAGA,EAAIkmB,EAAgBjmB,OAAQD,IAAK,KAC3CqmB,EAAYH,EAAgBlmB,MAC7BlB,WAASoB,SAASkmB,EAAWC,EAAUF,QAAS,QAE/CrnB,WAAS4E,WAAW2iB,EAAUpb,OACxBob,EAAUpb,MAAM/G,KAAKlF,KAAMonB,GAE3BC,EAAUpb,SAONoC,EAAOrH,MACtB6B,MAAM1D,oBAAoBkJ,EAAQA,EAAOrH,MAAMO,QAE5C,IAAIA,KAAQ8G,EAAO4X,UACtBpd,MAAM1D,oBAAoBkJ,EAAQA,EAAO4X,UAAU1e,IAMrC,SAAX+f,EAAYC,EAAeC,GAC9B3e,MAAMlB,KAAK6f,EAAW,SAACzhB,GACtBwhB,EAAcxkB,KAAKgD,gBAIb0hB,OACHzgB,EAAQygB,EAAQ9kB,MAAM,MACtB6kB,EAAYnZ,EAAOjJ,KAAKqiB,GAC5B5e,MAAMlB,KAAKX,EAAO,SAACzG,MACP,KAARA,MACE,IAAI8E,KAAKgJ,EAAO4X,UAAW,KAC1BsB,EAAgBnB,EAAU/gB,GAAK+gB,EAAU/gB,IAAM,GACnDiiB,EAASC,EAAeC,OAEnB,KACFD,EAAiBnB,EAAU7lB,GAAQ6lB,EAAU7lB,IAAS,GAC1D+mB,EAASC,EAAeC,UAnBvBpB,EAAY/X,EAAO+X,cAQnB,IAAIqB,KAAWpZ,EAAOjJ,OAAlBqiB,UAgBR5mB,UAAYwN,EACZ4W,WAAaE,cACb9e,OAAO2e,qBACAnkB,YCvWR,IAAMxB,SAASwJ,MAAMxJ,OACfS,WAAWT,SAAOS,SAElB4nB,aAAerhB,OAAOwe,WAAW,SAAuBE,GAC7Dlc,MAAMlB,KAAKod,EAAS,SAACrN,MACjB5X,WAAS4E,WAAWgT,EAAatP,UAAW,KAC1Cuf,EAAiBjQ,EAAatP,SAClCsP,EAAatP,SAAW,eAEnBwf,EAEAC,EAHA/mB,EAAShB,WAASgB,YAItB+H,MAAMlB,KAAK+P,EAAaoQ,MAAO,SAACvgB,OAC3BrH,EAAMY,EAAOolB,eAAe3e,MAC7BzH,WAAS4E,WAAWxE,UACtB2nB,EAAY3nB,GACL,IAIN2nB,EAAW,SACTvN,EAAO,GACHtZ,EAAI,EAAGA,EAAIf,UAAUgB,OAAQD,IACpCsZ,EAAKvX,KAAK9C,UAAUe,IAErB4mB,EAAKC,EAAU9nB,MAAMC,KAAM,CAAC2nB,EAAgB3nB,KAAMsa,SAElDsN,EAAKD,EAAe5nB,MAAMC,KAAMC,kBAGjC0nB,EAAiB,KACVC,GAERlQ,EAAatP,SAASuf,eAAiBA,EAExCI,eAAerQ,OAYjB,SAASqQ,eAAerQ,EAAcsQ,OAGjCpD,EAAW9C,aAAatL,UAAUkB,EAAarU,KAWlDuhB,EAVEA,GAUS9C,aAAa/G,UAAUrD,OAG/BoQ,EAAQ,CAACpQ,EAAarU,KACvBqU,EAAaiD,UAAYjD,EAAaiD,UAAYjD,EAAarU,KACjEykB,EAAM/kB,KAAK2U,EAAaiD,UAGtBiK,EAASjK,UAAYiK,EAASjK,UAAYjD,EAAaiD,UAAYiK,EAASjK,UAAYjD,EAAarU,KAEvGykB,EAAM/kB,KAAK6hB,EAASjK,UAErBjD,EAAaoQ,MAAQA,EACrBjf,MAAMlB,KAAKmgB,EAAO,SAACvgB,GAClBua,aAAa9K,UAAUzP,EAAMqd,GAC1B9kB,WAASqW,eAAe5O,KAC1Bqd,EAASnM,cAAe,SAsCtB/B,EAASkO,KAEblO,EAAOuG,WAAWvF,EAAatS,MAE5BsS,EAAalF,OAAO0P,QACtBxK,EAAalF,OAAO0P,OAAOxL,EAAOtR,MAEhC4iB,GAAoBA,EAAiBxV,OAAO2P,WAC9C6F,EAAiBxV,OAAO2P,UAAU6F,EAAiBpnB,MAAO8V,EAAOiE,SAAUjE,EAAOtR,KAAM,GAGzFsR,EAAOiF,SAAS,UAChBjF,EAAO4E,gBAAgB5D,EAAalF,OAAO8P,UAAYxiB,WAASgB,SAASwhB,UAEhD,GAAtB5L,EAAOtR,KAAKnE,OACdyV,EAAO8E,OAAO,QACR,KAEFyM,EAAe,WAClBnG,aAAalD,cAAclH,EAAchB,EAAQ,SAAC8D,OAC7CF,EAAO,GACP4N,EAAgB,GACpBrf,MAAMlB,KAAK6S,EAAY,SAAC8F,GACvB4H,EAAcnlB,KAAKud,GACnBhG,EAAKvX,KAAKud,GAAaA,EAAUjH,kBAElCiB,EAAKvX,KAAKmlB,GACVxR,EAAO8E,OAAOlB,IACZ,SAAC7R,EAAK2O,GACRM,EAAalF,OAAOyP,QAAQxZ,EAAK2O,MAIhCM,EAAaqK,UACfkG,IAEAvR,EAAO6F,SAAS0L,IAOnB,IAAMxQ,OAAS,kBACPiQ,aAAarD,UAAUtkB,MAAMC,KAAMC,YAGrCuX,QAAU,kBACRkQ,aAAapD,WAAWvkB,MAAMC,KAAMC,uBAGnCwX,OAASA,kBACTG,YAAcH,kBACdD,QAAUA,iBACZC,OAASA,gBACTD,QAAUA,QAEjBC,OAAO0Q,KAAM,EACb1Q,OAAO,UAAW,cC/KlB,IAAMpY,SAASwJ,MAAMxJ,OACfS,WAAWT,SAAOS,oBAIf2X,OAAOqK,aAAa7K,kBAAmB,CAC/CyD,oBAAW0N,EAAOlO,EAAQG,EAASvZ,OAC9BunB,EAAUvG,aAAa5K,aAAakR,GACpChjB,EAAOijB,EAAQjjB,UAEdgS,UAAUI,QAAQpS,EAAM,mBACxBkV,EAAO,GACHxO,EAAI,EAAGA,EAAI7L,UAAUgB,OAAQ6K,IACpCwO,EAAKvX,KAAK9C,UAAU6L,IAErBoO,EAAOI,KACLnH,KAAK,CACPuL,SAAU2J,EAAQ3J,YAGpBlF,qBAAY4O,UACJA,KCtBT,IAAM/oB,SAASwJ,MAAMxJ,OACfS,WAAWT,SAAOS,oBAEf2X,OAAO,QAAS,CACxBiD,oBAAW0N,EAAOlO,EAAQG,EAASvZ,GAClChB,WAAS4V,QAAQ,WAChBwE,SCNH,IAAM7a,SAASwJ,MAAMxJ,OACfS,WAAWT,SAAOS,oBAEf2X,OAAO,SAAU,CACzBuB,UAAU,EACV0B,oBAAW4N,EAAKpO,EAAQG,EAASvZ,QAC3BsW,UAAUI,QAAQ,CAAC8Q,GAAM,SAASjK,EAAK6J,GAC3ChO,EAAOmE,KACLlL,KAAK,CACPgP,mBAAUvhB,EAAOmF,EAAKqc,GACrBA,EAAQkE,OAAO,EAAGlE,EAAQnhB,WAEzBsI,MAAM,SAASF,GACjBgR,EAAQhR,QCZX,IAAMhK,SAASwJ,MAAMxJ,OACfS,WAAWT,SAAOS,oBAEf2X,OAAO,SAAU,CACzBuB,UAAU,EACV0B,oBAAW4N,EAAKpO,EAAQG,EAASvZ,WAC5BynB,EAAOD,EAAI3lB,MAAM,KACb3B,EAAI,EAAGA,EAAIunB,EAAKtnB,OAAQD,IAC/BunB,EAAKvnB,GAAKunB,EAAKvnB,GAAGgO,UAED,GAAfuZ,EAAKtnB,OACPoZ,EAAQ,8BACF,KACFgJ,EAAakF,EAAK,MACTzG,aAAatL,UAAU6M,QAE9BjM,UAAUI,QAAQ,CAAC6L,GAAa,SAAShF,EAAK6J,GAClDhO,EAAOmE,KACL9U,MAAM,SAASF,GACjBgR,EAAQhR,SAEH,SACF7E,OAAMtF,EACF8B,EAAI,EAAGA,EAAIunB,EAAKtnB,OAAQD,OAC5B7B,OAAOopB,EAAKvnB,IAAK,CACnBwD,EAAMrF,OAAOopB,EAAKvnB,eAIT9B,IAARsF,EACF6V,EAAQ,aAAeiO,GAEvBpO,EAAO1V,QChCZ,IAAMnF,SAASwJ,MAAMxJ,OACfS,WAAWT,SAAOS,oBAMf2X,OAAO,OAAQ,CACvBuB,UAAU,EACV0B,oBAAW4N,EAAKpO,EAAQG,EAASvZ,OAC5BF,EAAQ0nB,EAAI5nB,QAAQ,WACX,GAAVE,OAICyiB,EAAaiF,EAAI3nB,UAAU,EAAGC,GAE9BknB,GADJzE,EAAaA,EAAWzd,QAAQ,KAAM,MACfjD,MAAM,KACzBoD,EAAMuiB,EAAI3nB,UAAUC,EAAQ,QAC3BwW,UAAUI,QAAQ,CAACzR,GAAM,SAASsY,EAAK6J,WACvCM,EAAa,GACTxnB,EAAI,EAAGA,EAAI8mB,EAAM7mB,OAAQD,IAAK,KACjCynB,EAAUX,EAAM9mB,GAChB0nB,EAAQ5G,aAAatL,UAAUiS,MAChCC,GAAwB,QAAfA,EAAM7M,MACjB2M,EAAWzlB,KAAK0lB,YAGb/R,EAASwR,EAAc,GAAGxR,OAC3BgS,EACFA,EAAMtM,cAAc1F,GAEpBoL,aAAa9K,UAAUyR,EAAS/R,IAG/B8R,EAAWvnB,QACbgI,QAAQO,KAAK,kBAAmBgf,EAAWvlB,KAAK,MAEjDiX,EAAOmE,KACL9U,MAAM,SAASF,GACjBgR,EAAQhR,UA5BRgR,EAAQ,mBCbX,IAAMhb,SAASwJ,MAAMxJ,OACfS,WAAWT,SAAOS,oBAQf2X,OAAO,MAAO,cACF,oBAAVtY,OACT,MAAO,CACNwpB,KAAM,SAASzd,EAAGiG,EAAGwX,GACpBA,UAGCC,EAASzpB,OAAO8hB,UAAU4H,UAAU5gB,MAAM,oIAAsI,EAChL6gB,GAAgB,EAChBC,GAAY,EACbH,EAAO,IAAMA,EAAO,GACtBE,EAAgBjb,SAAS+a,EAAO,IAAM,GAAK/a,SAAS+a,EAAO,KAAO,EAC3DA,EAAO,IAAMA,EAAO,IAAM,qBAAsBziB,SAASmP,gBAAgB0T,MAChFD,GAAY,EACLH,EAAO,KACdE,EAAgBjb,SAAS+a,EAAO,IAAM,IAGrB,SAAdK,IACHC,EAAW/iB,SAAS4c,cAAc,SAClCjjB,WAAS4jB,cAAcwF,GACvBC,EAAWD,EAASE,YAAcF,EAASG,MAKzB,SAAfC,EAAwB9lB,GAC3B2lB,EAASI,UAAU/lB,GACnB0lB,EAAShP,OAAS,WACjBsP,KAIW,MADZC,IAECR,IACAQ,EAAQ,GAaO,SAAbC,EAAsBlmB,EAAK4E,MAC9BA,EAAWA,GAAY,aACnB+gB,GAAaA,EAASI,WACzBN,IAEEE,GAAYA,EAASI,UACpBI,EACFC,EAAQ7mB,KAAK,CAACS,EAAK4E,KAEnBkhB,EAAa9lB,GACbmmB,EAAgBvhB,OAEX,CACN8gB,EAASW,YAAc,YAAcrmB,EAAM,SACvCsmB,EAAeC,YAAY,eAE7Bb,EAASG,MAAMW,SACfC,cAAcH,GACd1hB,IACC,MAAMiB,GACPJ,QAAQO,KAAKH,KAEZ,KAGU,SAAX6gB,EAAoB1mB,EAAK4E,GAC5BA,EAAWA,GAAY,iBACnB+hB,EAAOhkB,SAAS4c,cAAc,WAClCoH,EAAKvU,KAAO,WACZuU,EAAKC,IAAM,aACRrB,EACFoB,EAAKjQ,OAAS,WACbiQ,EAAKjQ,OAAS,aACd9G,WAAWhL,EAAU,aAGlB0hB,EAAeC,YAAY,eAC1B,IAAI/oB,EAAI,EAAGA,EAAImF,SAASkkB,YAAYppB,OAAQD,IAAK,IACxCmF,SAASkkB,YAAYrpB,GACxBO,MAAQ4oB,EAAK5oB,YACrB0oB,cAAcH,GACP1hB,MAGP,IAEJ+hB,EAAK5oB,KAAOiC,EACZ1D,WAAS4jB,cAAcyG,OA9EpBjB,EAAUC,EAQVQ,EATAW,EAAS,GAOTb,EAAQ,EACRG,EAAU,GAcVJ,EAAgB,WACnBG,QACIY,EAAWX,EAAQ7W,QACnBwX,GAIJZ,EAAgBY,EAAS,GACzBjB,EAAaiB,EAAS,KAJrBZ,EAAgB,aAuDlBW,EAAO5P,WAAa,SAAS8P,EAAOtQ,EAAQG,EAASvZ,IAInDgoB,EAAgBY,EAAaQ,GAAUlqB,KAAKoX,UAAUhG,OAAOoZ,GAAO,GAAOtQ,IAE7EoQ,EAAO9Q,YAAc,SAASgR,OAIzBpT,EAAUpX,KAAKoX,iBACZA,EAAUA,EAAQhG,OAAOoZ,GAAO,GAAQA,GAEhDF,EAAOG,QAAU,SAASC,EAAStiB,IACjC0gB,EAAgBY,EAAaQ,GAAUpqB,WAASsR,OAAOsZ,GAAUtiB,IAGnEkiB,EAAOK,UAAY,mBACdrQ,EAAOra,UACHe,EAAI,EAAGA,EAAIsZ,EAAKrZ,OAAQD,KAC9B8nB,EAAgBY,EAAaQ,GAAUpqB,WAASsR,OAAOkJ,EAAKtZ,IAAK,OAG7DspB,ICjIR,IAAMjrB,SAASwJ,MAAMxJ,OACfS,WAAWT,SAAOS,oBAEf2X,OAAO,OAAQ,CAAC,UAAW,CACnCuB,UAAU,EACV0B,oBAAWnT,EAAM2S,EAAQG,EAASvZ,EAAQ8pB,OACrCpnB,EAAMxD,KAAKoX,UAAUhG,OAAO7J,GAAM,GACtCqjB,IAAOpnB,IAAIA,GACTqnB,SAAS,QACTC,GAAG,SAAS1d,GACZ8M,EAAO9M,KAEP2d,KAAK,SAAStiB,GACd4R,EAAQ5R,KAERuiB,UCfJ,IAAM3rB,SAASwJ,MAAMxJ,OACfS,WAAWT,SAAOS,oBAKf2X,OAAO,SAAU,CACzBuB,UAAU,EACV0B,WAAY,SAAS4N,EAAKpO,EAAQG,EAASvZ,EAAQ8pB,OAC9ChqB,EAAQ0nB,EAAI5nB,QAAQ,WACX,GAAVE,OAICyiB,EAAaiF,EAAI3nB,UAAU,EAAGC,GAC9BmF,EAAMuiB,EAAI3nB,UAAUC,EAAQ,QAC3BwW,UAAUI,QAAQ,CAACzR,GAAM,SAASsY,EAAK6J,GAC3C/oB,OAAOkkB,GAAchF,EACrBnE,EAAOmE,UAPPhE,EAAQ,mBCXX,IAAMhb,SAASwJ,MAAMxJ,OACfS,WAAWT,SAAOS,oBAIf2X,OAAO,WAAY,CAC3BiD,oBAAW4N,EAAKpO,EAAQG,EAASvZ,OAC5BF,EAAQ0nB,EAAI5nB,QAAQ,WACX,GAAVE,OAMCwE,EAFAie,EAAaiF,EAAI3nB,UAAU,EAAGC,GAC9BqqB,EAAU3C,EAAI3nB,UAAUC,EAAQ,UAGnCwE,EAAOtF,WAASsO,YAAY6c,IACxBnrB,WAAS6E,QAAQS,eACpBiV,EAAQ,qBAAuB4Q,GAG/B,MAAM5hB,eACPgR,EAAQ,cAAgB4Q,QAGpB7T,UAAUI,QAAQ,CACtB,EAAC,GAAO+C,OAAOnV,GAAOie,GACpB,SAASd,EAAOlE,EAAK6J,GACvBhO,EAAOmE,KACLlL,KAAK,CACPuL,UAAU,SArBVrE,EAAQ,mBCTX,IAAMhb,SAASwJ,MAAMxJ,OACfS,WAAWT,SAAOS,oBAKf2X,OAAO,OAAQ,CAAC,UAAW,CACnCuB,UAAU,EACV0B,oBAAWnT,EAAM2S,EAAQG,EAASvZ,EAAQ8pB,OACrCpnB,EAAMxD,KAAKoX,UAAUhG,OAAO7J,GAAM,GACtCqjB,IAAOpnB,IAAIA,GACTqnB,SAAS,QACTC,GAAG,SAASI,GACZhR,EAAOgR,KAEPH,KAAK,SAAStiB,GACd4R,EAAQ5R,KAERuiB,UClBJ,IAAM3rB,SAASwJ,MAAMxJ,OACfS,WAAWT,SAAOS,SAEpBqrB,QAAU,CAAC,iBAAkB,oBAAqB,sBAQtD,SAASC,YAAY/c,YAKXgd,EAAK7mB,EAAK8mB,EAASC,eACPrsB,IAAjBsF,EAAI8mB,GACCC,EAEA/mB,EAAI8mB,YAIJE,EAAQhnB,EAAK8mB,EAASG,MAC3BjnB,EAAI8mB,OACF,IAAIxmB,KAAKN,EAAI8mB,GAAU,KACtBrf,EAAQzH,EAAI8mB,GAASxmB,GACtBmH,MAAAA,IAGHwf,EAAM3mB,GAAKmH,QAIV4T,EAAOwL,EAtBVhd,EADGA,GACM,GAsBc,MAAO,IAC9Bqd,EAAUL,EAAKhd,EAAQ,SAAU,OACjCsd,EAAU,GACVC,EAAW,oBACU,kBAErBC,EAASR,EAAKhd,EAAQ,SAAS,GAC/Byd,EAAaT,EAAKhd,EAAQ,aAAa,GACvC0d,EAAcV,EAAKhd,EAAQ,aAAc,QACtC2d,EAAW3d,EAAO4d,QACtBT,EAAQnd,EAAQ,SAAUsd,GAC1BH,EAAQnd,EAAQ,UAAWud,OAEvBM,EAAa7d,EAAOyc,GACpBqB,EAAe9d,EAAO0c,KACtBqB,EAAsB/d,EAAOge,YAC7BC,EAAyBje,EAAOke,eAChCC,EAAmBne,EAAOoe,SAC1BC,EAAsBre,EAAOse,YAC7BC,EAAoBve,EAAOwe,UAE3BC,EAAkBze,EAAOye,iBAAmB1B,YAAY0B,gBACxDC,EAAoB1e,EAAO0e,mBAAqB3B,YAAY2B,kBAC5DC,EAAsB3e,EAAO2e,qBAAuB5B,YAAY4B,6BAwB3DC,cAIMC,OACV7e,EAAS,CACZ7K,IAAKqc,EACL1W,OAAQuiB,EAAQyB,cAChB3c,OAAQmb,EACRyB,QAASxB,EACTyB,WAAYtB,EACZ9I,MAAO4I,EACPyB,UAAWxB,EACXG,QAASD,GAEVc,EAAgBze,EAAQ,qBAoBGA,EAAQ6e,OAC/BK,EAgEAC,KA/DDnf,EAAOif,UAAW,KAChBG,EAAW,IAAIC,aACf,IAAI5oB,KAAKuJ,EAAOmC,OAAQ,KACvBvE,EAAQoC,EAAOmC,OAAO1L,GACvBhF,WAAS6E,QAAQsH,GACnBwhB,EAASE,OAAO7oB,EAAGhF,WAAS2P,cAAcxD,IAE1CwhB,EAASE,OAAO7oB,EAAGmH,GAIrBshB,EAAOE,MACD,KAEF,IAAI3oB,KADRyoB,EAAO,GACMlf,EAAOmC,OAAQ,KACvBvE,EAAQoC,EAAOmC,OAAO1L,GACvBmH,MAAAA,IAGgB,UAAhB/C,QAAO+C,KACTA,EAAQnM,WAAS2P,cAAcxD,IAEhCshB,GAAQ,IAAM7G,mBAAmB5hB,GAAK,IAAM4hB,mBAAmBza,IAE1C,QAAjBoC,EAAOlF,QAAqC,OAAjBkF,EAAOlF,SACnCkF,EAAO7K,IAAInB,YAAY,KAAO,GAAmB,EAAdkrB,EAAKtsB,SAC1CoN,EAAO7K,KAAO,KAEf6K,EAAO7K,KAAO+pB,EACdlf,EAAO7K,IAAM6K,EAAO7K,IAAIoC,QAAQ,KAAM,KACtC2nB,EAAO,MAITL,EAAIU,KAAKvf,EAAOlF,OAAQkF,EAAO7K,IAAK6K,EAAO4U,OACtB,QAAjB5U,EAAOlF,QAAqC,OAAjBkF,EAAOlF,QAAqBkF,EAAOif,WAAcjf,EAAO+e,QAAQ9gB,eAAe,iBAE7G4gB,EAAIW,iBAAiB,eAAgB,uDAElC,IAAIC,KAAUzf,EAAO+e,QACxBF,EAAIW,iBAAiBC,EAAQzf,EAAO+e,QAAQU,IAGZ,mBAAvB1B,IACTc,EAAIa,OAAOC,YAAc5B,GAGU,mBAA1BE,IACTY,EAAIa,OAAOE,WAAa3B,GAGK,mBAApBE,IACTU,EAAIa,OAAO7T,OAASsS,GAGY,mBAAvBE,IACTQ,EAAIa,OAAO1T,QAAUqS,GAGS,mBAArBE,IACTM,EAAIa,OAAOG,UAAYtB,OAIpBuB,GAAY,EACb9f,EAAO4d,UACTuB,EAAepa,WAAW,WACzB+a,GAAY,EACZjB,EAAIkB,QACJzJ,aAAa6I,IACXnf,EAAO4d,UAGXiB,EAAImB,mBAAqB,SAASzK,OAC7B0K,KACkB,IAAnBpB,EAAI9X,cAEM,KADZkZ,EAASpB,EAAIoB,QAAU,IACJA,EAAS,MAAQA,EAAQ,KACvC7lB,EAAM,IAAInJ,MAAM+O,EAAO7K,IAAM,iBAAmB8qB,GACpD7lB,EAAIykB,IAAMA,EACVqB,EAAsBlgB,EAAQ6e,EAAKzkB,OAC7B,KACFzF,KACqB,SAAtBqL,EAAOgf,eAERrqB,EAASlD,WAASsO,YAAY8e,EAAIsB,cACjC,MAAMnlB,eACPklB,EAAsBlgB,EAAQ6e,EAAK,IAAI5tB,MAAM,oBAAsB+J,GAAI,wBAGzC,SAAtBgF,EAAOgf,aAChBrqB,EAASkqB,EAAIsB,cAEdzB,EAAkB/pB,EAAQqL,EAAQ,SAASrL,GAClB,mBAAdkpB,GACTA,EAAWlpB,EAAQkqB,IAElBA,WAIDM,GAAgBW,EAAW,KACzB1lB,EAAM,IAAInJ,MAAM+O,EAAO7K,IAAM,oBAAsB8qB,GACvD7lB,EAAIykB,IAAMA,EACVqB,EAAsBlgB,EAAQ6e,EAAKzkB,KAItCykB,EAAIuB,KAAKlB,GAjIRmB,CAAmBrgB,EAAQ6e,IACzBA,GAhBHyB,gBAtBIzB,EAAKlsB,EAAG4tB,KACiB,oBAAnBC,sBACF,IAAIA,eACL,GAA4B,oBAAlBC,kBACZ9tB,EAAI,EAAGA,EAAI,EAAGA,GAAK,EAAG,CACzB4tB,EAASzD,QAAQnqB,OAEhBksB,EAAM,IAAI4B,cAAcF,GACvB,MAAMvlB,GACPJ,QAAQO,KAAKH,MAGX6jB,EAAK,CACP/B,QAAU,CAACyD,iBAKP1B,EAID6B,aAmBER,EAAsBlgB,EAAQ6e,EAAKzkB,EAAKumB,GAChDhC,EAAoB3e,EAAQ,SAASrL,IACtB,IAAXA,QAA+B9D,IAAX8D,EAKU,mBAAhBmpB,EAChBA,EAAa1jB,GAEbQ,QAAQM,MAAMd,GAPU,mBAAdyjB,GACTA,EAAWlpB,EAAQkqB,IAQnBA,EAAK8B,SAoHQ,CAChB1B,mBAAUA,UACTxB,EAAawB,EACNttB,MAERqsB,qBAAYA,UACXD,EAAsBC,EACfrsB,MAERusB,wBAAeA,UACdD,EAAyBC,EAClBvsB,MAERysB,kBAASrkB,UACRokB,EAAmBpkB,EACZpI,MAER2sB,qBAAYvkB,UACXskB,EAAsBtkB,EACfpI,MAER6sB,mBAAUA,UACTD,EAAoBC,EACb7sB,MAERwD,aAAIyrB,UACHpP,EAAOoP,EACAjvB,MAERmJ,gBAAO+lB,UACNxD,EAAUwD,EACHlvB,MAERisB,iBAAQA,UACPD,EAAWC,EACJjsB,MAERijB,eAAMkM,UACLtD,EAASsD,EACFnvB,MAERwQ,gBAAO4e,MACHA,MACE,IAAItqB,KAAKsqB,EAAW,KACnBnjB,EAAQmjB,EAAUtqB,GACnBmH,MAAAA,IAGH0f,EAAQ7mB,GAAKmH,UAGRjM,MAERotB,iBAAQiC,MACJA,MACE,IAAIvqB,KAAKuqB,EACZzD,EAAS9mB,GAAKuqB,EAAWvqB,UAGpB9E,MAERqtB,oBAAWtB,UACH/rB,KAAK6qB,SAASkB,IAEtBlB,kBAASwC,MACU,SAAfA,GAAwC,SAAfA,OACrB,sBAAwBA,SAE/BtB,EAAcsB,EACPrtB,MAER8qB,YAAG1iB,UACF8jB,EAAa9jB,EACNpI,MAER+qB,cAAK3iB,UACJ+jB,EAAe/jB,EACRpI,MAER8sB,yBAAgB1kB,UACf0kB,EAAkB1kB,EACXpI,MAER+sB,2BAAkB3kB,UACjB2kB,EAAoB3kB,EACbpI,MAERgtB,6BAAoB5kB,UACnB4kB,EAAsB5kB,EACfpI,MAERgrB,oBAEEiC,IACC,MAAM5jB,GACmB,mBAAhB8iB,EACTA,EAAa9iB,GAEbJ,QAAQM,MAAMF,MASnB+hB,YAAY0B,gBAAkB,SAASze,EAAQjG,EAAU8kB,GACxD9kB,KAMDgjB,YAAY2B,kBAAoB,SAAS/pB,EAAQqL,EAAQjG,EAAU8kB,GAClE9kB,EAASpF,IAMVooB,YAAY4B,oBAAsB,SAAS3e,EAAQjG,EAAU8kB,EAAKoC,GACjElnB,OAASlJ,IAGVC,OAAOowB,iBAAmBnE,uBAEjB3T,OAAO,SAAU,GAAI,kBACtB2T,cCtWR,IAAM/rB,SAASwJ,MAAMxJ,OACfS,WAAWT,SAAOS,oBAEf2X,OAAO,YAAa,CAAC,UAAW,SAASmT,UASjC,SAASvc,GACxBA,EAASvO,WAASwO,OAAO,CACxBkC,YAAQtR,EACRkuB,aAASluB,EACTiK,YAAQjK,EACRsE,SAAKtE,EACLkJ,cAAUlJ,GACRmP,OACCmhB,GAAc,EACdC,EAAiB,CAAC,SAAS/tB,UACvBA,WAEL2M,EAAOjG,UACTqnB,EAAe1sB,KAAKsL,EAAOjG,UAE5BqnB,EAAernB,SAAW,SAAS1G,GAClC8tB,GAAc,MACV,IAAIxuB,EAAI,EAAGA,EAAIhB,KAAKiB,OAAQD,IAAK,KAG1B,KADVU,GAAK0G,EADUpI,KAAKgB,IACNU,aAOhB2M,EAAOyc,GAAK,SAASppB,GACpB+tB,EAAernB,SAAS1G,IAEzB2M,EAAO0c,KAAO,SAAStiB,GACtBgnB,EAAernB,SAAS,CACvBsnB,MAAO,EACPC,KAAMlnB,KAGR4F,EAAO4U,OAAQ,EAcf2H,EAAKvc,GAAQ2c,gBAZJ4E,UACK,CACZzc,KAAM,SAAS/K,MACXonB,QACI,IAAIlwB,MAAM,6BAEjBmwB,EAAe1sB,KAAKqF,GACbwnB,MAMHA,MC9DT,IAAMvwB,SAASwJ,MAAMxJ,OACfS,WAAWT,SAAOS,SAoLjB0S,GAEAqd,GACAC,GACAC,GACAC,GAvLP,QAIUC,QAAT,SAAiBra,UACTsa,cAOCC,WAAT,oBACUC,EAAQC,SACL,CACVA,QAASA,EACT5d,KAAM,KACN6d,IAAK,UAIHrvB,EAAS,EACTsvB,EAAWH,IACdI,EAAWD,WAyCHE,EAAWC,EAAUC,MACd,GAAZD,GAAiBA,EAAWzvB,WAE1B2vB,EAAQL,EACNG,KACLE,EAAQA,EAAMne,QAGZme,EAAMne,KAAM,KACVoe,EAAcD,EAAMne,QACrBke,EAAY,KACVG,EAAkBD,EAAYpe,KAC/Bqe,GACFA,EAAgBR,IAAMM,GAChBne,KAAOqe,GAEbF,EAAMne,KAAO,KACb+d,EAAWI,GAEZ3vB,WAEM4vB,EAAYR,oBAzDjB1C,OAAS,SAAS0C,OAClBU,EAAUX,EAAQC,IAEtBG,EAAS/d,KAAOse,GACRT,IAAME,EACdA,EAAWO,EACX9vB,UAII+vB,OAAS,SAASN,EAAUL,MACjB,GAAZK,GAAiBA,GAAYzvB,EAAQ,SAEnCmC,EAAOgtB,EAAQC,GACfO,EAAQL,EACNG,KACLE,EAAQA,EAAMne,YAGZme,EAAMne,QACRme,EAAMne,KAAK6d,IAAMltB,GACZqP,KAAOme,EAAMne,OAEnBme,EAAMne,KAAOrP,GACRktB,IAAMM,EACX3vB,KACO,SAEA,QAIJgwB,UAAY,SAASP,UAClBD,EAAWC,SAoCdQ,cAAgB,SAAS9oB,WACzBwoB,EAAQL,EAAS9d,KACfme,GAAO,KACRC,EAAcD,KACfxoB,EAASyoB,GAAc,KACrBC,EAAkBD,EAAYpe,KAC/Bqe,GACFA,EAAgBR,IAAMM,GAChBne,KAAOqe,GAEbF,EAAMne,KAAO,KACb+d,EAAWI,GAEZ3vB,IACA2vB,EAAQE,OAERF,EAAQA,EAAMne,YAMZ0e,SAAW,SAAST,UACjBD,EAAWC,GAAU,SAOxB9tB,IAAM,SAASwF,UACZpI,KAAKmxB,SAAS,SAOjBzwB,QAAU,SAAS2vB,WACnBO,EAAQL,EAAS9d,KACjB7R,EAAQ,EACNgwB,GAAO,IACS,mBAAXP,MACNA,EAAQO,EAAMP,gBACTzvB,OAEF,GAAGgwB,EAAMP,UAAYA,SACpBzvB,EAERA,IACAgwB,EAAQA,EAAMne,YAEP,QAGJ2e,KAAO,SAASf,OAChBzvB,EAAQZ,KAAKU,QAAQ2vB,UACT,GAATzvB,EAAaZ,KAAKixB,UAAUrwB,QAAS1B,QAIxCmyB,OAAS,SAAShB,OAClBzvB,EAAQZ,KAAKU,QAAQ2vB,UAClBrwB,KAAKmxB,SAASvwB,SAKjB0wB,QAAU,kBACI,IAAXrwB,QAIHswB,KAAO,kBACJtwB,IA1KLivB,cAAe,EACfsB,IAAM,CAMVA,WAAiB,kBACT,IAAIrB,gBAuKThxB,OAAO4V,iBAAkB,KA6PlB0c,kBAAT,SAA2BC,EAAKzd,EAAQ0d,EAAkBC,EAAUC,EAAUC,OAUzEC,EATAC,EAAW,IAAI7B,WAEf8B,EAAU,IACbC,EAAQ,IACLC,GAAc,EACjBC,EAAe,EACZC,GAAa,EAEbjpB,EAAOpJ,cAkBFsyB,EAAUC,EAASC,GAC3BppB,EAAKqpB,oBAAoBvtB,KAAKkE,EAAMopB,GACpCL,GAAc,EACdO,aAGQC,EAAOH,EAAMI,OAEpBxpB,EAAKypB,kBAAkB3tB,KAAKkE,EAAMopB,GACjC,MAAMnpB,GACPJ,QAAQO,KAAKH,GAEdypB,kBAAkBC,aAAa,CAC9BnlB,GAAIglB,GACFb,YAGKiB,EAAYR,GACpBR,EAASX,OAAO,SAAS3nB,UACjBA,EAAKkE,GAAK4kB,EAAK5kB,KAEvB8kB,aAGQO,EAAQrd,GACL,UAARA,IACFyc,GAAa,EACbppB,QAAQM,MAAM,2CAA6CmoB,EAAM,YAAcpwB,SAASC,MACxFqwB,EAAS,sBAIFsB,IACRnB,EAAWe,kBAAkBK,OAAOzB,EAAKI,EAAUH,EAAkB1d,EAAQ4d,EAAUS,EAAWK,EAAQK,EAAaC,YAG/GP,OACLP,UACEiB,EACGA,EAAMpB,EAASpvB,OACrBkwB,kBAAkBrE,KAAK2E,EAAIZ,KAAMT,EAAUqB,EAAIxlB,aAKzCkM,IACLqY,GAA8BF,EAAfG,GAA0BC,EACvCF,GAAgBE,GACnBT,EAAS,YAIXkB,kBAAkBO,SAAStB,GAC3BK,IACAU,kBAAkBQ,SAASpB,EAAOpY,SArE9B2Y,oBAAsB,UACtBI,kBAAoB,UACpBpE,KAAO,SAAS+D,OAChBY,EAAM,CACTxlB,GAAI9N,WAAS4N,SACb8kB,KAAMA,GAEPR,EAASrE,OAAOyF,GAChBV,UAGIjE,KAAK8E,QAAU,WACnBT,kBAAkBzB,OAAOU,IA2DvB9d,GACFif,IACApZ,KACU+X,GACVqB,SAGIM,UAAY,SAASjB,IACzBte,EAASse,KAERW,IACApZ,OAaM2Z,eAAT,SAAwBC,EAAkBrlB,EAAQslB,OA0B7CC,EATAlC,GAhBJrjB,EAASvO,WAASmS,WAAW,CAC5Byf,IAAK,cACLmC,SAAU,KACVC,UAAW,KACXhC,SAAU,KACVH,iBAAkB,SAAS1d,EAAQ8f,EAAQjC,EAAU1pB,GAEpDA,EADW9G,SAASM,SAAW,KAAON,SAASS,MAC9BgyB,EAAQ,YAE1BnC,SAAU,SAASoC,GACJ,WAAXA,GACF/qB,QAAQO,KAAK,2BAA6B6E,EAAOqjB,IAAM,YAAcpwB,SAASC,QAG9E8M,IAEcqjB,IACbuC,EAAoB5lB,EAAOylB,UAC3BI,EAAkB7lB,EAAOwlB,SACzB/B,EAAWzjB,EAAOyjB,SAClBF,EAAWvjB,EAAOujB,SAElBC,GAAY8B,EACZhC,EAAmBtjB,EAAOsjB,wBAI7BiC,EAAO,IAAInC,kBAAkBC,EADA,mBAApBgC,EACyB,KAEAA,EAFM/B,EAAkBC,EAAUC,EAAUC,IAK/EmC,EAAoBA,GAAqB,SAASE,EAAQrC,GACzD7oB,QAAQK,KAAKuoB,EAAW,SAAW,IAAM,cAAgBH,OAGzDkC,EAAKnB,oBAAsB,SAASX,OAElCmC,EAAkBj0B,KAAKyuB,KAAMqD,GAC5B,MAAMzoB,GACPJ,QAAQM,MAAMF,MAId6qB,IACFN,EAAKf,kBAAoB,SAASL,OAEhC0B,EAAgB1B,EAAMxyB,KAAKyuB,MAC1B,MAAMplB,GACPJ,QAAQM,MAAMF,MAIa,mBAApBqqB,GACTA,EAAiB,SAASU,GACzBR,EAAKJ,UAAUY,KAIVR,EAAKnF,MAGJ4F,eAAT,SAAwBC,EAAQjmB,OAC3B+lB,SAGHA,EAFmB,iBAAVE,EAEA,SAASlsB,GACjBksB,EAAOpa,OAAS,WACf9R,EAASpI,KAAKu0B,iBAIPD,EAAOC,cAEVd,eAAeW,EAAQ/lB,IAlb3BykB,mBACCtgB,GAAS,GAETqd,GAAc,GACdC,GAAkB,GAClBC,GAAkB,GAClBC,GAAiB,GAGrBxd,GAAO2gB,OAAS,SAASzB,EAAKI,EAAUH,EAAkB1d,EAAQ4d,EAAUS,EAAWK,EAAQK,EAAaC,OAEvGY,EAAW,CACdnC,IAAKA,EACLY,UAAWA,EACXK,OAAQA,EACRK,YAAaA,EACbC,QAASA,EACTnB,SAAUA,EACV0C,QAASvgB,EACTwgB,OAAQ5C,EACRF,iBAAkBA,EAClB/jB,GAAI9N,WAAS4N,SACbgnB,QAAS,IAGN5E,GAAgB4B,KACnB5B,GAAgB4B,GAAO,IAExB5B,GAAgB4B,GAAK3uB,KAAK8wB,OAEtBc,EAAad,EAASjmB,UAC1BiiB,GAAY8E,GAAcd,EACnBc,GAGRniB,GAAO6e,OAAS,SAASsD,KAsBzBniB,GAAOic,KAAO,SAAS+D,EAAMmC,EAAY/B,OACpCiB,EAAWhE,GAAY8E,GAC3BC,GAAU,MAAOf,EAASnC,IAAKmC,EAASW,QAAShC,EAAMmC,EAAY/B,IAGpEpgB,GAAO6gB,SAAW,SAASsB,OACtBd,EAAWhE,GAAY8E,GAC3BC,GAAU,OAAQf,EAASnC,IAAKmC,EAASW,QAASX,EAAS/B,SAAU6C,IAGtEniB,GAAOugB,aAAe,SAASP,EAAMmC,OAChCd,EAAWhE,GAAY8E,GAC3BC,GAAU,WAAYf,EAASnC,IAAKmC,EAASW,QAAShC,EAAMmC,IA2I7Dx1B,OAAO4V,iBAAiB,UAAW,SAAS8f,OAKvCrC,EAJDvC,QAAQ,uBACVhnB,QAAQK,IAAI,gBAAkBurB,EAAMd,OAAS,YAAczyB,SAASC,MACpE0H,QAAQK,IAAIurB,EAAMrC,WAIlBA,EAAO1yB,WAASsO,YAAYymB,EAAMrC,MACjC,MAAMnpB,GACPJ,QAAQO,KAAKH,MAEVmpB,GAAUA,EAAKd,KAAOc,EAAK5c,UAI3B8b,EAAMc,EAAKd,IACXoD,EAActC,EAAK5kB,GACnBmnB,EAAQvC,EAAKA,KACb5c,EAAO4c,EAAK5c,KACZgd,EAAQJ,EAAKI,MAEN,QAARhd,WA7JgB8b,EAAKsD,EAAYC,EAAWzC,EAAMsC,OAClD9E,GAAe8E,QAIdI,EAAYpF,GAAgB4B,MAC5BwD,MA6BA,IAAIl0B,EAAI,EAAGA,EAAIk0B,EAAUj0B,OAAQD,IAAK,KACrC6yB,EAAWqB,EAAUl0B,GACrB6yB,EAASa,QAAQI,IACpBjB,EAASlC,iBAAiBqD,EAAYC,EAAWzC,EAAM2C,EAAStB,EAASjmB,eA5BlEunB,EAASR,UAEV,SAASS,EAAUhC,MACrBgC,KAKDpF,GAAe8E,GACjB7rB,QAAQO,KAAK,sBAAwBkoB,EAAM,YAAcpwB,SAASC,WAC5D,GAAGwuB,GAAgB4E,GACzB1rB,QAAQO,KAAK,qBAAuBkoB,EAAM,YAAcpwB,SAASC,MACjEqzB,GAAU,SAAUlD,EAAKsD,EAAYF,OAC/B,CACN9E,GAAe8E,GAAeH,EAC9B5E,GAAgB4E,IAAc,MAC1Bd,EAAWhE,GAAY8E,GAC3Bd,EAASW,QAAUQ,EACnBnB,EAASE,OAASkB,EAClBL,GAAU,SAAUlD,EAAKsD,EAAYnB,EAAS/B,SAAU6C,EAAYG,QAfrDjF,GAAY8E,GAClBD,QAAQI,IAAe,IA+IlCO,CAAW3D,EAAKmD,EAAM5gB,OAAQ4gB,EAAMd,OAAQgB,EAAOD,GAClC,UAARlf,WApHW8b,EAAKsD,EAAYC,EAAWzC,EAAMsC,EAAaQ,OAChEJ,EAAYpF,GAAgB4B,MAC5BwD,MA+BA,IAAIl0B,EAAI,EAAGA,EAAIk0B,EAAUj0B,OAAQD,IAAK,KACrC6yB,EAAWqB,EAAUl0B,GACtB6yB,EAASjmB,IAAM0nB,GAAgBzB,EAASa,QAAQI,IAClDjB,EAASlC,iBAAiBqD,EAAYC,EAAWzC,EAAM2C,EAAStB,EAASjmB,cA9BlEunB,EAASR,UAEV,SAASS,EAAUhC,MACrBgC,KAKDpF,GAAe8E,GACjB7rB,QAAQO,KAAK,gBAAkBkoB,EAAM,YAAcpwB,SAASC,WACtD,GAAGwuB,GAAgB4E,GACzB1rB,QAAQO,KAAK,qBAAuBkoB,EAAM,YAAcpwB,SAASC,MACjEqzB,GAAU,SAAUlD,EAAKsD,EAAYF,OAC/B,CACN9E,GAAe8E,GAAeH,EAC9B5E,GAAgB4E,IAAc,MAE1Bd,EAAWhE,GAAY8E,GAC3Bd,EAASW,QAAUQ,EACnBnB,EAASE,OAASkB,EAClBL,GAAU,SAAUlD,EAAKsD,EAAYnB,EAAS/B,SAAU6C,GACxDd,EAASvB,UAAU0C,EAAYxC,QAjBhB3C,GAAY8E,GAClBD,QAAQI,IAAe,IA0GlCS,CAAa7D,EAAKmD,EAAM5gB,OAAQ4gB,EAAMd,OAAQgB,EAAOD,EAAalC,GACjD,UAARhd,WAjEW8b,EAAKsD,EAAYC,EAAWzC,EAAMsC,OACnDH,EAAa3E,GAAe8E,GAC5BjB,EAAWhE,GAAY8E,GAC3Ba,GAAY3B,EAAUmB,EAAYC,GAElCpB,EAASvB,UAAUuB,EAASW,QAAShC,GA6DpCiD,CAAa/D,EAAKmD,EAAM5gB,OAAQ4gB,EAAMd,OAAQgB,EAAOD,GACpC,OAARlf,WA3DQ8b,EAAKsD,EAAYC,EAAWzC,EAAMsC,EAAalC,OAC7D+B,EAAa3E,GAAe8E,GAC5BjB,EAAWhE,GAAY8E,GAC3Ba,GAAY3B,EAAUmB,EAAYC,GAElCpB,EAASlB,OAAOH,EAAMI,GAuDrB8C,CAAUhE,EAAKmD,EAAM5gB,OAAQ4gB,EAAMd,OAAQgB,EAAOD,EAAalC,GAC9C,YAARhd,WArDa8b,EAAKsD,EAAYC,EAAWzC,EAAMsC,OACrDH,EAAa3E,GAAe8E,GAC5BjB,EAAWhE,GAAY8E,GAC3Ba,GAAY3B,EAAUmB,EAAYC,GAElCpB,EAASb,YAAYR,GAiDpBmD,CAAejE,EAAKmD,EAAM5gB,OAAQ4gB,EAAMd,OAAQgB,EAAOD,GACtC,UAARlf,YAnFW8b,EAAKsD,EAAYC,EAAWK,GAClCzF,GAAYyF,GAClBrC,QAAQ,UAkFhB2C,CAAalE,EAAKmD,EAAM5gB,OAAQ4gB,EAAMd,OAAQgB,MAKhDviB,GAAO8gB,SAAW,SAASuC,EAAMztB,GAChCgL,WAAWhL,EAAUytB,IAGfrjB,IAsGJsjB,UAAYtE,IA6FhBsE,UAAUC,cAAgB,SAASzB,EAAQjmB,UACnCgmB,eAAeC,EAAQjmB,IAQ/BynB,UAAUE,cAAgB,SAAS3nB,UAC3BolB,eAAet0B,OAAO0e,OAAQxP,IAQtCynB,UAAUG,WAAa,SAAS5nB,UACxBolB,eAAet0B,OAAO+2B,IAAK7nB,IAQnCynB,UAAUK,cAAgB,SAAS9nB,UAC3BolB,eAAet0B,OAAOi3B,OAAQ/nB,IAQtCynB,UAAUO,cAAgB,SAAShoB,UAC3BolB,eAAe,KAAMplB,GAAQ,IAGrCynB,UAAUQ,MAAQ,SAASrG,GAC1BC,aAAeD,GAkBhBnwB,WAAS2X,OAAO,QAASqe,WAG1Bh2B,WAAS2X,OAAO,eAAgB,kBACxB0Y,aAEP,MAAM9mB,GACPJ,QAAQM,MAAMF,YA7VHmsB,GAAY3B,EAAUmB,EAAYC,MACvCpB,EAASW,SAAWQ,GAAcnB,EAASE,QAAUkB,QACvDhsB,QAAQO,KAAK,YAAcqqB,EAASE,OAAS,QAAUkB,GACjD,IAAI31B,MAAM,4BA4BTs1B,GAAUhf,EAAM8b,EAAKzd,EAAQue,EAAMmC,EAAY/B,OACnDQ,EAAM,CACTxd,KAAMA,EACN4c,KAAMA,EACNd,IAAKA,EACL9jB,GAAI+mB,EACJ/B,MAAOA,GAGL3C,QAAQ,uBACVhnB,QAAQK,IAAI,aAAehI,SAASC,MACpC0H,QAAQK,IAAI8pB,IAEbnf,EAAOsiB,YAAYz2B,WAAS2P,cAAc2jB,GAAM,KC/XpD,IAAM/zB,SAASwJ,MAAMxJ,OACfS,WAAWT,SAAOS,SAElB8qB,KAAOvrB,SAAOkwB,iBACdiH,UAAY,YACjBC,WAAa,qBACRC,WAAa,aAClBC,YAAc,sBACTC,UAAY,YACjBC,WAAa,qBACRC,eAAiB,iBAEnBC,iBACAC,SAAWl3B,WAASuG,SAAS/C,aAAakzB,YAAc12B,WAASuG,SAAS/C,aAAamzB,YACvFQ,SAAWn3B,WAASuG,SAAS/C,aAAaszB,YAAc92B,WAASuG,SAAS/C,aAAauzB,YACvFK,aAAep3B,WAASuG,SAAS/C,aAAawzB,gBAC9B,SAAjBI,cAA2C,MAAhBA,eAC7BA,aAAe,QAGhB,IAAIC,QAAU,oBACJC,EAAYt2B,OAChBu2B,EAAWv2B,EAAOw2B,KAAKC,QAAQryB,KAAKpE,EAAQm2B,UAC5C12B,EAAOe,SAASykB,SAEhBnlB,EAAQL,EAAK8B,YAAY,KACzBkF,EAAOhH,EAAKI,UAAUC,EAAQ,SACtB,KAAT2G,IACFA,EAAO,SAELzH,WAASoB,SAASqG,EAAM,WAC1BA,EAAOA,EAAK5G,UAAU,EAAG4G,EAAKtG,OAAS,IAKxCo2B,GAFCA,EADGA,GACQ,oBAEQzxB,QAAQ,SAAU2B,YAsC9BiwB,EAAkBC,EAAKj0B,EAAK4E,EAAUsvB,GAC9C9M,KAAK,CACJpnB,IAAKA,EACL2F,OAAQ,MACR8iB,QAAS,IACToB,WAAY,OACZvC,YAAG6M,OAEEC,GAcJA,WAxDmB92B,UACrBA,EAAShB,WAASmS,WAAW,CAC5BnO,WAAY,GACZwzB,KAAM,CACLC,0BACQN,UAAY,oBAEpB1vB,KAAM,OACNswB,eAAgB,UAChBC,gBAAiB,UACjB5V,gBAAO3a,GACN0B,QAAQK,IAAI,UAAY/B,IAEzBwwB,eAAMxwB,GACL0B,QAAQK,IAAI,SAAW/B,KAGzBywB,QAAS,CACRC,WAAW,EACXC,QAAS,IAEVC,sBAAaC,SACL,WAERtS,OAAQ,SACI,CACVK,aAAa,KAGbrlB,GA2BMu3B,CAZNT,EADkB,MAAhBV,aACKp3B,WAASmO,OAAO0pB,GACE,QAAhBT,aACFp3B,WAASsO,YAAYupB,GAEzB73B,WAAS0F,WAAWhC,EAAKlC,SAASM,SAAW,KAAON,SAASS,KAAO,KAE/DjC,WAASmO,OAAO0pB,GAEhB73B,WAASsO,YAAYupB,KAKtBW,sBACPV,EAAKU,uBAENV,EAAO93B,WAASiS,eAAe6lB,EAAMA,EAAK9zB,YAEvC4zB,GAAWE,EAAKI,QAAQC,UAC1BT,EAAkB,gBAAiBI,EAAKI,QAAQO,QAC/C,SAASC,OAKJC,EAAUpB,EAAUqB,EAGpBd,EACA9R,EARAsS,EAAcR,EAClBv4B,SAAOm5B,EAAalB,MAAQkB,EAAalB,KAAKO,gBAAkBO,EAAYd,KAAKO,gBAAkBO,EAQlF,OAHjBM,GAJAr5B,SAAOm5B,EAAalB,MAAQkB,EAAalB,KAAKQ,iBAAmBM,EAAYd,KAAKQ,iBAAmBU,GAI3EL,aAAajzB,KAAKszB,EAAcJ,MAIzDK,EAAWD,EAAalB,KAAK/vB,KAC7B8vB,EAAWxuB,MAAM7G,oBAAoBV,SAASC,KAAM61B,EAAYoB,IAChE1S,EAAS0S,EAAa1S,OAAO4S,GAC7Bd,EAAOY,GAGJ1S,IACH4S,EAAaN,EAAYD,aAAajzB,KAAKkzB,EAAa,MACxDK,EAAWL,EAAYd,KAAK/vB,KAC5B8vB,EAAWxuB,MAAM7G,oBAAoBV,SAASC,KAAM61B,EAAYgB,IAChEtS,EAASsS,EAAYtS,OAAO4S,GAC5Bd,EAAOQ,GAGJtS,EAKJ6S,EAAaF,EAAUpB,EAAUvR,EAAQ8R,EAAMQ,GAJ9CnvB,QAAQM,MAAM,kBAAoBmvB,KAQrCtwB,EAASwvB,IAGX7M,cAAKtiB,GACJQ,QAAQM,MAAM,QAAUkuB,EAAM,mBAAqBj0B,EAAM,YAAciF,MAEtEuiB,gBA6BK2N,EAAaC,EAAUH,EAAUpB,EAAUvR,EAAQ8R,EAAMQ,OAC7DF,EAAU,MACdN,EAAKI,QAAQa,QAAUX,EAAQn1B,KAAK60B,EAAKI,QAAQa,QACjDT,IAAgBR,GAAQQ,EAAYJ,QAAQa,QAAUX,EAAQn1B,KAAKq1B,EAAYJ,QAAQa,QAEvFjB,EAAKI,QAAQE,SAAWzuB,MAAMG,QAAQsuB,EAASN,EAAKI,QAAQE,SAC5DE,IAAgBR,GAAQQ,EAAYJ,QAAQE,SAAWzuB,MAAMG,QAAQsuB,EAASE,EAAYJ,QAAQE,SAElGp4B,WAASggB,eAAiB,SAASN,OAC9BzB,EAAK,UACTlV,MAAMlB,KAAKuwB,EAAS,SAAS10B,GAC5Bua,EAAGhb,KAAKjD,WAASoD,eAAeM,EAAK,KAAOkjB,mBAAmBlH,OAEzDzB,GAER+H,EAAOE,kBAAmB,EAC1BF,EAAOI,eAAiBJ,EAAOI,gBAAkB,GACjDJ,EAAOG,UAAYH,EAAOG,WAAa,IACV,GAA1BoR,EAAS32B,QAAQ,KAAY,KAC3BG,EAAYf,WAASgmB,GAEzB2S,EAAW,oBACPrzB,EAAO,GACRvE,EAAUuE,OACTvE,EAAUuE,KAAK,MACjBqE,MAAMG,QAAQxE,EAAMvE,EAAUuE,KAAK,MAEjCvE,EAAUuE,KAAKqzB,IACjBhvB,MAAMG,QAAQxE,EAAMvE,EAAUuE,KAAKqzB,KAGrCrzB,EAAKrC,KAAKs0B,GACVv3B,WAAS8X,YAAY6gB,EAAUrzB,EAAM,cAElC+N,KAAK,CACPwE,OAAQihB,SAEC94B,WAAS6lB,UAAU8S,KAC7B3S,EAAOG,UAAUwS,GAAYpB,GAG7Bv3B,WAASgmB,GAGVA,EAAOI,eAAeuS,GAAY,SAAS9Q,EAAgBmR,EAAYC,GACnEj5B,WAAS4E,WAAWkzB,EAAKN,KAAKpV,SAChC0V,EAAKN,KAAKpV,OAAOhd,KAAK0yB,EAAMa,OAEzB7Q,EAAKD,EAAe5nB,MAAM+4B,EAAYC,UAEvCj5B,WAAS4E,WAAWkzB,EAAKN,KAAKS,QAChCH,EAAKN,KAAKS,MAAM7yB,KAAK0yB,EAAMa,GAErB7Q,GAGR9nB,WAAS0X,QAAQ,CAACihB,GAAW,SAASnB,MAAUnkB,KAAK,CACpD8O,QAAS,SAASxZ,EAAK2O,GACnBA,GACFnO,QAAQM,MAAM,6BAA8B6N,EAAQhG,UAErDnI,QAAQM,MAAM,mBAAqBd,MAItC3I,WAAS0T,qBA1FRgkB,EAAkB,QAAST,iBAAkB,SAASqB,OAGjDK,GAFJp5B,SAAO+4B,EAAYd,KAAKO,gBAAkBO,GAEfd,KAAK/vB,KAE5BhG,EAAOD,SAASC,KAChBX,EAAQW,EAAKc,YAAY,KACjB,GAATzB,IACFW,EAAOA,EAAKZ,UAAU,EAAGC,QAGtBy2B,EAAWD,EAAYgB,GAE3Bf,GAAqC,GAA1BA,EAAS32B,QAAQ,KAAamI,MAAM7G,oBAAoBT,EAAM81B,GAAYA,MACjFqB,EAAaN,EAAYD,aAAajzB,KAAKkzB,EAAa,MAExDtS,EAASsS,EAAYtS,OAAO4S,GAC5B5S,EAIJ6S,EAAap3B,EAAMk3B,EAAUpB,EAAUvR,EAAQsS,EAAaA,GAH3DnvB,QAAQM,MAAM,wBAA0BmvB,KAIvC,KAoE0B,IAG5B1B,SACFD,iBAAmBluB,MAAM7G,oBAAoBV,SAASC,KAAMy1B,WAClDA,SAAYl3B,WAASuG,SAAS/C,aAAaozB,aAAe52B,WAASuG,SAAS/C,aAAaqzB,cACnGI,iBAAmBluB,MAAM7G,oBAAoBlC,WAASwlB,YAAa0R,UAEnEG,QAAU,KAEXA,SAAWA"}